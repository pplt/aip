\documentclass[11pt]{amsart}
\input{preamble.tex}
\usepackage{caption}
\usepackage{booktabs}
\usepackage{subcaption}
\captionsetup[subfigure]{subrefformat=simple,labelformat=simple}
\renewcommand\thesubfigure{(\sc \alph{subfigure})}
\usepackage{bm}
\usepackage[
ruled,
%linesnumbered,
vlined]{algorithm2e}
\usepackage{stmaryrd}

%shortfall and deficit
\newcommand{\short}{\operatorname{short}}
\newcommand{\ushort}{\operatorname{ushort}}
\newcommand{\deficit}{\operatorname{deficit}}
\newcommand{\udeficit}{\operatorname{udeficit}}

\newcommand{\denom}{d} 
\newcommand{\fsr}{\mathcal{R}}

\renewcommand{\S}{\mathcal{S}}
\newcommand{\pp}{\mathsf{p}}
\renewcommand{\tt}{\mathsf{t}}


\newcommand{\hooklongrightarrow}{\lhook\joinrel\longrightarrow}

\newcommand{\mspec}{\operatorname{mSpec}}
\newcommand{\spec}{\operatorname{Spec}}


\begin{document}

\title[Fractal and arithmetic programs]{Fractal programs, arithmetic programs, and the Frobenius powers of monomial ideals}
\author{Daniel J.~Hern\'andez}
\author{Pedro Teixeira}
\author{Emily E.~Witt}
\maketitle

\newcommand{\CheckedBox}{\text{\rlap{$\checkmark$}}\Box}
\details[inline]{
TO DO LIST:
\begin{enumerate}
% \item[$\CheckedBox$] Decide on ``special'' or ``universal'' denominator and uniformize.
% \emily[inline]{I'm starting to like ``universal.''}
% \pedro[inline]{I replaced the last few occurrences of ``special'' with ``universal''.}
\item[$\Box$]  Look at wording in proof of \Cref{less than u: L}. 
%\item[$\CheckedBox$] Write essential statements/proofs.
%\item[$\CheckedBox$] Decide on name of paper.
%\item[$\CheckedBox$] Decide on name for minimal coordinate.
% \comment[inline]{Going with ``special point''.}
%\item[$\CheckedBox$] Make sprout notation.
%\comment[inline]{Going with $\sprout(A,\vv{u},p)$}
% \item[$\CheckedBox$] Replace any remaining instances of $d$ for dimension with {\tt \text{numvars}}, and fix any inconsistencies. 
   % \begin{itemize}
   %    \item In the discussion after the definition of Sierpinski gasket; that could be replaced with anything else ($s$, for example).
   %    \pedro[inline]{Done.}
   %    \item In the definition of least positive residue; it would be OK to leave it alone, or replace it with anything else.
   %    \pedro[inline]{Changed to $a$ and $b$.}
   %    \item $\vv{m}$ appears in the proofs of \Cref{optimal division: L,ILL: T}; again it would be OK to leave it alone, or replace it with anything else.
   %    \emily[inline]{Like $\mathfrak{m}$, I am OK using this notation; I don't think it is confusing since vectors all have the same text styling.  We use, for instance, both $\ideala$ and $\vv{a}$.}
   %    \item In \Cref{colon-product-stabilization: L} and in the proof of \Cref{monomial-noetherian-decomposition: L}. Those would need to be replaced.
   %    \emily[inline]{Done.}
   % \end{itemize}
   %It also appeared in the general discussion of optimization, but I replaced it with $n$, as our optimization problems are in $\RR^n$ and $\ZZ^n$.   
\item[$\Box$]  Brainstorm list of the desired properties we want from examples, and what section to put them in: 
\begin{itemize}
   \item Examples of algorithms (e.g., $\idealm$-primary case, general setting)
   \item Maybe introduce the $\idealm$-primary and/or homogeneous case earlier, for instance, when we talk about minimal face, universal denominator, etc.
   % \item Possibly simple picture (2D or 3D) illustrating small and very small after \Cref{geometric small and very small: R}.
   % \pedro[inline]{I included an example with a picture.}
   % \emily[inline]{Thank you!}
\end{itemize}
% \item[$\Box$] Put in examples. Remember to label $\canvec_1$, $\canvec_2$, $\canvec_3$ when appropriate. 
% \pedro[inline]{Started working on it.}
%\item[$\CheckedBox$] Rewrite statements in terms of ``shortfall.''
% \item[$\CheckedBox$] Decide how to define matrix for collapse (remove row vs. zero row), and point out no zero columns.
%\comment[inline]{Going with dropping rows.}
%\item[$\Box$] Rewrite proofs with above convention.
%\item[$\Box$] Decide on how to define $\widehat{\witt}$.  (Sprouting graph?)
 %\item[$\CheckedBox$] Fill in/rewrite preliminaries.
 %\item[$\CheckedBox$] Reorganize and motivate the $\IP$ and $\ip$, and their connection, in Sections 5 and 6.
 %\item[$\CheckedBox$] ``Fractal linear program;'' solve $P$ in ``Sierpinski gasket''
 % \item[$\Box$] Direct proof that $\delta$/$\Delta$ are independent of $\vv{s}$.
 \item[$\Box$] Minimize and/or ``algebrafy'' statements.
 %\item[$\CheckedBox$] Background section on Frobenius powers, $\mu$, $\nu$, etc.
 \item[$\Box$] Derive some easy corollaries for critical exponents and very general hypersurfaces.  State them in introduction. 
% \item[$\CheckedBox$] Generalize the definition of $\IP$ so that $\IP(A, \vv{u}q)$ becomes $\IP(A, \vv{u}, q)$?
% \comment[inline]{Changed to $\IP(A, \vv{u}, q)$}

%    \item[$\Box$] Replace ``Lemma'' with ``Proposition'', if there's no immediate application in sight.
 
 % \item[$\CheckedBox$] Add remark describing how to verify inequalities $A\vv{k} < \vv{v}$ using projections/collapse.
 % \comment[inline]{See \Cref{rmk: verifying inequalities using collapses}.}
      %\item[$\CheckedBox$] Add remark that points out that $\collapse{A\vv{k}} = \collapse{A}\vv{k}$.
      %\item[$\CheckedBox$] In Section 4, we should talk about both $\nu$'s and $F$-thresholds. We could then introduce $\IP(A,\vv{u},q)$, immediately relate its value to the $\nu$'s, and relate $\val \LP(A,\vv{u})$ to the normalized limit of $\IP(A,\vv{u},q)$, just like we do later for the fractal programs $\fip_p$ and the arithmetic programs $\IP_p$.  Most of this has already been written, and it should just be moved from Section 5.
      %\item[$\CheckedBox$] Similarly, introduce $\fip_p$ and $\IP_p$ together, and describe their connection right away.
      %\item[$\CheckedBox$] Prior to Definition 4.1, state our goal for describing $F$-thresholds and $\nu$'s.  Use this to motivate definition of monomial pair
      %%%%% Notation %%%%%

 % \item[$\CheckedBox$] Uniformize $\collapse{A(X)} = \collapse{A}(X)$, or add a statement about this.
 % \pedro[inline]{I believe this is done now (using $\collapse{A}X$).}
      % \item[$\CheckedBox$] Use $\vv{d}$ for defining points?
      % %Pro: opens up $\vv{a}$ for columns of $A$.  Con:  maybe $\collapse{\vv{d}}$ looks ugly?  Another con is $d$ is used for number of variables and $\RR^\numvars$.
      % Emily suggest using $\vv{c}$.  This is probably a good idea.
      % \pedro[inline]{I macroed the defining points as \texttt{defpt}, and currently defined it as $\vv{c}$.}
      %\item[$\CheckedBox$] Uniformize the way we describe programs (e.g., as in Section 9).
%      \item[$\CheckedBox$] Uniformize the way we introduce collapses in statements.
 %     Daniel now prefers saying ``$\collapse{X}$ denotes the collapse of $X$ along $\O$\ldots'' without specifying what $X$ is; Pedro proposed to simply write ``Let the superscript bar denote collapse along\ldots''  I think we agreed Pedro's way is better.
  %    \pedro[inline]{Gave it a shot. Apparently, ``overbar'', ``overline'', and ``overscore'' are all accepted words for the superscript bar. I used ``overbar'', but feel free to change it, if you prefer a different term.}

      %    \item[$\CheckedBox$] Right now, we are referring to ``the'' monomial matrix associated to a monomial idea.  But, we don't want to restrict to associating columns to minimal generators, since this may not be preserved by collapse.  So, we don't seem to have a canonical monomial matrix, just one associated to every set of generators.
      % \emily[inline]{Would ``a monomial matrix'' be OK?}
      % \pedro[inline]{That sounds good to me.}
    %  \item[$\CheckedBox$] Label $\canvec_1$, $\canvec_2$, $\canvec_3$ in Figure 1, and other figures.
%      \item[$\CheckedBox$] Change ``image'' to ``optimal image'', at least in definitions. optim instead of im?
%      \item[$\Box$] Remove image of arithmetic program, restate things algebraically.
      %\item[$\CheckedBox$] Draw entire line of $\norm{\vv{s}} = \val \fip_p$.
%      \item[$\Box$] Add the analog to Corollary 2.4 for $F$-thresholds and test ideals?
%      \item[$\Box$] Does 7.10 come from 7.3, if we replace 1 with $q$ and $\IP$ with $\IP_p$? If so, we should write the proof this way, and replace the comment preceding 7.11 with a remark (that makes clear the reduction to the small case)
      % \item[$\Box$] Does Corollary 8.3 come from 7.10 too?
      % \emily[inline]{I think this is defunct now? }
   %    \item[$\Box$] Identify where ``equal'' and ``equivalent'' linear/integer programs are pointed out, and define this at that point.
   % \emily[inline]{This only seems to happen with $\IP$ and $\IP_p$ when the arithmetic constraint is automatically satisfied.  I think that the meaning will be clear to the reader, and I don't think we need to make it any more explicit by distinguishing between ``equal'' and ``equivalent.''}  
    \item[$\Box$] Put ``titles'' in appropriate statements. 
   \end{enumerate}
}

\setcounter{tocdepth}{1}
\tableofcontents

\newpage
\section{Introduction}

\begin{itemize}
 \item Motivate via test ideals of general hypersurfaces.
 \item Emphasize the uniformity result over algorithms, and tie it in with previous known results.
 \item State main theorems.
 \item Explain that we reduce to the case that $\idealb$ is a diagonal monomial ideal.  
\end{itemize}



Let $\kk$ be a field of prime characteristic $p>0$ with $[\kk:\kk^p] < \infty$, 
%, and consider the polynomial ring $R = \kk[x_1, \ldots, x_\numvars]$.  
%Given ideals $\ideala$ and $\idealb$ of $R$ with ${\ideala}$ contained in $\sqrt \idealb$, and a nonnegative integer $e$, we define
take  $\ideala$ and $\idealb$ in a polynomial ring over $\kk$ for which ${\ideala}$ is contained in $\sqrt \idealb$.  For a nonnegative integer $e$, we define
%
\[\nu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{k} \not\subseteq \idealb^{[p^e]}\big\}\]
%
where $\idealb^{[p^e]} = \langle g^{p^e} : g \in \idealb \rangle$ is the $p^e$-th Frobenius power of $\idealb$.
The condition that $\ideala \subseteq \sqrt \idealb$ guarantees that each $\nu(\ideala, \idealb, p^e)$ is a well-defined integer.

The \emph{growth rate} of these integers as a function of the nonnegative integer $e$ is of independent interest.
It is not hard to see that the sequence $\big(\nu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^{\infty}$ is nondecreasing and bounded,  and we define
\[ \ft{\ideala}{\idealb} = \lim_{e \to \infty} \frac{\nu(\ideala, \idealb, p^e)}{p^e}  = \sup_{e\in \NN} \frac{\nu(\ideala,\idealb,p^e)}{p^e}, \]
which we call the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}.

% \daniel{Motivate the $\nu$'s by tying them to roots of BS polynomials; motivate $F$-thresholds by relating them to behavior of test ideals.  Relate them to multiplier ideals}


\daniel[inline]{This is essentially copied verbatim from \cite[Problem 3.8]{mustata+takagi+watanabe.F-thresholds}.  It also appeared as \cite[Problem 2.3]{budur+mustata+saito.roots_bs_polys} .  We should probably restate it more precisely, and explain its significance.}

\begin{problem}
   Find conditions on the ideal $\ideala$ such that the following holds.
   Given an ideal $\idealb$ with $\ideala \subseteq \sqrt \idealb$ and a nonnegative integer $e$, there exists a positive integer $N$ and polynomials $P_i(t) \in \QQ[t]$ of degree $e$ for every $i$ that is a unit modulo $N$ such that $\nu(\ideala_p, \idealb_p, p^e) = P_i(p)$ whenever $p$ is sufficiently large and $p \equiv i \bmod N$.
   When could $N$ be chosen independently of $\idealb$ and $e$?
\end{problem}


%
\daniel[inline]{Emphasize that when $\ideala$ is monomial and $\idealb$ is arbitrary (over $\QQ$), then the $F$-threshold of $\ideala_p$ with respect to $\idealb_p$ is independent of $p$ for all $p \gg 0$.  This is \Cref{nu-mu-reduce-monomial: C}.}



%
\begin{theorem}
   \label{general-nu-theorem: T}
   Given a monomial ideal $\ideala$ of $\QQ[x_1, \ldots, x_\numvars]$, and an arbitrary ideal $\idealb$ of this polynomial ring with $\ideala \subseteq \sqrt{\idealb}$, there exist positive integers $\ell = \ell(\ideala)$ and  $\beta = \beta(\ideala, \idealb)$, and for every integer $1 \leq r < \ell$ relatively prime to $\ell$ a rational number $\delta(\ideala, \idealb, r)$ satisfying the following conditions.
   If $p^e > \beta(\ideala, \idealb)$ and $p^e \equiv r \bmod \ell$, then $ \nu(\ideala_p, \idealb_p, p^e) = \ft{\ideala}{\idealb} \cdot p^e - \delta(\ideala, \idealb, r)$.
\end{theorem}

As above, let $\kk$ be a field of prime characteristic $p>0$ with $[\kk: \kk^p]$ finite.
If $\ideala$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then the Frobenius powers of $\ideala$ are a family of ideals $\ideala^{[t]}$ indexed by a nonnegative real parameter $t$.
When the exponent is an integer, then the corresponding Frobenius power can be described concretely in terms of generators as follows:
If $k$ is a natural number, and $\ideala$ is generated by polynomials $f_1, \ldots, f_n$, then $\ideala^{[k]}$ is the ideal generated by the products $f^{\vv{u}} = f_1^{u_1}\cdots f_n^{u_n}$, ranging over all points $\vv{u} \in \NN^n$ for which the multinomial coefficient $\binom{k}{\vv{u}}$ is nonzero modulo $p$  \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.

Now, if $\idealb$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$ with $\ideala \subseteq \sqrt{\idealb}$, then in analogy with the above definitions, given a nonnegative integer $e$, we define
\[\mu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{[k]} \not\subseteq \idealb^{[p^e]}\big\}.\]
Then $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^{\infty}$ is a nondecreasing bounded sequence, and
\begin{equation}\label{eq: crit as a limit of mus}
   \crit(\ideala,\idealb) = \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e} = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}.
\end{equation}
is the critical exponent of $\ideala$ with respect to $\idealb$.

\begin{theorem}
   \label{general-mu-theorem: T}
   Given a monomial ideal $\ideala$ of $\QQ[x_1, \ldots, x_\numvars]$, there exists a positive integer $\ell = \ell(\ideala)$, and for every ideal $\idealb$ with $\ideala \subseteq {\idealb}$ and for every integer $1 \leq r < \ell$ relatively prime to $\ell$, there exist a positive integer $\beta = \beta(\ideala, \idealb)$ and a sequence $\big(\epsilon(\ideala, \idealb, r, e)\big)_{e=1}^{\infty}$ of nonnegative rational numbers satisfying the following condition.
   If $p > \beta$ and $p \equiv r \bmod \ell$, then
   \[ \mu(\ideala_p, \idealb_p, p^e) = \ft{\ideala}{\idealb} \cdot p^e - \sum_{s=1}^{e} \epsilon(\ideala, \idealb, r, s) \cdot p^{e-s}.\]
\end{theorem}

\newpage
\section{Notation and basic notions}


\subsection{Euclidean spaces}
\label{ss: euclidean spaces and convexity}
%We review in this subsection some of the terminology, notation, and constructions concerning Euclidean spaces used throughout the paper.
We use bold-face lower-case letters to denote points of the Euclidean space $\RR^n$, and the same letter, in regular font, to represent their coordinates (\eg $\vv{v}=(v_1,\ldots,v_n)$).
The points $(0,\ldots,0)$ and $(1,\ldots,1)$ are denoted $\vv{0}$ and $\vv{1}$, and we write the standard basis vectors of $\RR^n$ as $\canvec_1,\ldots,\canvec_n$.

Given a point $\vv{u}\in \RR^n$, $\norm{\vv{u}}$ denotes its coordinate sum, $u_1+\cdots+u_n$.
The standard inner product in $\RR^n$ is denoted by the usual angle brackets: $\iprod{\vv{u}}{\vv{v}} = u_1v_1 + \cdots + u_nv_n$.
An inequality between points of $\RR^n$ is a shorthand for a system of $n$ coordinatewise inequalities; e.g., $\vv{u}\le \vv{v}$ means that $u_i \le v_i$ for each $i=1,\ldots,n$.
In the same vein, operations on numbers are extended to points in $\RR^n$ in a coordinatewise fashion; for instance, $\up{\vv{u}}=(\up{u_1},\ldots,\up{u_n})$.

% We say that a point $\vv{u}\in \RR^n$ is positive (respectively, nonnegative) if $\vv{u} > \vv{0}$ (respectively, $\vv{u}\ge \vv{0}$).
\daniel{Revisit this when deciding how to describe collapsing}
% More generally,
We say that a point $\vv{u}$ in a coordinate subspace $\mathcal{S}$ of $\RR^n$ is a \emph{positive} (respectively, \emph{nonnegative}) point of $\mathcal{S}$ if $\vv{u}$ is a positive (respectively, nonnegative) linear combination of the standard basis vectors that span $\mathcal{S}$.
We extend this to all points in $\RR^n$, via projection: we say that $\vv{u} \in \RR^n$ is \emph{positive in $\mathcal{S}$} (respectively, \emph{nonnegative in $\mathcal{S}$}) if its projection on $\mathcal{S}$ is a positive (respectively, nonnegative) point of $\mathcal{S}$. 
Finally, given $\vv{u},\vv{v}\in \RR^n$, we say that \emph{$\vv{u}$ is less than} (respectively, \emph{less than or equal to}) \emph{$\vv{v}$ in $\mathcal{S}$} if $\vv{v}-\vv{u}$ is positive (respectively, nonnegative) in $\mathcal{S}$.

Note that with these conventions, $\vv{u} < \vv{v}$ if and only if $\vv{u}$ is less than $\vv{v}$ both in $\mathcal{S}$ and in its orthogonal complement $\mathcal{S}^\perp$.

\subsection{Monomial matrices, monomial ideals, and pairs}
\label{monomial newton preliminaries: ss}

We work in the polynomial ring $\kk[x_1, \ldots, x_\numvars]$ over a field $\kk$, and adopt standard notation for describing monomials.  That is, if $\vv{u} \in \NN^\numvars$, then $x^{\vv{u}} = x_1^{u_1} \cdots x_\numvars^{u_\numvars}$.

\begin{definition}[Monomial matrices]
\label{monomial matrix: D}
A \emph{monomial matrix} is a matrix over $\ZZ$ with nonnegative, nonzero rows and columns.
If $A$ is an $\numvars \times n$ monomial matrix, then we call $\ZZ^n$ the \emph{domain lattice} and $\ZZ^\numvars$ the \emph{target lattice} of $A$. 
\end{definition}

\begin{remark}[Connections with monomial ideals]
\label{monomial matrix ideal: R}  Consider a proper monomial ideal $\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$.  Given a generating set $\ideala = \langle x^{\vv{a}_1}, \ldots, x^{\vv{a}_n} \rangle$, not necessarily minimal, with the property that each variable of the ambient polynomial ring appears in some generator, it is not difficult to see that \[A= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}\] is an  $\numvars \times n$ monomial matrix.  Clearly, as this process depends on the choice of a distinguished generating set for $\ideala$, there are many monomial matrices $A$ we can assign to $\ideala$, though each such matrix will necessarily have $m$ rows.
\end{remark}

\begin{remark}[Generators in terms of monomial matrices]
   \label{generators-via-exponent-matrix: R}  If $\ideala$ is a proper monomial ideal, and $A= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}$ is a monomial matrix associated to $\ideala$, then the generators of powers of $\ideala$ can be described compactly in terms of the matrix $A$.
   Indeed, this follows from the fact that the product $(x^{\vv{a}_1})^{k_1} \cdots (x^{\vv{a}_n})^{k_n}$ can be written as $x^{A \vv{k}} = x^{k_1 \vv{a}_1 + \cdots + k_n \vv{a}_n}$.
   That is, $\ideala^\ell$ is generated by all monomials of the form $x^{A \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}} = \ell$.
%
% \begin{equation}
% \label{generators-via-exponent-matrix: e}
% \ideala^n = \langle x^{A \vv{k}} : \vv{k} \in \NN^n \text{ and } \norm{\vv{k}}=n \rangle.
% \end{equation}
\end{remark}



\begin{definition}[Diagonal ideals]  A  \emph{diagonal ideal} of $\kk[x_1, \ldots, x_{\numvars}]$ is any \emph{proper} ideal of the form $\ideald = \langle x_1^{u_1}, \ldots, x_{\numvars}^{u_{\numvars}} \rangle$.  In this case,  we call $\ideald$ the diagonal ideal associated to the \emph{positive} point $\vv{u} = (u_1, \ldots, u_{\numvars}) \in \ZZ^{\numvars}$.
\end{definition}

\begin{definition}[Pairs]  
\label{pairs: D}
   A \emph{monomial pair} $(A, \vv{u})$ consists of an $\numvars \times n$ monomial matrix $A$, and a positive point $\vv{u} \in \ZZ^\numvars$, the target lattice of $A$.  
    An \emph{$A$-pair} is a monomial pair whose first entry is $A$.
   
   An \emph{ideal pair} $(\ideala, \ideald)$ consists of a proper monomial ideal $\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$, along with a diagonal ideal $\ideald$ of the same ambient polynomial ring.
\end{definition}

\begin{remark}[Association of pairs]
\label{associate of pairs: R}
 As in \Cref{monomial matrix ideal: R}, we may associate to each ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$ a monomial pair $(A, \vv{u})$.  Observe that, though there need not be a canonical choice for the $m \times n$ matrix $A$, the positive point $\vv{u} \in \ZZ^m$ is uniquely determined by the diagonal ideal $\ideald$.
\end{remark}

\subsection{Optimization} \label{optimization: S}  Optimization problems play a central role in this paper.  Here, we briefly recall the basic framework of standard \emph{programming}.

Suppose that $\mathcal{X}$ is either $\RR^n$ or $\ZZ^n$.  By a \emph{program $\Omega$ in the ambient space $\mathcal{X}$}, we mean an optimization problem seeking to maximize some given linear \emph{objective function} $\RR^n \to \RR$ on some subset of $\mathcal{X}$ defined by a system of linear inequalities, called the \emph{constraints} of the program $\Omega$. If $\mathcal{X} = \RR^n$, then the points in $\mathcal{X}$ satisfying these constraints define a polyhedron in $\RR^n$, while if $\mathcal{X} = \ZZ^n$, then the points in $\mathcal{X}$ satisfying these constraints instead consist of the lattice points in some polyhedron in $\RR^n$.  In either case, we call this set of points in $\mathcal{X}$ the \emph{feasible set} of the program.  We denote it by $\feas \Omega$, and say that the points in this set are \emph{feasible} for the program $\Omega$.

To distinguish between these cases, we refer to a program in $\mathcal{X} = \RR^n$ as a {real linear program}, or \emph{linear program} for short, and to a program in $\mathcal{X}=\ZZ^n$ as an {integer linear program}, or \emph{integer program} for short.

Every program $\Omega$ we consider in this article has the property that the values taken on by the objective function on $\feas \Omega$ are bounded from above, and in this case, the maximum value achieved by the objective function on this feasible set is called the \emph{value} of the program $\Omega$, and is denoted $\val \Omega$.  The subset of $\feas \Omega$ where the objective function achieves this maximum value is called the \emph{optimal set} of $\Omega$, and is denoted $\opt \Omega$.   When $\Omega$ is a linear program in $\RR^n$, its optimal set is a face of the polyhedron $\feas \Omega$ in $\RR^n$.


\newpage
\section{Connections with optimization}
\label{sec: LPs}
  
Throughout this section, we consider an ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$, as described in \Cref{pairs: D}.   Our goal here, and for much of the rest of the article, is to study the integers $\nu(\ideala, \ideald, p^e)$ and $\mu(\ideala, \ideald, p^e)$ and rational numbers $\ft{\ideala}{\ideald}$ and $\crit(\ideala, \ideald)$ defined in the introduction.  As will soon be apparent, it is natural to do so in terms of various optimization problems.

\begin{remark} \label{reduction to diagonal :R}
This context might seem restrictive, given that our ultimate goal is to understand the nature of the above mention numerical invariants when the diagonal ideal $\ideald$ is replaced with an arbitrary ideal $\idealb$.  

However, as we explain in \Cref{monomial-reduction: A}, understanding the situation for all ideal pairs $(\ideala, \ideald)$ with $\ideala$ fixed, but $\ideald$ varying, leads to \Cref{general-nu-theorem: T,general-mu-theorem: T}.
\end{remark}

To facilitate the transition from algebra to optimization, fix a monomial pair $(A, \vv{u})$ associated to $(\ideala, \ideald)$, as described in \Cref{associate of pairs: R}.  In particular, $A$ is an $\numvars \times n$ monomial matrix, $\vv{u} \in \ZZ^m$ is a positive lattice point, and 
\[ \ideald = \langle x^{u_1}, \ldots, x^{u_{\numvars}} \rangle \subseteq \kk[x_1, \ldots, x_{\numvars}] \] is the diagonal ideal associated to $\vv{u}$.

\subsection{Relations with integer and linear programs}  We start by studying the integers $\nu(\ideala, \ideald, p^e)$ and rational numbers $\ft{\ideala}{\ideald}$; as touched on in \Cref{reduction to diagonal :R}, we will later be able to use our results here to obtain more general ones. 
First, recall that for each $q$ a power of $p$, the integer $\nu(\ideala, \ideald, q)$ is defined as 
\[\nu(\ideala,\ideald,q) = \max\big\{\ell \in \NN : \ideala^{\ell} \not\subseteq \ideald^{[q]}\big\}.\]

As noted in \Cref{generators-via-exponent-matrix: R},  the ideal $\ideala^{\ell}$ is generated by all monomials of the form $x^{A\vv{k}}$, with $\vv{k}\in \NN^n$ and $\norm{\vv{k}} = \ell$.  Furthermore, as $\ideald^{[q]}$ is the diagonal ideal associated to $\vv{u}q$, we have that $\ideala^{\ell} \not\subseteq \ideald^{[q]}$ if and only if there is some generator $x^{A \vv{k}}$ of $\ideala^{\ell}$ with $A\vv{k} < \vv{u}q$.  Thus, computing $\nu(\ideala,\ideald,q)$ is equivalent to maximizing the value of $\norm{\vv{k}}$, with $\vv{k} \in \ZZ^n$, and subject to the constraints $\vv{k} \geq \vv{0}$ and $A\vv{k} < \vv{u}q$.
This observation motivates the following definition.

\begin{definition}
\label{IP: D}
   If $q$ is a positive integer, then $\IP(A, \vv{u}, q)$ is the integer program in the domain lattice of $A$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}q - \vv{1}$.
\end{definition}

It is easy to deduce from the fact that the matrix $A$ is a monomial matrix (i.e., has nonnegative, nonzero rows and columns) that the feasible set of $\IP(A,\vv{u},q)$ is finite, and hence, this integer program has a well-defined value.  In fact, the discussion preceding \Cref{IP: D} demonstrates that 
%
\begin{equation}
\label{nu as program value: eq}
\nu(\ideala,\ideald,q) = \val \IP(A,\vv{u},q).
\end{equation}



We now shift our attention from the integers $\nu(\ideala, \ideald, q)$ to the $F$-threshold $\ft{\ideala}{\ideald}$.  First, note that \eqref{nu as program value: eq} and the definition of $\ft{\ideala}{\ideald}$ imply that 
%
\begin{equation}
\label{ft as limit of normalized program values: eq}
\ft{\ideala}{\ideald} = \lim_{e\to\infty} \frac{\nu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP(A,\vv{u},p^e)}{p^e}.
\end{equation}

Continuing with our theme, we seek to describe this number in terms of a certain optimization program, which we define below.

\begin{definition}
\label{LP: D}
 $\LP(A, \vv{u})$ is the linear program in the domain of $A$ which consists of maximizing $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}$.
\end{definition}

Once again, the fact that $A$ is monomial implies that the feasible set of the linear program $\LP(A,\vv{u})$ is bounded, and therefore a polytope in the domain of $A$.  Consequently, $\LP(A,\vv{u})$ has a well-defined value.
%In order to relate this value to the Newton polyhedron of $A$ we need the following definition.


\begin{proposition}
\label{ft as val LP: P}
The value of $\LP(A, \vv{u})$ equals the $F$-threshold $\ft{\ideala}{\ideald}$.
\end{proposition}

\begin{proof}
  Recall that, as $A$ is an $\numvars \times n$ monomial matrix, the domain of $A$ is $\RR^n$, and the domain lattice of $A$ is $\ZZ^n$.  If $\vv{k} \in \ZZ^n$ is optimal for $\IP(A,\vv{u},q)$, then the scaled point $\vv{k}/q$ is feasible for $\LP = \LP(A, \vv{u})$, so $\val \LP \geq \val \IP(A, \vv{u}, q)/q$ for all $q$.
   Thus, $\val \LP$ is at least equal to the limits appearing in \eqref{ft as limit of normalized program values: eq}.

   Conversely, given an optimal point $\vv{t} \in \RR^n$ for $\LP$,
   define $\vv{t}_q \in \ZZ^n$ as the point whose $i$-th coordinate is $0$ if $t_i=0$, and otherwise equals $\lceil q t_i \rceil - 1$, the greatest integer less than $q t_i$.
   By design, and the fact that $A$ is a monomial matrix, the $i$-th entry of $A \vv{t}_q$ is either less than the $i$-th entry of $A (q \vv{t})$, which itself is less than or equal to $u_iq$, by the feasibility of $\vv{t}$ for $\LP$, or equals $0$,  in which case it is also less than $u_i q$ since $\vv{u}$ is positive. This observation demonstrates that $\vv{t}_q$ is feasible for $\IP(A, \vv{u}, q)$, and so
   \[\val \IP(A, \vv{u}, q) \geq \norm{\vv{t}_q} \geq \sum_{i=1}^n \big(\lceil q t_i \rceil - 1\big) \geq q \norm{\vv{t}} -n = q \cdot \val \LP - n.\]
   
   Dividing by $q$ and taking the limit as $q$ tends to infinity, we find that the limits in \eqref{ft as limit of normalized program values: eq} are at least $\val \LP$, which completes the proof.
\end{proof}


\subsection{Relations with arithmetic and fractal programs}

 We now turn our attention to the integers $\mu(\ideala, \ideald, p^e)$ and rational numbers $\crit(\ideala,\ideald)$; as mentioned in the our method

 First, recall that for each $q$ a power of $p$, the integer $\mu(\ideala, \ideald, q)$ is defined as 
\[\mu(\ideala,\ideald,q) \coloneqq \max\big\{ \ell \in \NN : \ideala^{[\ell]} \not\subseteq \ideald^{[q]}\big\},\]
where $\ideala^{[\ell]}$ is the $\ell$-th (generalized) Frobenius power of $\ideala$.

As noted in the introduction, if $\idealb$ is an ideal of a ring of characteristic $p$ with generators $g_1, \ldots, g_n$, then $\idealb^{[\ell]}$ is the ideal generated by the products $g_1^{k_1}\cdots g_n^{k_n}$, ranging over $\vv{k} \in \NN^n$ with $\norm{\vv{k}}=\ell$, and for which  $\binom{\ell}{\vv{k}} =
\frac{\ell!}{k_1 ! \cdots k_n !}$ is nonzero modulo $p$  \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.
In light of this, \Cref{generators-via-exponent-matrix: R} tells us that $\ideala^{[\ell]}$ is generated by the monomials of the form $x^{A \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}}=\ell$ and $\binom{\ell}{\vv{k}} \not\equiv 0 \bmod p$.  As in the previous subsection, we may conclude that $\mu(\ideala,\ideald,q)$ is the maximum value of $\norm{\vv{k}}$, with $\vv{k} \in \NN^n$ subject to the linear constraint $A\vv{k} < \vv{u}q$, but also subject to the highly nonlinear constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not\equiv 0 \bmod{p}$.  Motivated by this, we introduce a variant of an integer program that we call an \emph{arithmetic integer program}.
%As this new constraint is arithmetic in nature, we call such an optimization problem an \emph{arithmetic integer program}.

\begin{definition}
\label{aip: D}
If $q$ is a power of $p$, then $\IP_p(A, \vv{u}, q)$ is the \emph{arithmetic integer program} in the domain lattice of $A$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the linear constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}q - \vv{1}$, and the arithmetic constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not \equiv 0 \bmod p$.
\end{definition}

We define the terms \emph{feasible, optimal}, and \emph{value} relative to the arithmetic program $\IP_p(A, \vv{u}, q)$ in analogy with those for the integer program $\IP(A, \vv{u}, q)$.


\begin{remark}[A characterization of the arithmetic constraint]
 \label{dickson: R}
   Consider $n \in \NN$ and $\vv{n} \in \NN^n$.
   In base $p$, we may uniquely express these quantities as $n= \sum_{e=0}^s n_e \, p^e$ and $\vv{n}=\sum_{e=0}^s \vv{n}_e \, p^e$
%\begin{equation*}
%n= \sum_{e=0}^s n_e \, p^e \quad \text{and} \quad \vv{n}=\sum_{e=0}^s \vv{n}_e \, p^e
%\end{equation*}
where $0\le n_e < p$ and $\vv{0}\le\vv{n}_e < p  \vv{1}$ for each $0 \leq e \leq s$, and where $n_s$ and $\vv{n}_s$ are allowed to be zero.
In any case, \cite{dickson.multinomial} then tells us that
$\binom{n}{\vv{n}}\equiv \binom{n_0}{\vv{n}_0}\binom{n_1}{\vv{n}_1}\cdots \binom{n_s}{\vv{n}_s} \mod{p}$.
%\[
%    \binom{n}{\vv{n}}\equiv \binom{n_0}{\vv{n}_0}\binom{n_1}{\vv{n}_1}\cdots \binom{n_t}{\vv{n}_t} \mod{p}.
%\]

In particular, the multinomial coefficient $\binom{n}{\vv{n}}$ is nonzero mod $p$ if and only if $\norm{\vv{n}_e}=n_e$ for each $e$, a condition that is sometimes described by saying that the entries of the vector $\vv{n} \in \NN$ sum to $n$ \emph{without carrying} in base $p$.

In light of this, the arithmetic constraint in \Cref{aip: D} is equivalent to the following condition:  If
 $\vv{k} = \vv{k}_0 + \vv{k}_1 \, p\cdots + \vv{k}_s \, p^s$ is the base $p$ expansion of the nonnegative lattice point $\vv{k}$, then $\norm{\vv{k}_e} < p$ for all $0 \leq e \leq s$.
\end{remark}

Clearly, the feasible set of $\IP_p(A, \vv{u}, q)$ lies in the feasible set of $\IP(A, \vv{u},q)$, and hence, is finite.  
In particular, this arithmetic program has a well-defined value, and the discussion preceding \Cref{aip: D} tells us that
%
\begin{equation}
\label{mu as program value: eq}
\mu(\ideala,\ideald,q) = \val \IP_p(A,\vv{u},q)
\end{equation}
%

Turning to the critical exponents $\crit(\ideala, \ideald)$, the identity \eqref{mu as program value: eq} implies that
%
\begin{equation}
\label{crit as limit of normalized program values: eq}
\crit(\ideala,\ideald) = \lim_{e\to\infty} \frac{\mu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP_p(A,\vv{u},p^e)}{p^e}.
\end{equation}
%

In what follows, in analogy with \Cref{ft as val LP: P}, we seek to relate these quantities to the value of a variant of a linear program that we call a \emph{fractal linear program}.  To do so, we require the following concept.

\begin{definition}
\label{sierpinski: D}
   The \emph{Sierpi\'nski $p$-gasket of dimension $n$} is the set $\sierp_{p,n}$ consisting of all points $\vv{t}\in \RR^n$ for which there exist $s \in \ZZ$ and a sequence of points $( \vv{t}_e )_{e=s}^\infty$ in $\NN^n$ such that $\norm{\vv{t}_e} < p$ for all $e \geq s$, and
 \[
\vv{t} = \sum_{e=s}^{\infty} \frac{\vv{t}_e}{p^e}.
 \]
\end{definition}

Note that the integer $s \in \ZZ$ in \Cref{sierpinski: D} can be negative.
It is also immediate that $\vv{t} \in \sierp_{p,n}$ if and only if $p^k  \vv{t} \in \sierp_{p,n}$ for some (equivalently, for every) integer $k \in \ZZ$; this reflects the self-symmetry observed in \Cref{fig: sierpinski 3-gasket}.
In particular, when determining whether $\vv{t} \in \RR^n$ lies in $\sierp_{p,n}$, we may rescale by a power of $p$  and assume that $\vv{t} \in [0,1]^n$.

Recall that every point $t \in [0,1]$ either has a unique base $p$ expansion, which is necessarily non-terminating, or else $p^k t \in \NN$ for some $k \in \ZZ$, in which case $t$ has both a terminating and a non-terminating expansion.
Thus, if $\vv{t} \in [0,1]^n$ is such that no component of $p^k \vv{t}$ is an integer for each $k \in \NN$, then there is a unique sequence $\{ \vv{t}_e \}_{e=1}^{\infty}$ in $ \NN^n$ such that $\vv{t} = \sum_{e=1}^{\infty} \frac{\vv{t}_e}{p^e}$, and such point lies in ${\sierp}_{p,n}$ if and only if all $\norm{\vv{t}_e}$ are less than $p$.
However, things can be more subtle when some $p^k \vv{t}$ has an integer component.

\begin{example}
If $p=2$, then $(1/4, 1/4) \in \sierp_{2,2}$.  Indeed, for the first component, take the non-terminating binary expansion $\frac{1}{4} = \frac{1}{2^3} + \frac{1}{2^4} + \frac{1}{2^5} + \cdots$, and for the second component, simply take the expansion $\frac{1}{4} = \frac{1}{2^2}$.  Note that if one instead considered the non-terminating expansion for both components, or the terminating expansion for both components, then the resulting expansion of $(1/4, 1/4)$ would fail to satisfy the condition in \Cref{sierpinski: D}.
\end{example}

This description of the Sierpi\'nski $p$-gasket in terms of expansions is not hard to translate geometrically into its description as a fractal.

\begin{example}
\label{sierpinski triangle: E}
The set $\sierp_{2,2} \cap [0,1]^2$ is the familiar Sierpi\'nski triangle, together with the line segments connecting $(1,0)$ to $(1,1)$, and $(1,1)$ to $(0,1)$.
Indeed, the points $\vv{t}$ in the unit square $[0,1]^2$ that have \emph{no} binary expansion $\vv{t} = \sum_{e=0}^{\infty}\frac{\vv{t}_e}{2^e}$ as above with $\norm{\vv{t}_1} < 2$ are precisely the points in the open triangle  $T = \{ (a,b) \in \RR^2 : a,b < 1, a+b > 1 \}$.
At the next stage, the points $\vv{t} \in [0,1]^2$ with \emph{no} expansion $\vv{t} = \sum_{e=0}^{\infty}\frac{\vv{t}_e}{2^e}$ with both  $\norm{\vv{t}_1} < 2$ and $\norm{\vv{t}_2} < 2$ are those in the union of open triangles $T$ and $\frac{1}{2} \cdot T$.  The condition on expansions at the third place removes three additional open triangles from this set, and we can continue analogously.
\end{example}


As suggested by \Cref{sierpinski triangle: E}, each $\sierp_{p,n}$  can be realized by removing a union of open simplices from $\RRnn^n$, and hence, is a closed set.  
\Cref{fig: sierpinski 3-gasket} illustrates the self-similarity of the $2$-dimensional Sierpi\'nski $3$-gasket.

\begin{figure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_a.pdf}
  \caption{Restriction to $[0,1]^2$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_b.pdf}
  \caption{Restriction to $[0,9]^2$}
\end{subfigure}
\caption{The $2$-dimensional Sierpi\'nski 3-gasket}
\label{fig: sierpinski 3-gasket}
\end{figure}


Remarkably, the critical exponent of a monomial pair $\crit(\ideala, \ideald)$ described in \eqref{crit as limit of normalized program values: eq} can be computed in terms of the Sierpi\'nski $p$-gasket, providing a geometric interpretation for this value.  To motivate our approach, we first note that the feasible set of the linear program $\LP(A, \vv{u})$, whose value equals the $F$-threshold $\ft{\ideala}{\ideald}$ by \Cref{ft as val LP: P}, is simply the closure with respect to the Euclidean topology of the set $\{ \vv{t} \in \RR^n : \vv{t} \geq \vv{0} \text{ and } A\vv{t} < \vv{u} \}$.  In what follows, we consider a similar optimization problem,  replacing the conditions that $\vv{t} \in \RR^n$ and $\vv{t} \geq \vv{0}$ with the ``fractal constraint" that $\vv{t} \in \sierp_{p,n}$.

\begin{definition}
\label{fractal program: D}
The \emph{fractal linear program} $\fip_p(A,\vv{u})$ consists of maximizing the objective function $\vv{t}\mapsto \norm{\vv{t}}$ on the Euclidean closure of the set \[ \{ \vv{t} \in \sierp_{p,n} : A \vv{t} < \vv{u} \}.\]  We call this closure the feasible set of $\fip_p(A, \vv{u})$, and denote it by $\feas \fip_p(A, \vv{u})$.
% The value of the problem, $\val \fip_p(A,\vv{u})$, is defined as the supremum of $\norm{\vv{t}}$ among all $\vv{t} \in \feas \fip_p(A, \vv{u})$.
\end{definition}

\begin{remark}
   Note that the closure in the above definition need not agree with the closed set $\{ \vv{t} \in \sierp_{p,n} : A \vv{t} \le \vv{u} \}$.
   For example, if $A$ is the $2\times 2$ identity matrix, $\vv{u} = (1,1)$, and $p=2$, then the closure of the set $\{ \vv{t} \in \sierp_{2,2} : A \vv{t} < \vv{u} \}$ is simply the classical Sierpi\'nski triangle---the set of points $\vv{t}$ in $\sierp_{2,2}$ with $\norm{\vv{t}} \le 1$. The set $\{ \vv{t} \in \sierp_{2,2} : A \vv{t} \le \vv{u} \}$, on the other hand, also includes the line segments from $(1,0)$ to $(1,1)$, and from $(1,1)$ to $(0,1)$.
\end{remark}

\begin{remark}[On the values and optimal sets of fractal programs]  The discussion preceding \Cref{fractal program: D} implies that $\feas \fip_p(A, \vv{u})$ is contained in the feasible set of $\LP(A, \vv{u})$, and hence, is bounded.  Thus, $\feas \fip_p(A, \vv{u})$ is compact, and so $\val \fip_p(A, \vv{u})$, the value of $\fip_p(A, \vv{u})$, can be defined as 
   \[ \max \{ \norm{\vv{t}}: \vv{t} \in \feas \fip_p(A, \vv{u}) \} = \sup \{ \norm{\vv{t}} : \vv{t} \in \sierp_{p,n}, A \vv{t} < \vv{u} \} \] which is a well-defined real number.
   As usual, we define the optimal set of $\fip_p(A, \vv{u})$ to be the set $\opt \fip_p(A, \vv{u})$ of feasible points where this maximum is attained.
%Moreover, there is exists an optimal point
%$\vv{t} \in \feas \fip_p(A, \vv{u})$ such that $\norm{\vv{t}} = \val \fip_p(A, \vv{u})$.
\end{remark}

\begin{example} \label{ex: feas fip}
 Consider the fractal linear program $\fip_p = \fip_p(A, \vv{u})$, where
\[ A = \begin{bmatrix}
 3&11\\ 11&2 \\ 5&10 \\ 2&0
 \end{bmatrix}
\quad \text{and} \quad \vv{u} = \begin{bmatrix} 1 \\ 1 \\ 1 \\ \end{bmatrix}.
\]
\Cref{fig: feas fip} illustrates the key features of the program $\fip_p$ for small values of $p$.  The feasible set for $ \fip_p$ is displayed in blue, the feasible set for $\LP = \LP(A,\vv{u})$ in gray, and the line of points with coordinate sum equal to $\val \fip_p$ in green.  Thus,  $\opt \fip_p$ is simply the intersection of the blue points and green points.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}
  \centering
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char2.pdf}\hskip .04\textwidth
   \captionsetup{labelformat=empty}
   \caption{$p=2$}
  % \caption{
  %    $
  %    \begin{array}{l}
  %      \opt \fip_2 = \conv\big(\big(\frac1{20},\frac3{40}\big),\big(\frac1{12},\frac1{24}\big)\big)\\[2mm]
  %      \val \fip_2 = \frac18
  %    \end{array}
  %    $
  % }
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
\includegraphics[width=.9\textwidth]{pictures/ex4_char3.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=3$}
% \caption{
%      $
%      \begin{array}{l}
%        \opt \fip_3 = \conv\big(\big(\frac1{36},\frac1{12}\big),\big(\frac7{81},\frac2{81}\big)\big)\\[2mm]
%        \val \fip_3 = \frac19
%      \end{array}
%      $
% }
\end{subfigure}

\bigskip

\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char5.pdf}\hskip .04\textwidth
  \captionsetup{labelformat=empty}
  \caption{$p=5$}
  % \caption{
  %    $
  %    \begin{array}{l}
  %      \opt \fip_5 = \opt \LP = \big\{\big(\frac2{25}, \frac3{50}\big)\big\}\\[2mm]
  %      \val \fip_5 = \frac7{50}
  %    \end{array}
  %    $
  % }
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char7.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=7$}
  % \caption{
  %    $
  %    \begin{array}{l}
  %      \opt \fip_7 = \big\{\big(\frac{19}{245}, \frac3{49}\big)\big\}\\[2mm]
  %      \val \fip_7 = \frac{34}{245}
  %    \end{array}
  %    $ }
\end{subfigure}
\caption{The feasible and optimal sets of $\fip_p(A, \vv{u})$ for $A$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{fig: feas fip}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\Cref{table: feas fip details} provides a more precise description of these quantities.
It is worth mentioning that when $p=5$, the optimal sets of $\fip_p$ and $\LP$ agree, and consequently so do their values.
On the other hand, if $p=2$, $3$, or $7$, then $\val \fip_p < \val \LP$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF TABLE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{table}
\begin{center}
\begingroup
\setlength{\tabcolsep}{8pt} % Default value: 6pt
\renewcommand{\arraystretch}{1.4} % Default value: 1
\begin{tabular}{ccc}
  \toprule
  $p$ & $\val \fip_p$ & $\opt \fip_p$  \\
  \midrule
  $2$ & $\frac18$ & $\conv\big(\big(\frac1{20}, \frac3{40}\big),\big(\frac1{12}, \frac1{24}\big)\big)$ \\
  $3$ & $\frac19$ & $\conv\big(\big(\frac{1}{36}, \frac1{12}\big),\big(\frac7{81}, \frac2{81}\big)\big)$ \\
  $5$ & $\frac7{50}$ & $\big\{\big(\frac2{25}, \frac3{50}\big) \big\}$  \\
  $7$ & $\frac{34}{245}$ & $\big\{\big(\frac{19}{245}, \frac3{49}\big) \}$ \\
  \bottomrule
\end{tabular}
\endgroup
% The \begingroup ... \endgroup pair ensures the separation
% parameters only affect this particular table, and not any
% sebsequent ones in the document.
\end{center}
\medskip
\caption{The values and optimal sets of $\fip_p(A, \vv{u})$ for $A$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{table: feas fip details}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{example}


\begin{proposition}
The value of $\fip_p(A,\vv{u})$ equals $\crit(\ideala, \ideald)$.
\end{proposition}

\begin{proof}
   If $e \in \NN$, then the constraints of $\IP_p(A, \vv{u}, p^e)$ imply that $p^{-e}  \feas \IP_p(A, \vv{u}, p^e)$ lies in $\feas \fip_p(A,\vv{u})$.
   It then follows from this and \eqref{crit as limit of normalized program values: eq} that
   %
   \[
      \val\fip_p(A,\vv{u}) \ge \displaystyle \lim_{e \to \infty}\frac{\val\IP_p(A,\vv{u}, p^e)}{p^e} = \crit(\ideala, \ideald).
   \]

   Next, fix a point $\vv{t} \in \sierp_{p,n}$ with $A \vv{t} < \vv{u}$.
   By definition of $\sierp_{p,n}$, we may fix an integer $s$, and a sequence $\{ \vv{t}_l \}_{l=s}^\infty$ in $\NN^n$ with $\norm{\vv{t}_l} < p$ for all $l \geq s$, such that $\vv{t} = \sum_{l=s}^{\infty} \frac{\vv{t}_l}{p^l}$.
   For each integer $e \geq 1$, set $\vv{t}^\star_{p^e} = \sum_{l=s}^{e} \frac{\vv{t}_l}{p^l}$.

   We claim that $p^e  \vv{t}^\star_{p^e}$ is feasible for $\IP_p(A, \vv{u}, p^e)$.
   To see why, first note that \Cref{dickson: R} tells us that this point satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p^e)$.
   Furthermore, $\vv{t}^{\star}_{p^e} \leq \vv{t}$, and so $A \vv{t}^{\star}_{p^e} \leq A \vv{t} < \vv{u}$, which demonstrates that $p^e \vv{t}^\star_{p^e}$ satisfies the linear constraints of $\IP_p(A, \vv{u}, p^e)$.
   Dividing by $p^e$ and taking limits, we find that
   \[
      \crit(\ideala, \ideald) = \lim_{e \to \infty} \frac{\val \IP_p(A, \vv{u}, p^e)}{p^e} \geq \lim_{e \to \infty}   \norm{\vv{t}^\star_{p^e}} = \norm{\vv{t}}.
   \]

   We have just shown that the objective function $\vv{t} \mapsto \norm{\vv{t}}$ is at most $\crit(\ideala, \ideald)$ on the set $\{ \vv{t} \in \sierp_{p,n} : A \vv{t} < \vv{u} \}$, and so the same must be true on the closure of this set, which agrees with the feasible set of $\fip_p(A, \vv{u})$, by definition.
   Restated,  $ \val \fip_p(A, \vv{u})$ is at most $\crit(\ideala,  \ideald)$, and so equality holds.
\end{proof}

\subsection{An outline}

\ \daniel[inline]{I imagine placing an outline here that points out the steps we are going to take to solve all of these optimization problems.}

\newpage
\section{Connections with Newton polyhedra}
\label{s: newton}
Here, as in \Cref{sec: LPs},  we use $A$ to denote a fixed $\numvars \times n$ monomial matrix.
In fact, throughout this section, we fix an $A$-pair $(A, \vv{u})$, so that $\vv{u}$ is a point in $\NN^\numvars$ with positive entries.
Our goal is to study the linear program $\LP(A, \vv{u})$ in terms of the \emph{Newton polyhedron} associated to the matrix $A$.



\subsection{Newton polyhedra and their faces}

For the reader's convenience, we start this section with a brief account of the terminology, basic facts, and notations associated with polyhedral geometry that will be used here and throughout the paper.

A (convex) \emph{polyhedron} in $\RR^n$ is a subset of $\RR^n$ obtained by intersecting finitely many closed halfspaces or, equivalently, a set consisting of all points $\vv{x}\in \RR^n$ satisfying an inequality of the form $A\vv{x}\le \vv{b}$, where $A$ is a matrix with $n$ columns.
The (convex) \emph{cone generated by $\vv{u}_1,\ldots,\vv{u}_k \in \RR^n$}, denoted $\cone(\vv{u}_1,\ldots,\vv{u}_k)$, is the set consisting of all \emph{conical combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative real numbers.
Likewise, the \emph{convex hull of $\vv{u}_1,\ldots,\vv{u}_k$}, denoted $\conv(\vv{u}_1,\ldots,\vv{u}_k)$, is the set of all \emph{convex combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative and $\sum_{i=1}^k \lambda_i = 1$.
The convex hull of a finite set of points is called a \emph{polytope}.

If $\mathcal{U}$ and $\mathcal{V}$ are subsets of $\RR^n$, their \emph{Minkowski sum} is the set
\[\mathcal{U}+\mathcal{V} \coloneqq \{\vv{u}+\vv{v}: \vv{u}\in \mathcal{U}\text{ and }\vv{v}\in \mathcal{V}\}.\]
The \emph{Minkowski--Weyl Theorem} asserts that a subset $\mathcal{P}$ of $\RR^n$ is a polyhedron if and only if $\mathcal{P}$ is the Minkowski sum of a polytope and a finitely generated cone.
The cone in this decomposition is the set of all directions $\vv{v} \in \RR^n$ in which $\mathcal{P}$ recedes, that is, $\vv{u} + \lambda \vv{v} \in \mathcal{P}$ for every $\vv{u} \in \mathcal{P}$ and $\lambda > 0$; it is uniquely determined by $\mathcal{P}$, and called the \emph{recession cone of $\mathcal{P}$}.
The Minkowski--Weyl Theorem gives us a couple of useful characterizations of polytopes: a polyhedron $\mathcal{P}$ is a polytope if and only if it is a bounded polyhedron or, equivalently, a polyhedron with a trivial recession cone.

\begin{definition}[Newton polyhedron]
The \emph{Newton polyhedron} associated to the monomial matrix $A$ is the polyhedron in $\RR^\numvars$ given by
\[ \N = \conv( \col(A) ) + \cone( \canvec_1, \ldots, \canvec_\numvars), \]
where $\col(A)$ is the set of columns of $A$.
\end{definition}

\begin{definition}[Faces]
   \label{defn: face}
   A proper nonempty subset $\O$ of $\N$ is a \emph{face} of $\N$ if there exists $\defpt \in \RR^\numvars$ and a nonnegative real number $\alpha$ are such that $\iprod{\defpt}{\vv{v}} \geq \alpha$ for all $\vv{v} \in \N$, with equality if and only if $\vv{v} \in \O$.
   We say that such a point $\defpt$ \emph{defines} $\O$ in $\N$.
   If $\O$ is not contained in any proper coordinate subspace of $\RR^\numvars$, we call it a \emph{standard} face of $\N$.
\end{definition}

\begin{remark}
   \label{rmk: nonnegativity of defining point}
   The requirement that the number $\alpha$ in \Cref{defn: face} be nonnegative is an arbitrary convention, which will play a role in \Cref{alpha=1: convention} below.
   We observe that the defining point $\defpt$ is nonnegative as well.
   Indeed, if $\vv{v} \in \O$, then $\vv{v} + \canvec_i \in \N$, and thus $c_i = \iprod{\defpt}{\vv{v} + \canvec_i} -\alpha \ge 0$, for each $i$.
\end{remark}

In this article, we are largely concerned with standard faces, and for those we shall adopt a helpful convention.

\begin{convention}
\label{alpha=1: convention}
Take $\O \subseteq \RR^\numvars$, $\defpt \in \RR^\numvars$, and $\alpha \in \RR$ as in \Cref{defn: face}.
If $\O$ is standard, then $\alpha$ must be positive, which allows us to rescale $\defpt$ so as to assume that $\alpha = 1$.
Thus, throughout this article, we always assume that defining points of standard faces have been normalized in this way.
\end{convention}

This convention leads to the following useful observation.

\begin{proposition}\label{prop: inner product with columns of A}
   Suppose $\defpt \in \RR^\numvars$ defines a standard face $\O$ of the Newton polyhedron $\N$ associated to the monomial matrix $A$, and let $\vv{s} \in \RR^n$.
   If $s_i \ge 0$ whenever the $i$-th column of $A$ is not in $\O$, then the inner product $\iprod{\defpt}{A\vv{s}}$ is at least $\norm{\vv{s}}$.
   Moreover, equality holds if and only if $s_i = 0$ whenever the $i$-th column of $A$ is not in $\O$.
\end{proposition}

\begin{proof}
If $\vv{a}_i$ denotes the $i$-th column of $A$, then \Cref{alpha=1: convention} and the assumption on $\vv{s}$ imply that $\iprod{\defpt}{\vv{a}_i}  s_i \geq s_i$ for every $1 \leq i \leq n$, with equality if and only if $s_i = 0$ or $\vv{a}_i \in \O$.
Thus,
\[ \iprod{\defpt}{A\vv{s}} = \sum_{i=1}^n \iprod{\defpt}{\vv{a}_i} s_i \geq  \sum_{i=1}^n s_i  = \norm{\vv{s}},\]
and equality holds if and only if $s_i = 0$ whenever $\vv{a}_i \notin \O$.
\end{proof}

% \pedro[inline]{
%    The identity $\O =  \conv( \col(A) \cap \O ) + \cone(\rb(\O))$ appeared in the proof of a proposition that is now commented out.
%    It didn't seem obvious nor necessary to that proof, and seemed to say more than the proposition itself.
%    Since the identity is used a couple of times, I decided to focus on it instead.
   
%    From the wording in the older proof (``Similar logic shows that\ldots''), it seems that someone may know a simpler proof for it.
%    If that's the case, please replace the proof below with it.
% }

\begin{proposition}
   \label{prop: MW for faces}  
   Let $\O$ be a face of the Newton polyhedron $\N$ associated to the monomial matrix $A$, and suppose $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
   Set $\rb(\O) =  \{ \canvec_i \in \RR^\numvars : \iprod{\defpt}{\canvec_i} = 0\}$.
   Then
   \[\O =  \conv( \col(A) \cap \O ) + \cone(\rb(\O)),\]
   where we agree that $\cone(\emptyset) = \{\vv{0}\}$.
   In particular, the supporting indices of $\defpt$ depend only on $\O$, and $\O$ is bounded if and only if $\defpt$ is positive.
\end{proposition}

\begin{proof}
   Suppose $\iprod{\defpt}{\vv{v}} = \alpha$ for all $\vv{v} \in \O$.
   Then one easily sees that the same holds for all $\vv{v} \in\conv( \col(A) \cap \O ) + \cone(\rb(\O)) \subseteq \N$, showing that this sum is contained in  $\O$.

   To prove the reverse containment, let $\vv{v} \in \O$.
   Since $\vv{v} \in \N$, we know that $\vv{v} \ge A \vv{s}$ for some $\vv{s}\ge \vv{0}$ with $\norm{\vv{s}} = 1$.
   Denoting the $i$-th column of $A$ by $\vv{a}_i$, we may assume that $\col(A) \cap \O = \{\vv{a}_1,\ldots,\vv{a}_k\}$.
   If $s_1 + \cdots + s_k$ were  $0$, then $\iprod{\defpt}{\vv{v}} \ge \iprod{\defpt}{A\vv{s}} = \sum_{i>k} s_i \iprod{\defpt}{\vv{a}_i}> \alpha \cdot \sum_{i>k} s_i  =\alpha$, a contradiction.
   So $s_1+\cdots+s_k >0$, and we set
   \[\vv{w} = \frac{s_1\vv{a}_1+\cdots+s_k\vv{a}_k}{s_1+\cdots+s_k}.\]
   Then $\vv{w} \in \conv(\col(A)\cap \O) \subseteq \O$, and therefore $\iprod{\defpt}{\vv{w}} = \alpha$.
   As $\iprod{\defpt}{\vv{v}-\vv{w}} = 0$, the nonnegativity of $\vv{v} - \vv{w}$ and $\defpt$ implies that $\vv{v} - \vv{w} \in \cone(\rb(\O))$, showing that $\vv{v} \in \conv( \col(A) \cap \O ) + \cone(\rb(\O))$.
\end{proof}

% \emily[inline]{Is there a reason that we are defining $\rb \O$ here, instead of before \Cref{prop: MW for faces}, right above (where it is defined in the statement)?}
% \pedro[inline]{
%    I think the original intention was to show that the definition is independent of the choice of $\defpt$ before the definition, as opposed to justifying it afterwards.
%    We could switch things around, though.
% }
% \emily[inline]{Got it.  I like it as is.}
\begin{definition}[Recession basis and subspace]
   If $\defpt \in \RR^\numvars$ defines $\O$, then the \emph{recession basis} of $\O$ is the set $\rb(\O)$ of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that the $i$-th coordinate of $\defpt$ is zero, and the \emph{recession subspace} of $\O$ is the subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.
\end{definition}

\Cref{prop: MW for faces} above shows that these definitions depend only on $\O$, but not on the choice of the defining point $\defpt$.
It also shows that the cone generated by $\rb(\O)$ is the recession cone of $\O$, motivating our choice of terminology.




\subsection{The $F$-threshold of a monomial pair}

\begin{definition}[Minimal face]
   The \emph{minimal face} of $(A, \vv{u})$ is the face $\mf(A, \vv{u})$ of $\N$ that is minimal, with respect to inclusion, among the faces containing the unique point where the cone generated by $\vv{u}$ intersects the boundary of $\N$.
\end{definition}

Note that the intersection of two faces of $\N$ is also a face of $\N$.
Thus, as minimality here is with respect to inclusion, it follows that there is a unique such minimal face.
Note also that the positivity of $\vv{u}$ implies that $\mf(A,\vv{u})$ is a standard face of $A$.

The \emph{relative interior} of a subset $\mathcal{U}$ of $\RR^n$, denoted $\ri \mathcal{U}$, is its interior relative to the smallest affine subset of $\RR^n$ containing $\mathcal{U}$.
The relative interior of a polyhedron is simply the subset of all points not contained in any proper face.
The minimality of $\mf(A,\vv{u})$ implies, then, that the cone generated by $\vv{u}$ intersects the boundary of $\N$ at a point in the relative interior of $\mf(A,\vv{u})$.

\begin{proposition}
   \label{FT descriptions: P}
   The following numbers coincide\textup:
   \begin{enumerate}
      \item\label{value} The value of the linear program $\LP(A, \vv{u})$.
      \item\label{limit} The limit of $q^{-1}\val \IP(A,\vv{u},q)$ as $q$ tends to infinity.
      \item\label{lambda} The unique positive real number $\lambda$ with the property that the scaled point $\lambda^{-1}\vv{u}$ lies in the boundary of $\N$.
      \item\label{new ip} The inner product $\iprod{\vv{c}}{\vv{u}}$, where $\vv{c} \in \RR^\numvars$ is a point defining the minimal face $\mf(A, \vv{u})$ in $\N$ \textup(adhering to \Cref{alpha=1: convention}\textup).
   \end{enumerate}
\end{proposition}

As noted in \Cref{ft as val LP: P}, if $(A,\vv{u})$ is a monomial pair associated to the ideal pair $(\ideala,\ideald)$, then the quantity appearing in \Cref{FT descriptions: P}(1) can be described algebraically as the $F$-threshold of $(\ideala,\ideald)$.
This motivates the following definition.

\begin{definition}[$F$-threshold]
\label{FT: D}
   The \emph{$F$-threshold} of a monomial pair $(A, \vv{u})$ is the number described in \Cref{FT descriptions: P}.  We denote it by $\ft{A}{\vv{u}}$.
\end{definition}

\begin{proof}[Proof of \Cref{FT descriptions: P}]
 \Cref{ft as val LP: P} and \eqref{ft as limit of normalized program values: eq} tells us that the quantities in \eqref{value} and \eqref{limit} agree.  In what follows, let $\lambda$ be as in \eqref{lambda}.


    Let $\O = \mf(A,\vv{u})$, and fix a point $\vv{c} \in \RR^\numvars$ defining $\O$ in $\N$.  Our choice of $\lambda$ allows us to write
    $\vv{u} = \lambda \vv{w}$ for some $\vv{w} \in \O$,  and in view of \Cref{alpha=1: convention}, it follows that $\iprod{\vv{c}}{\vv{u}} = \lambda \iprod{\vv{c}}{\vv{w}} = \lambda$.
   This establishes the equality of the numbers described in \eqref{lambda} and \eqref{new ip}.

Therefore, to conclude our proof,  it remains to show that $\val \LP = \lambda$, where $\LP = \LP(A, \vv{u})$.  Towards this, note that if $\vv{s} \in \feas \LP$, then $\vv{s}\ge \vv{0}$ and $A \vv{s} \leq \vv{u}$, and consequently
  $\norm{\vv{s}} \le \iprod{\vv{c}}{A \vv{s}} \leq \iprod{\vv{c}}{\vv{u}} = \lambda$,
   where the first inequality follows from \Cref{prop: inner product with columns of A}, and the second from the nonnegativity of $\vv{c}$.
   This shows that the value of $\LP$ is at most $\lambda$. 

   On the other hand, since $\lambda^{-1}\vv{u} \in \N$, we have $\lambda^{-1}\vv{u} \ge A\vv{s}$ for some $\vv{s} \geq \vv{0}$ with $\norm{\vv{s}} = 1$.
   Multiplying by $\lambda$, we see that  $\lambda\vv{s}$ is feasible for $\LP$, and so the value of $\LP$ is at least $\lambda$.
\end{proof}

\begin{example}\label{ex: ft}
   We examine the different characterizations of $\ft{A}{\vv{u}}$ given in \Cref{FT descriptions: P}, for 
   \[A=\begin{bmatrix}5&3&4\\ 5&4&3\\ 2&8&5\end{bmatrix} \quad \text{and} \quad \vv{u} =
      \begin{bmatrix} 1 \\ 1\\ 1 \end{bmatrix}.\]
   The Newton polyhedron $\N$ of $A$ is shown in \Cref{fig: newton polyhedron}.
   \begin{figure}
   \centering
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron.pdf}\\[1.4mm]
      \caption{The Newton polyhedron of $A$}
      \label{fig: newton polyhedron}
   \end{subfigure}
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/splitting_polytope.pdf}
      \caption{The feasible region of $\LP(A,\vv{u})$}
      \label{fig: splitting polytope}
   \end{subfigure}
      \caption{Illustration for \Cref{ex: ft}}
   \label{fig: newton polyhedron and splitting polytope}
   \end{figure} 
   The point $(17/4)\cdot \vv{u}$, shown in white, lies in the relative interior of the face
   \[\O = \conv(\col(A)) + \cone(\canvec_2).\]
   Thus, $\mf(A,\vv{u}) = \O$, and the description given in \Cref{FT descriptions: P}\eqref{lambda} tells us that $\ft{A}{\vv{u}} = 4/17$.

   The minimal face $\O$ is defined by the point $\defpt = (3/17, 0, 1/17)$, so \Cref{FT descriptions: P}\eqref{new ip} tells us that
   $\ft{A}{\vv{u}} = \iprod{\defpt}{\vv{u}} = 4/17$.

   From yet another perspective, \Cref{fig: splitting polytope} shows the feasible region of the linear program $\LP(A,\vv{u})$, with its optimal set,
   \[\opt \LP(A,\vv{u}) = \conv\bigg(\bigg(\frac1{17}, 0, \frac3{17}\bigg),\bigg(\frac2{17}, \frac1{17}, \frac1{17}\bigg)\bigg),\]
   highlighted in green.
   Thus, \Cref{FT descriptions: P}\eqref{value} again tells us that
   \[\ft{A}{\vv{u}} = \val \LP(A,\vv{u}) = \bigg\|\bigg(\frac1{17}, 0, \frac3{17}\bigg)\bigg\| = \frac4{17}.\]
\end{example}

\subsection{Characterizing optimal points of $\LP(A,\vv{u})$}

\Cref{prop: MW for faces} above implies that $\vv{u}$ is a conical combination of the columns of $A$ lying in $\O = \mf(A,\vv{u})$ and the points in the recession basis of $\O$.
Typically, there are many ways to express $\vv{u}$ as such a conical combination, and as we see below, the set of all such expressions parameterizes  $\opt \LP(A, \vv{u})$.

\begin{proposition}\label{opt set: P}
%   Let $(A,\vv{u})$ be a monomial pair, where $A$ is an $\numvars\times n$ matrix.
   A point $\vv{s} \in \RR^n$ is optimal for $\LP(A, \vv{u})$ if and only if it satisfies the following conditions.
\begin{enumerate}
\item  \label{mc coords: e} The coordinates of $\vv{s}$ are nonnegative, and the $i$-th coordinate of $\vv{s}$ is zero whenever the $i$-th column of $A$ is not contained in $\O = \mf(A, \vv{u})$.
\item  \label{mc decomposition: e} $\vv{u} = A \vv{s} + \vv{w}$ for some $\vv{w} \in  \cone(\rb(\O))$.
%\item  \label{mc sum: e}$\norm{\vv{s}} = \ft{A}{\vv{u}}$.
\end{enumerate}
\end{proposition}

\begin{proof}
   Set $\LP = \LP(A, \vv{u})$ and $\lambda = \val \LP $, and fix $\defpt \in \RR^\numvars$ that defines the face $\O = \mf(A, \vv{u})$ in the Newton polyhedron of $A$.
   Let $\vv{s} \in \RR^n$ and set $\vv{w} = \vv{u} - A\vv{s}$.
   By \Cref{prop: inner product with columns of A,FT descriptions: P},
   %
   \begin{equation}\label{eq 1}
      \lambda = \iprod{\defpt}{\vv{u}} = \iprod{\defpt}{A \vv{s}} + \iprod{\defpt}{\vv{w}} \geq \norm{\vv{s}} + \iprod{\defpt}{\vv{w}}.
   \end{equation}
   %
   If $\vv{s}$ is optimal for $\LP$, then $\vv{s} \ge \vv{0}$, $\vv{w} \ge \vv{0}$, and $\norm{\vv{s}} = \lambda$, and \eqref{eq 1} shows that $\iprod{\defpt}{A \vv{s}} = \norm{\vv{s}}$ and $\iprod{\defpt}{\vv{w}} = 0$.
   The first identity and \Cref{prop: inner product with columns of A} show that $\vv{s}$ satisfies~(1); the second identity shows that $\vv{w}\in \cone(\rb(\O))$, so $\vv{s}$ satisfies~(2).
   Conversely, if $\vv{s}$ satisfies (1) and (2), then $\vv{s}$ is feasible for $\LP$, $\iprod{\defpt}{A \vv{s}} = \norm{\vv{s}}$, and $\iprod{\defpt}{\vv{w}} = 0$.
   By \eqref{eq 1}, $\norm{\vv{s}} = \lambda$, so $\vv{s}$ is optimal for $\LP$.
\end{proof}

The previous proposition allows us to show the existence of a ``universal'' denominator for the vertices---that is, faces of dimension zero---of $\opt\LP(A,\vv{u})$, dependent only on the monomial matrix $A$, and not on $\vv{u}$.
For that, we shall need the following well-known characterization of the vertices of a polyhedron, whose proof can be found, for instance, in \cite[Theorem~3.34]{conforti+etal.integer_programming}.

\begin{lemma}
   \label{prop: characterization of vertices}
   Let $\mathcal{P}$ be the polyhedron defined by a system of inequalities $M \vv{x} \le \vv{b}$, where $M\in \RR^{s\times t}$, and let $\vv{v} \in \mathcal{P}$.
   For a subset $I$ of $\{1,\ldots,s\}$, let $M_I$ and $\vv{b}_I$ be the matrix and vector obtained by selecting the $i$-th rows of $M$ and $\vv{b}$, for each $i\in I$.
   Then $\vv{v}$ is a vertex of $\mathcal{P}$ if and only if there exists $I \subseteq \{1,\ldots,s\}$ such that $A_I$ is a nonsingular square matrix and $\vv{v} = M_I^{-1}\vv{b}_I$.
\qed
\end{lemma}

\begin{theorem}
\label{uniform denominators for vertices:  T}
Given a monomial matrix $A$, there exists a positive integer $\denom = \denom(A)$ such that for every $A$-pair $(A, \vv{u})$, every vertex of $\opt \LP(A, \vv{u})$ is rational with denominator $\denom$.
\end{theorem}

\begin{proof}
   Let $M$ be the matrix obtained by stacking $A$, $-A$, the identity matrix $I_n$, and $-I_n$, and let $\vv{b}$ be obtained by stacking $\vv{u}$, $-\vv{u}$, and $\vv{0}\in \RR^{2n}$.
   By \Cref{opt set: P}, $\opt \LP(A,\vv{u})$ is defined by the inequalities $A\vv{s} \le \vv{u}$ and $\vv{s}\ge \vv{0}$, where equality is required in a prescribed set of coordinates.
   Thus, $\opt \LP(A,\vv{u})$ is defined by a subsystem of $M \vv{x} \le \vv{b}$.
   Let $\denom$ be the least common multiple of the nonzero $n\times n$ minors of $M$.
   Then by \Cref{prop: characterization of vertices}, every vertex of $\opt \LP(A,\vv{u})$ is rational, with denominator $\denom$.
\end{proof}

\subsection{Special points and universal denominators}

Technicalities that arise in future sections whenever the minimal face of $(A, \vv{u})$ is unbounded force us to consider a certain distinguished subset of optimal points, in which we require a strengthening of condition \eqref{mc decomposition: e} in \Cref{opt set: P}.

\begin{definition}[Special point]
   \label{mc: D}
   Let $\O = \mf(A, \vv{u})$.
   A point $\vv{s}$ is a \emph{special point} for $(A, \vv{u})$ if it satisfies the following conditions.
\begin{enumerate}
\item $\vv{s} \in \opt \LP(A, \vv{u})$.
%\item $\vv{u} = A \vv{s} + \vv{w}$ for some $\vv{w}$ in the relative interior of $\cone ( \rb(\O))$.
\item $\vv{u} = A \vv{s} + \vv{w}$ for a positive point $\vv{w}$ of $\rs(\O)$, with the convention that $\vv{w}=\vv{0}$ when $\rb(\O)$ is empty.
% \pedro{We could just say that $\vv{w}$ is a positive point of $\rs(\O)$, which is how we are phrasing things later.}
% \emily{It seems that we agree; I took a crack at updating it.}
\end{enumerate}
The set of all such points is denoted $\sp(A, \vv{u})$, and the set of all such points with rational coordinates is denoted $\sp_{\QQ}(A, \vv{u})$.
\end{definition}

\begin{proposition}
   \label{opt versus mc: P}
   If $\O = \mf(A, \vv{u})$ is bounded, then $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$.  Otherwise,  $\sp(A, \vv{u})$ is a nonempty convex set lying between $\opt \LP(A, \vv{u})$ and $\ri \opt \LP(A, \vv{u})$.
\end{proposition}

\begin{proof}
   If $\O$ is bounded, then $\rb(\O) = \emptyset$, and so $\cone( \rb(\O)) = \{\vv{0} \}$ is equal to its relative interior.
   Thus, in view of \Cref{opt set: P}, condition (2) in \Cref{mc: D} is redundant, and $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$.
   
   Next, set $\lambda = \ft{A}{\vv{u}}$ and assume that $\O$ is unbounded.
   The minimality of $\O$ implies that $\lambda^{-1}\vv{u}$ is not in any proper face of $\O$, and therefore, must lie in its relative interior.  Further, as the relative interior operation on convex sets commutes with Minkowski sums---see, \eg \cite[Theorem 4.10(b)]{vantiel.convex_analysis}---the decomposition in \Cref{prop: MW for faces}  implies that $\vv{u} = \vv{v} + \vv{w}$ with $\vv{v} \in \lambda \conv(\col(A) \cap \O)$ and $\vv{w} \in \ri \cone(\rb(\O))$.  Any realization of $\vv{v}$ as $\lambda$ times a convex combination of the points in $\col(A) \cap \O$ then determines a special point.

 We have just shown that $\sp(A, \vv{u})$ is nonempty, and it is clear that this set is convex.
 Before proceeding to show that $\sp(A, \vv{u})$ contains the relative interior of the optimal set of $\LP = \LP(A,\vv{u})$,
  recall that the relative interior of a polytope consists of all convex combinations with \emph{positive coefficients} of the vertices of the polytope, while the polytope itself consists of all convex combinations of its vertices.

  Let $\vv{s} \in \ri \opt \LP$, and suppose $\vv{s}$ is not special for $(A,\vv{u})$.
  Then there exists some $i$ with $\canvec_i \in \rb(\O)$ for which $A\vv{s}$ agrees with $\vv{u}$ in the $i$-th coordinate.
  The characterization of relative interior above then implies that the same is true for every \emph{vertex} of $\opt \LP$, and consequently for every \emph{point} of $\opt \LP$.
  But this shows that $\sp(A,\vv{u})$ is empty---a contradiction.
\end{proof}

\begin{example}
   \label{ex: ft.1}
   The containments asserted in \Cref{opt versus mc: P} may all be proper.
   Indeed, if $A$ and $\vv{u}$ are as in \Cref{ex: ft}, then $\opt \LP(A,\vv{u})$, highlighted in green in \Cref{fig: splitting polytope}, is the line segment connecting $\vv{s}_0 = (2/17, 1/17, 1/17)$ and $\vv{s}_1 = (1/17, 0, 3/17)$.
   Its relative interior excludes both $\vv{s}_0$ and $\vv{s}_1$, while the set of special points for $(A,\vv{u})$ excludes only $\vv{s}_0$.
   Indeed, setting $\vv{s}_t=(1-t)\vv{s}_0 + t \vv{s}_1$, where $0\le t\le 1$, we have $\vv{u} - A\vv{s}_t = (0,3t/17,0)$, which lies in the relative interior of $\cone(\canvec_2)$ if and only if $0<t\le 1$.
\end{example}

% Consider the monomial matrix \[ A = \begin{bmatrix} a & 0 & c \\ 0 & b & c \\ 0 & 0 & d \end{bmatrix} \]
% where $a,b,c$ are positive integers with $1/a + 1/b = 1/c$ and $d$ is any integer with $d>c$.  The maximal face of the splitting polytope is the edge connecting the points \[ \left( \frac{d-c}{da}, \frac{d-c}{db}, \frac{1}{d} \right) \text{ and } \left( \frac{1}{a}, \frac{1}{b}, 0 \right).\]  On the other hand, it is easy to check that the special points for $(A, \vv{1})$ consist of the points on this edge except for the first of these two  points.

\begin{definition}[Universal denominator]
   \label{universal denominator: D}
   Suppose that $A$ is a monomial matrix.
   A \emph{universal denominator} for $A$ is a positive integer $\denom = \denom(A)$ such that for every $A$-pair $(A, \vv{u})$, there exists a point $\vv{s} \in \sp(A, \vv{u})$ so that $\denom \cdot \vv{s}$ has integer coordinates.
\end{definition}

\begin{theorem}
\label{universal-denominators-exist:  T}
Universal denominators exist.
\end{theorem}

\begin{proof}
   Let $A$ be a monomial matrix.
   Let $\denom_{\circ}$ be an integer satisfying the property described in \Cref{uniform denominators for vertices:  T} relative to $A$, and fix an $A$-pair $(A, \vv{u})$.
   If $\O = \mf(A, \vv{u})$ is bounded, then $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$ by \Cref{opt versus mc: P}, and so every vertex in this set has denominator~$\denom_{\circ}$.

   Next, suppose $\O$ is unbounded, so that $A$ has $\numvars \geq 2$ many rows.
   Without loss of generality, suppose that $\rb(\O) = \{ \canvec_1, \ldots, \canvec_t \}$ for some $1 \leq t \leq \numvars-1$, and fix \emph{positive} integers $\numvars_1, \ldots, \numvars_t$ that sum to $\numvars-1$.
   As demonstrated in the  proof of \Cref{opt versus mc: P}, for every index  $1 \leq i \leq t$, there exists a vertex $\vv{s}_i$ of $\opt \LP(A, \vv{u})$ for which $A \vv{s}_i$ is less than $\vv{u}$ in the $i$-th coordinate.
   It then follows from the definition of special point that the point
   \[ \frac{ \numvars_1 \cdot \vv{s}_1 + \cdots + \numvars_t \cdot  \vv{s}_t}{\numvars-1}  \]
   lies in $\sp_{\QQ}(A, \vv{u})$ and has denominator $(\numvars-1)\denom_{\circ}$.
\end{proof}

\subsection{Discreteness of $F$-thresholds}

The following is a consequence of the discreteness of the $F$-jumping exponents of an ideal in a regular ring \cite[Theorem~3.1]{blickle+mustata+smith.discr_rat_FPTs}.
However, to keep our discussion self-contained, we include an elementary proof in our specialized setting.

\begin{proposition}
\label{discreteness: P}
Given a monomial matrix $A$ and a real number $\beta > 0 $, there are only finitely many numbers of the form $\ft{A}{\vv{u}}$ less than $\beta$.
\end{proposition}

\begin{proof}
   It suffices to show that there are only finitely many numbers $\ft{A}{\vv{u}}$ less than $\beta$ with $\mf(A, \vv{u}) = \O$ being fixed.
   Consider such a pair, and suppose $\defpt$ defines $\O$ in the Newton polyhedron of $A$.
   Then $\ft{A}{\vv{u}} = \iprod{\defpt}{\vv{u}}$, and the nonnegativity of $\defpt$ implies that, as $\vv{u}$ ranges over positive integral points, this inner product takes on only finitely many values less than $\beta$.
   Indeed, when $c_i \ne 0$, the upper bound $\beta$ allows only finitely many choices for $u_i$, while when $c_i = 0$, the value of $u_i$ does not affect the inner product.
\end{proof}


\newpage
\section{Collapsing}

This section concerns an operation used to get around some technical difficulties that arise when dealing with an unbounded minimal face.
Recall that if a face $\O$ of a Newton polyhedron in $\RR^\numvars$ is defined by a point~$\defpt$, then its recession basis is the set $\rb(\O)$ consisting of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that $c_i = 0$, and its recession subspace is the subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.

\begin{definition}
\label{collapse: D}
 Suppose that $\O$ is a proper face of the Newton polyhedron $\N$ of a monomial matrix $A$ with $\numvars$ rows.

\begin{enumerate}
   \item The set $\rb(\O)^{\perp}$ is the complement of $\rb(\O)$ in $\{ \canvec_1, \ldots, \canvec_\numvars \}$, and $\rs(\O)^\perp$ is the subspace of $\RR^\numvars$ spanned by $\rb(\O)^\perp$, that is, the orthogonal complement of $\rs(\O)$ in $\RR^\numvars$.
   (The assumption that $\O \neq \N$ implies that $\rb(\O)^{\perp} \neq \emptyset$.)
% \item The \emph{collapse} of a subset $X$ of $\RR^\numvars$ along $\O$ is the image of $X$ under the projection $\RR^\numvars \stackrel{B}{\longrightarrow} \RR^{\#\rb(\O)^\perp}$, where $B$ is the matrix whose rows are the vectors $\canvec_i$ in $\rb(\O)^\perp$.
% In other words, the collapse of each point $\vv{v}$ along $\O$ is obtained by deleting each coordinate $v_i$ with $\canvec_i\in \rb(\O)$.
   \item The \emph{collapsing along $\O$} is the projection map $\RR^\numvars \to \RR^{\#\rb(\O)^\perp}$ that deletes the $i$-th coordinate of a point whenever $\canvec_i \in \rb(\O)$, while preserving the order of the remaining coordinates.
   The images of points or sets under this projection are called \emph{collapses} of these objects along $\O$.
   \item The \emph{collapse} of $A$ along $\O$ is the matrix obtained from $A$ by collapsing each of its columns along $\O$, or in other words, the matrix obtained by deleting the $i$-th row of $A$ whenever $\canvec_i\in \rb(\O)$.
\end{enumerate}
\end{definition}

Below, we adopt the notation established in \Cref{collapse: D}, and we use an overbar to denote the collapse along $\O$.

\begin{remark}
   \label{rmk: collapse of a matrix}
   It is clear from the definition that $\collapse{A\vv{k}} = \collapse{A}\vv{k}$, for each $\vv{k}$ in the domain of $A$.
%   Indeed, both are obtained by left-multiplying $\vv{k}$ by $BA$, where $B$ is as in \Cref{collapse: D}.
\end{remark}

\begin{remark}
   \label{collapse of a defining vector: R}
   If $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then the coordinates deleted in $\collapse{\defpt}$ correspond precisely to the zero coordinates of $\defpt$.
   Consequently, $\iprod{\defpt}{\vv{u}} = \iprod{\collapse{\defpt}}{\collapse{\vv{u}}}$ for every $\vv{u} \in \RR^\numvars$. \daniel[inline]{Restate this?}
\end{remark}



\begin{remark}
\label{collapse of monomial is monomial: R}
The collapsed matrix $\collapse{A}$ is monomial.  Indeed, each row of $\collapse{A}$ is a row of $A$, and hence is nonzero.   On the other hand, if $\defpt \in \RR^\numvars$ defines $\O$, then \Cref{collapse of a defining vector: R} implies that the inner product of $\collapse{\defpt}$ with every column of $\collapse{A}$ is at least one.  In particular, the columns of $\collapse{A}$ are nonzero.
\end{remark}

\begin{proposition}\label{collapse of Newton polyhedron: P}
   Let $\O$ be a face of the Newton polyhedron $\N$ of a monomial matrix $A$.
   As above, we use an overbar to denote collapse along $\O$.
   Then $\collapse{\N}$ is the Newton polyhedron of $\collapse{A}$, and $\collapse{\O}$ is a bounded face of $\collapse{\N}$.
   In addition, if $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then $ \collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$.
\end{proposition}

\begin{proof}
   Taking the equation defining $\N$ and collapsing it along $\O$, we obtain
   \[ \collapse{\N} = \ol{\conv( \col(A))} + \ol{\cone(\canvec_1, \ldots, \canvec_\numvars)} = \conv( \col(\collapse{A}) ) + \cone(\collapse{\canvec}_1,\ldots,\collapse{\canvec}_m).\]
   The nonzero vectors among $\collapse{\canvec}_1,\ldots,\collapse{\canvec}_m$ are precisely the standard basis vectors in  $\RR^{\#\rb(\O)^\perp}$, so this agrees with the definition of the Newton polyhedron of $\collapse{A}$.

Given \Cref{collapse of a defining vector: R}, it is not difficult to verify that $\collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$ whenever $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
The positivity of $\collapse{\defpt}$ then implies that $\collapse{\O}$ is bounded.
Alternatively, one may collapse the identity in \Cref{prop: MW for faces} along $\O$ to see that the collapsed face $\collapse{\O}$ is the polytope $\conv( \collapse{ \col(A) \cap \O}) = \conv( \col(\collapse{A}) \cap \collapse{\O})$.
\end{proof}

Below, we describe the relationship between collapses and the other notions introduced in \Cref{sec: LPs,s: newton}.

\begin{proposition}
   \label{collapse of mf and mc: P}
   Consider a monomial pair $(A, \vv{u})$, and let an overbar denote collapse along $\O = \mf(A, \vv{u})$.
   Then the following hold.
\begin{enumerate}
\item $\mf(\collapse{A}, \collapse{\vv{u}}) = \collapse{\O}$ and $\ft{A}{\vv{u}} = \ft{\collapse{A}}{\collapse{\vv{u}}}$.
\item Each optimal point for $\LP(A, \vv{u})$ is also optimal for $\LP(\collapse{A}, \collapse{\vv{u}})$.
\item Each special point for $(A, \vv{u})$ is a special point for $(\collapse{A}, \collapse{\vv{u}})$.
\end{enumerate}
\end{proposition}

\begin{proof}
   Set $\lambda = \ft{A}{\vv{u}}$, so that $\lambda^{-1} \vv{u}$ lies in the relative interior of $\O$.
   It is clear that a projection preserves relative interiors, and so $\lambda^{-1}\collapse{\vv{u}}$ must lie in the relative interior of $\collapse{\O}$, a  face of $\collapse{\N}$ by \Cref{collapse of Newton polyhedron: P}.
   This shows that $\collapse{\O}= \mf(\collapse{A},\collapse{\vv{u}})$ and $\lambda = \ft{\collapse{A}}{\collapse{\vv{u}}}$.
   Consequently,
   \[ \val \LP(A, \vv{u}) = \ft{A}{\vv{u}} = \ft{\collapse{A}}{\collapse{\vv{u}}} = \val \LP(\collapse{A}, \collapse{\vv{u}}). \]
   Since each row of $\collapse{A}$ is a row of $A$, the constraints of $\LP(\collapse{A}, \collapse{\vv{u}})$ are a subset of those of $\LP(A, \vv{u})$.
   It follows that any optimal point for $\LP(A, \vv{u})$ must be optimal for $\LP(\collapse{A}, \collapse{\vv{u}})$.
   The boundedness of $\collapse{\O}$, \Cref{opt versus mc: P}, and the preceding observation allows us to conclude that
   \begin{equation*}
      \sp(A, \vv{u}) \subseteq \opt \LP(A, \vv{u}) \subseteq \opt \LP(\collapse{A}, \collapse{\vv{u}}) = \sp(\collapse{A}, \collapse{\vv{u}}).
   \qedhere
\end{equation*}
\end{proof}

\begin{example}
   \label{ex: ft.2}
   Let $A$ and $\vv{u}$ be as in \Cref{ex: ft}.
   Then $\O = \mf(A,\vv{u}) = \conv(\col(A)) + \cone(\canvec_2)$, so $\rb(\O) = \{\canvec_2\}$.
   \Cref{fig: newton polyhedron of collapse} shows the Newton polyhedron of the collapse $\collapse{A}$ of $A$ along $\O$ (compare with \Cref{fig: newton polyhedron}).
   \begin{figure}
   \centering
   \begin{subfigure}{.49\textwidth}
      \centering

      \ \\[.1mm] \

      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron_of_collapse.pdf}\\[2mm]
      \caption{The Newton polyhedron of $\collapse{A}$}
      \label{fig: newton polyhedron of collapse}
   \end{subfigure}
   \begin{subfigure}{.49\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/opt_for_collapse_may_change.pdf}
      \caption{The feasible region of $\LP(\collapse{A},\collapse{\vv{u}})$}
      \label{fig: splitting polytope of collapse}
   \end{subfigure}
   \caption{Illustration for \Cref{ex: ft.2}}
   \label{fig: collapse}
   \end{figure}
   The point $(17/4)\cdot\collapse{\vv{u}}$, shown in white, lies in the relative interior of $\collapse{\O}$, shown in blue; thus, $\collapse{\O} = \mf(\collapse{A},\collapse{\vv{u}})$ and $\ft{\collapse{A}}{\collapse{\vv{u}}} = 4/17 = \ft{A}{\vv{u}}$.

   The feasible region of $\LP(A,\vv{u})$, shown in \Cref{fig: splitting polytope}, is properly contained in the feasible region for $\LP(\collapse{A},\collapse{\vv{u}})$, shown in \Cref{fig: splitting polytope of collapse}, which highlights the difference between those sets in yellow.
   \Cref{fig: splitting polytope of collapse} also shows that the optimal set of $\LP(A,\vv{u})$ is properly contained in the optimal set of $\LP(\collapse{A},\collapse{\vv{u}})$, highlighting the difference between these sets in red.
   Thus, the containment established in \Cref{collapse of mf and mc: P}(2) may be proper---in which case so is the one in (3), since every optimal point for $\LP(\collapse{A},\collapse{\vv{u}})$ is special for $(\collapse{A},\collapse{\vv{u}})$, due to the boundedness of $\collapse{\O}$.
\end{example}

\newpage
\section{An auxiliary integer program}

\subsection{Canonical feasible points}

We highlight a simple construction that associates to any point in $\sp_{\QQ}(A, \vv{u})$ a feasible point for $\IP(A, \vv{u}, q)$.
As a part of this, we call upon some basic notions from modular arithmetic.

\begin{definition}[Least positive residue]
   If $a, b \in \ZZ$ are positive, then $\lpr{a}{b}$ is the \emph{least positive residue} of $a$ modulo $b$, that is, $a \equiv \lpr{a}{b} \bmod b$ and $1 \leq \lpr{a}{b} \leq b$.
\end{definition}

\begin{definition}
   \label{tail: D}
   Let $q$ be a positive integer.
   If $\lambda = a/b$ for some \emph{positive} integers $a$ and $b$, then we define
   \[ \tail{\lambda}_q = \frac{ \lpr{aq}{b}}{b}. \]
   This expression is clearly independent of the choice of the integers $a$ and $b$.
   In addition, we set  $[0]_q = 0$, and if $\vv{s} \in \QQ^n$ is nonnegative, we define $\tail{\vv{s}}_q$ as the point in $\QQ^n$ obtained by applying this operation to each coordinate of $\vv{s}$.
\end{definition}

\begin{remark}
   \label{tail-basics: R}
   If $q \in \ZZ$ is positive and $\lambda = a/b$ with $a$ and $b$ positive integers, then $\tail{\lambda}_q$ is positive and rational, at most $1$,  and depends on  $q$ modulo $b$, but not on $q$ itself.
   Furthermore,
   \[ \lambda q - \tail{\lambda}_q = \frac{aq-\lpr{aq}{b}}{b} \]
   is an integer, and in fact, is the \emph{greatest integer less than $\lambda q$}, that is, $\up{\lambda q} - 1$.
   This number agrees with $\down{ \lambda q}$ if and only if $\lambda q$ is not an integer.
\end{remark}

\begin{lemma}
   \label{less than u: L}
   Suppose that $\vv{s}$ is a special point for a monomial pair $(A, \vv{u})$.
   If $\vv{t}$ is a point in the domain of $A$ with $\vv{0} \leq \vv{t} \leq \vv{s}$, with the latter bound strict in every coordinate in which $\vv{s}$ is positive, then $A \vv{t} < \vv{u}$.
\end{lemma}

\begin{proof}
   Set $\O = \mf(A, \vv{u})$.
   As $\vv{s} \in \sp(A, \vv{u})$, we can write $\vv{u} = A \vv{s} + \vv{w}$,
   where $\vv{w}$ in a positive point of $\rs(\O)$.
   The inequality $\vv{t} \leq \vv{s}$ induces the bound $A \vv{t} \leq A \vv{s} = \vv{u} - \vv{w}$, which shows that $A\vv{t}$ is less than $\vv{u}$ in $\rs(\O)$---recall that by this, we mean that the $i$-th coordinate of $A\vv{t}$ is less than $u_i$ whenever $\canvec_i\in \rs(\O)$. 
   To conclude the proof, it suffices to show that the same is true in the complementary subspace $\rs(\O)^{\perp}$.

   Towards this, let $(\collapse{A},\collapse{\vv{u}})$ be the collapse of $(A,\vv{u})$ along $\O$.
   Our choice of $\vv{t}$ implies that $\collapse{A}( \vv{s} - \vv{t})$ and $\collapse{A} \vv{s} = \collapse{\vv{u}}$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{A}$.
   Therefore, since $\collapse{\vv{u}} = \collapse{A} \vv{s}$ is positive, then the same must be true for $\collapse{A}(\vv{s} - \vv{t})$.
   In other words, $\collapse{A} \vv{t} < \collapse{A} \vv{s} = \collapse{\vv{u}}$, which shows that $A \vv{t}$ is less than  $\vv{u}$ in $\rs(\O)^{\perp}$.
\end{proof}

\begin{remark}
   \label{rmk: verifying inequalities using collapses}
   In the above proof, we used for the first time what will turn out to be a recurring technique in the remainder of this article:
   In order to verify an inequality between points in $\RR^\numvars$, we prove that the inequality holds in the recession subspace $\rs(\O)$ and that it holds for the collapses of the points along $\O$.
   The latter shows that the inequality we are trying to verify also holds in the complementary subspace $\rs(\O)^\perp$, and thus holds in $\RR^\numvars = \rs(\O) \oplus \rs(\O)^\perp$.
\end{remark}

\begin{theorem}
   \label{canonical-feasible: T}
   If $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ and $q \in \ZZ$ is positive, then
   \[ \vv{s}q - \tail{\vv{s}}_q \in \feas \IP(A, \vv{u}, q).\]
   We call $\vv{s}q - \tail{\vv{s}}_q$ a \emph{canonical feasible point} for $\IP(A,\vv{u},q)$.
\end{theorem}

\begin{proof}
   \Cref{tail-basics: R} tells us that if $\vv{t} = \vv{s} - (1/q) {\tail{\vv{s}}_q}$, then $\vv{t}q = \vv{s}q -\tail{\vv{s}}_q$ has nonnegative integer coordinates, and $\vv{t}$ satisfies the hypotheses of \Cref{less  than u: L}, which shows that $A (\vv{s} q - \tail{\vv{s}}_q ) =  A\vv{t}q <  \vv{u}q$.
\end{proof}

\begin{remark}[Comparisons with canonical feasible points]
   \label{comparison: R}
   Adopt the context of \Cref{canonical-feasible: T}, and fix a point $\vv{k}$ that is feasible for $\IP = \IP(A, \vv{u}, q)$.
   Our goal is to describe some natural constraints on the difference between $\vv{k}$ and the feasible point  described in \Cref{canonical-feasible: T}.
   Toward this, set
   \[ \vv{h} =  \vv{k} - \vv{s}q + \tail{\vv{s}}_q \]
   and let an overbar denote the collapse along the face $\O = \mf(A, \vv{u})$.

   Notice that if $s_i = 0$, then $h_i  = k_i \geq 0$ by the nonnegativity constraint of $\IP$.
   The definition of $\vv{h}$ and the constraints of $\IP$ also tell us that $A ( \vv{s}q-\tail{\vv{s}}_q + \vv{h}) = A \vv{k} < \vv{u}q = A \vv{s}q + \vv{w}q$, where $\vv{w} \in \rs(\O)$ is as in \Cref{mc: D}.
   Collapsing this inequality, keeping in mind that $\collapse{\vv{w}} = \vv{0}$, and rearranging terms, shows that $\collapse{A} \vv{h} < \collapse{A} \tail{\vv{s}}_q$.
   This motivates us to study another integer program, that will be formally introduced in the next subsection.
\end{remark}

\subsection{Another integer program}

\begin{definition}[Monomial list]
   A \emph{monomial list} $(A, \vv{u}, \vv{s}, q)$ consists of the following data.
   \begin{enumerate}
      \item A monomial pair $(A, \vv{u})$.
      \item A rational special point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
      \item A positive integer $q$.
   \end{enumerate}
   We call a monomial list whose first term is the matrix $A$ an \emph{$A$-list}.
\end{definition}

\begin{definition}
   \label{aux program: D}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, the integer program $\ip(A, \vv{u}, \vv{s}, q)$ in the domain lattice of $A$ consists of maximizing the function $\vv{h} \mapsto \norm{\vv{h}}$, subject to the constraints that the $i$-th coordinate of $\vv{h}$ is nonnegative whenever the $i$-th coordinate of $\vv{s}$ is zero, and $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$, where the overbar denotes collapse along the minimal face $\mf(A, \vv{u})$.
\end{definition}

Recall that since each row of $\collapse{A}$ is a row of $A$, the inequalities determined by $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$ are a subset of those in $A \vv{h}  < A \tail{\vv{s}}_q$.
Also note that because $\collapse{A}$ is a monomial matrix, the inequality $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$ imposes upper bounds on all coordinates of $\vv{h}$, and thus $\ip(A, \vv{u}, \vv{s}, q)$ has a well-defined value.

\begin{example}
   \label{ex: ft.3}
   Let $A$ and $\vv{u}$ be as in \Cref{ex: ft,ex: ft.1,ex: ft.2}, and consider the special point $\vv{s}=(1/17,0,3/17)$.
   The constraints for $\ip = \ip(A,\vv{u},\vv{s},q)$ in this case are $h_2 \ge 0$ and $\collapse{A}\vv{h} < \collapse{A}\tail{\vv{s}}_q$, where
   \[\collapse{A} = \begin{bmatrix}5&3&4\\ 2&8&5\end{bmatrix}. \]
   \begin{figure}
      \includegraphics[width=.5\textwidth]{pictures/Theta.pdf}
      \caption{The feasible set for the integer program $\ip(A,\vv{u},\vv{s},q)$ in \Cref{ex: ft.3}, with $\lpr{q}{17}=11$}
      \label{fig: Theta}
   \end{figure}
   \Cref{fig: Theta} shows a portion of the (unbounded) polyhedron defined by the above inequalities, in the case where $\lpr{q}{17}=11$, together with the feasible points for $\ip$.
   In this case the value of $\ip$ is $1$, and the optimal set---a subset of which is shown in red in \Cref{fig: Theta}---is infinite.
   In fact, all points of the form $(k,k,1-2k)$, $(k+1,k,-2k)$, and $(k+2,k,-1-2k)$, with $k\in \NN$, are optimal for $\ip$.
   The situation is analogous for $q$ in every other congruence class modulo $17$.
\end{example}

\Cref{comparison: R} tells us that if $(A, \vv{u}, \vv{s}, q)$ is a monomial list and $\vv{k}$ is feasible for $\IP(A, \vv{u}, q)$, then $\vv{k} - \vv{s}q + \tail{\vv{s}}_q$ is feasible for  $\ip (A, \vv{u}, \vv{s}, q)$.
In particular,
\begin{equation}
   \label{ineq between deficits}
   \val \IP(A, \vv{u}, q) \le \ft{A}{\vv{u}}q - \norm{\tail{\vv{s}}_q} + \val \ip (A, \vv{u}, \vv{s}, q),
\end{equation}
where we have used that $\vv{s} \in \opt \LP(A,\vv{u})$ and so $\norm{\vv{s}} = \val \LP(A,\vv{u}) = \ft{A}{\vv{u}}$.
The next proposition gives conditions under which equality holds.

\begin{proposition}
   \label{uniform value: P}
   Consider a monomial list $(A, \vv{u}, \vv{s}, q)$, and a denominator $\denom$ for the special point $\vv{s}$.
   If $\vv{h} \in \opt \ip(A, \vv{u}, \vv{s}, q)$, and $q/\denom$ is greater than every coordinate of $\vv{1} - \vv{h}$ and every coordinate of $A \vv{h}$, then the point $\vv{s}q - \tail{\vv{s}}_q + \vv{h}$ is optimal for $\IP(A, \vv{u}, q)$.
   Consequently, equality holds in \eqref{ineq between deficits}.
\end{proposition}

\begin{proof}
   Let an overbar denote collapse along $\O = \mf(A, \vv{u})$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   \Cref{tail-basics: R} tells us that $\vv{k}$ has integer coordinates, and we claim that $\vv{k} \geq \vv{0}$.
   Indeed, if $s_i$ is zero, then so is $\tail{s_i}_q$, and $k_i = h_i \ge 0$, by the feasibility of  $\vv{h}$ for $\ip = \ip(A, \vv{u}, \vv{s}, q)$.
   On the other hand, if $s_i$ is positive, then it must be at least $1/\denom$, and so
   $k_i = s_iq-\tail{s_i}_q+h_i \ge q/d - 1 + h_i$, and the last expression is nonnegative by assumption.

   To proceed, write $\vv{u} = A \vv{s} + \vv{w}$, where $\vv{w}$ in a positive point of $\rs(\O)$, as in \Cref{mc: D}.
   Now, $\vv{k}$ is feasible for $\IP = \IP(A, \vv{u}, q)$ if and only if
   \[ A\vv{k} = A (\vv{s}q - \tail{\vv{s}}_q + \vv{h})  < \vv{u}q = A {\vv{s}}q + \vv{w}q,\]
   which we rewrite as
   \begin{equation}
      \label{equivalent ineq: e}
      A \vv{h} < A \tail{\vv{s}}_q + \vv{w}q,
   \end{equation}
   and prove using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
   As $\vv{u}=A\vv{s}+\vv{w}$ has integer coordinates, it follows that $\denom$ is also a denominator for $\vv{w}$.
   This and the positivity of $\vv{w}$ in $\rs(\O)$ imply that $\vv{w}q$ is greater than $q\vv{1}/d$ in $\rs(\O)$, which in turn is greater than $A\vv{h}$, by assumption.
   Thus, \eqref{equivalent ineq: e} holds in $\rs(\O)$.
   Collapsing along $\O$, on the other hand, \eqref{equivalent ineq: e} becomes $\collapse{A} \vv{h} < \collapse{A} \tail{\vv{s}}_q$, which holds by the feasibility of $\vv{h}$ for $\ip$, and shows that \eqref{equivalent ineq: e} also holds in $\rs(\O)^\perp$.

   In summary, we have just shown that $\vv{k}$ is feasible for $\IP$, and so
   \[ \val \IP \geq \norm{\vv{k}} = \ft{A}{\vv{u}} \cdot q - \norm{\tail{\vv{s}}_q} + \val \ip, \]
   and equality holds by \eqref{ineq between deficits}.
\end{proof}

We now move towards establishing a useful bound for the value of $\ip(A, \vv{u}, \vv{s}, q)$.

\begin{lemma}
   \label{tail projection: L}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, then $\collapse{A}\tail{\vv{s}}_q$ is a positive lattice point, where the overbar denotes collapse along $\mf(A,\vv{u})$.
\end{lemma}

\begin{proof}
   By construction, $\vv{s}q - \tail{\vv{s}}_q $ has nonnegative integer coordinates, and the identity $\collapse{\vv{u}} q =\collapse{A} \vv{s} q = \collapse{A} ( \vv{s}q - \tail{\vv{s}}_q ) +\collapse{A} \tail{\vv{s}}_q$ then shows that $\collapse{A} \tail{\vv{s}}_q$ must also have integer coordinates.
   To see that this point is positive, note that $\collapse{\vv{u}} = \collapse{A} \vv{s}$ and $\collapse{A} \tail{\vv{s}}_q$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{A}$.
   It is then easy to see that since $\collapse{\vv{u}} = \collapse{A} \vv{s}$ is positive, so is $\collapse{A} \tail{\vv{s}}_q$.
\end{proof}

\begin{proposition}
   \label{bounded value: P}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, then
   \[0 \leq  \val  \ip(A, \vv{u}, \vv{s}, q) < \norm{\tail{\vv{s}}_q}.\]
\end{proposition}

\begin{proof}
   Fix a point $\defpt \in \RR^\numvars$ that defines $\O  = \mf(A, \vv{u})$, and let an overbar denote collapse along $\O$.
   Let $\vv{h}$ be optimal for $\ip = \ip(A, \vv{u}, \vv{s}, q)$.
   If the $i$-th column of $A$ does not lie in $\O$, then $s_i$ is zero, and consequently $h_i$ is nonnegative. 
   \Cref{prop: inner product with columns of A,rmk: collapse of a matrix,collapse of a defining vector: R} then tell us that
   \begin{equation}
      \label{bound in inner product: e}
      \val \ip = \norm{\vv{h}} \leq \iprod{\defpt}{A \vv{h}} = \iprod{\collapse{\defpt}}{\collapse{A} \vv{h}}.
   \end{equation}
   Those same results applied to $\tail{\vv{s}}_q$ give us
   \begin{equation}
      \label{norm of tail: e}
      \norm{\tail{\vv{s}}_q} =  \iprod{\defpt}{A \tail{\vv{s}}_q} = \iprod{\collapse{\defpt}}{\collapse{A} \tail{\vv{s}}_q}.
   \end{equation}
   These observations and the constraint $\collapse{A}\vv{h} <\collapse{A} \tail{\vv{s}_q}$ combine to tell us that
   \[ \val\ip \leq \iprod{\collapse{\defpt}}{\collapse{A} \vv{h}} < \iprod{\collapse{\defpt}}{\collapse{A} \tail{\vv{s}}_q} = \norm{\tail{\vv{s}}_q}.\]
   Finally, the positivity of $\collapse{A}\tail{\vv{s}}_q$ established in \Cref{tail projection: L} implies that $\vv{0}$ is feasible for $\ip$, and thus $\val \ip \ge 0$.
\end{proof}

% \begin{remark}
%    \label{bounded value sharpened: R}
%    For later use, note that if we set $\vv{v} = \collapse{A} \tail{\vv{s}}_q - \collapse{A}\vv{h}$, where $\vv{h}$, as in the above proof, is any optimal point for $\ip(A,\vv{u},\vv{s},q)$, then we have
%    \begin{equation}
%       \label{sharpened bound: E}
%    0 \leq  \val  \ip(A, \vv{u}, \vv{s}, q) \le \norm{\tail{\vv{s}}_q} - \ft{\collapse{A}}{\vv{v}} < \norm{\tail{\vv{s}}_q}.
%    \end{equation}
%    Indeed, \Cref{collapse of Newton polyhedron: P} shows that $\collapse{\defpt}$ is the defining point of the Newton polyhedron $\collapse{\N}$ of $\collapse{A}$, and since $\vv{v}/\ft{\collapse{A}}{\vv{v}}$ lies in $\collapse{\N}$, we have $\iprod{\collapse{\vv{\defpt}}}{\vv{v}} \ge \ft{\collapse{A}}{\vv{v}}$ by \Cref{alpha=1: convention}.
%    Equations \eqref{bound in inner product: e} and \eqref{norm of tail: e}, on the other hand, tell us that $\iprod{\collapse{\vv{\defpt}}}{\vv{v}} \le \norm{\tail{\vv{s}}_q} - \val \ip$.
%    Putting these inequalities together and rearranging gives us the central inequality in \eqref{sharpened bound: E}.
% \end{remark}

\subsection{Some finiteness properties}

We now explore finiteness properties concerning the nature of these programs as, for a fixed monomial matrix $A$, we vary the $A$-list $(A, \vv{u}, \vv{s}, q)$.
The following theorem underlies some of our later finiteness results.


\begin{theorem}
   \label{finitely many secondary programs: T}
   If $A$ is fixed, then there are only finitely many integer programs of the form $\ip(A, \vv{u}, \vv{s}, q)$ as we vary over all $A$-lists $(A, \vv{u}, \vv{s}, q)$.
\end{theorem}

\begin{proof}
   Consider a monomial list $(A, \vv{u}, \vv{s}, q)$.
   As $A$ is fixed, there are only finitely many possibilities for $\O = \mf(A, \vv{u})$, and only finitely many possibilities for the set of supporting indices of any point $\vv{s} \in \sp_{\QQ}(A ,\vv{u})$.

   Next, let $\collapse{A}$ be the collapse of $A$ along the face $\O$.
   If $\vv{s} \in \sp_{\QQ}(A, \vv{u})$, then $\vv{0} \leq \tail{\vv{s}}_q \leq \vv{1}$ for every positive integer $q$.
   Consequently, $\vv{0} \leq \collapse{A} \tail{\vv{s}}_q \leq \collapse{A}\, \vv{1}$, and as \Cref{tail projection: L} tells us that $\collapse{A} \tail{\vv{s}}_q$ has integer coordinates, it follows that there are only finitely many possibilities for this point.
\end{proof}

\begin{corollary}\label{finitely many coord sums: C}
   If $A$ is fixed, then there are only finitely many rational numbers of the form $ \norm{\tail{\vv{s}}_q}$ as we vary over all $A$-lists $(A, \vv{u}, \vv{s}, q)$.
\end{corollary}

\begin{proof}
   This follows from \eqref{norm of tail: e} and the proof of \Cref{finitely many secondary programs: T}.
\end{proof}

\newpage
\section{Toward solving $\IP$}
\label{solving: S}

Suppose that $(A, \vv{u})$ is a monomial pair and that $q$ is positive integer.
The goal in this section is to demonstrate that the value and optimal image of $\IP(A, \vv{u}, q)$ vary with $q$ in a uniform way as $q$ tends to infinity.

\subsection{Shortfall and deficit}

The constraints of the programs $\IP(A,\vv{u},q)$ and $\IP_p(A,\vv{u},q)$ imply that for every subset $\mathcal{F}$ of their feasible sets, the image of $\mathcal{F}$ under $A$, denoted $A(\mathcal{F})$, consists of points in the target lattice of $A$ less than $\vv{u}q$.
In particular, the Minkowski difference $\vv{u}q-A(\mathcal{F})$ consists of positive lattice points in the target lattice of $A$.

\begin{definition}[Shortfall for $\IP$ and $\IP_p$]
   The \emph{shortfall} of the integer program $\IP(A, \vv{u}, q)$ is the Minkowski difference
   \[ \short \IP(A, \vv{u}, q) = \vv{u}q - A( \opt \IP(A, \vv{u}, q)).\]
   The shortfall of the arithmetic integer program $\IP_p(A, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

The preceding discussion shows that the shortfall of either program consists of positive lattice points in the target lattice of $A$.

\begin{remark}[Algebraic interpretation of shortfalls]
\label{shortfall motivation: R}
Let $(A,\vv{u})$ be a monomial pair associated to an ideal pair $(\ideala,\ideald)$.
If $q$ is a power of $p$, $\IP = \IP(A,\vv{u},q)$, and $\nu = \nu(\ideala,\ideald,q) = \val \IP$, then the shortfall of $\IP$ can be interpreted as the ``leftovers'' of $\ideala^\nu$ modulo $\ideald^{[q]}$.

More precisely, the discussion preceding \Cref{IP: D} tells us that the generators of $\ideala^{\nu}$ not contained in $\ideald^{[q]}$ are precisely the monomials of the form $x^{A \vv{k}}$, with $\vv{k}$ in the domain lattice of $A$, and satisfying $\norm{\vv{k}} = \nu$ and $A\vv{k}<\vv{u}q$.  
Keeping in mind that $\nu= \val \IP$, these conditions on $\vv{k}$ are equivalent to $\vv{k}$ being optimal for $\IP$.
Thus, the generators of $\ideala^{\nu}$ not in $\ideald^{[q]}$ are precisely the monomials of the form $x^{\vv{w}}$, with the exponent vector $\vv{w}$ lying in $A(\opt \IP) = \vv{u}q - \short \IP$.
In other words,
\begin{equation}
\label{algebraic shortfall PI general: e}
 \ideala^{\nu(\ideala, \ideald, q)} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP(A,\vv{u},q)} \bmod \ideald^{[q]}.
 \end{equation}
Likewise, one can show that
\begin{equation}
\label{algebraic shortfall PI_p general: e}
\ideala^{[\mu(\ideala, \ideald, q)]} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP_p(A,\vv{u},q)} \bmod \ideald^{[q]},
\end{equation}
giving us an algebraic interpretation for the shortfall of the arithmetic integer program $\IP_p(A,\vv{u},q)$.
\end{remark}

If $\vv{k}$ is optimal for $\IP = \IP(A,\vv{u},q)$ or $\IP_p = \IP_p(A,\vv{u},q)$, then $A\vv{k} < \vv{u}q$.
For sufficiently small positive $\epsilon$, $A(\vv{k}+\epsilon\vv{1}) < \vv{u}q$, so $(\vv{k}+\epsilon \vv{1})/q$ is feasible for $\LP(A,\vv{u})$.
Thus, $\norm{\vv{k}}/q < \val \LP(A,\vv{u}) = \ft{A}{\vv{u}}$, showing that the values of $\IP$ and $\IP_p$ are strictly less than $\ft{A}{\vv{u}}q$.
The notion of \emph{deficit} is introduced to measure how far those values are from this natural upper bound.

\begin{definition}[Deficit for $\IP$ and $\IP_p$]
   The \emph{deficit} of the integer program $\IP(A, \vv{u}, q)$ is positive rational number
   \[ \deficit \IP(A, \vv{u}, q) = \ft{A}{\vv{u}}q - \val \IP(A, \vv{u}, q).\]
   The deficit of the arithmetic integer program $\IP_p(A, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

We now extend the definitions of shortfall and deficit to the auxiliary integer program $\ip(A,\vv{u},\vv{s},q)$.

\begin{definition}[Shortfall and deficit]
   \label{deficit and shortfall ip: D}
   The \emph{shortfall} of the integer program $\ip = \ip(A, \vv{u}, \vv{s}, q)$ is the set
   \[ \short \ip = \collapse{A} \tail{\vv{s}}_q - \collapse{A} (\opt \ip)\]
   where the overbar denotes collapse along $\mf(A, \vv{u})$.
   The \emph{deficit} of $\ip$ is the positive rational number
   \[ \deficit \ip = \norm{\tail{\vv{s}}_q} - \val \ip. \] 
\end{definition}

\Cref{tail projection: L} and the constraints of $\ip$ imply that the shortfall of $\ip$ consists of positive lattice points, while \Cref{bounded value: P} shows that the deficit of $\ip$ is indeed positive.

Our next proposition will show that, even though the optimal set of an integer program $\ip$ may be infinite, as shown in \Cref{ex: ft.3}, its shortfall is always finite.
For that, we shall need the following simple boundedness result.

\begin{lemma}
   \label{bounded polytope: L}
   Let $\vv{c}$ and $\vv{u}$ be points in $\RR^\numvars$, and suppose that $\vv{c}$ has positive coordinates.
   If $\alpha$ is any real number, then the polyhedron consisting of all points $\vv{v} \in \RR^\numvars$ such that  $\vv{v} \le \vv{u}$ and $\iprod{\vv{c}}{\vv{v}} \geq \alpha$ is bounded.
\end{lemma}

\begin{proof}
   It suffices to show that the given set is bounded from below.
   For each $\vv{v}$ in that set and each $i$ we have $\vv{v}\le \vv{u} + (v_i - u_i)\canvec_i$.
   As $\vv{c}$ has positive coordinates, $\alpha\le \iprod{\vv{c}}{\vv{v}}\le \iprod{\vv{c}}{\vv{u} + (v_i -u_i)\canvec_i} = \iprod{\vv{c}}{\vv{u}} + c_i(v_i - u_i)$, so $v_i \ge (\alpha + c_iu_i - \iprod{\vv{c}}{\vv{u}})/c_i$.
\end{proof}

\begin{proposition}
   \label{finite image: P}
   The shortfall of $\ip(A, \vv{u}, \vv{s}, q)$ is finite.
\end{proposition}

\begin{proof}
   Suppose $\defpt$ defines $\O  = \mf(A, \vv{u})$, and let an overbar denote collapse along $\O$.
   If $\vv{k}$ is optimal for $\ip = \ip(A, \vv{u}, \vv{s}, q)$, then \eqref{bound in inner product: e} implies that $\val \ip = \norm{\vv{k}} \leq \iprod{\collapse{\defpt}}{\collapse{A} \vv{k}}$, and so $\collapse{A} \vv{k}$ is a lattice point in the polyhedron of all points $\vv{v}$ with $\vv{v} < \collapse{A} \tail{\vv{s}}_q$ and $\iprod{\collapse{\defpt}}{\vv{v}} \geq \val \ip$.
   The positivity of $\collapse{\defpt}$ and \Cref{bounded polytope: L} then tell us that this polyhedron is bounded.
   Thus, $\collapse{A}(\opt \ip)$ is finite, and therefore so is $\short \ip$.
\end{proof}

\begin{example}
   In the situation of \Cref{ex: ft.3}, we have seen that the optimal set for $\ip = \ip(A,\vv{u},\vv{s},q)$ consists of three infinite families of points.
   A direct computation shows that each of those families provides a unique point in the shortfall of $\ip$, and that $\short\ip = \{(3,1),(2,4),(1,7)\}$.
   % \begin{align*}
   %   P_1 &= \{(k,k,1-2k): k\in \NN\},\\
   %   P_2 &= \{(k+1,k,-2k): k\in \NN\},\\
   %   P_3 &= \{(k+2,k,-1-2k): k\in \NN\}.
   % \end{align*}
   % For $\vv{h} \in \opt\ip$ we have
   % \[
   %    \collapse{A}\tail{\vv{s}}_p -\collapse{A}\vv{h} =
   %    \begin{cases}
   %       (3,1) & \text{if $\vv{h}\in P_1$}\\
   %       (2,4) & \text{if $\vv{h}\in P_2$}\\
   %       (1,7) & \text{if $\vv{h}\in P_3$}
   %    \end{cases}
   % \]
%   Thus, in this case $\short\ip = \{(3,1),(2,4),(1,7)\}$.
\end{example}

\Cref{finite image: P,finitely many secondary programs: T} give us the following result.

%\emily[inline]{Restate?}
\begin{theorem}[Existence of finite sets of representatives]
   \label{fsr-exist: T}
   Given a monomial matrix $A$, there exists a finite subset $\fsr = \fsr(A)$ of the domain lattice of $A$ such that for each integer program $\ip = \ip(A, \vv{u}, \vv{s}, q)$ we have
   \[\short \ip = \collapse{A}\tail{\vv{s}}_q - \collapse{A}(\fsr \cap \opt \ip).\]
   % For every $A$-list $(A, \vv{u}, \vv{s}, q)$, and for every $\vv{v}$ in the image of $\opt\ip(A, \vv{u}, \vv{s}, q)$ under $\collapse{A}$, the collapse of $A$ along $\mf(A,\vv{u})$, there exists $\vv{h} \in \fsr \cap \opt \ip(A, \vv{s}, \vv{u}, q)$ with $\collapse{A} \vv{h} =  \vv{v}$.
\end{theorem}

\begin{proof}
   \Cref{finite image: P} implies that for every monomial list $(A, \vv{u}, \vv{s}, q)$,  there exists a \emph{finite} subset $\fsr(A, \vv{u}, \vv{s}, q)$ of $\opt \ip (A, \vv{u}, \vv{s}, q)$ such that
   \[  \collapse{A}(\opt \ip (A, \vv{u}, \vv{s}, q) ) = \collapse{A}(\fsr(A, \vv{u}, \vv{s}, q)). \]
   \Cref{finitely many secondary programs: T} then implies that these sets may be chosen in such a way so that $\fsr(A) = \bigcup \fsr(A, \vv{u}, \vv{s}, q)$ is finite, where the union is over all $A$-lists.
\end{proof}

\subsection{Relating the two integer programs}
\label{relating-programs: ss}

\begin{proposition}
   \label{uniform value and image: P}
   Given a monomial matrix $A$, there exists $\beta = \beta(A) \in \ZZ$ satisfying the following condition\textup:
   If $(A, \vv{u})$ is a monomial pair, $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ is a point with denominator $\denom$, and $q>\beta \denom$, then
   \[ \deficit \IP(A, \vv{u}, q) = \deficit \ip(A, \vv{u}, \vv{s}, q) \]
   and
   \[ \ol{\short \IP(A, \vv{u}, q)} = \short \ip(A, \vv{u}, \vv{s}, q),\]
   where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
\end{proposition}

\begin{proof}
   Let $\fsr$ be as in \Cref{fsr-exist: T}, and $\beta$ be the maximum among all coordinates of all points of $\vv{1} - \fsr$ and $A(\fsr)$.
   Fix an $A$-pair $(A, \vv{u})$ and a point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
   If $\denom$ is a denominator for $\vv{s}$, fix an integer $q > \beta \denom$, and set $\IP = \IP(A,\vv{u},q)$ and $\ip = \ip(A,\vv{u},\vv{s},q)$.
   \Cref{uniform value: P} then shows that
   \begin{equation}\label{eq: comparing values}
       \val \IP = \ft{A}{\vv{u}}q - \norm{\tail{\vv{s}}_q}+\val\ip,
   \end{equation}
   so $\deficit \IP = \deficit \ip$.
   Let $\vv{h}$ be a point in the domain lattice of $A$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   Multiplying by $\collapse{A}$ and noting that $\collapse{A}\vv{s} = \collapse{\vv{u}}$, we obtain
   \begin{equation}\label{eq: comparing differences}
   \collapse{\vv{u}}q - \collapse{A}\vv{k} = \collapse{A}\tail{\vv{s}}_q - \collapse{A} \vv{h}.
   \end{equation}
   If $\vv{k}\in \opt\IP$, then $\vv{h}$ is feasible for $\ip$ by \Cref{comparison: R}, and therefore optimal for $\ip$ by \eqref{eq: comparing values}.
   Equation~\eqref{eq: comparing differences} then shows that $\ol{\short\IP}\subseteq \short \ip$.
   Conversely, if $\vv{h} \in \fsr \cap \opt\ip$, then \Cref{uniform value: P} shows that $\vv{k}\in \opt \IP$.
   \Cref{fsr-exist: T} and \eqref{eq: comparing differences} then give us the reverse containment, $\short \ip \subseteq \ol{\short\IP}$.
\end{proof}

The above result leads to a fundamental observation.

\begin{corollary}
   \label{independence: C}
%    Fix a monomial pair $(A, \vv{u})$ and an integer $q>0$.  If $\collapse{A}$ is the collapse of $A$ along $\O = \mf(A, \vv{u})$, then the quantities
% \[   \delta(A, \vv{u}, \vv{s}, q)  = \norm{\tail{\vv{s}}_q}  - \val \ip(A, \vv{u}, \vv{s}, q)\] and
% \[ \Delta(A, \vv{u}, \vv{s}, q)  = \collapse{A} \tail{\vv{s}}_q - \im  \ip( A, \vv{u}, \vv{s}, q)  \]
The deficit and the shortfall of $\ip(A, \vv{u}, \vv{s}, q)$ do not depend on $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
\end{corollary}

\begin{proof}
   Fix $\vv{s}$ and $\vv{s}'$ in $\sp_{\QQ}(A, \vv{u})$, as well as a common denominator $\denom$ for these points.
   As the deficits and shortfalls of $\ip(A,\vv{u},\vv{s},q)$  and $\ip(A,\vv{u},\vv{s}',q)$ clearly depend only on $q$ modulo $\denom$, it suffices to show that they agree whenever $q \gg 0$, but this follows from \Cref{uniform value and image: P}.
\end{proof}

\begin{definition}
\label{independence: D}
Given a monomial pair $(A, \vv{u})$ and positive integer $q$, we define the \emph{universal deficit} and \emph{universal shortfall} of $(A,\vv{u},q)$ as follows\textup:
 \[ \udeficit(A, \vv{u}, q) = \deficit\ip( A, \vv{u}, \vv{s}, q)\] and
\[\ushort(A, \vv{u}, q) = \short\ip( A, \vv{u}, \vv{s}, q), \]
where  $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
\end{definition}

%\begin{remark} Above, we referred to \Cref{uniform value and image: P} to deduce the independence of $\delta(A, \vv{u}, q)$ and $\Delta(A, \vv{u}, q)$ on the rational point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.  Though it seems likely that this can be established with a more direct argument, we have yet to identify one.
%\end{remark}

%\emily[inline]{Maybe we should restate \Cref{finitely many deltas for a fixed A: R} more precisely. }
%
\begin{remark}[A finiteness property]
   \label{finitely many deltas for a fixed A: R}
   Given a monomial matrix $A$, there are only finitely many universal deficits $\udeficit(A, \vv{u}, q)$ and universal shortfalls $\ushort(A, \vv{u}, q)$, as we vary over all $A$-pairs $(A,\vv{u})$ and all positive integers $q$.
   Indeed, this follows immediately from \Cref{finitely many secondary programs: T}.
\end{remark}

\begin{remark}[Invariance of universal deficit and shortfall under collapse]
   \label{comparing deltas: R}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list and $(\collapse{A}, \collapse{\vv{u}})$ is the collapse of $(A ,\vv{u})$ along $\mf(A, \vv{u})$, then \Cref{collapse of mf and mc: P} implies that $(\collapse{A}, \collapse{\vv{u}}, \vv{s}, q)$ is also a monomial list, and it is then clear from \Cref{aux program: D} that $\ip(A, \vv{u}, \vv{s}, q) = \ip(\collapse{A}, \collapse{\vv{u}}, \vv{s}, q)$.
   Consequently,
   \[ \udeficit(A, \vv{u}, q) = \udeficit(\collapse{A}, \collapse{\vv{u}}, q)\]
   and
   \[\ushort(A, \vv{u},q) = \ushort(\collapse{A}, \collapse{\vv{u}}, q),\]
   and one may replace the point in $\sp_{\QQ}(A, \vv{u})$ in \Cref{independence: D} with one in $\sp_{\QQ}(\collapse{A}, \collapse{\vv{u}})$ without affecting the universal deficit and shortfall.
\end{remark}

\begin{remark}[Uniform periodicity of universal shortfall and deficit]
   \label{pair periodicity: R}
   Given a monomial matrix $A$, there exists a positive integer $\denom$ such that for every $A$-pair $(A,\vv{u})$, $\udeficit(A, \vv{u}, q)$ and $\ushort(A,\vv{u},q)$ only depend on $q$ modulo $\denom$.
   Indeed, if $\denom$ is a universal denominator for $A$, as in \Cref{universal denominator:  D}, then we may compute  $\udeficit(A, \vv{u}, q)$ and $\ushort(A, \vv{u}, q)$ for every $A$-pair $(A, \vv{u})$ and every $q$ using a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
   Then
   \[
      \udeficit(A, \vv{u}, p) = \udeficit(A, \vv{u}, q)
   \]
   and
   \[
      \ushort(A, \vv{u}, p) = \ushort(A, \vv{u}, q)
   \]
   whenever $p \equiv q \bmod \denom$.
\end{remark}


% \begin{remark}
%    \label{pair periodicity: R}
%    If $(A, \vv{u})$ is fixed, then the universal deficit and shortfall of $(A, \vv{u}, q)$ are periodic in $q$.
%    Indeed, if $\denom$ is the denominator of some point in $\sp_{\QQ}(A, \vv{u})$, then
%    \begin{equation}
%       \label{periodicity: e}
%       \begin{split}
%       \udeficit(A, \vv{u}, p) &= \udeficit(A, \vv{u}, q)\\
%       &\text{and}\\
%       \ushort(A, \vv{u}, p) &= \ushort(A, \vv{u}, q)
%    \end{split}
%    \end{equation}
%    whenever $p \equiv q \bmod \denom$.
%    In fact, \Cref{comparing deltas: R} tells us that the same is true if instead $\denom$ is the denominator of a point in $\sp_{\QQ}(\collapse{A}, \collapse{\vv{u}})$.
% \end{remark}

% \begin{remark}
%    \label{pair periodicity: R}
%    If only $A$ is specified, then there exists a uniform integer $\denom$ such that \eqref{periodicity: e} holds for every monomial pair $(A, \vv{u})$ whenever $p \equiv q \bmod \denom$.
%    Indeed, if $\denom$ is as a universal denominator, as in \Cref{universal denominator:  D}, then we may compute  $\udeficit(A, \vv{u}, q)$ and $\ushort(A, \vv{u}, q)$ for all monomial pairs $(A, \vv{u})$ and integers $q>0$ using a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
% \end{remark}

We record another application of universal denominators below.

\begin{theorem}
\label{uniform uniform value and image: T}
Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
If $q > \beta$ and $(A, \vv{u})$ is a monomial pair, then
\[  \deficit \IP(A, \vv{u}, q) = \udeficit(A, \vv{u}, q) \]
and
\[  \ol{ \short \IP(A, \vv{u}, q)} = \ushort (A, \vv{u}, q).\] 
\end{theorem}

\begin{proof}
   Let $\denom$ be a universal denominator for $A$, so that for every $A$-pair $(A, \vv{u})$, there exists a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
   If $\beta_{\circ}$  is any integer satisfying the condition stated in \Cref{uniform value and image: P}, then we may take $\beta = \denom \beta_{\circ}$.
\end{proof}

To interpret this result algebraically, we need to extend the notion of collapses to monomial and diagonal ideals.

\begin{definition}[Algebraic collapses]
   Let $(\ideala,\ideald)$ be an ideal pair in $R = \kk[x_1,\ldots,x_\numvars]$.
   Let $(A,\vv{u})$ be an associated monomial pair and $\O=\mf(A,\vv{u})$.
   \begin{enumerate}
      \item The \emph{collapse of $R$} (along $\O$) is the polynomial ring $\collapse{R}$ obtained from $R$ by omitting the variable $x_i$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideala$} (along $\O$) is the monomial ideal $\collapse{\ideala}$ of $\collapse{R}$ obtained from $\ideala$ by setting $x_i$ equal to $1$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideald$} (along $\O$) is the proper diagonal ideal $\collapse{\ideald}$ of $\collapse{R}$ obtained from $\ideald$ by setting $x_i$ equal to $0$ whenever $\canvec_i \in \rb(\O)$.
   \end{enumerate}
\end{definition}

Thus, $\collapse{\ideala}$ and $\collapse{\ideald}$ are the images of $\ideala$ and $\ideald$ under suitable (different) evaluation homomorphisms $R\to \collapse{R}$, designed so that $(\collapse{\ideala},\collapse{\ideald})$ is an ideal pair, and $(\collapse{A},\collapse{\vv{u}})$ is a monomial pair associated to it.

We note that the collapsed ideal pair $(\collapse{\ideala},\collapse{\ideald})$ depends on the choice of the associated monomial pair $(A,\vv{u})$ associated to $(\ideala,\ideald)$.
If this choice is irrelevant or clear from the context, then we shall omit the reference to the minimal face $\O$ when referring to collapsed ideal pairs.

% \begin{remark}[An algebraic interpretation]
%    \label{leftover p large: R}
%    Let $(A, \vv{u})$ be a monomial pair associated to an ideal pair $(\ideala, \ideald)$.
%    If $\beta = \beta(A)$ is as in \Cref{uniform uniform value and image: T}, then the first conclusion of that theorem tells us that if $q > \beta$, then
%    \[ \nu(\ideala, \ideald, q) = \ft{\ideala}{\ideald} q - \udeficit(A, \vv{u},q). \] 

%    Next, we consider the algebraic implications of the description of the collapse of the optimal image of $\IP(A, \vv{u}, q)$ in \Cref{uniform uniform value and image: T}.
%    For simplicity, we first consider the case that $\O = \mf(A, \vv{u})$ is bounded.
%    In this case,  the collapse along $\O$ is the identity map, and so $\short\IP(A, \vv{u}, q) = \ushort(A, \vv{u},q)$.
% In light of this, it follows from \Cref{shortfall motivation: R} that whenever $q >\beta$,
% \[ \ideala^{\nu(\ideala, \ideald, q)} \equiv \ideal{x^{\vv{u}q-\vv{w}}: \vv{w} \in \ushort(A,\vv{u},q)} \bmod \ideald^{[q]}.\]
% In other words, the ``leftovers" of $\ideala^{\nu(\ideala, \ideald, q)}$ modulo $\ideald^{[q]}$, the diagonal ideal determined by $\vv{u}q$, differ from $\vv{u}q$ in a uniform way, at least when $q > \beta$.

% When $\O$ is unbounded, the situation is slightly more complicated. \daniel{Return to this later;  you'll need to settle on how to describe collapses first}
% \end{remark}

% The following is a consequence of \Cref{comparing deltas: R,uniform uniform value and image: T}.

% \begin{corollary}
% Given a monomial matrix $A$, there exists an integer $\beta$ with the following property\textup:  If $q > \beta$ and $(A, \vv{u})$ is a monomial pair with $\O = \mf(A, \vv{u})$, then $\val \IP(A, \vv{u}, q) = \val \IP(\collapse{A}, \collapse{\vv{u}}, q)$ and $\ol{ \im \IP(A, \vv{u}, q)} = \im \IP(\collapse{A}, \collapse{\vv{u}}, q)$ where the overbar denotes collapse along $\O$.
% \end{corollary}

% \emily[inline]{The following could just replace the above statement?  Replace integer programming language with algebraic language? For instance, as follows?}

\begin{corollary}
   Given a monomial ideal $\ideala$, there exists an integer $\beta = \beta(\ideala)$ with the following property\textup:
   If $q> \beta$, and $(\ideala, \ideald)$ is an ideal pair, then
   \begin{equation*}
      \nu(\ideala, \ideald, q) = \ft{\ideala}{\ideald} q - \udeficit(A, \vv{u},q) = \nu(\collapse{\ideala},\collapse{\ideald}, q). \qed
   \end{equation*}
\end{corollary}


% \pedro[inline]{
%    This lemma appeared earlier in the section, and contained things we already knew (positivity and integrality).
%    I removed those things, and what is left should go somewhere else (where it's used), maybe as a remark, maybe incorporated in another proof.
% \begin{lemma}
% \label{independence: L}
% If $\collapse{A}$ is the collapse of $A$ along $\O = \mf(A, \vv{u})$ and $q>0$ is an integer, then no column of $\collapse{A}$ is less than any point in $\ushort(A, \vv{u}, q)$.
% \end{lemma}
% \begin{proof}
%    Suppose $\vv{k}$ is optimal for $\ip = \ip(A,\vv{u},\vv{s},q)$, for some $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
%    Then optimality implies that  $\collapse{A}( \vv{k} + \canvec_i) \not < \collapse{A} \tail{\vv{s}}_q$ for each standard basis vector $\canvec_i$ in the domain of $\collapse{A}$, and thus  $\collapse{A} \canvec_i \not < \collapse{A} \tail{\vv{s}}_q - \collapse{A} \vv{k}$.
% \end{proof}


% \daniel[inline]{I think it is OK to just omit this here, as it is noted (in a slightly more general context) in \Cref{sprouts as collapsed shortfall pairs: R}, which is probably a better location anyway.}
% }


\newpage
\section{Arithmetic integer programs revisited}

The remainder of this paper is dedicated to the study of the arithmetic integer programs $\IP_p(A, \vv{u}, p^e)$ described in \Cref{aip: D}, which perhaps unsurprisingly, turn out to be far more complex in nature than their non-arithmetic counterparts $\IP(A, \vv{u}, p^e)$.
Throughout this section, $e$ will denote a natural number, and $q$ will denote a power of $p$.  

\daniel{Should we state the main result of this section?  \Cref{m-primary AIP: T}?}

\subsection{A key theorem}
The following theorem plays a key role in our algorithm for computing the value of $\IP_p(A, \vv{u}, p^e)$ for $p \gg 0$, in the case that $\ft{A}{\vv{u}} \le 1$ and the matrix $A$ is associated to an $\idealm$-primary ideal, where $\idealm$ is the ideal generated by the variables. 
The description of this algorithm caps off this section, and justifies the main theorem herein (outside of one detail that will be verified in \Cref{sprouting: S}), \Cref{m-primary AIP: T}, which characterizes this value.
In fact, it is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{A}{\vv{u}}$, and, remarkably, depends only on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$. 

\begin{theorem}  
\label{general AIP: T}
If $q$ is a power of $p$, and $e$ is a nonnegative integer, then
%
\[  L \coloneqq \val \IP_p(A, \vv{u}, qp^e) -  \val \IP_p(A, \vv{u}, q)p^e  \]
is nonnegative, at most $p^e-1$, and also at most
%
\[ M \coloneqq \max \{ \val \IP_p(A, \vv{v}, p^e)  \},  \] 
where the maximum is over all points $\vv{v}$ in the shortfall of $\IP_p(A, \vv{u}, q)$.\footnote{
   Recall that, as $A$ is a monomial matrix, the feasible set of $\IP_p(A, \vv{v}, q)$ is finite, and hence, so is the shortfall of this program.  In particular, this maximum value is well defined.
}

If, in addition\daniel{I don't know of any case where $M$ is at least $p^e$, but it might be true in low characteristic.}, $M$ is at most $p^e-1$,  then $L=M$, and 
\[  \short \IP_p(A, \vv{u}, qp^e) = \bigcup \short \IP_p(A, \vv{v}^{\ast}, p^e), \]
where the union is over all $\vv{v}^{\ast} \in \short \IP_p(A, \vv{u}, q)$ that achieve $M$.
\end{theorem}

\begin{proof}
   It is clear that multiplying a feasible point for $\IP_p(A, \vv{u}, q)$ by $p^e$ yields a feasible point for $\IP_p(A, \vv{u}, qp^e)$, from which it follows that $L\geq 0$.


   Next, consider $\vv{g} \in \opt \IP_p(A, \vv{u}, qp^e)$.
   Dividing by $p^e$, we write
   \[ \vv{g} = \vv{h} p^e + \vv{k}, \]
   where $\vv{h}$ and $\vv{k}$ are nonnegative lattice points, and every coordinate of $\vv{k}$ is less than $p^e$.
   By \Cref{dickson: R}, the arithmetic constraint satisfied by $\vv{g}$ implies that $0 \not \equiv \binom{\norm{\vv{g}}}{\vv{g}} \equiv \binom{\norm{\vv{h}}}{\vv{h}} \binom{\norm{\vv{k}}}{\vv{k}} \bmod p$, so that both $\binom{\norm{\vv{h}}}{\vv{h}}$ and $\binom{\norm{\vv{k}}}{\vv{k}}$ must be nonzero modulo $p$.
   In particular, $\vv{h}$ satisfies the arithmetic constraint of $\IP_p(A,\vv{u},q)$, and it is easy to see that it also satisfies its linear constraint.

   Having established the feasibility of $\vv{h}$ for $\IP_p(A,\vv{u},q)$, we now demonstrate its optimality.
   Observe that, by virtue of being a remainder upon division by $p^e$, the base $p$ expansion of $\vv{k}$ is of the form $\vv{k} = \sum_{0 \leq s< e} \vv{k}_s  p^s$.
   As noted in \Cref{dickson: R}, the nonvanishing of $\binom{\norm{\vv{k}}}{\vv{k}} \bmod p$ tells us that each $\norm{\vv{k}_s}$ is less than $p$, and so it follows that $\norm{\vv{k}} < p^e$.
   If $\vv{h}$ were not optimal for $\IP_p(A, \vv{u}, q)$, then there would exist $\vv{m}$ feasible for $\IP_p(A, \vv{u}, q)$ with $\norm{\vv{m}} \geq \norm{\vv{h}} + 1$, which would lead to a point $\vv{m}p^e$ feasible for $\IP_p(A, \vv{u}, qp^e)$ whose norm is
   \[ \norm{\vv{m}}  p^e \geq \norm{\vv{h}}  p^e + p^e >  \norm{\vv{h}}  p^e + \norm{\vv{k}} = \norm{\vv{g}},\]
   which contradicts the optimality of $\vv{g}$.
   We conclude that $\vv{h} \in \opt \IP_p(A, \vv{u},q)$.

   This optimality, along with the definition of shortfalls, tells us that $\vv{v} \coloneqq \vv{u}q-A\vv{h}$ is a point in the shortfall of $\IP_p(A, \vv{u},q)$.
   We may then express the linear constraint on $\vv{g}$ imposed by $\IP_p(A, \vv{u}, qp^e)$ as
   \[ \vv{u}qp^e > A \vv{g} = A \vv{h} p^e + A \vv{k} = (\vv{u}q-\vv{v})p^e + A \vv{k}, \]
   which is equivalent to the constraint $A \vv{k} < \vv{v}p^e$.
   As we have already seen above that $\binom{\norm{\vv{k}}}{\vv{k}}$ is nonzero modulo $p$, it follows that $\vv{k} \in \feas \IP_p(A, \vv{v}, p^e)$.
   Putting everything together, we see that
   \[ L = \norm{\vv{g}}-\norm{\vv{h}}p^e = \norm{\vv{k}} \leq \min \{ p^e-1, \val \IP_p(A, \vv{v}, p^e) \} \leq \min \{ p^e-1, M \}.\]

   For the remainder of this proof, suppose that $M \leq p^e-1$.
   Consider a point  $\vv{v}^{\ast} \in \short \IP_p(A, \vv{u}, q)$ that achieves $M$, and write $\vv{v}^{\ast} = \vv{u}q - A \vv{h}^{\ast}$ for some $\vv{h}^{\ast} \in \opt \IP(A, \vv{u}, q)$.
   If $\vv{k}^{\ast} \in \opt \IP_p(A, \vv{v}^{\ast}, p^e)$, then $\norm{\vv{k}^{\ast}} = M \leq p^e-1$, and so every entry of $\vv{k}^{\ast}$ is at most $p^e - 1$.
   Thus, if $\vv{g}^{\ast} \coloneqq \vv{h}^{\ast} p^e + \vv{k}^{\ast}$, then \Cref{dickson: R} tells us that $\binom{\norm{\vv{g}^{\ast}}}{\vv{g}^{\ast}} \equiv  \binom{\norm{\vv{h}^{\ast}}}{\vv{h}^{\ast}} \binom{\norm{\vv{k}^{\ast}}}{\vv{k}^{\ast}} \not \equiv 0 \bmod p$.
   A direct computation will also show that $\vv{g}^{\ast}$ satisfies the linear constraint of  $\IP_p(A, \vv{u}, qp^e)$, which shows that $\vv{g}^{\ast}$ must be feasible for this program.
   It follows that
   \[ L \geq \norm{\vv{g}^{\ast}} - \norm{\vv{h}^{\ast}}p^e = \norm{\vv{k}^{\ast}} = M, \]
   which allows us to conclude that $L=M$, provided that $M \leq p^e-1$.

   It follows that $\vv{g}^{\ast}$ must be optimal for $\IP_p(A, \vv{u}, qp^e)$, and so the identity
   \[  \vv{v}^{\ast} p^e-A\vv{k}^{\ast} = (\vv{u}q-A\vv{h}^{\ast})p^e-A(\vv{g}^{\ast}-\vv{h}^{\ast}p^e) = \vv{u}qp^e-A \vv{g}^{\ast} \]
   demonstrates that $\vv{v}^{\ast} p^e-A\vv{k}^{\ast}$, an arbitrary point that achieves $M$ in the shortfall of $\IP_p(A, \vv{v}^{\ast}, p^e)$, lies in the shortfall of $\IP_p(A, \vv{u},qp^e)$, showing that
   \begin{equation}
      \label{general comparison of shortfalls: e}
      \bigcup_{\vv{v}^{\ast}} \short \IP_p(A, \vv{v}^{\ast}, p^e) \subseteq \short \IP_p(A, \vv{u}, qp^e).
   \end{equation}

   To establish the opposite containment, let $\vv{g}$ be the optimal point for $\IP_p(A, \vv{u}, qp^e)$ considered earlier in this argument.
   As the reader may verify, now that we know that $L=M$, the optimality of $\vv{g}$ implies that $\vv{v} \in \short \IP_p(A, \vv{u}, q)$ must also achieve $M$, and an argument similar to the one above will show that $\vv{u}qp^e - A \vv{g}$, which represents an arbitrary point in the shortfall of $\IP_p(A, \vv{u}, qp^e)$, equals $\vv{v}p^e-A\vv{k}$, a point in the shortfall of $\IP_p(A, \vv{v}, p^e)$.
   Thus, the containment of sets in \eqref{general comparison of shortfalls: e} must be an equality.
\end{proof}

We record a consequence of the bound $L \leq p^e-1$ in \Cref{general AIP: T} below.

\begin{corollary}
   \label{cor: mu comparison}
   Suppose that $(A,\vv{u})$ and $(B,\vv{v})$ are monomial pairs, not necessarily of the same dimension.  
   If $\val \IP_p(A, \vv{u}, q)$ is greater than $\val \IP_p(B, \vv{v}, q)$ for some $q$, then $\val \IP_p(A, \vv{u}, qp^e)$ is greater than $\val \IP_p(B, \vv{v}, qp^e)$ for all $e$.
\end{corollary}

\begin{proof}
   \Cref{general AIP: T} gives us
   \begin{equation*}
      \val \IP_p(A, \vv{u},q)p^e \leq \val \IP_p(A, \vv{u}, qp^e) < (\val \IP_p(A, \vv{u}, q)+1)p^e,
   \end{equation*}
   as well as analogous inequalities for $(B,\vv{v})$.
   Combining these bounds with our assumption that $\val \IP_p(A, \vv{u}, q) \ge \IP_p(B, \vv{v}, q) + 1$, we see that
   \begin{align*}
     \val \IP_p(A, \vv{u}, qp^e)  &\geq \val \IP_p(A, \vv{u}, q)  p^e \\
                                  &\geq (\val \IP_p(B, \vv{v}, q)+1) p^e \\
                                  & > \val \IP_p(B, \vv{v}, qp^e). \qedhere
   \end{align*}
\end{proof}

\begin{remark}
The integer programs $\IP$ do not always satisfy the ``uniform comparison'' property of the arithmetic integer programs $\Pi_p$ in  \Cref{cor: mu comparison}.
For instance, suppose that $p \equiv 3 \bmod 4$, and let 
\[
 A = \begin{bmatrix} 4 & 0 \\ 0 & 4\end{bmatrix},  \ 
 \vv{u} = \begin{bmatrix}3\\ 3\end{bmatrix}, \text{ and }
 \vv{v} = \begin{bmatrix}5 \\ 1\end{bmatrix}.
\]
Then for $e \geq 1$, 
\[
\val\IP(A, \vv{u}, p^e) = \begin{cases}  
\frac{3}{2}p^e - \frac{1}{2} & \text{if } e \text{ is odd} \\
\frac{3}{2}p^e - \frac{3}{2} & \text{if } e \text{ is even}
\end{cases}
\]

\noindent On the other hand, these values are ``switched'' for $\IP(A, \vv{v}, p^e)$; its value is $\frac{3}{2}p^e - \frac{3}{2}$ when $e$ is odd, and 
equals $\frac{3}{2}p^e - \frac{1}{2}$ for even $e$. 
\end{remark}


\subsection{Small and very small pairs}

\begin{definition}
A monomial pair $(A, \vv{u})$ is \emph{small} if $\vv{u}$ is not greater than any column of $A$, and is \emph{very small} if $\ft{A}{\vv{u}}$ is at most one. 
\end{definition}

\begin{remark}[Algebraic description of small and very small pairs]
\label{algebraic small and very small: R}
  Suppose $(A, \vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$.  If $\vv{a}_i$ is the $i$-th column of $A$, then the condition that $\vv{a}_i \not < \vv{u}$ is equivalent to the condition that the generator $x^{\vv{a}_i}$ of $\ideala$ lies in $\ideald$.  In other words, $(A, \vv{u})$ is small if and only if $\ideala \subseteq \ideald$.

The algebraic characterization of a very small pair is simply that $(A, \vv{u})$ is very small if and only if the $F$-threshold of $\ideala$ with respect to $\ideald$ is at most $1$.
\end{remark}

\begin{remark}[Geometric description of small and very small pairs]
\label{geometric small and very small: R}
Given an $\numvars \times n$ monomial matrix $A$, let $\N \subseteq \RR^{\numvars}$ be its Newton polyhedron.
Geometrically, a pair $(A, \vv{u})$ is small if and only if $\vv{u}$ does not lie in the interior of the Minkowski sum $\col(A) + \cone(\canvec_1,\ldots,\canvec_m)$, a subset of $\RR^{\numvars}$ sometimes called the \emph{upper staircase} determined by the columns of $A$. 
On the other hand, \Cref{FT: D} and \Cref{FT descriptions: P}\eqref{lambda} imply that a pair $(A, \vv{u})$ is very small if and only if $\vv{u}$ does not lie in the interior of $\N$.
It is clear from these interpretations that a very small pair must also be small, and that a small pair can fail to be very small.  %However, once the monomial matrix $A$ is fixed, there are only finitely pairs $(A, \vv{u})$ that are small, but not very small, as the region lying outside of the interior of the staircase determined by $A$, but within the Newton polyhedron $\N$, is bounded.
% \pedro[inline]{
%    Is this true?
%    If we take, say, the example below, and add a row of ones to the matrix, wouldn't this region be unbounded?
%    Don't we get infinitely many ``layers'' of black points?
% }
% \daniel[inline]{This does look like a counterexample.  Maybe I meant to say is that as we very over all small, but not very small, pairs $(A,\vv{u})$, there are only finitely many collapsed pairs $(\ol{A}, \ol{\vv{u}})$.  I think this might have been buried in an earlier version.  But, with the current proof of \Cref{small not very small value: T}, I don't think we ever called upon this ``fact".  Maybe we should even point out this example and state that there can be infinitely many pairs that are small and not very small, perhaps right before we state \Cref{small not very small value: T}. }
% \emily[inline]{Agreed, thanks for noticing this.  I've added a simple example to the remark below, and reminded the reader of this before \Cref{small not very small value: T}.  }
\end{remark}

\begin{example}
   \label{ex: small vs very small}
   \begin{figure} 
      \centering
      \includegraphics[width=.5\textwidth]{pictures/small_very_small_illustration.pdf}
      \caption{Illustration for \Cref{ex: small vs very small}}
      \label{fig: small vs very small}
   \end{figure}
   \Cref{fig: small vs very small} shows the typical situation in two dimensions.
   It shows the Newton polyhedron of a matrix $A$ with two rows, 
   % \daniel{Is it necessary to explicitly indicate the matrix $A$ here?  We could maybe say this is typical of the picture of two variables.}
   % \[A=
   %    \begin{bmatrix}
   %       1&3&7&10\\
   %       10&6&3&2
   %    \end{bmatrix}
   % \]
   as well as the upper staircase determined by the columns of $A$.
   If $\vv{u}$ is any of the gray points, the monomial pair $(A,\vv{u})$ is very small.
   If $\vv{u}$ is any of the black points, $(A,\vv{u})$ is small, but not very small.
   Finally, if $\vv{u}$ is any of the white points, $(A,\vv{u})$ is neither small nor very small.

   It is interesting to notice that if we were to make this a three-dimensional example by adding a nonzero constant row to the matrix $A$, we would then have infinitely many ``layers'' looking exactly like \Cref{fig: small vs very small}, and consequently we would have infinitely many small but not very small pairs. 
   Indeed, this behavior can occur for $\numvars \times n$ monomial matrices $A$ for which $m > 2$.
   For a perhaps simpler (but similar) example, notice that the monomial pair $(A, \vv{u})$ associated to the ideal pair $(\ideala, \ideald)$, where $\ideala= \ideal{x^3 z, y^2z}$ and $\ideald = \ideal{x^2, y, z^t}$, is small but not very small for every $t > 1$. 
\end{example}

\begin{remark}[Small pairs from shortfalls]  
\label{small pairs from shortfalls: R}
If $\vv{v}$ is any point in the shortfall of some integer program $\IP = \IP(A, \vv{u}, q)$, then the pair $(A, \vv{v})$ is small.  Indeed, by definition of shortfalls, we may write $\vv{v} = \vv{u}q-A\vv{h}$ for some $\vv{h} \in \opt \IP$.  Subtracting $\vv{a}_i$, the $i$-column of $A$, from both sides of this identity yields 
\[ \vv{v}-\vv{a}_i = \vv{u}q-A\vv{h}-\vv{a}_i = \vv{u}q-A(\vv{h}+\vv{e}_i). \] 
The optimality of $\vv{h}$ implies that $\vv{h}+\vv{e}_i$ cannot satisfy the linear constraint of $\IP$, which shows that the right-hand side above is not positive.  In other words, $\vv{v} \not > \vv{a}_i$, and as $i$ was arbitrary, this shows that $(A, \vv{v})$ is small.

Similarly, if $\vv{v}$ is any point in the universal shortfall $\ushort(A, \vv{u}, q)$, then $(\collapse{A}, \vv{v})$ is also small, where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
\end{remark}

\begin{proposition}
   \label{trivial small value bound: P} 
   If $(A, \vv{u})$ is small,  then $\val \IP_p(A, \vv{u}, p^e) \leq p^e-1$.
\end{proposition}

\begin{proof}
   For a change of pace, we give an algebraic proof.
   If $(A,\vv{u})$ is associated to the ideal pair $(\ideala, \ideald)$, then as noted in \Cref{algebraic small and very small: R}, the smallness of $(A, \vv{u})$ is equivalent to the containment $\ideala \subseteq \ideald$.
   However, this containment implies that $\ideala^{[p^e]} \subseteq \ideald^{[p^e]}$, which shows that $\val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e) \leq p^e-1$.
\end{proof}

\begin{remark}[Reduction to the small case]
   We now describe how to reduce the computation of the values of the arithmetic integer programs $\IP_p(A, \vv{u}, p^e)$ for all $e \geq 1$ to the small case, at least when $p$ is large relative to the pair $(A, \vv{u})$. 
   For what follows, fix a pair $(A, \vv{u})$, and suppose that $p$ is larger than the value of the standard integer program $\IP(A, \vv{u},1)$.
   The arithmetic constraint of $\IP_p(A,\vv{u},1)$ is thus automatically satisfied, and so $\IP_p(A, \vv{u}, 1) = \IP(A, \vv{u}, 1)$.

   If $\vv{v} \in \short \IP(A,\vv{u},1)$, \Cref{small pairs from shortfalls: R} tells us that $(A, \vv{v})$ is small, and \Cref{trivial small value bound: P}  then tells us that $\val \IP_p(A, \vv{v}, p^e) \le p^e-1$.
   Setting $q=1$ in the statement of \Cref{general AIP: T}, this observation tells us that quantity $M$ defined therein is at most $p^e-1$, and that same theorem shows that
   \[ \val \IP_p(A, \vv{u},p^e) = \val \IP(A, \vv{u},1)p^e + \max \{ \val \IP_p(A, \vv{v}, p^e) \},\]
   where the maximum is over all $\vv{v} \in \short \IP(A, \vv{u},1)$.
   As noted earlier, each such pair is small, which completes our reduction.
\end{remark}

The following theorem allows us to reduce even further, to the very small case; a related statement appears as \cite[Theorem~6.4]{hernandez+etal.frobenius_powers}. 
Notice that \Cref{fig: small vs very small} may be misleading in the sense that in this case, there are only finitely many $\vv{u} \in \NN^2$ for which $(A, \vv{u})$ is small, but not very small, so that the existence of $\beta$ in \Cref{small not very small value: T} is immediate. 
However, as mentioned in \Cref{ex: small vs very small}, given a monomial matrix $A$, there can exist infinitely many small pairs $(A, \vv{u})$ that are not very small.

%if for all $\vv{u} = (2,1,t)$, $t>1$, if $A = \begin{bmatrix} 3 & 0 \\ 0 & 2 \\ 1 & 1 \end{bmatrix}$. 

\begin{theorem}
   \label{small not very small value: T}
   Given a monomial matrix $A$, there exists an integer $\beta=\beta(A)$ with the following property\textup:
   If $(A, \vv{u})$ is small, but not very small, then  \[ \val \IP_p(A, \vv{u}, p^e) = p^e-1\] for every $p > \beta$ and $e \geq 1$.
 % \comment{Compare Theorem~6.4 of \emph{Frobenius Powers}}\emily{Maybe just add ``Cf. \cite[Theorem~6.4]{hernandez+etal.frobenius_powers}'' above?}
\end{theorem}
% \daniel[inline]{This is the "lost theorem" Pedro recovered.  I've added a new proof (the old one is commented out) that does not rely on the fact (stated in \Cref{geometric small and very small: R} without proof) that there are only finitely many small but not very small pairs}

\begin{proof}
   If we fix a universal denominator $\denom$ for $A$, then \Cref{finitely many coord sums: C} implies that there exists an integer $\beta$ such that $p/\denom > \norm{\tail{\vv{s}}_p}$ for every $A$-list $(A,\vv{u},\vv{s}, p)$ with $p > \beta$.
   In what follows, we will assume that $p > \beta$.

   Suppose that $(A,\vv{u})$ is small, but not very small, and let $\vv{s}$ be a special point for this pair with denominator $\denom$.
   \Cref{canonical-feasible: T} then states that
   \[ \vv{k} \coloneqq \vv{s}p-\tail{\vv{s}}_p \in \feas \IP(A,\vv{u},p). \]
   Since $(A,\vv{u})$ is not very small, $\norm{\vv{s}} = \ft{A}{\vv{u}} > 1$, and our choice of $\denom$ then implies that $\norm{\vv{s}} \geq 1 + 1/\denom$, so that
   \[\norm{\vv{k}} \geq p + \frac{p}\denom - \norm{\tail{\vv{s}}_p} > p,\]
   where the strict inequality follows from our choice of $p \gg 0$.

   This bound implies that there exists a point $\vv{h} \leq \vv{k}$ with $\norm{\vv{h}} = p-1$.
   Without loss of generality, assume $h_1 < k_1$, and define $\vv{g} = \vv{h}q + \vv{e}_1(q-1)$.
   By construction, $\vv{g} \leq \vv{k}q, \norm{\vv{g}} = qp-1$, and $\binom{\norm{\vv{g}}}{\vv{g}} \not\equiv 0 \bmod p$.
   Furthermore, the fact that $\vv{k} \in \feas \IP(A,\vv{u},p)$ implies that $A\vv{g} \leq A{\vv{k}}q < \vv{u}qp$, and so $\vv{g} \in \feas \IP_p(A,\vv{u},qp)$.
   It follows that $\val \IP_p(A,\vv{u},qp) \geq \norm{\vv{g}} = qp-1$, and \Cref{trivial small value bound: P} implies that this bound must be an equality.
\end{proof} 

With these reductions in hand, we now describe how to compute the value of $\IP_p(A, \vv{u}, p)$ when $(A, \vv{u})$ is very small,  by appealing to our earlier work on the standard integer programs $\IP(A, \vv{u}, p^e)$. 

\pedro[inline]{
   I modified the statement and proof of the following theorem to isolate the part that depends on $p\gg 0$.
   Original statement and proof were commented out.
}
\daniel[inline]{This is better.  In this light, is it true that if $p \gg 0$ relative to $A$ and $(A,\vv{u})$ is small, then $\IP_p(A,\vv{u},p) = \IP(A,\vv{u},p)$ if and only if $(A,\vv{u})$ is very small?}
\pedro[inline]{
   If $\ft{A}{\vv{u}} > 1$, then $\val \IP(A,\vv{u},p) >  p$, for $p \gg 0$ as in the proof of the previous theorem.
   But if that is the case \emph{and} $\IP_p(A,\vv{u},p) = \IP(A,\vv{u},p)$, then the scarcity of points with norm $p$ satisfying the arithmetic constraint of $\IP_p$ will show that a point of the form $p \canvec_i$ is feasible for these programs.
   This would imply that $p\vv{a}_i < p \vv{u}$, hence $\vv{a}_i < \vv{u}$, so the pair isn't even small, a contradiction.
   (Or maybe it's easier to just argue algebraically.)\\[2mm]
   Maybe this could be a lemma? Something like\ldots
   \begin{lemma}
      If $(A,\vv{u})$ is very small, then the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
      Moreover, the converse is true for $p$ sufficiently large, depending solely on $A$.
   \end{lemma}
   Then we can remove this from the theorem, and eliminate its proof (simply say it follows from the lemma and \Cref{uniform uniform value and image: T}).
}
\emily[inline]{Sounds good to me.}
\begin{theorem}
   \label{arithmetic uniform value and image: T}
   For every very small pair $(A,\vv{u})$, the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
   Consequently, given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $(A, \vv{u})$ is very small, and $p > \beta$, then 
   \[\deficit \IP_p(A,\vv{u},p)=\deficit \IP(A,\vv{u},p) = \udeficit(A,\vv{u},p) \]
   and
   \[ \collapse{\short \IP_p(A,{\vv{u}},p)}= \collapse{\short \IP(A,{\vv{u}},p)}= \ushort(A,\vv{u},p), \]
   where the overbar denotes collapse along $\mf(A, \vv{u})$.
\end{theorem}

\begin{proof}
   We have seen that
   \[ \deficit \IP(A, \vv{u}, p)  = \ft{A}{\vv{u}} p -\val \IP(A, \vv{u}, p)\]
   is positive. 
   As $\ft{A}{\vv{u}} \leq 1$ for a very small pair $(A,\vv{u})$, this implies that $\val\IP(A,\vv{u},p)\le p-1$.
   Thus, every feasible point for $\IP(A, \vv{u}, p)$ automatically satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p)$, and so these programs coincide.
   Our other claims then simply follow from \Cref{uniform uniform value and image: T}.
\end{proof}

% \begin{theorem}
%    \label{arithmetic uniform value and image: T}
%    Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
%    If $(A, \vv{u})$ is very small, and $p > \beta$, then the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
%    In particular, if $p > \beta$, then 
%    \[\deficit \IP_p(A,\vv{u},p)=\deficit \IP(A,\vv{u},p) = \udeficit(A,\vv{u},p) \]
%    and
%    \[ \collapse{\short \IP_p(A,{\vv{u}},p)}= \collapse{\short \IP(A,{\vv{u}},p)}= \ushort(A,\vv{u},p), \]
%    where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
% \end{theorem}

% \begin{proof}
%    If $\beta = \beta(A)$ is as in \Cref{uniform uniform value and image: T}, then
%    \[ \val \IP(A, \vv{u}, p) = \ft{A}{\vv{u}} \cdot p - \udeficit(A, \vv{u}, p) \]
%    for every $A$-pair $(A, \vv{u})$ and $p > \beta$.
%    Suppose from here on that $(A,\vv{u})$ is very small and $p > \beta$.
%    As $\ft{A}{\vv{u}} \leq 1$, the positivity of $\udeficit(A, \vv{u},p)$ implies that $\val\IP(A,\vv{u},p)\le p-1$.
%    Consequently, every point $\vv{k}$ that is feasible for $\IP(A, \vv{u}, p)$ automatically satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p)$.
%    We conclude that $\IP(A, \vv{u}, p) = \IP_p(A, \vv{u}, p)$, and our assertion follows from applying \Cref{uniform uniform value and image: T} once again.
% \end{proof}

\begin{remark} \label{program behavior small: R}
   \Cref{arithmetic uniform value and image: T}, together with the periodicity of universal deficits and shortfalls shown in \Cref{pair periodicity: R}, shows that for a very small pair $(A,\vv{u})$, the deficit and the collapse of the shortfall of  $\IP_p(A,\vv{u},p)$ along $\mf(A, \vv{u})$ do not depend on $p$,  but rather on the class of $p$ modulo a universal denominator.
% For $(A, \vv{u})$ very small, \Cref{arithmetic uniform value and image: T} tells us that for $p \gg 0$, the programs $\IP = \IP(A, \vv{u},p)$ and $\IP_p = \IP_p(A, \vv{u},p)$ coincide, and consequently, the collapse of the shortfall along $\O = \mf(A,\vv{u})$ of $\IP_p$ equals that of $\IP$.  
% Hence, since the collapse of $\short \IP$ along $\O = \mf(A, \vv{u})$ does not depend on $p$,  but rather on the class of $p$ modulo a universal denominator (see \Cref{pair periodicity: R} and \Cref{uniform uniform value and image: T}), the collapse of $\short \IP_p$ is also independent of $p$.  
\end{remark}

\begin{example}
   If $(A, \vv{u})$ is small but not very small, $\IP = \IP(A,\vv{u},p)$ and $\IP_p = \IP_p(A,\vv{u},p)$ need not agree.
   Moreover, the collapses of their shortfalls along the minimal face can also differ.
   For instance, let $A$ be the $2 \times 2$ identity matrix and $\vv{u} = (1,1)$, so that $(A,\vv{u})$ is small, but not very small.
   Notice that in this case the minimal face $\O = \mf(A,\vv{u})$ is bounded, so that collapsing along $\O$ is simply the identity.
   For any prime $p$, $\val \IP = 2p - 2$, attained by a unique optimal point, namely $(p-1,p-1)$; thus, $\short \IP = \{(1,1)\}$, which is independent of $p$, as guaranteed by \Cref{uniform uniform value and image: T}  (at least when $p \gg 0$).
   In contrast, for any odd prime $p$, the point $(\frac{p-1}{2}, \frac{p-1}{2})$ is feasible for $\IP_p$, and therefore optimal by \Cref{trivial small value bound: P}.
   Thus, $\val \IP_p = p-1$ and the point $(\frac{p+1}{2}, \frac{p+1}{2})$, which depends strongly on $p$, is an element of $\short \IP_p$.
\end{example}

The above example shows that the nature of the programs $\IP$ and $\IP_p$ for very small pairs and for small but not very small pairs can differ drastically.
This motivates our technique of reducing to the \emph{very small} setting.  

\Cref{arithmetic uniform value and image: T} is fundamental and, together with \Cref{general AIP: T}, forms the basis for a process to compute the value of $\IP_p(A, \vv{u}, p^e)$ when $p$ is large.  Below, we describe this process in an important special case.  Though somewhat technical, these arguments will motivate some constructions in the general case, which is more complicated, and treated in the next section.

% \subsection{The $\idealm$-primary case}
% \label{m-primary: SS}
%   Our goal here is to describe an algorithm for computing the value of the arithmetic integer program $\IP_p(A,\vv{u}, p^e)$ in the case that $A$ is associated to an $\idealm$-primary monomial ideal, where $\idealm$ is the ideal generated by the variables, $(A,\vv{u})$ is very small, $p$ is large relative to $A$, and $e > 0$ is arbitrary.  As a by-product, this algorithm  establishes the following result.

% \begin{theorem}
%    \label{m-primary AIP: T}
%    If $A$ is a monomial matrix associated to an $\idealm$-primary monomial ideal, then there exists $\beta=\beta(A)$ with the following property\textup:
%    If $p > \beta$ and $(A,\vv{u})$ is very small, then the value of $\IP_p(A,\vv{u},p^e)$ is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{A}{\vv{u}}$.
%    Furthermore, the non-leading coefficients in this polynomial are nonpositive and rational, and depend on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$.
% \end{theorem}

% Our assumption that $A$ comes from an $\idealm$-primary ideal implies that the minimal face $\mf(A, \vv{u})$ is bounded for every pair $(A, \vv{u})$, and so the collapse along every such face is the identity.
% In this context, \Cref{arithmetic uniform value and image: T}, when it applies, becomes a significantly stronger result, as it computes \emph{full} shortfalls, as opposed to a properly collapsed one.
% Indeed, the failure of \Cref{arithmetic uniform value and image: T} to compute full shortfalls in general accounts for much of the increased technicality present in the next section.

% \begin{remark}[On $p$ being sufficiently large]
%    \label{p large m-primary: R}
%    First off, throughout this discussion, we will always assume that $p$ is large enough, relative to $A$, so that the conclusions of \Cref{small not very small value: T,arithmetic uniform value and image: T} are valid.
%    We also want $p$ to be large enough so that the problem of comparing two rational numbers of the form $\val \IP_p(A,\vv{u},p)$, with $(A,\vv{u})$ very small, depends only on the class of $p$ modulo some integer, and not on $p$ itself.

%    More precisely, if $(A,\vv{u})$ is very small, then  \Cref{arithmetic uniform value and image: T} implies that
%    \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p), \]
%    a linear polynomial in $p$.
%    By definition, the very small pair $(A,\vv{u})$ satisfies $\ft{A}{\vv{u}} \leq 1$, and \Cref{discreteness: P} then implies that there are only finitely many possible values for $\ft{A}{\vv{u}}$ as the very small pair $(A,\vv{u})$ varies.

%    Similarly, \Cref{finitely many deltas for a fixed A: R} tells us that there are only finitely many possible values for $\udeficit(A,\vv{u},p)$ as we vary over all pairs $(A,\vv{u})$, while \Cref{pair periodicity: R} tells us that this universal deficit, with $(A,\vv{u})$ fixed, depends on the class of $p$ modulo any universal denominator for $A$, but not on $p$ itself.

%    It follows from these observations that we can choose $p \gg 0$, with the lower bound depending only on the ambient matrix $A$, so that to compare any two numbers of the form $\val \IP_p(A,\vv{u},p)$ with $(A,\vv{u})$ very small, it suffices to first compare their leading coefficients, and if necessary, their constant term.
%    Furthermore, the outcome of any such comparison will depend on the class of $p$ module any universal denominator for $A$, but not on $p$ itself.
% \end{remark}


% We are now prepared to describe our algorithm.
% In what follows, choose $p \gg 0$ as in \Cref{p large m-primary: R}, and fix a universal denominator  $\denom$ for $A$.
% We begin our process by initially defining both $\S_p = \S_p(A,\vv{u})$ and $\S^{\ast}_p = \S^{\ast}_p(A,\vv{u})$ as the singleton set $\S_p=\S_p^{\ast} = \{ (A,\vv{u}) \}$,  and noting that 
% \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p).\]

% We turn our attention to \emph{at least} computing $\val \IP_p(A,\vv{u},p^2)$, and set
% \begin{align*}
%  \S_{p^2} = \S_{p^2}(A,\vv{u}) \coloneqq& \{ (A,\vv{v}) : \vv{v} \in \short \IP_{p}(A,\vv{u},p) \} \\
%  =& \{ (A,\vv{v}) : \vv{v} \in \ushort(A,\vv{u},p)\}.
% \end{align*}  
% Observe that this set depends on the class of $p$ modulo $\denom$, but not on $p$ itself.  Furthermore, \Cref{small pairs from shortfalls: R} tells us that every pair in $\S_{p^2}$ is small.
% This smallness, along with \Cref{trivial small value bound: P}, tells us that
% \[ M_e \coloneqq \max \{ \val \IP_p(A, \vv{v}, p^e) :  (A,\vv{v}) \in \S_{p^2} \}\]
% is at most $p^e-1$.
% \Cref{general AIP: T}, with $q=p$, and \Cref{arithmetic uniform value and image: T} then tell us that
% %
% \begin{equation}
% \label{m-primary value: e}
%  \val \IP_p(A,\vv{u},p^{e+1}) = \ft{A}{\vv{u}}p^{e+1} - \udeficit(A,\vv{u},p)p^e + M_e.
%  \end{equation}
% % 
% \Cref{general AIP: T} also tells us that
% %
% \begin{equation}
% \label{m-primary shortfall: e}
% \short \IP_p(A,\vv{u},p^{e+1}) = \bigcup \short \IP_p(A,\vv{v}, p^e),
% \end{equation}
% %
% where the union is over all $(A,\vv{v}) \in \mathcal\S_{p^2}$ that achieve $M_e$.

% As $\S_{p^2}$ depends on $p$ modulo the universal denominator $\denom$, the issue of whether there exists a pair in $\S_{p^2}$ that is not very small also depends on $p$ modulo $\denom$.  When this occurs, \Cref{small not very small value: T} tells us that $M_e = p^e-1$, and \eqref{m-primary value: e} then allows us to conclude that 
% %
% \[ \val \IP_p(A,\vv{u},p^{e+1})  = \ft{A}{\vv{u}} p^{e+1}-(\udeficit(A,\vv{u},p)-1)p^e-1.  \]
% %
% As this formula is valid for all $e \geq 1$, our process terminates in this case.

% On the other hand, if every pair in $\S_{p^2}$ is very small, then \Cref{arithmetic uniform value and image: T} instead allows us to compute $M_1$ as 
% \[ M_1 = \max \{ \ft{A}{\vv{v}}p-\udeficit(A,\vv{v},p) : (A,\vv{v}) \in \S_{p^2}\}. \] 
% Let $\S_{p^2}^{\ast} = \S_{p^2}^{\ast}(A,\vv{u})$ be the subset of $\S_{p^2}$ consisting of all $(A,\vv{v})$ that first maximize $\ft{A}{\vv{v}}$, and amongst these, then minimize $\udeficit(A,\vv{v},p)$.
% By definition, $\S_{p^2}^{\ast}$ depends on $p$ modulo $\denom$, and our choice of $p \gg 0$ guarantees that $\S_{p^2}^{\ast}$ corresponds to the points in $\S_{p^2}$ that achieve $M_1$.
% Therefore, we may write \[ M_1 = \epsilon_{p^2} p - \delta_{p^2}\]  where $\epsilon_{p^2}$ and $\delta_{p^2}$ are positive rational numbers that depend on $p$ modulo $\denom$.

% Setting $e=1$ in \eqref{m-primary value: e} then shows that 
% %
% \[ \val \IP_p(A,\vv{u},p^2) = \ft{A}{\vv{u}}p^2 - (\udeficit(A,\vv{u},p)-\epsilon_{p^2})p - \delta_{p^2},  \] 
% %
% while setting $e=1$ in \eqref{m-primary shortfall: e} tells us that
% %
% \[ \short \IP_p(A,\vv{u},p^2) = \bigcup_{\vv{v} \in \S_{p^2}^{\ast}} \short \IP_p(A,\vv{v},p) = \bigcup_{\vv{v} \in \S_{p^2}^{\ast}} \ushort(A,\vv{v},p). \]  
% %
% Turning our attention to \emph{at least} computing $\val \IP_p(A,\vv{u},p^3)$, we define
% \begin{align*}
% \S_{p^3} = \S_{p^3}(A,\vv{u}) & \coloneqq \{ (A,\vv{w}):  \vv{w} \in \short \IP_p(A,\vv{u},p^2) \} \\
%  & = \bigg\{ (A,\vv{w}): \vv{w} \in \bigcup_{\vv{v} \in \S_{p^2}^{\ast}} \ushort(A,\vv{v},p) \bigg\}. 
% \end{align*}
% Observe that $\S_{p^3}$ depends on the class of $p$ modulo $\denom$, but not on $p$ itself.
% Furthermore, \Cref{small pairs from shortfalls: R} tells us that every pair in $\S_{p^3}$ is small.

% Next, we set $M'_e  \coloneqq \max \{ \val \IP_p(A, \vv{w}, p^e) :  (A,\vv{w}) \in \S_{p^3}\}$ for every $e \geq 1$.
% Arguing as above, one can find that
% \begin{equation}
% \label{m-primary value 2: e}
%  \val \IP_p(A,\vv{u},p^{e+2}) = \val \IP_p(A,\vv{u},p^2)p^e+ M'_e,
% \end{equation}
% % \ft{A}{\vv{u}}p^{e+2} - (\udeficit(A,\vv{u},p)-\epsilon_p)p^{e+1} - \delta_pp^e
% and also that 
% %
% \begin{equation}
% \label{m-primary shortfall 2: e}
% \short \IP_p(A,\vv{u},p^{e+2}) = \bigcup \short \IP_p(A,\vv{w}, p^e),
% \end{equation}
% where the union is over all $(A,\vv{w}) \in \S_{p^3}$ that achieve $M'_e$.

% Further arguing as above, we see that if there exists a pair in $\S_{p^3}$ that is not very small, then $M'_e = p^e-1$.
% In this case, \eqref{m-primary value 2: e} and our earlier determination of $\val \IP_p(A,\vv{u},p^2)$ tell us that $\val \IP_p(A,\vv{u},p^{e+2})$ equals
% %
% \[ \ft{A}{\vv{u}}p^{e+2} - (\udeficit(A,\vv{u},p)-\epsilon_{p^2})p^{e+1} - (\delta_{p^2}-1)p^e -1. \] 
% %
% As this formula is valid for all $e \geq 1$, our process terminates in this case.

% However, if each pair in $\S_{p^3}$ is very small, then \Cref{arithmetic uniform value and image: T} instead implies that $M'_1 = \max \{ \ft{A}{\vv{w}}p-\udeficit(A,\vv{w},p) : (A,\vv{w}) \in \S_{p^3}\}$.
% As above, the subset $\S^{\ast}_{p^3}$ of $\S_{p^3}$ of points that achieve $M'_1$ depends on $p$ modulo $\denom$, and can be explicitly described in a concrete way.
% Thus, there exist positive rational numbers $\epsilon_{p^3}$ and $\delta_{p^3}$, depending on $p$ modulo $\denom$, such that $M'_1 = \epsilon_{p^3} p -\delta_{p^3}$, and setting $e=1$ in \eqref{m-primary value 2: e} then demonstrates that $\val \IP_p(A,\vv{u},p^3)$ equals
% %
% \[ \ft{A}{\vv{u}}p^{3} - (\udeficit(A,\vv{u},p)-\epsilon_{p^2})p^{2} - (\delta_{p^2}- \epsilon_{p^3})p -\delta_{p^3}. \] 
% %

% In this situation, we may also set $e=1$ in \eqref{m-primary shortfall 2: e} to see that the next collection of shortfalls may be described as 
% %
% \[\short \IP_p(A,\vv{u},p^3) = \bigcup_{\vv{w} \in \S_{p^2}^{\ast}} \short \IP_p(A,\vv{w},p) = \bigcup_{\vv{w} \in \S_{p^3}^{\ast}} \ushort(A,\vv{w},p). \]  

% Next, in analog with our previous definitions, we set %
% \begin{align*}
% \S_{p^4} = \S_{p^4}(A,\vv{u}) & \coloneqq \{ (A,\vv{z}):  \vv{z} \in \short \IP_p(A,\vv{u},p^3) \} \\
%  & = \bigg\{ (A,\vv{z}): \vv{z} \in \bigcup_{\vv{w} \in \S_{p^3}^{\ast}} \ushort(A,\vv{w},p).\bigg\}. 
% \end{align*}
% Like $\S_p,\S_{p^2}$ and $\S_{p^3}$, the set $\S_{p^4}$ consists of small pairs, and depends on $p$ modulo $\denom$, but not on $p$ itself.
% If $\S_{p^4}$ contains a pair that is not very small, then repeating this process, we can compute the value of $\IP_p(A,\vv{u},p^{e+3})$ for all $e \geq 1$.
% Otherwise, we can only compute the value and shortfalls of the next program $\IP_p(A,\vv{u},p^{4})$, and then analogously repeat our arguments.

% We may continue iterating these steps.
% Note that, when it is necessary to define it, the set $\S_{p^e}$ will consist of small pairs $(A,\vv{v})$, where $\vv{v}$ is in some universal shortfall of an $A$-pair.
% It then follows from \Cref{finitely many deltas for a fixed A: R} that all defined $\S_{p^e}$ are subsets of some \emph{finite set} determined by $A$.
% Thus, there is an upper bound for the number of possible distinct  $\S_{p^e}$, and as soon as such a set repeats, the process must cycle from that point onward.

% Finally, we note that it remains to establish the nonpositivity of the non-leading coefficients asserted in \Cref{m-primary AIP: T}, but this follows from  \Cref{non-leading coefficients: L}, and will be covered in our treatment of the general case.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative m-primary subsection starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The $\idealm$-primary case}
\label{m-primary: SS}


\ \pedro[inline]{
   I propose the following alternate version of this subsection.
   It extracts the algorithm from the theorem, not the other way around.
   It is one page shorter.
}
\emily[inline]{The updated organization looks really readable; I like it.}
\pedro[inline]{
   Cool. I commented out the original version, but we can restore it or merge it with this if you guys want.
}
We now focus on computing the value of the arithmetic integer program $\IP_p(A,\vv{u}, p^e)$ when $A$ is associated to an $\idealm$-primary monomial ideal, where $\idealm$ is the ideal generated by the variables of the ambient polynomial ring, $(A,\vv{u})$ is very small, $p$ is large relative to $A$, and $e > 0$ is arbitrary.
The assumption that $A$ comes from an $\idealm$-primary ideal implies that the minimal face of every $A$-pair is bounded, and so the collapse along such face is the identity.
In this context, \Cref{arithmetic uniform value and image: T} becomes significantly stronger, as it computes \emph{full} shortfalls, as opposed to a properly collapsed one.
Indeed, the failure of \Cref{arithmetic uniform value and image: T} to compute full shortfalls in general accounts for much of the increased technicality present in the next section.

The main result of this subsection is the following.

\begin{theorem}
   \label{m-primary AIP: T}
   If $A$ is a monomial matrix associated to an $\idealm$-primary monomial ideal, then there exists $\beta=\beta(A)$ with the following property\textup:
   If $p > \beta$ and $(A,\vv{u})$ is very small, then $\val \IP_p(A,\vv{u},p^e)$ is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{A}{\vv{u}}$, whose non-leading coefficients are rational and depend on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$.
\end{theorem}

\begin{remark}
   In \Cref{non-leading coefficients: P}, we will show that the non-leading coefficients of this polynomial are nonpositive.
   The proof below, however, will only show that the constant coefficient is negative.
\end{remark}

Before presenting the proof, we clarify our requirements for $p\gg 0$.

\begin{remark}[On $p$ being sufficiently large]
   \label{p large m-primary: R}
   First off, we assume that $p$ is large enough so that the conclusions of \Cref{small not very small value: T,arithmetic uniform value and image: T} are valid.
   Moreover, given a collection $\S$ of very small pairs $(A,\vv{u})$, we want the subset~$\S^*$ of~$\S$ consisting of the pairs for which $\val \IP_p(A,\vv{u},p)$ is maximum to only depend on $p$ modulo some integer, and not on $p$ itself.
   We explain below how this can be accomplished by choosing $p$ sufficiently large.

   For a very small pair $(A,\vv{u})$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p).\]
   As we vary over all such pairs, $\ft{A}{\vv{u}}$ remains bounded above by $1$, and thus takes on only finitely many values by \Cref{discreteness: P}.
   \pedro{This is actually unnecessary, as in this case there are only finitely many small pairs.}
   Similarly, $\udeficit(A,\vv{u},p)$ takes on only finitely many values by \Cref{finitely many deltas for a fixed A: R}, while \Cref{pair periodicity: R} tells us that its value, once $(A,\vv{u})$ is fixed, depends only on the class of $p$ modulo a universal denominator $\denom$ for $A$.
   Thus, by choosing $p\gg 0$, with lower bound dependent only on $A$, we can select the very small pairs $(A,\vv{u})$ to be included in $\S^*$ by first selecting those with maximal $\ft{A}{\vv{u}}$ (which is independent of~$p$), and then selecting among those the pairs with minimal $\udeficit(A,\vv{u},p)$ (which only depends on $p$ modulo $\denom$).
\end{remark}

We are now ready to prove the above theorem.

\begin{proof}[Proof of \Cref{m-primary AIP: T}]
   Choose $p \gg 0$ as in \Cref{p large m-primary: R}, and fix a universal denominator $\denom$ for $A$.
   Set $\S_p = \S^*_p = \{ (A,\vv{u}) \}$ and, for each $e > 1$,
   \begin{align*}
   \S_{p^{e}} &= \{ (A,\vv{v}):  \vv{v} \in \short \IP_p(A,\vv{u},p^{e-1}) \},\\
   \S^*_{p^{e}} &= \{ (A,\vv{v}) \in \S_{p^{e}}:  \val\IP_p(A,\vv{v},p)\text{ is maximum} \}.
   \end{align*}
   Now consider the following claims:
   \begin{enumerate}[(a),leftmargin=*]
      \item\label{c1} $\val \IP_p(A,\vv{u},p^e)$ has the stated properties;
      %and its constant coefficient is either $-1$ or is of the form $ - \udeficit(A,\vv{v},p)$, for some $(A,\vv{v}) \in \S^*_{p^{e}}$;
      \item\label{c2} $\S_{p^e}$ consists of very small pairs, and only depends on $p$ modulo $\denom$ (and consequently so does $\S^*_{p^e}$, by our choice of $p\gg 0$ as in \Cref{p large m-primary: R}).
   \end{enumerate}
   For $e=1$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p),\]
   and claim \ref{c1} follows from \Cref{pair periodicity: R}, while \ref{c2} holds trivially.
   Fix $e\ge 1$ and suppose that claims \ref{c1} and \ref{c2} hold for $e$ and all preceding exponents.
   We now proceed to investigate these claims for $e+1$.

   We start with claim \ref{c2}.
   % If $e=1$, then $\short \IP_p(A,\vv{u},p) = \ushort(A,\vv{u},p)$ only depends on $p$ modulo $\denom$ by \Cref{pair periodicity: R}, and consequently so does $\S_{p^2} = \{ (A,\vv{v}):  \vv{v} \in \short \IP_p(A,\vv{u},p) \}$.
   % Furthermore, every pair in $\S_{p^{2}}$ is small by \Cref{small pairs from shortfalls: R,arithmetic uniform value and image: T}.
   % If $e > 1$, 
   \Cref{general AIP: T} shows that 
   \[\short \IP_p(A,\vv{u},p^{e}) = \bigcup_{(A,\vv{v}) \in \S^*_{p^e}} \short \IP_p(A,\vv{v}, p)
      = \bigcup_{(A,\vv{v}) \in \S^*_{p^e}} \ushort(A,\vv{v}, p).\]
   Since $\S^*_{p^e}$ and each $\ushort(A,\vv{v}, p)$ only depend on $p$ modulo $\denom$, so does $\S_{p^{e+1}} = \{(A,\vv{v}): \vv{v}\in \short \IP_p(A,\vv{u},p^{e})\}$.
   Moreover, since $\S^*_{p^e}$ consists of very small pairs, the above decomposition, \Cref{small pairs from shortfalls: R}, and \Cref{arithmetic uniform value and image: T} tell us that every pair in $\S_{p^{e+1}}$ is small.
   We have therefore verified most of claim \ref{c2}, except that $\S_{p^{e+1}}$ might contain a small but not very small pair.
 
   Suppose that is not the case.
   \Cref{general AIP: T,trivial small value bound: P} show that
   \begin{equation}
      \label{recurrence: E}
      \val \IP_p(A,\vv{u},p^{e+1}) = \val \IP_p(A,\vv{u},p^e)p + M,
   \end{equation}
   where $M = \val\IP_p(A,\vv{v},p)$ for any  $(A,\vv{v}) \in \S^*_{p^{e+1}}$.
   Since $(A,\vv{v})$ is very small, \Cref{arithmetic uniform value and image: T} gives us
   \[\val \IP_p(A,\vv{u},p^{e+1}) = (\val \IP_p(A,\vv{u},p^e) + \ft{A}{\vv{v}}) p - \udeficit(A,\vv{v},p),\]
   which, in view of our assumption on $\val \IP_p(A,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   So, in this case claims \ref{c1} and \ref{c2} hold for $e+1$.

   Suppose now that $\S_{p^{e+1}}$ contains a small but not very small pair.
   Engaging the full firepower of \Cref{general AIP: T}, as well as \Cref{small not very small value: T}, we obtain
   \begin{equation}
      \label{tail: E}
      \val \IP_p(A,\vv{u},p^{e+k}) = \val \IP_p(A,\vv{u},p^e)p^k + p^k - 1,\text{ for all }k\in \NN,
   \end{equation}
   which, given our assumption on $\val \IP_p(A,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   Thus, even though \ref{c2} does not hold for $e+1$, we were able to verify \ref{c1} not only for $e+1$, but for all subsequent exponents.
\end{proof}

\begin{remark}[An algorithm]
   \label{m-primary algorithm: R}
   The above proof gives, in this $\idealm$-primary, very small case, an algorithm to compute $\val\IP_p(A,\vv{u},p^e)$ not only up to a specific $e$, but for \emph{all} $e \ge 1$.
   Indeed, as we iterate \eqref{recurrence: E}, one of two situations will occur that will allow us to determine the \emph{entire} remainder of the sequence.

   First, with a bit of luck we may come across a set $\S^*_{p^e}$ that contains a small but not very small pair, and \eqref{tail: E} gives us the remainder of the sequence.
   In the absence of such luck, note that in this $\idealm$-primary case there are only finitely many small $A$-pairs.
   Thus, there are only finitely many distinct sets $\S_{p^e}$, and once one of these sets repeats, the numbers $M$ that appear in the recurrence \eqref{recurrence: E} will cycle from that point onward.

   All of this is formalized in Algorithm~\ref{alg}, which takes a very small pair $(A,\vv{u})$ and a positive representative $r$ for a congruence class modulo a universal denominator $\denom$ for $A$, and returns a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for the values of $\IP_p(A,\vv{u},p^e)$ with $p$ in the given congruence class---a convenient way to pack the entire sequence of values we are after.
   More explicitly, the rational function $G(\pp,\tt)$ returned can be written as a power series
   \[G(\pp,\tt) = \sum_{e=1}^\infty G_e(\pp)\tt^e,\]
   where each $G_e(\pp)$ is a polynomial in $\pp$ such that
   \[ \val \IP_p(A,\vv{u},p^e) = G_e(p)\]
   for any sufficiently large prime $p\equiv r\bmod \denom$.

   Note that this algorithm relies on the solution of several linear programs---each time an $F$-threshold is evaluated---and several integer programs---each time a universal deficit or shortfall is computed.
   Given the computational complexity of solving such programs, our algorithm is bound to be highly inefficient or impractical for large matrices or large $r$.
   Surprisingly, though, a preliminary implementation in \emph{Macaulay2} by the authors fares well on examples of moderate size.
\end{remark}

\pedro[inline]{
   Should we get into more details?
   E.g., present pseudo-code such as Algorithm~\ref{alg}, or discuss practical (or impractical) matters like the computability of the shortfalls?
}
\emily[inline]{The pseudocode looks good.  If we can find a succinct way to touch on computability, I'm for it.}
\pedro[inline]{
   I gave it a shot.
   I changed the notation in the pseudo-code a bit: I'm using $r$ to denote the representative of the congruence class mod $\denom$, to emphasize that it need not be prime.
   I'm now using $\S_e$ (and likewise for $\S^*$), as $\S_{p^e}$ does not make sense anymore, and $\S_{r^e}$ causes confusion then $r=1$, as it does not tell us the level we are in.
   I guess $\S_{\pp^e}$ would be another option.
}
\setlength{\algomargin}{0em}
\begin{algorithm}\caption{The $\idealm$-primary case}
   \label{alg}
\Indp
\SetInd{1.55em}{0em}
\DontPrintSemicolon
\medskip
\SetKwInput{Input}{input}\SetKwInput{Output}{output}
\Input{ \\
   $\bullet$ a very small pair $(A,\vv{u})$, associated to an $\idealm$-primary ideal\\
   $\bullet$ a positive representative $r$ for a congruence class modulo a universal denominator $\denom$
}
\medskip
\Output{ \\ $\bullet$ a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for $\val\IP_p(A,\vv{u},p^e)$, with $p\equiv r \bmod \denom$
}
\medskip
\Begin{
   \medskip
$\S_{1},\  \S^*_{1} \leftarrow \{(A,\vv{u})\}$\;
$e \leftarrow 1$\;
%\texttt{done} $\leftarrow$ \texttt{false}\;
$M_1 \leftarrow \ft{A}{\vv{u}}\pp - \udeficit(A,\vv{u},r)$\;
\medskip
\While{\texttt{\em true}}{
   $e\leftarrow e+1$\;
   $S_{e} \leftarrow \big\{(A,\vv{v}): \vv{v} \in \bigcup_{(A,\vv{v}^*) \in \S^*_{e-1}} \ushort(A,\vv{v}^*,r)\big\}$\;
   \If{$\exists k < e: \S_{k} = \S_{e}$}{
      \KwRet{$\dfrac{\sum_{1\le i<k} M_i\tt^i}{1-\pp\tt}+\dfrac{\sum_{k\le i<e} M_i\tt^i}{(1-\pp\tt)(1-\tt^{e-k})}$}
   }
   $\epsilon \leftarrow \max \{\ft{A}{\vv{v}}: (A,\vv{v}) \in \S_{e}\}$\;
   \If{$\epsilon >1$}{
      \KwRet{$\dfrac{\sum_{1\le i<e}M_i\tt^i}{1-\pp\tt} + \dfrac{(\pp - 1)\tt^e}{(1-\pp \tt)(1-\tt)}$}
   }
   $\text{\texttt{aux}} \leftarrow \{(A,\vv{v})\in \S_{e}: \ft{A}{\vv{v}} = \epsilon\}$\;
   $\delta \leftarrow \min\{\udeficit(A,\vv{v},r): (A,\vv{v})\in \text{\texttt{aux}}\}$\;
   $\S^*_{e} \leftarrow \{(A,\vv{v})\in \text{\texttt{aux}}: \udeficit(A,\vv{v},r) = \delta\}$\;
   $M_e \leftarrow \epsilon \pp - \delta$\;
}
}
\end{algorithm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Alternative m-primary subsection ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Sprouting graphs} \label{sprouting: S}

\pedro[inline]{
   Maybe having more subsections will help organize this long section.
   I gave it a shot\ldots
}

\emily[inline]{Maybe give an a brief description of how each graph will be used, and explain why we looked at $\mathfrak{m}$-primary case first.}

\subsection{The sprouting graph of a monomial matrix}

\begin{definition}
   A \emph{descendant} of a monomial matrix $A$ is any monomial matrix $B$ obtained from $A$ by deleting some (possibly, none) of its columns.
\end{definition}

\begin{definition}
   \label{p-sprout: D}
   Consider a monomial pair $(A,\vv{u})$, and let an overbar denote collapse along $\mf(A,\vv{u})$.
   We say that $(B, \vv{v})$ is a \emph{$p$-sprout} of $(A, \vv{u})$ whenever the following conditions are satisfied.
   \begin{enumerate}
      \item $B = \collapse{A}$, the collapse of $A$ along $\O = \mf(A, \vv{u})$.
      \item $\vv{v}$ is any point in $\ushort(A, \vv{u}, p) = \ushort(B, \collapse{\vv{u}}, p)$.
   \end{enumerate}
\end{definition}

\begin{remark}
   \label{p-sprout: R}
   As noted in \Cref{collapse of monomial is monomial: R}, the collapse of a monomial matrix along a face of its Newton polyhedron is monomial.
   This and the positivity of points in shortfalls show that the $p$-sprout of a monomial pair is also a monomial pair.  Furthermore, \Cref{small pairs from shortfalls: R,finitely many deltas for a fixed A: R} tell us that there are only finitely many $p$-sprouts of a fixed monomial pair, and that each such sprouted pair is small.
 \end{remark}

\begin{remark}[Sprouts as collapsed shortfall pairs]
   \label{sprouts as collapsed shortfall pairs: R}
   Throughout this remark, suppose that $p$ is large enough relative to $A$ so that the conclusion of \Cref{arithmetic uniform value and image: T} holds.
   Let us call an $A$-pair $(A,\vv{w})$ a \emph{$p$-shortfall pair associated to $(A,\vv{u})$} if $\vv{w} \in \short \IP_p(A,\vv{u},p)$.
%   \daniel{I don't think this is an equality unless $\mf(A,\vv{u})$ is bounded.  Am I missing something?}
%   \emily{No, I removed the ``$= \ushort(A,\vv{u},p)$'' since our intention is to choose a point in the actual shortfall.}
   Recall that $p$-shortfall pairs played an important role in the process for computing $\val \IP_p(A,\vv{u},p^e)$ described in \Cref{m-primary: SS} when $A$ is associated to an $\idealm$-primary ideal.

   It follows immediately from \Cref{p-sprout: D} and \Cref{arithmetic uniform value and image: T} that a $p$-sprout of a pair $(A,\vv{u})$ is the same as the collapse of a $p$-shortfall pair of $(A,\vv{u})$ along the face $\O=\mf(A,\vv{u})$.  In particular, when $\O$ is bounded, then there is no difference between $p$-sprouts and $p$-shortfall pairs of $(A,\vv{u})$.  
\end{remark}

\begin{definition}[The directed sprouting graph]
   Let $A$ be a monomial matrix.
   We define $\graph_p(A)$ to be the set consisting of all very small $A$-pairs, and once $\graph_q(A)$ has been defined for some $q$ a power of $p$, we then define $\graph_{qp}(A)$ to be the set consisting of all $p$-sprouts of all pairs in $\graph_q(A)$.

   We define the vertices of the graph $\sprout_p(A)$ to be the disjoint union
   \[ \bigsqcup_{e=1}^{\infty} \graph_{p^e}(A). \]
   A vertex in the $p^e$-th component of the above disjoint union is said to be of \emph{level} $p^e$.
   The directed edges in $\sprout_p(A)$ are defined only between points of consecutive levels:
   There is a directed edge from a vertex of level $q$ to one of level $qp$ if the latter is a $p$-sprout of the former.
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary1: R}
   Consider a monomial matrix $A$.
   In this remark, we gather some basic facts concerning the graph $\sprout_p(A)$.
   \daniel{Please verify these} 
\begin{enumerate} 
\item The set $\graph_p(A)$ of very small $A$-pairs is independent of $p$, and can be infinite, depending on the geometry of the Newton polyhedron of $A$.  

\item \label{elementary1 small pairs} \Cref{p-sprout: R} tells us that every vertex of $\sprout_p(A)$ is a small monomial pair.  Furthermore, if $(B,\vv{v})$ is a vertex of $\sprout_p(A)$, then $B$ must be among the finitely many descendants of $A$.

\item \label{elementary1 periodic in e} Applying \Cref{finitely many deltas for a fixed A: R} and the finiteness of each universal shortfall to $A$ and to each of its descendant monomial matrices, we see that $\bigcup_{e>1} \graph_{p^e}(A)$ is a finite set, and the recursive nature of their construction then implies that the sets $\graph_{p^e}(A)$ are eventually periodic in $e$.  

\item \label{elementary1 periodic in p} Furthermore, \Cref{pair periodicity: R} tells us that if $\denom$ is a universal denominator for $A$ and all of its finitely many descendants, then the sprouting graph  $\sprout_p(A)$ (meaning, all of its vertices \emph{and} arrows) depends on the class of $p$ modulo $\denom$.
\end{enumerate}
\end{remark}


\begin{lemma}
   \label{positive-polynomial: L}
   Given a real number $w > 0$, and a set $\Omega$ of real numbers that is bounded from above, there exists an integer $\beta = \beta(w, \Omega)$ satisfying the following condition\textup:
   If $p > \beta$, then for every integer $e \geq 1$, and for every $\omega_1, \ldots, \omega_e \in \Omega$, we have that $wp^{e} >  \omega_1 p^{e-1} + \cdots + \omega_{e-1} p + \omega_e$.
\end{lemma}

\begin{proof}
   Given a positive upper bound $\lambda$ for $\Omega$, let $\beta = \lambda/w  + 1$.
   Then for $p>\beta$, $\omega_1 p^{e-1} + \cdots + \omega_{e-1}  p + \omega_e$ is at most $\lambda(p^{e-1} + p^{e-2} + \cdots + 1) = \lambda \cdot \frac{p^e-1}{p-1}$, which, in turn, is less than $\lambda (p^e-1) \cdot w/\lambda < w p^e$.
\end{proof}

\begin{theorem}[Iterated lifting]
\label{ILL: T}
   For each monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $p>\beta$ and \[ (A_1, \vv{u}_1) \to (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)\] is a path in $\sprout_p(A)$, then for every $1 \leq i \leq e$, there exists a point $\vv{k}_i$ in the optimal set of the standard integer program $\IP(A_i, \vv{u}_i,p)$  such that
   \[
      \vv{k}_1 p^{e-1} + \vv{k}_2 p^{e-2} + \cdots + \vv{k}_{e-1} p + \vv{k}_e
   \]
   is feasible for $\IP(A_1, \vv{u}_1, p^e)$.
 \end{theorem}

\begin{proof}
   We start by describing what it means for $p$ to be large.
   Toward this, let $M_1, \cdots, M_l$ be the finitely many descendents of  $A$.
   Fix a positive integer $\denom$ that is a universal denominator for all $M_i$, as guaranteed by \Cref{universal-denominators-exist:  T}, and a finite set of representatives $\fsr(M_i)$ for each $M_i$, as in \Cref{fsr-exist: T}.
   Set $\fsr = \fsr(M_1) \cup \cdots \cup \fsr(M_l)$, and let $\Omega$ be the set consisting of all coordinates of all points in $A(\fsr)$.
   We stress that $\fsr$ and $\Omega$ are finite sets determined by $A$, and do not depend in any way on $p$.

   The finiteness of $\fsr$  and \Cref{positive-polynomial: L} 
   imply that there exists an integer $\beta = \beta(\denom, \fsr)$ for which the following conditions hold for $p > \beta$. 
    \begin{align}
      \tag{$\heartsuit$} \label{p-big-1}
      &\text{$\frac{p}{\denom}$ is greater than any coordinate of any point in $\vv{1} - \fsr$;}\qquad\qquad\quad \\
      \tag{$\diamondsuit$} \label{p-big-2}
      &\text{$\frac{p^e}{\denom} > \sum_{i=1}^e \omega_i p^{e-i}$ for every $e \geq 1$ and $\omega_1, \ldots, \omega_e \in \Omega$.}
    \end{align}
    In what follows, we assume that $p$ is chosen so as to satisfy \eqref{p-big-1} and \eqref{p-big-2}. 

    Consider a finite path
    \[ (A_1, \vv{u}_1) \to (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e) \]
    in $\sprout_p(A)$.
    For every $1 \leq i \leq e$, set $\O_i = \mf(A, \vv{u}_i)$, and fix a special point $\vv{s}_i \in \sp(A_i, \vv{u}_i)$ with denominator $\denom$.
    If $1 \leq i < e$, then the sprouting $(A_i, \vv{u}_i) \to (A_{i+1}, \vv{u}_{i+1})$ tells us that $A_{i+1}$ is the collapse of $A_i$ along $\O_i$, and that
    \[
       \vv{u}_{i+1} \in \ushort(A_i, \vv{u}_i, q)= A_{i+1} \tail{\vv{s}_i}_p - A_{i+1}(\opt \ip( A_i, \vv{u}_i, \vv{s}_i, p)).
    \]
    Then \Cref{fsr-exist: T} and our choice of $\fsr$ allow us to fix a point $\vv{h}_i$ in $\fsr \cap \opt \ip ( A_i, \vv{u}_i, \vv{s}_i, p)$ such that $\vv{u}_{i+1} = A_{i+1} \tail{\vv{s}_i}_p - A_{i+1} \vv{h}_i$.
    Finally, let $\vv{h}_e$ be any point in the nonempty set $\fsr \cap \opt \ip ( A_e, \vv{u}_e, \vv{s}_e, p)$.

    Next, for every $1 \leq i \leq e$,  we define $\vv{k}_i \coloneqq \vv{s}_i p - [\vv{s}_i]_p + \vv{h}_i$.
    Observe that \eqref{p-big-1} and \eqref{p-big-2} imply that for every $1 \leq i \leq e$, the quantity $p/\denom$ is greater than every coordinate of $\vv{1}-\vv{h}_i$ and every coordinate of $A_i \vv{h}_i$.
    It then follows from \Cref{uniform value: P} that
    \begin{equation}
       \label{optimality-for-each-component: e}
       \vv{k}_i \in \opt \IP(A_i, \vv{u}_i,p).
    \end{equation}

    We will now induce on $e$ to prove that $\sum_{i=1}^e \vv{k}_i p^{e-i} \in \feas\IP(A_1, \vv{u}_1, p^e)$.
    When $e = 1$, this follows from \eqref{optimality-for-each-component: e}.
    Next, suppose that $e \geq 2$.
    Our induction hypothesis applied to the truncated path
    \[ (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e) \]
    tells us that $\vv{k}^{\ast} = \sum_{i=2}^e \vv{k}_i p^{e-i} \in \feas \IP(A_2, \vv{u}_2, p^{e-1})$.
    To complete the induction step, we must show that $\vv{k}_1 p^{e-1} + \vv{k}^{\ast}$ is feasible for $\IP(A_1, \vv{u}_1, p^e)$.
    However, \eqref{optimality-for-each-component: e} implies that this point has nonnegative integer coordinates, and hence, we must only show that $A_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$.

    To do so, recall that our choice of $\vv{s}_1 \in \sp(A_1, \vv{u}_1)$ allows us to write $\vv{u}_1 = A_1 \vv{s}_1 + \vv{w}$, where $\vv{w}$ is a positive point of $\rs(\O_1)$.
    This expression implies that the universal denominator $\denom$ is also a denominator for $\vv{w}$.
    It then follows from the definition of $\vv{k}_1$ and this expression for $\vv{u}_1$ that the inequality $A_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$ is equivalent to
    \begin{equation}
       \label{target-inequality: e}
       A_1( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + A_1\vv{k}^{\ast} < \vv{w} p^e.
    \end{equation}
    
    We prove this inequality using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
    First we verify that the inequality holds in $\rb(\O_1)^{\perp}$, by verifying that it holds after collapsing along $\O_1$.
    As $A_2$ is the collapse of $A_1$ along $\O_1$ and $\vv{w}\in \rs(\O_1)$, this means verifying that
    \[A_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + A_2\vv{k}^{\ast} < \vv{0}.\]
    But $A_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) = -\vv{u}_2$, by our choice of $\vv{h}_1$, so this inequality reduces to $-\vv{u}_2 p^{e-1} + A_2 \vv{k}^{\ast} < \vv{0}$, which holds as $\vv{k}^{\ast} \in \feas \IP(A_2, \vv{u}_2, p^{e-1})$.

    We now prove that \eqref{target-inequality: e} holds in $\rs(\O_1)$, by verifying that the stronger inequality
    \[ \sum_{i=1}^{e} A_1 \vv{h}_i p^{e-i} = A_1 \vv{h}_1 p^{e-1} + A_1 \vv{k}^{\ast} < \vv{w}p^e \]
    holds in $\rs(\O_1)$.
    However, as $\vv{w}$ is positive in $\rs(\O_1)$ and has denominator $\denom$, $\vv{w} p^e$ is greater than or equal to $p^e \vv{1} / \denom$ in $\rs(\O_1)$, while every coordinate of $\sum_{i=1}^{e} A_1 \vv{h}_i p^{e-i}$ is of the form $\sum_{i=1}^{e} \omega_i  p^{e-i}$ for some $\omega_1, \ldots, \omega_e \in \Omega$.
    Thus, the condition \eqref{p-big-2} tells us that this stronger inequality holds in $\rs(\O_1)$.

    We have just verified that \eqref{target-inequality: e} holds throughout $\rs(\O_1) \oplus \rs(\O_1)^{\perp}$, which allows us to conclude the induction step, and hence, our proof.
\end{proof}


\subsection{Subgraphs associated to pairs}

\ \daniel[inline]{Use algorithm in $\idealm$-primary case to motivate these definitions}

\begin{definition}[Subgraphs associated to very small pairs]
   Suppose that $(A,\vv{u})$ is very small, and define $\S_p(A,\vv{u})$ to be the set consisting solely of $(A,\vv{u})$.
   Next, suppose that $\S_q(A,\vv{u})$ has been defined for some $q=p^e$.
   \begin{enumerate}
      \item If $\S_q(A,\vv{u})$ is nonempty and consists only of very small pairs, then define $\S^{\ast}_q(A,\vv{u})$ to be the set of all $(B,\vv{v})$ in $\S_q(A,\vv{u})$ that first maximize $\ft{B}{\vv{v}}$, and only then minimize $\udeficit(B,\vv{v},p)$.  We then~define~$\S_{qp}(A,\vv{u})$ to be the set of all $p$-sprouts of all pairs in $\S^{\ast}_q(A,\vv{u})$.
      \item Otherwise, we define $\S_q^{\ast}(A,\vv{u})=\S_{qp}(A,\vv{u}) = \emptyset$.
   \end{enumerate}
   By definition, each $\S_{p^e}(A,\vv{u})$ and $\S^{\ast}_{p^e}(A,\vv{u})$ is a subset of $\graph_{p^e}(A)$, which we identify with the vertices of $\sprout_p(A)$ of level $p^e$.
   We then define $\sprout_p^{\ast}(A,\vv{u})$ to be the induced subgraph of $\sprout_p(A)$ on the set of vertices
   \[ \bigsqcup_{e=1}^{\infty} \S^{\ast}_{p^e}(A,\vv{u}). \]
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary2: R}
   Suppose $(A,\vv{u})$ is very small.
   In this remark, we gather some basic facts \daniel{Please verify these} concerning the graph $\sprout^{\ast}_p(A,\vv{u})$.
   \begin{enumerate}
      \item  \label{elementary2 lowest level}
      The only vertex of $\sprout_p^{\ast}(A,\vv{u})$ of level $p$ is $(A,\vv{u})$.
      \item \label{elementary2 small pairs}
      It follows from \Cref{elementary1: R}\eqref{elementary1 small pairs} that $\S_{q}(A,\vv{u})$, when non-empty, consists of small pairs whose monomial matrix is among the finitely many descendants of $A$.
      Furthermore, $\S_{qp}(A,\vv{u}) = \emptyset$ if and only if $\S_q(A,\vv{u}) = \emptyset$ or $\S_q(A,\vv{u})$ contains a pair that is not very small, which itself holds if and only if $\S_{q}^{\ast}(A,\vv{u})= \emptyset$.
      Moreover, $\S_q^{\ast}(A,\vv{u})$ is either empty, or contains only very small pairs.
      \item \label{elementary2 periodic in e}
      Arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in e}, we see that both $\bigcup_{e=1}^{\infty} \S_{p^e}(A,\vv{u})$ and  $\bigcup_{e=1}^{\infty} \S^{\ast}_{p^e}(A,\vv{u})$ are finite, and that each of the sets $\S_{p^e}(A,\vv{u})$ and $\S^{\ast}_{p^e}(A,\vv{u})$ are eventually periodic in $e$.
      \item \label{elementary2 periodic in p}
      Similarly, arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in p}, the graph $\sprout_p^{\ast}(A,\vv{u})$ depends only on $p$ modulo any universal denominator $\denom$ for $A$  and all of its finitely many descendants.
   \end{enumerate}
\end{remark}

\begin{example}
   \label{ex: ft.4}
   \begin{figure}
      \centering
      \includegraphics[width=.85\textwidth]{pictures/sprouting_graph.pdf}
      \caption{The sprouting subgraph for \Cref{ex: ft.4}}
      \label{fig: sprouting graph}
   \end{figure}
   \Cref{fig: sprouting graph} shows the sprouting subgraph associated to the pair $(A,\vv{u})$ in our running example, initiated in \Cref{ex: ft}.
   As in \Cref{ex: ft.3}, we consider the case where $p$ is congruent to $11$ modulo a universal denominator for $A$.
   The overbar represents collapse along $\mf(A,\vv{u})$.   
   The figure shows $\S_{p^e}(A,\vv{u})$ for $e=1,\ldots,4$, with $\sprout^*_p(A,\vv{u})$ shown in green.
   The nodes shown in red are pairs that are not very small, which cause $\sprout^*_p(A,\vv{u})$ to terminate.

   \begin{figure}
      \centering
      \includegraphics[width=.45\textwidth]{pictures/graph_on_newton.pdf}
      \caption{A geometric representation of the sprouting subgraph $\sprout^*_p(\ol{A},\ol{\vv{u}})$ in \Cref{ex: ft.4}}
      \label{fig: graph on newton}
   \end{figure}
   Note that $\sprout^*_p(A,\vv{u})$ is essentially the same as $\sprout^*_p(\collapse{A},\collapse{\vv{u}})$, pictured geometrically in \Cref{fig: graph on newton}, together with the Newton polyhedron of~$\collapse{A}$.
   \pedro{Maybe totally unnecessary, but the picture was fun to produce.
      Please feel free to remove or modify as you see fit.
   }
\end{example}

\begin{definition}
   \label{epsilon delta: D}
   If $(A,\vv{u})$ is very small, and $\S^{\ast}_{p^e}(A,\vv{u}) \neq \emptyset$, then we define
   \begin{align*}
     \epsilon_{p^e}(A,\vv{u}) & \coloneqq \ft{B}{\vv{v}} \\
     \delta_{p^e}(A,\vv{u}) & \coloneqq \udeficit(B,\vv{v},p)
   \end{align*}
   where $(B,\vv{v})$ is any pair in $\S^{\ast}_{p^e}(A,\vv{u})$.
   Observe that, by definition of $\S^{\ast}_{p^e}(A,\vv{u})$, these numbers are independent of the choice of $(B,\vv{v}) \in \S^{\ast}_{p^e}(A,\vv{u})$.
\end{definition}

\begin{proposition}
   \label{p large graph: P}
   Given a monomial matrix $A$, there exists $\beta = \beta(A)$ with the following property\textup:
   If $p > \beta$, $(A,\vv{u})$ is very small, and $\S_{p^e}^{\ast}(A,\vv{u})$ is non-empty, then
   \[
      \max \{ \val \IP_p(B,\vv{v},p) : (B,\vv{v}) \in \S_{p^e}(A,\vv{u}) \} = \epsilon_{p^e}(A,\vv{u}) p-\delta_{p^e}(A,\vv{u})
   \]
   and the subset of $\S_{p^e}(A,\vv{u})$ of pairs that achieve this maximum is $\S^{\ast}_{p^e}(A,\vv{u})$.
\end{proposition}

\begin{proof}
   First, choose $p$ to be large enough so that the conclusions of \Cref{arithmetic uniform value and image: T} hold for $A$, as well as for each of its finitely many descendants.
   In particular, for such primes, $\val \IP_p(B,\vv{v},p) = \ft{B}{\vv{v}}p-\udeficit(B,\vv{v},p)$  for each vertex $(B,\vv{v})$ of $\sprout_p^{\ast}(A,\vv{u})$, and the existence of $\beta(A)$ as above then follows from arguments similar to those made in \Cref{p large m-primary: R}.
\end{proof}

\begin{definition}
   If $(A,\vv{u})$ is very small, then $\mathcal{Q}_p(A,\vv{u})$ denotes the largest level of any vertex in the graph $\sprout_p^{\ast}(A,\vv{u})$.
   Formally,
   \[
      \mathcal{Q}_p(A,\vv{u}) \coloneqq \inf \{ q :  \S^{\ast}_{qp}(A,\vv{u}) = \emptyset \}.
   \]
\end{definition}

\begin{remark}
   As noted in \Cref{elementary2: R}\eqref{elementary2 lowest level}, if $(A,\vv{u})$ is very small, then $\S^{\ast}_p(A,\vv{u}) = \{ (A,\vv{u} )\}$, which shows that $\Q_p(A,\vv{u})$ is at least $p$.
   Furthermore, \Cref{elementary2: R}\eqref{elementary2 periodic in e}  implies that the issue of whether $\Q_p(A,\vv{u}) = \infty$ can be determined by checking whether $\S_{qp}(A,\vv{u}) \neq \emptyset$ for a finite number of $q$.
   Finally, \Cref{elementary2: R}\eqref{elementary2 periodic in p} implies that $\log_p \Q_p(A,\vv{u})$ depends only on $(A,\vv{u})$, and on the class of $p$ modulo any universal denominator for $A$, but not $p$ itself. 
\end{remark}

\subsection{The main theorem}

Having the necessary concepts and definition in hand, we now turn to the proof of our main theorem, which extends \Cref{m-primary AIP: T} to arbitrary monomial matrices. 

\begin{lemma}\label{lem: upper bound for higher mu}
   Given a monomial matrix $A$, there exists an integer $\beta= \beta(A)$ for which the following holds\textup:
   For each $p>\beta$, if $(A, \vv{u})$ is very small, and $(A_1, \vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ is a path in $\sprout^{\ast}_p(A,\vv{u})$,  then
   \[
      \val \IP_p(B, \vv{v}, p^e) \leq \sum_{s=1}^e \val \IP_p(A_s, \vv{u}_s, p)p^{e-s}
   \]
   for any vertex $(B, \vv{v})$ of $\sprout^{\ast}_p(A,\vv{u})$ of the same level as $(A_1, \vv{u}_1)$.
\end{lemma}

\begin{proof}
   Choose $p$ large enough so that the conclusions of \Cref{arithmetic uniform value and image: T} hold for $A$ and for each of its finitely many descendants, and also so that \Cref{p large graph: P} holds for $A$.  
   This proposition then implies that $\val \IP_p(B,\vv{v},p)$ equals $\val \IP_p(A_1, \vv{u}_1, p)$, by virtue of both being vertices of the same level in the graph $\sprout_p^{\ast}(A, \vv{u})$.
   This establishes the result when $e = 1$.
   
   Next, consider a path $(A_1,\vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ with $e \geq 2$, and suppose that the result holds for all shorter paths.
   Invoking \Cref{general AIP: T} for the pair $(B,\vv{v})$, keeping in mind that  $\val \IP_p(B,\vv{v},p) =  \val \IP_p(A_1,\vv{u}_1,p)$, we see that
    \[
      \val \IP_p(B,\vv{v},p^e) \leq \val \IP_p(A_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (B,\vv{w},p^{e-1}) \}, \\
    \]
    where the maximum above is over all $p$-shortfall pairs derived from $(B,\vv{v})$, that is, over all pairs $(B,\vv{w})$ with $\vv{w} \in \short \IP_p(B,\vv{v},p)$.  
    
    Let an overbar denote collapse along $\O=\mf(B,\vv{v})$.
    If the pair $(B,\vv{w})$ is as above, then the linear constraints of $\IP_p(\collapse{B}, \collapse{\vv{w}}, p^{e-1})$ are a subset of the linear constraints of $\IP_p(B, \vv{w}, p^{e-1})$, while their arithmetic constraints are identical.
    Therefore, the value of $\IP_p(B,\vv{w},p^{e-1})$ is at most the value of $\IP_p(\collapse{B}, \collapse{\vv{w}}, p^{e-1})$.  On the other hand, as noted in \Cref{sprouts as collapsed shortfall pairs: R}, the collapsed pairs $(\collapse{B}, \collapse{\vv{w}})$ of this form are precisely the $p$-sprouts of $(B,\vv{v})$.
    Thus, 
    \[
      \val \IP_p(B,\vv{v},p^e) \leq \val \IP_p(A_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (C,\vv{z},p^{e-1}) \}, \\
   \]
   where the maximum above is over all $p$-sprouts $(C,\vv{z})$ of $(B,\vv{v})$.
   Therefore, to complete our inductive step, it suffices to show that
   \begin{equation}\label{ineq}
      \val \IP_p(C,\vv{z},p^{e-1}) \le \sum_{s=2}^e \val \IP_p(A_s,\vv{u}_s,p) p^{e-s}
   \end{equation}
   for each $p$-sprout $(C,\vv{z})$ of $(B,\vv{v})$.
   In what follows, we fix such a $p$-sprout.

   Let $q$ be the common level of $(B,\vv{v})$ and $(A_1, \vv{u}_1)$ in $\sprout^{\ast}_p(A,\vv{u})$.
   Being a $p$-sprout of $(B,\vv{v})$, it follows that $(C,\vv{z}) \in \S_{qp}(A,\vv{u})$, while our assumption that $e \geq 2$ implies that $S^{\ast}_{qp}(A,\vv{u})$ is non-empty, as it contains $(A_2, \vv{u}_2)$.
   Below, we establish \eqref{ineq} in cases, depending on whether $(C,\vv{z}) \in \S^{\ast}_{qp}(A,\vv{u})$.

   If $(C,\vv{z}) \notin \S^{\ast}_{qp}(A,\vv{u})$, then $\val \IP_p(C,\vv{z}, p)< \val \IP_p(A_2, \vv{u}_2, p)$ by \Cref{p large graph: P}, and consequently $\val \IP_p(C, \vv{z},p^{e-1}) < \val\IP_p(A_2,\vv{u}_2, p^{e-1})$ by \Cref{cor: mu comparison}.
   The induction hypothesis applied to $(A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)$ and $(A_2,\vv{u}_2)$ itself gives \eqref{ineq}.
   On the other hand, if $(C, \vv{z}) \in \S^{\ast}_{qp}(A,\vv{u})$, then it is on the same level in $\sprout_p^{\ast}(A,\vv{u})$ as $(A_2, \vv{u}_2)$, and  our induction hypothesis applied to the path $(A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)$ and the point $(C, \vv{z})$ once again gives us \eqref{ineq}, completing the proof.
\end{proof}

\begin{theorem}
   \label{main theorem wrt diagonal: T}
   Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $p > \beta$ and $(A,\vv{u})$ is very small, then $\val \IP_p(A,\vv{u},p^e)$ is a polynomial of degree $e$ in $p$.
   The leading coefficient of this polynomial is $\ft{A}{\vv{u}}$, and all non-leading coefficients are nonpositive and rational.
   Furthermore, these coefficients depend on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$, but not on $p$ itself.

   More explicitly, if $e$ is an integer with $1 \leq e \leq \log_p \Q_p(A,\vv{u})$, then
   \[
      \val \IP_p(A,\vv{u}, p^e) =  \ft{A}{\vv{u}}  p^e - \sum_{1 \leq s < e} ( \delta_{p^s}(A,\vv{u}) - \epsilon_{p^{s+1}}(A,\vv{u}))  p^{e-s} - \delta_{p^e}(A,\vv{u}).
   \]
   Furthermore, if $\Q = \Q_p(A,\vv{u})$ is finite, then
   \[
      \val \IP_p(A,\vv{u}, \Q q) = \val \IP_p(A,\vv{u}, \Q)  q + q-1
   \]
   for every $q$ a power of $p$.
\end{theorem}

\begin{proof}
   Choose $p \gg 0$ so that the conclusions of \Cref{ILL: T,small not very small value: T,arithmetic uniform value and image: T,lem: upper bound for higher mu} are valid.
   Set $\Q = \Q_p(A,\vv{u})$.
   If $e$ is an integer satisfying $1 \leq e \leq \log_p\Q$, then $S_{p^e}^{\ast}(A,\vv{u})$ is nonempty, and by construction of $\sprout_p^{\ast}(A,\vv{u})$, there exists a path $(A,\vv{u}) = (A_1, \vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ in this graph.
   This path in $\sprout_p^{\ast}(A,\vv{u})$ also defines a path in $\sprout_p(A)$, and so \Cref{ILL: T} tells us that there exist points $\vv{k}_1,\ldots,\vv{k}_e$ in the domain lattice of $A$ with each $\vv{k}_s \in \opt \IP(A_s, \vv{u}_s, p)$ for which the point $\vv{k} \coloneqq \sum_{s=1}^e \vv{k}_s p^{e-s}$ is feasible for the standard integer program $\IP(A, \vv{u}, p^e)$.

   However, as noted in \Cref{elementary2: R}\eqref{elementary2 small pairs}, each of the vertices $(A_s, \vv{u}_s)$ is very small, and  \Cref{arithmetic uniform value and image: T} then implies that $\IP(A_s,\vv{u}_s,p) = \IP_p(A_s, \vv{u}_s, p)$.
   \Cref{trivial small value bound: P} then tells us that $\norm{\vv{k}_s} \le p - 1$, and \Cref{dickson: R} shows that the point $\vv{k}$ satisfies the arithmetic constraint of the arithmetic program $\IP_p(A,\vv{u},p^e)$, so that
   \begin{align*}
     \val \IP_p(A,\vv{u},p^e) \geq  \norm{\vv{k}} & = \sum_{s=1}^e \val \IP_p(A_s,\vv{u}_s,p) p^{e-s} \\
                                                  & = \sum_{s=1}^e (\epsilon_{p^s}(A,\vv{u})p - \delta_{p^s}(A,\vv{u})) p^{e-s}.
   \end{align*}
   \Cref{lem: upper bound for higher mu} then implies that we must have equality throughout.
   Noticing that $\epsilon_p(A,\vv{u}) = \ft{A}{\vv{u}}$, this is simply a rearrangement of our first claim.

   Next, suppose that $\Q$ is finite.
   By definition of $\Q$, we know that $\S_{\Q}^{\ast}(A,\vv{u})$ is nonempty, while $\S^{\ast}_{\Q p}(A,\vv{u})$ is empty, so that $\S_{\Q p}(A,\vv{u})$ must contain a pair that is not very small.
   Set $l=\log_p \Q$.
   Then there exists a path
   \[
      (A,\vv{u}) = (B_1,\vv{v}_1) \to \cdots \to (B_{l}, \vv{v}_{l})
   \]
   in $\sprout_p^{\ast}(A,\vv{u})$, which extends to a path
   \[
      (A,\vv{u}) = (B_1,\vv{v}_1) \to \cdots \to (B_{l}, \vv{v}_{l}) \to (B_{l+1}, \vv{v}_{l+1})
   \]
   in $\sprout_p(A)$ whose terminal vertex is small, but not very small.
   \Cref{ILL: T}, applied to this second path, tells us that there exist points $\vv{h}_1,\ldots, \vv{h}_{l+1}$ with each $\vv{h}_s \in \opt \IP(B_s, \vv{v}_s, p)$, and such that
   \[
      \vv{h} \coloneqq \sum_{s=1}^{l+1} \vv{h}_s p^{l+1-s} \in \feas \IP(A,\vv{u}, \Q p).
   \]
   Arguing as in the proof of \Cref{small not very small value: T}, our choice of $p \gg 0$ guarantees that the value of the standard linear program $\IP(B_{l+1}, \vv{v}_{l+1},p)$ is greater than~$p$.
   Therefore, $\norm{\vv{h}_{l+1}} > p$, and so there exists a point $\vv{g} \leq \vv{h}_{l+1}$ with $\norm{\vv{g}} = p-1$.
   Without loss of generality, suppose that the inequality $\vv{g} \leq \vv{h}_{l+1}$ is strict in the first entry, so that $\vv{0} \leq \vv{g} + \vv{e}_1 \leq \vv{h}_{l+1}$.

   Fix an integer $e \geq 1$, and consider the point
   \[
      \vv{m} \coloneqq \sum_{s=1}^{l} \vv{h}_s p^{e+l-s} + (\vv{g}+\vv{e}_1)p^{e-1} - \vv{e}_1,
   \]
   which is obtained from $\vv{h}p^{e-1}$ by replacing $\vv{h}_{l+1}p^{e-1}$ with  $(\vv{g}+\vv{e}_1)p^{e-1} - \vv{e}_1$, which is less than or equal to $\vv{h}_{l+1} p^{e-1}$, by our choice of $\vv{g}$.
   Therefore, $\vv{m} \leq \vv{h}p^{e-1}$, and the feasibility of $\vv{h}$ for $\IP(A,\vv{u}, \Q p)$ then implies that $\vv{m} \in \feas \IP(A,\vv{u}, \Q p^e)$.

   To see that $\vv{m}$ satisfies the arithmetic constraint of $\IP_p(A,\vv{u}, \Q p^e)$, observe that the base $p$ expansion of $\vv{m}$ is given by
   \[
      \vv{m} = \sum_{s=1}^{l} \vv{h}_s p^{e+l-s} + \vv{g}p^{e-1} + (p-1) \vv{e}_1 \cdot p^{e-2} + \cdots + (p-1)\vv{e}_1
   \]
   and note that $\norm{\vv{h}_s} = \epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u}) < p$ for each $1 \leq s \leq l$, by virtue of the first path above lying entirely in $\sprout_p^{\ast}(A,\vv{u})$.
   Thus, $\vv{m}$ is feasible for $\IP_p(A,\vv{u}, \Q p^e)$, and this and our earlier work show that
   \begin{align*}
     \val \IP_p(A,\vv{u}, \Q p^e) \geq \norm{\vv{m}} & = \sum_{s=1}^l (\epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u})) p^{e+l-s} + p^e-1 \\
                                                     & = \Big ( \sum_{s=1}^l (\epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u})) p^{l-s} \Big ) p^e + p^e-1 \\
                                                     & = \val \IP_p(A,\vv{u}, \Q) p^e + p^e-1,
   \end{align*}
   and \Cref{general AIP: T} further implies that equality must hold throughout.

   To conclude our proof, it remains to show that the non-leading coefficients in $\val \IP_p(A,\vv{u},p^e)$ are nonpositive, but this is done in \Cref{non-leading coefficients: P}.
\end{proof}





\details[inline]{
TO DO LIST:
\begin{enumerate}
\item[$\CheckedBox$] Make local to do list
\item[$\Box$]  Describe an analog of \Cref{leftover p large: R}:  Explain how our proof demonstrates that $\mu(A,\vv{u},p^e) = \mu(\collapse{A}, \collapse{\vv{u}}, p^e)$ for every $p \gg 0$ and $e \geq 1$.  This follows from the fact that $\sprout_p^{\ast}(A,\vv{u}) = \sprout_p^{\ast}(\collapse{A}, \collapse{\vv{u}})$. 
\item[$\CheckedBox$] Should we explain what \Cref{main theorem wrt diagonal: T} tells us about the difference between critical exponents and $F$-thresholds? \daniel[inline]{We can only say something when $p \gg 0$.  I gave it a shot in \Cref{crit versus ft: R}.}
\item[$\Box$] Should we explain why we have a deterministic algorithm for computing critical exponents, modulo algorithms for solving integer programs, or computing lattice points in polyhedra?
\item[$\CheckedBox$]  It seems like if $A$ comes from a positively homogeneous $\idealm$-primary ideal, then most non-leading coefficients vanish, and it should be true that either $\crit(A,\vv{u}) = \ft{A}{\vv{u}}$ or $\crit(A,\vv{u})$ is rational with denominator a power of $p$.  Is this worth pointing out?
\end{enumerate}
}

%\daniel[inline]{\begin{remark}[A deterministic algorithm]  \!{To do}
%\end{remark}
%}

\subsection{Concerning non-leading coefficients}

We now address the nonpositivity of the non-leading coefficients, claimed in \Cref{main theorem wrt diagonal: T}.

\begin{lemma}
   \label{non-leading coefficients: L}
   If $(B, \vv{v})$ is a $p$-sprout of $(A, \vv{u})$, then
   \[
      \udeficit(A, \vv{u}, p) \geq \ft{B}{\vv{v}}
   \]
   with equality if $A$ is the monomial matrix associated to an $\idealm$-primary monomial ideal that is homogeneous with respect to some positive $\ZZ$-grading.
\end{lemma}

\pedro[inline]{
   Here, we don't really just mean homogeneous, but actually generated by monomials of the same degree, right?
}

\begin{proof}
   Let $\N$ be the Newton polyhedron of $A$, let an overbar denote collapse along $\O=\mf(A,\vv{u})$, and choose a point~$\defpt$ that defines the face $\O$ in $\N$.
   By definition, $B$ is the collapse of $A$ along $\O$, and $\vv{v} \in \ushort(A,\vv{u},p)$.
   \Cref{collapse of Newton polyhedron: P} tells us that $\collapse{\O}$ is a face of $\collapse{\N}$, the Newton polyhedron of $B=\collapse{A}$, defined in $\collapse{\N}$ by the collapsed point $\collapse{\vv{c}}$.
   \Cref{FT descriptions: P}\eqref{lambda} then shows that $\frac1{\ft{B}{\vv{v}}}\cdot \vv{v} \in \collapse{\N}$, so by \Cref{alpha=1: convention} we have $\iprod{\collapse{\vv{c}}}{\vv{v}} \ge \ft{B}{\vv{v}}$.
   But since $\vv{v} \in \ushort(A, \vv{u}, p)$, we may write $ \vv{v} = B \tail{\vv{s}}_p - B \vv{h}$ for some $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ and $\vv{h}$  optimal for $\ip = \ip(A, \vv{u}, \vv{s}, p)$, and \eqref{bound in inner product: e} and \eqref{norm of tail: e} allow us to conclude that
   \[
      \ft{B}{\vv{v}} \le \iprod{\collapse{\defpt}}{\vv{v}} \leq \norm{\tail{\vv{s}}_p} - \val \ip= \udeficit(A, \vv{u}, p).
   \]

   We now address the last assertion:
   If $A$ satisfies these additional conditions, then homogeneity implies that the convex hull of the columns of $A$ is a proper face $\O$ of $\N$.
   The positivity of the grading implies that the point $\defpt$ defining this face must be positive.
   Thus, $\O$ must be bounded, and in particular, collapsing along $\O$ is simply the identity.
   Finally, the $\mathfrak{m}$-primary assumption further implies that $\mf(A, \vv{u}) = \O$ for every pair $(A,\vv{u})$.
   Given this, one may retrace the steps above to see that every inequality involving the inner product of $\defpt = \collapse{\defpt}$ with another point must be, in fact, an equality.  
\end{proof}

\begin{proposition}
\label{non-leading coefficients: P}
The non-leading coefficients appearing in the polynomial expressions described in \Cref{main theorem wrt diagonal: T} are rational and nonpositive.
\end{proposition}

\begin{proof}
   Fix a pair $(A,\vv{u})$, and set $\Q=\Q_p(A,\vv{u})$.
   By \Cref{main theorem wrt diagonal: T}, the non-leading coefficients under consideration are the rational numbers $-(\delta_{q}(A,\vv{u})-\epsilon_{qp}(A,\vv{u}))$ whenever $q < \Q$, the rational number $-(\delta_{\Q}(A,\vv{u}) - 1)$ whenever $\Q$ is finite, the rational numbers $-\delta_q(A,\vv{u})$ whenever $q\le \Q$, and $-1$.

   The proofs that the coefficients of the first and second type are nonpositive are similar, so we will only consider the coefficients of the second type.
   Towards this, suppose that $\Q$ is finite.
   In this case, $\S^{\ast}_{\Q p}(A,\vv{u})$ is empty, and so there is an edge $(B,\vv{v}) \to (C,\vv{z})$ in $\sprout_p(A)$ whose initial pair lies in $\S^{\ast}_{\Q}(A,\vv{u})$, and whose terminal pair is not very small. \Cref{non-leading coefficients: L} then tells us that $\delta_{\Q}(A,\vv{u}) = \udeficit(B,\vv{v},p)$ is at least $\ft{C}{\vv{z}}$, which is greater than $1$ as $(C,\vv{z})$ is not very small.
   Thus, $-(\delta_\Q(A,\vv{u})-1)$ is negative.
\end{proof}

\subsection{Critical exponents versus $F$-thresholds}
\label{crit versus ft: SS}

Let us now investigate what \Cref{main theorem wrt diagonal: T} tells us about the the difference between critical exponents and $F$-thresholds of monomial ideals, at least from the perspective of reduction to sufficiently large prime characteristic.  
Recall that if $\ideala$ and $\idealb$ are ideals in an $F$-finite regular ring, then whenever these numbers are defined, the critical exponent of $\ideala$ with respect to $\idealb$ is at most the $F$-threshold $\ideala$ with respect to $\idealb$, and both are known to be rational \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}.  

Suppose that $p \gg 0$ so that the conclusions of \Cref{main theorem wrt diagonal: T} hold for some fixed monomial~matrix~$A$.  Consider a monomial pair $(A,\vv{u})$, and set  $\Q = \Q_p(A,\vv{u})$.
If $\Q$ is infinite, then  \Cref{main theorem wrt diagonal: T} implies that
\pedro[inline]{
   I don't think we defined $\crit(A,\vv{u})$.
   Should we?
   Or should we simply use $\crit(\ideala,\ideald)$?
}
\begin{equation}\label{eq: crit infinite case}
\crit(A,\vv{u})=\ft{A}{\vv{u}} - \sum_{s=1}^{\infty} \frac{\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})}{p^s}. 
\end{equation}
In this case, \Cref{elementary2: R}\eqref{elementary2 periodic in e} implies that the terms $\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})$ are eventually periodic in $s$, which demonstrates that $\crit(A,\vv{u})$ is rational.

On the other hand, when $\Q$ is finite, \Cref{main theorem wrt diagonal: T} instead implies that
\begin{align*} 
\crit(A,\vv{u})& = \frac{\val \IP_p(A,\vv{u}, \Q) +1}{\Q} \\ 
& = \ft{A}{\vv{u}} -  \sum_{1 \leq s < \log_p \Q} \frac{\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})}{p^s} -  \frac{ \delta_{\Q}(A,\vv{u})-1}{\Q}
\end{align*}
and so $\crit(A,\vv{u})$ is again rational, with denominator a power of $p$.
% \pedro{The \emph{difference} $\text{ft} - \crit$ has denominator a power of $p$, right?}
% \emily{The numerators on the second line are rational, but not necessarily integers.  The first line shows that crit has denominator $\Q$, a power of $p$.}
% \pedro{Ooops\ldots I was only looking at the last line. Thanks!}

Thus, if $p \gg 0$ and $(A,\vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$, then 
\[ \ft{\ideala}{\ideald} - \crit(\ideala, \ideald) = \ft{A}{\vv{u}}-\crit(A,\vv{u}) = \sum_{s=1}^{\infty} \frac{ \sigma_{p^s}(A,\vv{u})}{p^s} \] 
where $\{ \sigma_{p^e}(A,\vv{u}) \}_{e=1}^{\infty}$ is a sequence of nonnegative rational numbers that is eventually periodic, and depends on the pair $(A,\vv{u})$ and on the class of $p$ modulo any universal denominator for $A$, but not on the value of $p$ itself.

\begin{remark}[The $\idealm$-primary homogeneous case]
   If $A$ is associated to an $\idealm$-primary ideal that is homogeneous under some positive $\ZZ$-grading, then \Cref{non-leading coefficients: L} shows that the terms $\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})$ appearing in \eqref{eq: crit infinite case} are all zero.
   Consequently, in this case $\crit(A,\vv{u})$ is either equal to $\ft{A}{\vv{u}}$, or it is a rational number with denominator a power of $p$.
   \pedro[inline]{Daniel: is this what you had in mind, or did you want to say more?}
   \pedro[inline]{Maybe we could bring up this case more often throughout the paper; e.g., as an example when introducing minimal face, universal denominator, etc. \emily[inline]{Sure}}
\end{remark}
\daniel[inline]{Summarize what the constant terms are.  Namely, $-\delta_{p^e}(A,\vv{u})$ and $-1$.  This will come up when looking at the roots of the BS-polynomials}
\emily[inline]{See below.}

\begin{remark}
\Cref{main theorem wrt diagonal: T} tells us that that under its assumptions, the constant term of $\val \IP_p(A,\vv{u},p^e)$ as a polynomial in $p$ is $- \delta_{p^e}(A,\vv{u})$ for 
  $1 \leq e \leq \log_p \Q_p(A,\vv{u})$, and is $-1$ for $e > \log_p \Q_p(A,\vv{u})$.
\end{remark}


%\newpage
%
%\section{Applications to generic hypersurfaces}
%
%\subsection{Generic hypersurfaces in large characteristics}
%
%
%\begin{theorem}  Given a collection of non-constant monomials $\mathcal{M}$, there exists $\beta = \beta(\mathcal{M})$ with the following property:  If $p > \beta$, then the test ideals of a generic polynomial over a field of characteristic $p$ supported at $\mathcal{M}$  
%
%\end{theorem}
%
%\subsection{Generic hypersurfaces in characteristic zero}

\newpage

\begin{corollary}
   Given a monomial matrix $A$, fix a universal denominator $\denom$ for all the descendants of $A$ \textup(e.g., take the least common multiple of universal denominators of each of its finitely many descendants\textup).
   Then there exists $\beta = \beta(A)$ such that whenever $p>\beta$ and $p \equiv 1 \bmod \denom$, 
\[
 \val\IP_p(A,\vv{u},p^e) = (p^e-1) \cdot \ft{A}{\vv{u}}
\]
for every very small $A$-pair $(A, \vv{u})$, and all $e \geq 1$.
In particular, for such $p$ we have $\crit(A,\vv{u}) = \ft{A}{\vv{u}}$.
\end{corollary}

\pedro[inline]{
   I modified the statement, replacing $\mu$ with $\val\IP_p$, to be consistent with previous theorems.
   However, we should think if we want jito state these big theorems in terms of $\mu(\ideala,\ideald,p^e)$ instead.
}
\begin{proof}
We first prove the following claim: 

\begin{claim}
   If $B$ is a descendant of $A$ and $(B, \vv{v})$ is a very small pair, then $\udeficit(B, \vv{v}, p) = \ft{B}{\vv{v}}$.
\end{claim}

Let $\vv{s}$ be a special point for $(B, \vv{v})$ with denominator $\denom$, so that $\norm{\vv{s}} = \ft{B}{\vv{v}} \leq 1$, and $\vv{s} = \vv{t}/\denom$, where $\vv{t}$ has nonnegative integer coordinates bounded above by $\denom$.
Since $p \equiv 1 \bmod \denom$, this means that $\tail{s_i}_p$ equals $\lpr{t_i p}{d}/d = t_i/d$ if $s_i \neq 0$, and equals $0$ otherwise; i.e., $\tail{\vv{s}}_p = \vv{s}$.
If $\Theta = \Theta(B, \vv{v}, \vv{s}, p)$, we have that $0 \leq \val \Theta < \norm{\vv{s}} = \ft{B}{\vv{v}} \leq 1$  by \Cref{bounded value: P}, forcing the value of the integer program $\Theta$ to be $0$.
Hence $\udeficit(B, \vv{v}, p) = \deficit \Theta = \norm{\vv{s}} - \val\Theta = \ft{B}{\vv{v}}$, proving the claim.\\[2mm] 
Observe that if $(C, \vv{w})$ is a $p$-sprout of a pair $(B, \vv{v})$ as above, then $\ft{C}{\vv{w}} \leq \udeficit(B, \vv{v}, p) = \ft{B}{\vv{v}}$ by \Cref{non-leading coefficients: L} and the above claim, so that $(C, \vv{w})$ is also very small.  
Hence $\S^\ast_{q}(A, \vv{u})$ is nonempty for every $q$, and consequently, $\Q(A,\vv{u})$ is infinite. 

Fix $(B, \vv{v}) \in \S_{q}^\ast$ for some $q$, and let an overbar denote collapse along $\O = \mf(B, \vv{v})$.
The proof of the claim shows that a special point $\vv{s}$ for $(B,\vv{v})$ with denominator $\denom$ satisfies $\tail{\vv{s}}_p = \vv{s}$, and $\vv{0} \in \opt \Theta(B,\vv{v},\vv{s},p)$. 
Hence $\overline{\vv{v}} = \overline{B}\vv{s} = \overline{B}\tail{\vv{s}}_p - \overline{B} \, \vv{0} \in \ushort(B, \vv{v}, p)$, and $(\overline{B}, \overline{\vv{v}}) \in \S_{pq}(A, \vv{u})$.

The claim implies that $\S^\ast_{pq}(A, \vv{u})$ consists of the pairs in $\S_{pq}(A, \vv{u})$ with maximum $F$-threshold. 
We know $\ft{\overline{B}}{\overline{\vv{v}}} = \ft{B}{\vv{v}}$ by \Cref{collapse of mf and mc: P}, and 
that the $F$-threshold of any $p$-sprout of $(B, \vv{v})$ is bounded above by $\ft{B}{\vv{v}}$ by our earlier observation.
Hence $(\overline{B}, \overline{\vv{v}}) \in \S^\ast_{pq}(A, \vv{u})$.

Inductively, we conclude that for each $e\ge 1$, there exists a path $(A,\vv{u}) = (A_1,\vv{u}_1) \to \cdots \to (A_e,\vv{u}_e)$ in $\sprout^*(A,\vv{u})$, where each pair is the collapse of the previous one along its minimal face.
Consequently, $\udeficit(A_i,\vv{u}_i,p) = \ft{A_i}{\vv{u}_i} = \ft{A}{\vv{u}}$, for each $1\le i \le e$.
Then for each such $i$, $\epsilon_{p^i}(A,\vv{u}) = \delta_{p^i}(A,\vv{u}) = \ft{A}{\vv{u}}$, and the desired formula follows from 
\Cref{main theorem wrt diagonal: T}.
% First, consider the following claim:
% 
% \vspace{.2cm}
% 
% \noindent \emph{Claim.} If $C$ is a descendant of $A$ and $(C, \vv{z})$ is a very small pair, then $\udeficit(C, \vv{z}, p) = \ft{C}{\vv{z}}$.
% 
% \vspace{.2cm}
% 
% Toward the claim, let $\vv{s}$ be a special point for $(C, \vv{z})$ with denominator $\denom$, so that $\norm{\vv{s}} = \ft{C}{\vv{z}} \leq 1$, and $\vv{s} = \vv{t}/\denom$, where $\vv{t}$ has nonnegative integer coordinates bounded above by $\denom$.
% Since $p \equiv 1 \bmod \denom$, this means that $\tail{s_i}_p$ equals $\lpr{t_i p}{d}/d = t_i/d$ if $s_i \neq 0$, and equals $0$ otherwise; i.e.,
% $\tail{\vv{s}}_p = \vv{s}$.
% If  $\Theta = \Theta(C, \vv{z}, \vv{s}, p)$, we have that $0 \leq \val \Theta < \norm{\vv{s}} = \ft{C}{\vv{z}} \leq 1$  by \Cref{bounded value: P}, forcing the value of the integer program $\Theta$ to be $0$.  Hence $\udeficit(C, \vv{z}, p) = \deficit \Theta = \norm{\vv{s}} - \val\Theta = \ft{C}{\vv{z}}$.
% 
% Let $\lambda = \ft{A}{\vv{u}}$. We now proceed by induction to show that $\epsilon_{p^s}(A,\vv{u})  =  \delta_{p^s}(A,\vv{u}) = \lambda$ for all $s \geq 1$ (so that in particular, $\mathcal{Q}_p(A,\vv{u})$ is infinite).
% For $s=1$, notice that $\S_p^\ast = \{ (A, \vv{u} ) \}$, so that 
% $\lambda = \epsilon_{p^s}(A,\vv{u}) = \delta_{p^s}(A,\vv{u})$ by the above claim. 
% 
% Suppose now that $\epsilon_{p^s}(A,\vv{u})  =  \delta_{p^s}(A,\vv{u}) = \lambda$ for some $s \geq 1$.  Take any $(B, \vv{v}) \in \S_{p^s}^\ast$, and let an overbar denote collapse along $\O = \mf(B, \vv{v})$.
% By \Cref{collapse of mf and mc: P}, 
% $\ft{\overline{B}}{\overline{\vv{v}}} = \ft{B}{\vv{v}}  = \lambda$, and 
% noting \Cref{comparing deltas: R}, $\udeficit(\overline{B}, \overline{\vv{v}}, p) = \udeficit(B, \vv{v}, p) = \lambda$ as well.
% 
% If $\vv{r}$ is a special point for $(\overline{B}, \overline{\vv{v}} )$, then $\vv{0}$ is feasible for $\Theta(B,\vv{v},\vv{r},p)$, as pointed out in the proof of \Cref{bounded value: P}.
% This means that $\overline{\vv{v}} = \overline{B}\vv{r} = \overline{B}\tail{\vv{r}}_p - \overline{B} \, \vv{0}$ is in $\ushort(B, \vv{v}, p)$, and so $(\overline{B}, \overline{\vv{v}}) \in \S_{p^{s+1}}(A, \vv{u})$.
% 
% Given an arbitrary $p$-sprout $(\overline{B}, \vv{w})$ of $(B, \vv{v})$, we have that  
% $\ft{\overline{B}}{\vv{w}} \leq 
% \udeficit(B, \vv{v}, p) = \lambda$ by \Cref{non-leading coefficients: L},  and in particular, $(\overline{B}, \vv{w})$ is very small.   
% Moreover, if $\ft{\overline{B}}{\vv{w}}$ achieves the maximum value among all such $p$-sprouts, namely $\lambda = \ft{\overline{B}}{\overline{\vv{v}}}$, then by our claim above,  $\udeficit(\overline{B},\vv{w},p) = \lambda = \udeficit(\overline{B}, \overline{\vv{v}}, p)$. 
% Hence $(\overline{B}, \overline{\vv{v}}) \in \S_{p^{s+1}}^\ast(A, \vv{u})$,
% and since we have already found that $\ft{\overline{B}}{\overline{\vv{v}}} = \udeficit(\overline{B}, \overline{\vv{v}}, p)= \lambda$, 
%  we conclude that
%  $\epsilon_{p^{s+1}}(A,\vv{u})  =  \delta_{p^{s+1}}(A,\vv{u}) = \lambda$, completing our inductive proof. 
% 
% 
% Finally, after replacing each $\epsilon_{p^s}(A,\vv{u})$ and $\delta_{p^s}(A,\vv{u})$, for  $1 \leq s \leq e$, with $\lambda$ in the statement of 
% \Cref{main theorem wrt diagonal: T}, we confirm that $\val \Pi_p(A, \vv{u}, p^e) = p^e \lambda - \lambda = (p^e-1)\lambda$, for all $p$ greater than some integer $\beta = \beta(A)$.
\end{proof}

% \pedro[inline]{
%    We can probably shorten the proof a bit:
%    First notice that the claim and \Cref{non-leading coefficients: L} imply that $p$-sprouts of very small pairs are themselves very small; in particular, $\S^*_q(A,\vv{u})$ is nonempty, for each $q$, and $\Q(A,\vv{u})$ is infinite.
%    Let $(B,\vv{v}) \in \S^*_q(A,\vv{u})$.
%    The proof of the claim shows that $(\collapse{B},\collapse{\vv{v}})$ is a $p$-sprout of $(B,\vv{v})$, and therefore an element of $\S_{pq}(A,\vv{u})$.
%    Now notice that the claim implies that a pair in $\S_{pq}(A,\vv{u})$ lies in $\S^*_{pq}(A,\vv{u})$ if and only if it has maximal $F$-threshold.
%    This observation, combined with \Cref{non-leading coefficients: L} and the claim, tells us that $(\collapse{B},\collapse{\vv{v}}) \in \S^*_{pq}(A,\vv{u})$.
%    This shows that for each $e\ge 1$ there exists a path $(A,\vv{u}) = (A_1,\vv{u}_1) \to \cdots \to (A_e,\vv{u}_e)$ in $\sprout^*(A,\vv{u})$ where each pair is the collapse of the previous one along its minimal face, and consequently $\udeficit(A_i,\vv{u}_i,p) = \ft{A_i}{\vv{u}_i} = \ft{A}{\vv{u}}$, for each $1\le i \le e$.
% }
% \emily[inline]{OK, I removed the explicit induction and pruned it down. Feel free to edit further if you see fit.}
% \pedro[inline]{Maybe add a quick corollary about crits?}

\newpage

\appendix

\section{Monomial ideals and reduction}
\label{monomial-reduction: A}

% The purpose of this appendix is to describe the behavior of the monomials contained in some possibly non-monomial ideal under reduction to prime characteristic.  To make this precise, consider the following definition. 
% 
% \begin{definition}
% If $\kk$ is a field and $I$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then $\mon(I)$ is the ideal generated by the monomials in $I$. % That is, \[ \mon(I) = \langle x^{\vv{u}}: x^{\vv{u}} \in I \rangle \subseteq \kk[x_1, \ldots, x_\numvars].\]
% \end{definition}
% 
% The following theorem, a generalization of \cite[Lemma 6.1]{budur+mustata+saito.roots_bs_polys_monomial}, is the main result of \Cref{monomial-reduction: A}. This appendix concludes with \Cref{reduce me to diagonal: L} that can be applied to reduce \Cref{general-mu-theorem: T} to the case where $\idealb$ is a monomial ideal of the form $\ideald = \ideal{x_1^{u_1}, \ldots, x_\numvars^{u_\numvars}}$ for $\vv{u} = (u_1,\ldots,u_\numvars) > \vv{0}$.
% 
% \begin{theorem}
%    \label{mon-operation-modulo-p: T}
%    Given an ideal $I \subseteq \QQ[x_1, \ldots, x_\numvars]$, there exists an integer $\beta = \beta(I)$ with the following property\textup:
%    If $p > \beta$, then $\mon(I)_p = \mon(I_p)$.
% \end{theorem}
% 
% The subscript ``$p$'' indicates reduction modulo $p$, which will be described in the first subsection. 
% Our methods in proving \Cref{mon-operation-modulo-p: T} are adapted from those in \emph{loc.\,cit}.
% Applications of the theorem related to critical exponents and $F$-thresholds 
% appear in the final subsection of this appendix. 
% 
% \newpage
% 
% \subsection{Reduction to prime characteristic}
% 
% \newcommand{\maxi}{\mathfrak{m}}
% 
% We now briefly recall the process of reduction to prime characteristic, at least in the context of polynomial rings.  To start, we recall some fundamental facts, both of which may be thought of as corollaries of Noether Normalization.  We refer those unfamiliar with these statements to \cite[Chapter 3]{hernandez.thesis} for more details\daniel{Is it OK to just cite my thesis?}.
% 
% \begin{remark}[Generic freeness] \label{generic-freeness} Suppose that $A$ is a Noetherian domain,  and that $S$ is a finitely generated $A$-algebra.  Generic freeness states that if $M$ is a finitely-generated $S$-module, then there exists  $0 \neq \ell \in A$ such that $A[\ell^{-1}] \otimes_A M$, the localization of $M$ at $\ell$, is free as a module over $A[\ell^{-1}]$.
% \end{remark}
% 
% \begin{remark}[On maximal ideals]
%    \label{maximal ideals: R}
%    Suppose that $A$ is a domain of characteristic zero that is finitely generated as an algebra over $\ZZ$.  Then every maximal ideal of $A$ contains a positive prime integer, and all but finitely many such prime integers are contained in some maximal ideal of $A$.  Furthermore, the quotient of $A$ by any maximal ideal is a finite field. 
% \end{remark}
% 
% \begin{remark}[Reduction to prime characteristic]
%    \label{reduction: R}
%    Let $R = \kk[x_1, \ldots, x_\numvars]$ be a polynomial ring over a field $\kk$ of characteristic zero.
%    If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$, then we define $R_A$ to be the polynomial ring $R_A=A[x_1, \ldots, x_\numvars]$, and if $I$ is an ideal of $R$, then $I_A$ denotes any ideal of $R_A$ that extends to $I$ under the inclusion $R_A \hooklongrightarrow R$, provided such an ideal exists.  In this case, we call $I_A$ an $A$-model of $I$.
%    Observe that once an ideal $I$ of $R$ is specified, then an $A$-model of $I$ exists at least whenever $A$ is the subalgebra of $\kk$ generated over $\ZZ$ by the finitely many coefficients in $\kk$ appearing in some finite ideal-generating set for $I$.
% 
%    Suppose that $I$ and $A$ are as above, and that $I_A$ exists.
%    If $\maxi \in \mspec(A)$, then $I_A(\maxi)$ is the extension of $I_A$ to $R_{A}(\idealm)= (A/\maxi)[x_1, \ldots, x_\numvars]$ under the quotient map $R_A \longrightarrow R_A(\idealm)$.
%    As noted in \Cref{maximal ideals: R}, the finite generation of $A$ over $\ZZ$ implies that $A/\maxi$ is a finite field, and for this reason, we may regard $I_A(\idealm)$ as a prime characteristic model of $I$.   Furthermore, as the point $\maxi \in \mspec(A)$ varies, we obtain models $I_A(\idealm)$ of $I$ over a finite field of characteristic $p>0$ for all but finitely many $p$.
% \end{remark}
% 
% This process greatly simplifies in the important case that $\kk=\QQ$.
% Indeed, every ideal $I$ of $R=\QQ[x_1, \ldots, x_\numvars]$ is generated by a set $G$ of polynomials with integer coefficients.
% Given such a generating set, we may then take $A=\ZZ$, and let $I_A$ be the ideal generated by $G$ in $R_A=\ZZ[x_1, \ldots, x_\numvars]$.
% If  $\maxi$ is the maximal ideal of $A=\ZZ$ generated by a prime integer $p$, then $I_A(\maxi)$ is the ideal of $R_A(\maxi) = \FF_p[x_1, \ldots, x_\numvars]$  generated by the image of $G$.
% 
% \daniel[inline]{Also explain why reducing a monomial ideal is also easy}
% \pedro[inline]{Introduce subscript-$p$ notation}
% 
% In \Cref{noncontainment mod p: L,colon mod p: L} below, we adopt the notation from \Cref{reduction: R}
% 
% %\daniel[inline]{This may need to be generalized, depending on what we want to say about Bernstein-Sato polynomials}
% %Though defined more generally, we describe the reduction $I_p$ modulo $p$ in a special case: 
% %Given an ideal $I = \ideal{f_1, \ldots, f_n}$ of $\QQ[x_1, \ldots, x_\numvars]$, for $p$ greater than the denominator of each coefficient of $f_1, \ldots, f_n$, reduce the coefficients of the $f_i$ to obtain polynomials over $\ZZ/p\ZZ$; $I_p$ is the ideal of $(\ZZ/p\ZZ)[x_1, \ldots, x_\numvars]$ generated by these polynomials.
% 
% \begin{lemma}
% \label{noncontainment mod p: L}
% Consider a proper ideal $I$ of $R$.  If $A$ is a finitely-generated $\ZZ$-subalgebra of $\kk$ such that $I_A$ is defined, then there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that $(A/\maxi) \otimes_A I_A \cong I_A(\maxi) \subsetneq R_A(\maxi)$ for every $\maxi \in \mathcal{U}$.
% \end{lemma}
% 
% 
% \begin{proof}
%    Consider the exact sequence $0 \to I_A \to R_A \to R_A/I_A \to 0$ of finitely-generated $R_A$-modules.
%    This sequence remains exact when regarding its terms as $A$-modules, and as the localization $A[\ell^{-1}]$, where $0 \ne \ell \in A$, is flat over $A$, we have that
%    \[
%       0 \to A[\ell^{-1}] \otimes_A I_A \to A[\ell^{-1}] \otimes_A R_A \to A[\ell^{-1}] \otimes_A (R_A/I_A) \to 0
%    \]
%    is an exact sequence of $A[\ell^{-1}]$-modules.
%    By generic freeness with $S=R_A$, we may assume that the last term is free over $A[\ell^{-1}]$ of rank $0 \leq r \leq \infty$.
% 
%    Therefore,  if $B$ is any $A[\ell^{-1}]$ algebra, then this freeness implies that tensoring this exact sequence with $B$ over $A[\ell^{-1}]$ yields a split exact sequence
%    \[
%       0 \to B \otimes_A I_A \to B \otimes_A R_A \to B \otimes_A (R_A/I_A) \to 0
%    \]
%    of $B$-modules whose last term is free rank $r$.
%    As $R_A = A[x_1, \ldots, x_\numvars]=A[x]$, the middle term is isomorphic to $B[x_1, \ldots, x_\numvars]=B[x]$,  and the first non-trivial map identifies $B \otimes_A I_A$ with the extension of $I_A \subseteq R_A$ to $B[x]$.
%    In other words, this split exact sequence is isomorphic to the exact sequence
%    \[
%       0 \to I_A  B[x] \to B[x] \to  B[x] / I_A B[x]  \to 0
%    \]
%    of $B$-modules whose last term is free of rank $r$.
%    In particular, taking $B=\kk$ yields the exact sequence $0 \to I \to R \to R/I \to 0$, which tells us that $r \neq 0$.
% 
%    Next, let $\mathcal{U}$ denote the set of all points $\maxi \in \mspec(A)$ such that the characteristic of $A/\idealm$ does not divide $\ell$.
%    Note that $\mathcal{U}$ is an open dense (i.e., open and nonempty) subset of $\mspec(A)$.  Furthermore, if $\maxi \in \mathcal{U}$, then $A/\maxi$ is an $A[\ell^{-1}]$-algebra, and setting $B=A/\maxi$ above yields the exact sequence
%    \[
%       0 \to I_A(\maxi) = I_A R_A(\maxi) \to R_A(\maxi) \to R_A(\maxi)/ I_A(\maxi) \to 0
%    \]
%    which demonstrates that $I_A(\maxi) = I_A R_A(\maxi)  \cong (A/\maxi) \otimes_A I_A$, and also that $I_A(\maxi) \neq R_A(\maxi)$, as the third term above is free over $A/\maxi$ of rank $r \neq 0$.
% \end{proof}
% 
% \begin{lemma}
%    \label{colon mod p: L}
%    Consider an ideal $I \subseteq R$ and an element $f \in R$.
%    If $A$ is a finitely-generated $\ZZ$-subalgebra of $\kk$ such that $I_A$ is defined, and $f \in R_A$, then  $(I_A :_{R_A} f)$ is an $A$-model of $(I:_R f)$.
%    Furthermore, with this choice of $A$-model, there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that
%    \[
%       (I :_R f)_A(\maxi) = (I_A(\maxi) :_{R_A(\maxi)} f_A(\maxi))
%    \]
%    for every $\maxi \in \mathcal{U}$, where $f_A(\maxi)$ denotes the reduction of $f \in R_A$ modulo $\maxi$, i.e., the image of $f$ under the quotient map $R_A \to R_A(\maxi)$.
%  \end{lemma}
% 
%  \begin{proof}
%     Consider the exact sequence
%     \[
%        0 \to (I_A :_{R_A} f) \to R_A \stackrel{f}{\longrightarrow} (f R_A + I_A)/I_A \to 0
%     \]
%     of finitely-generated $R_A$-modules.
%     We may then tensor this exact sequence of $A$-modules with the flat $A$-module $A[\ell^{-1}]$ over $A$ to obtain an exact sequence of $A[\ell^{-1}]$-modules, where $0 \neq \ell \in A$.  By generic freeness, we may assume that the last term in such a sequence is free over $A[\ell^{-1}]$, and so if we further tensor this sequence with an $A[\ell^{-1}]$-algebra $B$ over $A[\ell^{-1}]$, we obtain
%     \[
%        0 \to B \otimes_A (I_A :_{R_A} f) \to B \otimes_A R_A \stackrel{f}{\longrightarrow} B \otimes_A ((f R_A + I_A)/I_A) \to 0
%     \]
%     which is a split exact sequence of $B$-modules.
% 
%     As in the proof of \Cref{noncontainment mod p: L}, $B \otimes_A R_A \cong B[x_1, \ldots, x_\numvars]=B[x]$, and the above sequence is isomorphic to the exact sequence
%     \[
%        0 \to (I_A :_{R_A} f) B[x] \to  B[x] \stackrel{f}{\longrightarrow} (f R_A + I_A)B[x]/I_AB[x] \to 0.
%     \]
%     However, the last term above equals $(fB[x] + I_AB[x])/I_AB[x]$, which shows that $(I_A:_{R_A} f)B[x]= \ker ( B[x] \stackrel{f}{\longrightarrow} (fB[x] + I_AB[x])/I_AB[x])$.
%     That is,
%     \[ 
%        (I_A:_{R_A} f)B[x] = (I_AB[x] :_{B[x]} f).
%     \]
% 
%     When $B=\kk$, this tells us that $(I_A:_{R_A} f)R = (I :_{R} f)$, which demonstrates that $(I_A :_{R_A} f)$ is an $A$-model for $(I :_R f)$.
%     Next, let $\mathcal{U}$ denote the set of all points $\maxi \in \mspec(A)$ such that the characteristic of $A/\idealm$ does not divide $\ell$.
%     If $\maxi \in \mathcal{U}$, then we may instead take $B=A/\maxi$ to see that
%     \[
%        (I_A:_{R_A} f)R_A(\maxi) = (I_A(\maxi) :_{R_A(\maxi)} f_A(\maxi)).
%     \]
%     This concludes our proof, as the left-most term above is just $(I :_R f)_A(\maxi)$.
% \end{proof}
% 
% %\begin{proof}
% %%First, we prove the statement when $I = \ideal{f}$ is principal. 
% %Let $Q$ denote the cokernel of the inclusion of $(J:_A f)$ into $A$.  If $\ell$ is a nonzero integer and $B = \ZZ[\ell^{-1}] \otimes_{\ZZ} A$ is the localization of $A$ as a $\ZZ$-module at $\ell$, then by Generic Freeness (\Cref{generic-freeness}), we can choose such an $\ell$ so that each of the $\ZZ[\ell^{-1}]$-modules  $B$, $(J:_A f)B$, $QB$, and $(A/J)B$, are free over $\ZZ[\ell^{-1}]$.
% %
% %The exact sequence of $A$-modules
% % \[
% %  0 \longrightarrow (J:_A f) \longrightarrow A \longrightarrow Q \to 0
% % \]
% % is also exact as $\ZZ$-modules, and localizing at $\ell$ yields an exact sequence of $\ZZ[\ell^{-1}]$-modules
% % \[ 0  \longrightarrow (J:_A f)B \longrightarrow B \longrightarrow QB \longrightarrow 0 \]
% %since each module above is free over $\ZZ[\ell^{-1}]$.
% %Hence if $p \nmid \ell$, then $\ZZ/p\ZZ$ is an algebra over $\ZZ[\ell^{-1}]$, so by taking the tensor product of this exact sequence with $\ZZ/p\ZZ$ over $\ZZ[\ell^{-1}]$, we obtain an exact sequence of free $\ZZ/p\ZZ$-modules
% %\begin{equation} \label{colon-injection: e} 0  \longrightarrow (J:_A f)A_p \longrightarrow A_p \to Q_p \longrightarrow 0 \end{equation} where $A_p = A \otimes_{\ZZ} \ZZ/p\ZZ$.  Clearly, this is also an exact sequence of $A_p$-modules.
% %
% %Observe that we also have the exact sequence of $A$-modules 
% %\[ 0 \longrightarrow (J:_f A) \longrightarrow A \stackrel{f}{\longrightarrow} A/J 
% %\]
% %where the first map is again the natural injection.  
% %By again localizing at $\ell$ and reducing modulo $p$, we obtain the sequence of $A_p$-modules 
% %\begin{equation} \label{reduction-colon: e}
% %0 \longrightarrow (J:_A f)A_p \longrightarrow A_p \stackrel{f_p}{\longrightarrow} \left( A/J \right)_p 
% %\end{equation}
% %where, by Generic Freeness, the map given by multiplication by $f_p$ is onto.  Recalling that $(J:_A f)A_p \longrightarrow A_p$ is injective by \Cref{colon-injection: e}, we know that \eqref{reduction-colon: e} is an exact sequence.  
% %By again localizing and then reducing the exact sequence  
% %$0 \to J \to A \to A/J\to 0$ modulo $p$, we find that $\left(A/J\right)_p \cong A_p/J_p$, so that we conclude from \eqref{reduction-colon: e} that $(J:_A: f) = (J A_p :_{A_p} \ideal{f}A_p)$. 
% %\end{proof}
% 
% \subsection{Monomial ideals} \label{monomial-ideals: S}
% 
% By definition, both $\mon(I)_p$ and $\mon(I_p)$ are monomial ideals, and so they are equal if and only if they contain the same monomials.
% However, if $h$ is a monomial contained in $I$, then it is clear that $h_p$ is a monomial contained in $I_p$ for all $p$.
% Thus, to prove \Cref{mon-operation-modulo-p: T} it suffices to prove the following statement:
% If $p \gg 0$ and $h$ is a monomial with $h \notin I$, then $h_p \notin I_p$.
% 
% Given any $h$ not contained in $I$, then \Cref{noncontainment mod p: L,colon mod p: L} tell us that $(I_p:h_p) = (I:h)_p \ne \FF_p[x_1,\ldots,x_\numvars]$, and hence $h_p \notin I_p$, for all sufficiently large primes $p$.
% This argument establishes \Cref{{mon-operation-modulo-p: T}} in the case that $I$ contains all but finitely many monomials;  that is, in the case that $ \mon(I)$ is $\idealm$-primary.
% 
% %%%% Commented out paragraph seemed to refer to an older version of preliminary results.
% % Given any $h$ not contained in $I$, then setting $J = I + \langle h \rangle$ in \Cref{noncontainment mod p: L} tells us that $h_p \notin I_p$ for all primes $p$ that are large relative to $h$.  This argument establishes \Cref{noncontainment mod p: L} in the case that $I$ contains all but finitely many monomials;  that is, in the case that $ \mon(I)$ is $\idealm$-primary.
% 
% If $\mon(I)$ is not $\idealm$-primary, then this argument breaks down.
% In this case, our strategy will rely on the fact that, even though there may be infinitely many monomials not in $I$, there are still only finitely many ideals of the form $(I:x^{\vv{u}})$ with $x^{\vv{u}} \notin I$.
% This is established in \Cref{monomial-noetherian-decomposition: L} below.
% We begin our arguments by recalling a basic and useful fact about colon ideals.
% 
% \begin{lemma}
%    \label{colon-product-stabilization: L}
%    Suppose that $f,g_1, \cdots, g_s$ are elements of a ring $R$, and that $I$ is an ideal of $R$.
%    If $\ell$ is a nonnegative integer such that $(I: f g_i^\ell) = (I: f g_i^k)$ for every index $1 \leq i \leq s$ and every integer $k \geq \ell$, then
%    \[
%       (I: f g_1^\ell \cdots g_s^\ell) = (I: f g_1^{k_1} \cdots g_s^{k_s})
%    \]
%    for all integers $k_1, \ldots, k_s \geq \ell$.
% \end{lemma}
% 
% \begin{proof}
% We induce on $k_1 + \cdots + k_s$.  The base case is when $k_1 = \cdots = k_s = \ell$, which is trivial, and the induction step, which is left to the reader, involves repeatedly applying the fact that $(I:fab) = ((I:fa):b)$ for all $a,b \in R$.
% \end{proof}
% 
% \begin{lemma}
% \label{monomial-noetherian-decomposition: L}
% Given a proper ideal $I$ of $\kk[x_1, \ldots, x_\numvars]$, there exists a finite subset $\mathcal{V}$ of $\NN^\numvars$, and for every $\vv{v} \in \mathcal{V}$ a finite subset $\mathcal{W}(\vv{v})$ of the set of standard basis vectors of $\ZZ^\numvars$,  satisfying the following conditions.
% \begin{enumerate}
% \item $x^{\vv{u}} \notin I$ if and only if $\vv{u} \in \mathbf{v} + \NN \mathcal{W}(\vv{v})$ for some $\vv{v} \in \mathcal{V}$.
% \item $(I:x^{\vv{v}}) = (I: x^{\vv{v}+\vv{w}})$ for every $\vv{v} \in \mathcal{V}$ and $\vv{w} \in  \NN  \mathcal{W}(\vv{v})$.
% \end{enumerate}
% \end{lemma}
% 
% \begin{proof}  By definition, a monomial lies in $I$ if and only if it lies in $\mon(I)$.  However, $\mon(I)$ is the intersection of ideals of the form $\langle x_i^{b_i} : i \in \Omega \rangle$, where $\Omega$ is some nonempty subset of $\{ 1, \ldots, \numvars \}$, and each exponent $b_i$ is positive.   It follows that a monomial is not in $I$ if and only if it is not in one of these components of $\mon(I)$.  Given this, it suffices to establish the following.
% 
% \vspace{.2cm}
% 
% \noindent \emph{Claim.} Given positive integers  $b_1, \cdots, b_{s}$ with $1 \leq s \leq \numvars$, there exists a finite subset $\mathcal{V}$ of $\NN^\numvars$, and for every $\vv{v} \in \mathcal{V}$ a finite subset $\mathcal{W}(\vv{v})$ of the set of standard basis vectors of $\ZZ^\numvars$,  satisfying the following conditions.
% \begin{enumerate}
% \setcounter{enumi}{2}
% \item \label{stab-1: e} $x^{\vv{u}} \notin \langle x_1^{b_1}, \ldots, x_{s}^{b_{s}} \rangle $ if and only if $\vv{u} \in \vv{v} + \NN \mathcal{W}(\vv{v})$ for some $\vv{v} \in \mathcal{V}$.
% \item \label{stab-2: e} $(I:x^{\vv{v}}) = (I: x^{\vv{v}+\vv{w}})$ for every $\vv{v} \in \mathcal{V}$ and $\vv{w} \in  \NN  \mathcal{W}(\vv{v})$.
% \end{enumerate}
% 
% \vspace{.15cm}
% 
% 
% Toward the claim, let $\mathcal{A}$ be the finite set of all points $\vv{a} \in \NN^\numvars$ such that $0 \leq a_i < b_i$ for every $1 \leq i \leq s$ and $a_i = 0$ whenever $s < i \leq \numvars$.  If $s = \numvars$, then it is clear that we may take $\mathcal{V} = \mathcal{A}$ and $\mathcal{W}(\vv{v}) = \emptyset$ for every $\vv{v} \in \mathcal{V}$.
% 
% Now assume that $1 \leq s < \numvars$.
% For every $\vv{a} \in \mathcal{A}$ and $s < i \leq \numvars$, the ideals $(I: x^{\vv{a}} x_i^k)$ are increasing in $k$.  Hence there exists an integer $\ell \geq 0$ such that
% \begin{equation}
% \label{colon-simple: e}
% (I: x^{\vv{a}}x_i^\ell) = (I: x^{\vv{a}}x_i^k)
% \end{equation}
% for every point $\vv{a} \in \mathcal{A}$, every index $s < i \leq \numvars$, and every integer $k \geq \ell$.
% 
% 
% Let $\mathcal{V}$ be the set consisting of all points of the form $\vv{v} = \vv{a} + \sum_{s <i \leq \numvars} t_i \vv{e}_i$ where $\vv{a} \in \mathcal{A}$, and each integer $t_i$ satisfies $0 \leq t_i \leq \ell$.  For every such $\vv{v}$, set $\mathcal{W}(\vv{v}) = \emptyset$ if some $t_i$ is not $\ell$, and set $\mathcal{W}(\vv{v}) = \{ \vv{e}_i : s < i \leq \numvars \}$ otherwise.
% 
% After unraveling these definitions, it is obvious that \eqref{stab-1: e} is satisfied.  Furthermore, the only case in which \eqref{stab-2: e} is nontrivial is when $\vv{v} = \vv{a} + \sum_{s <i \leq \numvars} \ell \vv{e}_i$ for some $\vv{a} \in \mathcal{A}$,  in which case we must prove that
% %
% \[( I : x^{\vv{a}} x_{s+1}^\ell \cdots x_\numvars^\ell ) =   ( I : x^{\vv{a}} x_{s+1}^{\ell+w_{s+1}} \cdots x_{\numvars}^{\ell+w_\numvars}) \]
% for all nonnegative integers $w_{s+1}, \ldots, w_{\numvars}$.  However, this is an immediate consequence of \eqref{colon-simple: e} and \Cref{colon-product-stabilization: L}.
% \end{proof}
% 
% With \Cref{colon-product-stabilization: L,monomial-noetherian-decomposition: L} in hand, we now prove \Cref{mon-operation-modulo-p: T}.
% 
% \begin{proof}[Proof of \Cref{mon-operation-modulo-p: T}] Let $\mathcal{V}$ and $\mathcal{W}(\vv{v})$ be as in \Cref{monomial-noetherian-decomposition: L}, so that \[ \langle 1 \rangle \neq (I : x^{\vv{v}}) = (I : x^{\vv{v}+\vv{e}_i}) \text{ for all } \vv{v} \in \mathcal{V} \text{ and } \vv{e}_i \in \NN \mathcal{W}(\vv{v}).\]
% The finiteness of $\mathcal{V}$ and \Cref{noncontainment mod p: L,colon mod p: L} then imply that if $p \gg 0$, then
% \[ \langle 1 \rangle \neq (I_p : x^{\vv{v}}) = (I_p : x^{\vv{v}+\vv{e}_i}) \text{ for all } \vv{v} \in \mathcal{V} \text{ and } \vv{e}_i \in \NN \mathcal{W}(\vv{v}).\]
% Given this, \Cref{colon-product-stabilization: L} then implies that if $p \gg 0$, then
% \begin{equation}
% \label{canonical-set-reduces: e}
% \langle 1 \rangle \neq (I_p : x^{\vv{v}}) = (I_p : x^{\vv{v}+\vv{w}}) \text{ for all } \vv{v} \in \mathcal{V} \text{ and } \vv{w} \in \NN \mathcal{W}(\vv{v}).
% \end{equation}
% 
% For the remainder of the proof, suppose that $p \gg 0$ so that \eqref{canonical-set-reduces: e} holds.  Finally, consider a monomial $x^{\vv{u}} \notin I$.  As discussed immediately after the statement of \Cref{mon-operation-modulo-p: T}, it suffices to prove that $x^{\vv{u}} \notin I_p$.  However,  \Cref{monomial-noetherian-decomposition: L} the fact that $x^{\vv{u}} \notin I$ imply that $\vv{u} = \vv{v} + \vv{w}$ for some $\vv{v} \in \mathcal{V}$ and $\vv{w} \in \mathcal{W}(\vv{v})$, and \eqref{canonical-set-reduces: e} then tells us that $(I_p:x^{\vv{u}}) \neq \langle 1 \rangle$, so that $x^{\vv{u}} \notin I_p$.
% \end{proof}
% 
% 
% \subsection{Some applications}
% 
% 
% \begin{lemma} \label{frobenius-powers+mon-commute: L}
% Suppose that $\kk$ is a field of characteristic $p>0$.  If $\idealb$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then $\mon(\idealb^{[p^e]}) = \mon(\idealb)^{[p^e]}$ for every $e \geq 1$.
% \end{lemma}
% 
% \begin{proof}  Set $\idealc = \mon(\idealb)$ and $q=p^e$.  Given that both ideals in question are monomial, it suffices to prove that a monomial lies in $\mon(\idealb^{[q]})$ if and only if it lies in $\idealc^{[q]}$.  However, as $\idealc^{[q]} \subseteq \idealb^{[q]}$, it follows that
% $\idealc^{[q]} = \mon(\idealc^{[q]}) \subseteq \mon(\idealb^{[q]})$.
% 
% Thus, to conclude the proof, it suffices to prove that any monomial in $\idealb^{[q]}$ must lie in $\idealc^{[q]}$.  Towards this, consider a monomial $x^{\vv{u}} \in \idealb^{[q]}$, and write $\vv{u} = \vv{v}q + \vv{w}$ where $\vv{v}$ and $\vv{w}$ are points in $\NN^\numvars$, and $\vv{0} \leq \vv{w} < \vv{1}q$.
% 
% As $x^{\vv{u}} = x^{\vv{v}q} x^{\vv{w}} \in \idealb^{[q]}$, the fact that $R$ is free over $R^q$ implies that $x^{\vv{w}} \in ( \idealb^{[q]}: x^{\vv{v}q}) = (\idealb:x^{\vv{v}})^{[q]}$.  Applying the $q$-root operation to this inclusion then illustrates that $\langle 1 \rangle = \langle x^{\vv{w}} \rangle^{[1/q]}  \subseteq (\idealb: x^{\vv{v}})$,  where the first equality here follows from the bounds on $\vv{w}$ noted above.   Therefore, $x^{\vv{v}} \in \idealb$, which by definition of the ideal $\idealc$ implies that $x^{\vv{v}} \in \idealc$, and so $x^{\vv{v}} \in \langle x^{\vv{w}q} \rangle \subseteq \idealc^{[q]}$.
% \end{proof}
% 
% 
% \begin{corollary}
% \label{reduce-to-monomial-case: C}
% Suppose that $\kk$ is a field of characteristic $p>0$, and that $\ideala$ and $\idealb$ are ideals of $\kk[x_1, \ldots, x_\numvars]$ with $\ideala$ monomial and $\ideala \subseteq \sqrt{\idealb}$.  If we set $\idealc = \mon(\idealb)$,  then there exists a diagonal ideal $\ideald$ in $\kk[x_1, \cdots, x_\numvars]$ associated to a positive point in $\NN^m$ such that $\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e) = \mu(\ideala, \ideald, p^e)$ for every natural number $e$.  In particular, $\crit(\ideala,\idealb) = \crit(\ideala, \idealc) = \crit(\ideala, \ideald)$.
% \end{corollary}
% 
% % \begin{corollary}
% % \label{reduce-to-monomial-case: C}
% % Suppose that $\operatorname{char} \kk = p > 0$, that $\ideala$ is a monomial ideal of $\kk[x_1, \ldots, x_\numvars]$, and that $\idealb$ is an ideal of this same ring with $\ideala \subseteq \sqrt{\idealb}$.  If $e$ is an arbitrary nonnegative integer and $\idealc = \mon(\idealb)$, then the following hold.
% % \begin{enumerate}
% % \item $\nu(\ideala, \idealb, p^e) = \nu(\ideala, \idealc, p^e)$ and $\ft{\ideala}{\idealb} = \ft{\ideala}{\idealc}$.
% % \item $\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e)$ and $\crit(\ideala,\idealb) = \crit(\ideala,\idealc)$. 
% % \end{enumerate}
% % \end{corollary}
% 
% 
% 
% % \begin{proof}
% %  Since $\ideala$ is a monomial ideal, the invariants relying on $\idealc$ are well-defined.  Moreover, 
% % a (Frobenius) power of $\ideala$ sits in $\idealb^{[p^e]}$ if any only if it sits in $\mon(\idealb^{[p^e]})$, which equals
% % $\idealc^{[p^e]}$ by \Cref{frobenius-powers+mon-commute: L}.
% % \end{proof}
% 
% 
% \begin{proof}
% As $\ideala$ is monomial, a Frobenius power of $\ideala$ sits in $\idealb^{[p^e]}$ if any only if it sits in $\mon(\idealb^{[p^e]})$, which equals
% $\idealc^{[p^e]}$ by \Cref{frobenius-powers+mon-commute: L}.  Thus, \[\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e).\]
% 
% Next, recall that the monomial ideal $\idealc = \mon(\idealb)$ can be written as an intersection $\idealc = I_1 \cap \ldots \cap I_n$, where each $I_i$ is generated by some subset of the ambient variables raised to positive powers (e.g., see \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA}).  Thus, as $\idealc^{[p^e]} = I_1^{[p^e]} \cap \ldots \cap I_n^{[p^e]}$, it follows that $\mu(\ideala, \idealc, p^e)$ is the maximum among the  $\mu(\ideala, I_i, p^e)$.    Furthermore, though the ideals that achieve this maximum may vary as $e$ grows, \Cref{cor: mu comparison} guarantees that there exists an ideal $I$ among the $I_i$ such that $\mu(\ideala, \idealc, p^e) = \mu(\ideala, I, p^e)$ for every $e$.
% After possibly reordering the variables,  we may assume that there exists $1 \leq t \leq \numvars$ and positive integers $w_i$ for each $1 \leq i \leq t$ such that $I = \langle x_1^{w_1}, \ldots, x_t^{w_t} \rangle$.
% 
% Let $A$ be a monomial matrix associated to $\ideala$, which necessarily has $m$ rows, and let $B$ be the matrix consisting of the first $t$ rows of $A$.  If some column of the truncated matrix $B$ were zero, then some monomial generator of $\ideala$ would not be divisible by $x_i$  for all $1 \leq i \leq t$, which is impossible, since  $\ideala \subseteq \idealc \subseteq I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$ and each $w_i$ is positive. Hence $B$ is a monomial matrix,  and so if we define $\vv{w} = (w_1, \ldots, w_t) \in \NN^t$,   it follows that the feasible set of the linear program $\LP(B, \vv{w})$ is compact.  Therefore, there exists a positive integer $M$ such that the inner product of the $i$-th row and any point in the feasible set of $\LP(B, \vv{w})$ is less than $M$ for each $t < i \leq m$.   
% 
% Let $\vv{u} \in \NN^n$ be the vector whose $i$-th coordinate is $w_i$ for $1 \leq i \leq t$, and is $M$ for $t < i \leq \numvars$.  We claim that the feasible sets of the arithmetic integer programs $\IP_p(A,\vv{u},p^e)$ and $\IP_p(B,\vv{w},p^e)$ agree for each natural number $e$.  Towards this,  note that the arithmetic constraints of these programs are identical, and also that the program $\IP_p(A, \vv{u}, p^e)$  has \emph{at least} as many linear constraints as $\IP_p(B, \vv{w},p^e)$, and so 
% $\feas \IP_p(A, \vv{u}, p^e)$ lies in $\feas \IP_p(B, \vv{w}, p^e)$.
% 
% Next, consider a point $\vv{k} \in \feas \IP_p(B, \vv{w},p^e)$.  Then, the normalized point $\vv{k}/p^e$ must lie in $\feas\LP(B,\vv{w})$, and so the inner product of $\vv{k}/p^e$ with the $i$-th row of $A$ is less than $M$ for each $t < i \leq m$.    Restated, the inner product of $\vv{k}$ with the $i$-th row of $A$ is less than $u_ip^e = Mp^e$ for each $t < i \leq m$, while the feasibility of $\vv{k}$ for $\IP_p(B,\vv{w},p^e)$ implies that the inner product of the $i$-th row of $A$ is less than $w_ip^e = u_ip^e$ for $1 \leq i \leq t$.  In other words, $A \vv{k} < \vv{u}p^e$, which implies that $\vv{k} \in \feas \IP_p(A,\vv{u},p^e)$, and establishes our claim. 
% 
% In summary, if $e$ is an arbitrary natural number, then
% \begin{align*}
%  \mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e) = \mu(\ideala, I, p^e) & = \val\IP_p(B, \vv{w}, p^e) \\ 
%  & = \val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e) 
% \end{align*}
% where $\ideald$ is the diagonal ideal associated to the positive point $\vv{u} \in \NN^\numvars$. 
%  \end{proof}
% 
% \daniel[inline]{I guess we are going to have to be more precise when talking about reduction mod $p$.  I will try to give it a shot soon}
%  
% \begin{corollary} \label{nu-mu-reduce-monomial: C}
% Suppose that $\ideala \subseteq \sqrt{\idealb}$ are ideals of $\QQ[x_1, \ldots, x_\numvars]$, where $\ideala$ is a monomial ideal. If $\idealc = \mon(\idealb)$, then there exists $\beta = \beta(\ideala, \idealb) \in \ZZ$, and a diagonal ideal $\ideald$ associated to a positive point in $\NN^m$ with $\idealc \subseteq \ideald$, such that 
% \[ \mu(\ideala_p, \idealb_p, p^e) =  \mu(\ideala_p, \idealc_p, p^e) =  \mu(\ideala_p, \ideald_p, p^e) \] 
% for every $p > \beta$ and $e \geq 1$.  In particular, 
% \[ \crit(\ideala_p, \idealb_p) =  \crit(\ideala_p, \idealc_p) =  \crit(\ideala_p, \ideald_p)\] whenever $p > \beta$.  
% Finally, if $\idealb$ is monomial, then one may take $\beta(\ideala, \idealb) = 0$.
% %\begin{enumerate}
% %\item $\nu(\ideala_p, \idealb_p, p^e) = \nu(\ideala_p, \idealc_p, p^e)$ and $\ft{\ideala_p}{\idealb_p} = \ft{\ideala_p}{\idealc_p}$.
% %\item $\mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, \idealc_p, p^e)$ and $\crit(\ideala_p,\idealb_p) = \crit(\ideala_p,\idealc_p)$. 
% %\end{enumerate}
% \end{corollary}
% 
% 
% \begin{proof}
% Observe that since $\ideala \subseteq \sqrt{\idealb}$, for every monomial $\mu \in \ideala$, there exists a positive integer $k$ for which $\mu^k \in \idealb$, which happens if and only if the monomial $\mu^k$ is in $\idealc$.  Hence $\ideala \subseteq \sqrt{\idealc}$.
% Therefore, there exists $\alpha = \alpha(\ideala, \idealb)$ such that 
% $\sqrt{\idealb_p} = (\sqrt{\idealb})_p$, $\sqrt{\idealc_p} = (\sqrt{\idealc})_p$, and 
%  $\ideala_p \subseteq \sqrt{\idealc_p} \subseteq 
% \sqrt{\idealb_p}$ whenever $p > \alpha$
% Then
% $\nu(\ideala_p, \idealb_p, p^e), \mu(\ideala_p, \idealb_p, p^e)$ are defined for all $p > \alpha$ and $e \geq 1$. 
% Now, by \Cref{mon-operation-modulo-p: T}, we can find $\gamma = \gamma(\idealb)$ for which $\idealc_p = \mon(\idealb_p)$.  Then for $p$ greater than $\beta = \max\{ \alpha, \gamma \}$, the statements hold by \Cref{reduce-to-monomial-case: C}.
% \end{proof}
% 
% 
% Finally, we are equipped to prove the following result, which is applied to reduce \Cref{general-mu-theorem: T} to the case that $\idealb$ is a diagonal ideal. We follow a very similar line of reasoning to that in \cite{budur+mustata+saito.roots_bs_polys_monomial}, where they first reduce to the case that $\idealb$ is monomial in their Appendix, and then reduce further to the case that it is diagonal in the prose after Remark 4.2.  
% Our proof explicitly spells out all steps in each reduction, 
% and also makes it clear that for the first reduction, we can simply replace $\idealb$ with $\mon(\idealb)$.
% 
% % \begin{lemma} \label{reduce me to diagonal: L}
% %  Given a monomial ideal $\ideala$ of $\QQ[x_1,\ldots, x_\numvars]$, 
% % then for every ideal $\idealb$ containing $\ideala$, there exists a 
% % positive vector $\vv{u} \in \NN^\numvars$ and a positive integer $\ell = \beta(\ideala, \idealb)$ such that for all $p \geq \beta$ and $e \geq 1$, 
% % \[
% %  \mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, \ideald_p, p^e)
% % \]
% % where $\ideald$ is the diagonal ideal with respect to $\vv{u}$.  
% % \end{lemma}
% % 
% % \begin{proof}
% % The monomial ideal $\idealc = \mon(\idealb)$ can be written as the intersection of finitely many ideals of the form $I = \langle x_i^{w_i} \mid w_i \geq 1 \rangle$, for some combinatorially-determined $\vv{w} \in \NN^\numvars$ (e.g., see \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA}).   
% % As a consequence, $\idealc_p$ is the intersection of the reductions of these ideals modulo $p$. 
% % Thus, $\ideala_p^{[N]}$ is contained in $\idealc_p^{[p^e]}$ if and only if it is contained in all  $(I_p)^{[p^e]}$, so $\mu(\ideala_p, \idealc_p, p^e)$ is the maximum among the  $\mu(\ideala_p, I_p, p^e)$.
% % Then by \Cref{nu-mu-reduce-monomial: C}, there exists $\beta= \beta(\ideala, \idealb)$ for which $\mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, I_p, p^e)$ for all $p > \beta$ and $e \geq 1$.
% % 
% % 
% % 
% % If $A$ is an $\numvars \times n$ monomial matrix associated to $\ideala$, let $\vv{r}_i$ denotes its $i$-th row, let $\widetilde{A}$ be the $t \times n$ matrix with $i$-th row $\vv{r}_i$.
% % If some column of $\widetilde{A}$ were zero, then some monomial of $\ideala$ would have no $x_i$ in its support, for $1 \leq i \leq t$.  However, this is not possible since  $\ideala \subseteq \idealc \subseteq I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$. Hence $\widetilde{A}$ is monomial, so that for all $e \geq 1$, $\feas P(\widetilde{A}, \vv{w}, p^e)$ is bounded.  
% % Therefore, there exists a positive integer $M$ such that, for all $1 \leq i \leq t$, we have that $\vv{r}_i \cdot \vv{h} < M$ for every $\vv{h} \in \feas\LP(\widetilde{A}, \vv{w})$. 
% % 
% % Let $\vv{u} \in \NN^n$ be the vector whose $i$-coordinate is $w_i$ for $1 \leq i \leq t$, and is $M$ for $t < i \leq n$.
% % Given $e \geq 1$, notice that the program $\IP_p(A, \vv{u}, p^e)$ has at least as many constraints as $\IP_p(\widetilde{A}, \vv{w},p^e)$, so
% % $\feas \IP_p(A, \vv{u}, p^e) \subseteq \IP_p(\widetilde{A}, \vv{w}, p^e)$.
% % On the other hand, if $\vv{k} \in \feas \IP_p(\widetilde{A}, \vv{w},p^e)$, then 
% % $\vv{k}/p^e \in \feas\LP(\widetilde{A},\vv{w})$ and so
% % $\vv{r}_i \cdot (\vv{k}/p^e) \leq w_i$ for $1 \leq i \leq t$.  
% % Moreover,  for all $t < i \leq n$, 
% % $\vv{r}_i \cdot (\vv{k}/p^e) < M$, so that $\vv{r}_i \cdot \vv{k} < M p^e$ as well.
% % Since $\vv{k} \geq \vv{0}$, and arithmetic constraint is also satisfied, we conclude that the feasible set of $\IP_p(\widetilde{A}, \vv{w}, p^e)$ sits inside that of $\IP_p(\widetilde{A}, \vv{w}, p^e)$, so they must coincide. 
% % Hence 
% % \[
% %  \val\IP_p(\widetilde{A}, \vv{w}, p^e) = \val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e)
% % \]
% % where $\ideald$ is the diagonal ideal associated to $\vv{u} \in \NN^\numvars$. 
% % \end{proof}
% 
% % 
% % 
% % \begin{proof}[Proof of \Cref{general-mu-theorem: T}]
% % It suffices to show that there exist $\beta = \beta(\ideala,\idealb)$ and $t \geq 1$  for which the following holds: 
% % If $p > \beta$, then for all $e\geq1$, 
% % \[ \mu(\ideala_p, \idealb_p, p^e)= \mu(\widetilde{\ideala}_p, \ideald_p, p^e) \]  where $\widetilde{\ideala}$ and $\ideald = \ideal{x_1^{u_1}, \ldots, x_t^{u_t}}$, for some positive $\vv{u} \in \NN^t$,  are ideals of $\QQ[x_1, \ldots, x_t]$.
% % Indeed, after possibly enlarging $\beta$,  \Cref{diagonal-mu-theorem: T}
% % gives the desired conclusion.
% % 
% % Let $\idealc = \mon(\idealb)$. Then by \Cref{nu-mu-reduce-monomial: C}, there exists $\beta= \beta(\ideala, \idealb)$ for which $\mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, \idealc_p, p^e)$ for every $e \geq 1$. 
% % The monomial ideal $\idealc$ can be written as the intersection of finitely many ideals of the form $I_\vv{w} = \langle x_i^{w_i} | w_i \geq 1 \rangle$, for some combinatorially-determined $\vv{w} \in \NN^\numvars$ (e.g., see \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA}).  As a consequence, $\idealc_p$ is the intersection of the reductions of these ideals. 
% % Thus, $\ideala_p^{[N]}$ is contained in $\idealc_p^{[p^e]}$ if and only if it is contained in all  $(I_{\vv{w}})_p^{[p^e]}$, so $\mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, \idealc_p, p^e)$ is the maximum among the  $\mu(\ideala_p, (I_\vv{w})_p, p^e)$.
% % Hence, after possibly reordering the variables, we conclude that $\mu(\ideala_p, \idealb_p, p^e) = \mu(\ideala_p, I_p, p^e )$, where $I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$ for some $1 \leq t \leq \numvars$, and $w_1, \ldots, w_t \geq 1$.
% % 
% % Let $\widetilde{\ideala}$ be the ideal of $\QQ[x_1, \ldots, x_t]$ of elements of $\ideala$, after setting $x_i$ to $1$, for $t < i \leq \numvars$, and let $\ideald = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$ in this ring.
% % It is straightforward to check that $\ideala_p^{[N]} \subseteq I_p^{[p^e]}$ if and only if  $(\widetilde{\ideala})_p^{[N]} \subseteq \ideald_p^{[p^e]}$, so that $\mu(\ideala_p, \idealb_p, p^e) = \mu(\widetilde{\ideala}_p, \ideald_p, p^e)$.
% % \end{proof}


\section{Frobenius powers of monomial ideals}

\emily[inline]{This appendix will likely be dissolved.  We may need to bring some of these definitions/properties to an appropriate section where they will be used.  }

\emily[inline]{I believe that none of \Cref{frobenius powers definitions: S} appears verbatim in either of our previous papers.  }

\subsection{Definitions} \label{frobenius powers definitions: S}

{

%In this section, we recall the definition and basic properties of (generalized) Frobenius powers and critical exponents, as introduced in \cite{hernandez+etal.frobenius_powers}.
%Let $R$ be a regular domain of characteristic $p > 0$, and let $\ideala$ be an ideal of $R$.
If $q$ is a power of $p$, then $\ideala^{[q]}$ denotes the standard $q$-th Frobenius power of $\ideala$, that is, the ideal generated by the $q$-th powers of the elements of $\ideala$.
Given a nonnegative integer $k$, with base $p$ expansion $k = k_0 + k_1 p + \cdots + k_r p^r$, the $k$-th Frobenius power of $\ideala$ is the ideal
\[\ideala^{[k]} \coloneqq \ideala^{k_0}\big(\ideala^{k_1}\big)^{[p]}\cdots \big(\ideala^{k_r}\big)^{[p^r]}.\]


%More relevant to this article, though, is the description of $\ideala^{[k]}$ in terms of generators of $\ideala$:
%Given $\vv{u} \in \NN^n$, we use
%$\binom{k}{\vv{u}}$ to denote the binomial coefficient $\binom{k}{u_1,\ldots,u_n}$, which equals zero if $\norm{\vv{u}} \neq k$.
%If $\ideala = \ideal{f_1,\ldots,f_n}$, then $\ideala^{[k]}$ is the ideal generated by the products $f_1^{u_1}\cdots f_n^{u_n}$, ranging over all $\vv{u} \in \NN^n$ for which $\binom{k}{\vv{u}}\not\equiv 0\bmod{p}$ \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.


Frobenius powers are extended to allow nonnegative real exponents, through the use of the Frobenius roots introduced in \cite{blickle+mustata+smith.discr_rat_FPTs}.
Explicitly, for a nonnegative rational exponent of the form $k/p^e$, we define
\[\ideala^{[k/p^e]} \coloneqq \big(\ideala^{[k]}\big)^{[1/p^e]},\]
and for an arbitrary positive real number $t$, we define $\ideala^{[t]}$ by taking approximations of $t$ from above by such rational numbers, in a way analogous to the definition of test ideals in \loccit\
More explicitly, if $\left\{t_j\right\}_{j=1}^\infty$ is a sequence of real numbers limiting to $t$ from above, each of the form $k/p^e$ for some $k>0$ and $e \geq 0$, then $\ideala^{[t]}$ is defined the union of the ideals $\ideala^{[t_j]}$.

Like test ideals and multiplier ideals, as $t$ varies, the Frobenius powers $\ideala^{[t]}$ form a nonincreasing chain, and are right-constant for positive $t$, \ie $\ideala^{[t+\epsilon]} = \ideala^{[t]}$, for $0<\epsilon \ll 1$.
The positive exponents where $\ideala^{[t]}$ ``jumps'' (that is, $\ideala^{[t-\epsilon]}\ne \ideala^{[t]}$, for all $0<\epsilon \le t$) are called the \emph{critical exponents} of $\ideala$.
These are the analogues of the jumping numbers of multiplier ideals, and of the $F$-jumping exponents of test ideals, and like their counterparts, they form a discrete set of rational numbers \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}.

If $\ideala$ and $\idealb$ are nonzero proper ideals of $R$, with $\ideala \subseteq \sqrt\idealb$, the \emph{critical exponent of $\ideala$ with respect to $\idealb$} is the number
\begin{equation}\label{eq: defn of crit(a,b)}
   \crit(\ideala,\idealb) \coloneqq \min\big\{t\in \RRnn: \ideala^{[t]} \subseteq \idealb\big\}
      = \sup\big\{t\in \RRnn: \ideala^{[t]} \not\subseteq \idealb\big\}.
\end{equation}
This is indeed a critical exponent of $\ideala$, and moreover, every critical exponent $\lambda$ of $\ideala$ is of this form, for some $\idealb$ (take, for instance, $\idealb = \ideala^{[\lambda]}$).

We now describe a more explicit realization of the critical exponents of an ideal, which is central to this paper.
With $\ideala$ and $\idealb$ as above, given a nonnegative integer $e$, we set
\[\mu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{[k]} \not\subseteq \idealb^{[p^e]}\big\}.\]
Then $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_e$ is a nondecreasing bounded sequence, and

\textcolor{red}{This is already \eqref{eq: crit as a limit of mus}: 
}
\begin{equation}
   \crit(\ideala,\idealb) = \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e} = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}.
\end{equation}
% The $\mu(\ideala,\idealb,p^e)$ not only determine $\crit(\ideala,\idealb)$, but can also be recovered from $\crit(\ideala,\idealb)$, via truncations:
% \begin{equation}\label{eq: recovering mus from crit}
%    \mu(\ideala,\idealb,p^e) = \up{p^e\crit(\ideala,\idealb)} - 1.
% \end{equation}

% Before moving forward, we observe that the notions introduced in the last two paragraphs run parallel to the theory of $F$-thresholds.
% With $\ideala$ and $\idealb$ as above, the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}, denoted $\ft{\ideala}{\idealb}$, is defined as in \eqref{eq: defn of crit(a,b)}, replacing the Frobenius power $\ideala^{[t]}$ with the test ideal $\tau(\ideala^t)$.
% There is an explicit description for $\ft{\ideala}{\idealb}$ analogous to \eqref{eq: crit as a limit of mus}, where $\mu(\ideala,\idealb,p^e)$ is replaced with
% \[\nu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{k} \not\subseteq \idealb^{[p^e]}\big\}.\]
% However, there is no analogue to \eqref{eq: recovering mus from crit}, unless $\ideala$ is a principal ideal.


\subsection{Frobenius powers and critical exponents of monomial ideals}

% We now introduce some notation and gather some basic results concerning Frobenius powers and critical exponents of monomial ideals.
% We work in a polynomial ring over a field of characteristic $p>0$, in the variables $x=x_1,\ldots,x_\numvars$.
% 
% \begin{notation}
%    If $\vv{u}\in \NN^\numvars$, then $\diag(\vv{u})$ denotes the \emph{diagonal ideal}
%    \[ \diag(\vv{u}) = \ideal{x_1^{u_1},\ldots,x_\numvars^{u_\numvars}} = \ideal{x^{\vv{v}} : \vv{v} \in \NN^\numvars \text{ and } \vv{v} \not < \vv{u}}.\]
%    When dealing with notation involving diagonal ideals, we shall typically replace $\diag(\vv{u})$ in the notation with $\vv{u}$.
%    For instance, $\crit(\ideala,\diag(\vv{u}))$ will be simply denoted $\crit(\ideala,\vv{u})$.
%    Likewise, we shall often replace a monomial ideal with its exponent matrix in our notation.
% \end{notation}
% 
% \begin{remark}\label{rmk: Frobenius powers of monomial ideals are monomial ideals}
%    Since integral Frobenius powers and Frobenius roots of monomial ideals are themselves monomial ideals, the same is true for arbitrary Frobenius powers of monomial ideals.
% \end{remark}

\textcolor{red}{The first equivalent below is established in \cite[Proposition 2.5]{hernandez+etal.frobenius_examples}, and the second follows immediately from \eqref{eq: defn of crit(a,b)}.}


\begin{proposition}\label{prop: description of frobenius powers in terms of crits}
   If $\ideala$ is a monomial ideal and $\vv{v} \in \NN^\numvars$ with $\vv{v}>\vv{0}$, then
   \[ x^{\vv{v}} \in \ideala^{[t]} \iff \ideala^{[t]} \not \subseteq \diag(\vv{v}+\vv{1}) \iff \crit(\ideala, \vv{v}+\vv{1}) > t.\]
   Consequently, $\ideala^{[t]} = \ideal{x^{\vv{v}} : \crit(\ideala, \vv{v}+\vv{1}) > t}$.
\end{proposition}


% \begin{proof}
%    The second equivalence follows immediately from \eqref{eq: defn of crit(a,b)}.
%    As for the first, the forward implication is trivial, since $x^\vv{v} \notin\diag(\vv{v}+\vv{1})$, and conversely, if $\ideala^{[t]} \not \subseteq \diag(\vv{v}+\vv{1})$, then there exists $x^\vv{u} \in \ideala^{[t]}$ with $\vv{u} \le \vv{v}$, so $x^\vv{v}\in \ideal{x^\vv{u}} \subseteq \ideala^{[t]}$.
%    The final conclusion holds because $\ideala^{[t]}$ is a monomial ideal, as noted in \textcolor{red}{missing reference}.
% \end{proof}

\textcolor{red}{The following is stated for $\idealm$-primary ideals $\ideala$ as \cite[Proposition 2.6]{hernandez+etal.frobenius_examples}.}

\begin{corollary}
   \label{cor: every crit is crit wrt diagonal ideal}
   If $\ideala$ is a monomial ideal, then every critical exponent of~$\ideala$ is of the form $\crit(\ideala,\vv{u})$, for some $\vv{u} > \vv{0}$ in $\NN^\numvars$.
\end{corollary}

\begin{proof}
   Let $\lambda$ be a critical exponent of $\ideala$, so that $\ideala^{[\lambda]}$ is properly contained in $\ideala^{[t]}$ for every $0 \le t <\lambda$.
   Since the critical exponents of $\ideala$ form a discrete set \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}, the intersection of all such $\ideala^{[t]}$ properly contains $\ideala^{[\lambda]}$.
   This intersection---a monomial ideal by \textcolor{red}{missing reference}---thus contains a monomial $x^\vv{v}$ not in $\ideala^{[\lambda]}$.
   \cref{prop: description of frobenius powers in terms of crits} then shows that $\ideala^{[t]}\not\subseteq \diag(\vv{v}+\vv{1})$, whenever $0\le t < \lambda$, but $\ideala^{[\lambda]} \subseteq \diag(\vv{v}+\vv{1})$, hence $\lambda = \crit(\ideala,\vv{v}+\vv{1})$.
\end{proof}

\daniel[inline]{
   When we look for corollaries, our ability to compute $\crit(\ideala, \vv{u})$ with $\vv{u} > \vv{1}$ will show that the ideals $\ideala^{[\lambda]}$ also vary ``uniformly'' with respect to the class of $p$ modulo some denominator $\denom$, in a way that we can make precise.
}

\daniel[inline]{What about adding a connection between $\ideala^{[t]}$ and $\tau(\ideala^{t'})$ where $t'$ is the greatest $F$-threshold less than $t$?  Like in the diagonal section of our examples paper?  Maybe we could wait to do this until we compare Frobenius powers and test ideals.}
}

% 
% \newpage
% 
% In the proof of the following lemma, we apply some basic facts about colon ideals:  Suppose that $J$ is an ideal in a polynomial ring in variables $x_1, \ldots, x_\numvars$.   Given $\vv{u}, \vv{v} \in \NN^\numvars$, we have that $(J : x^{\vv{u}}) \subseteq (J : x^{\vv{u}+\vv{v}})$ and 
% \[
% ((J : x^{\vv{u}}) : x^{\vv{v}} ) = (J : x^{\vv{u}+\vv{v}})
% \]
% 
% \begin{lemma}
% Given an ideal $J$ in a polynomial ring in variables $x_1, \ldots, x_\numvars$ over a Noetherian ring, there exists a finite set $V \subseteq \NN^\numvars$ with the following property:
% For each $\vv{v} \in V$, there exists a set $W(\vv{v}) \subseteq \{ \vv{e}_1, \ldots, \vv{e}_\numvars \}$ for which 
% \[ 
% \NN^\numvars = \bigcup_{\vv{v} \in V} ( \vv{v} + \NN \, W(\vv{v}) ) 
% \]
% % \bigsqcup
% and $(J : x^{\vv{v}}) =  (J : x^{\vv{v}+ \vv{u}})$ for all $\vv{v}\in V$ and $\vv{u} \in \NN \, W(\vv{v})$.
% \end{lemma}
% 
% \begin{proof}
% Observe that if $\vv{u}, \vv{w} \in \NN^\numvars$, then $(J : x^{\vv{u}}) \subseteq (J : x^{\vv{u}+\vv{w}})$. 
% For each $1 \leq i \leq \numvars$, let $w_i$ be the smallest nonnegative integer for which $(J : x^{w_i \vv{e}_i}) = (J : x^{(w_i+1) \vv{e}_i})$, which is well defined since the polynomial ring is Noetherian. 
% Then for all integers $\ell \geq 0$, $((J : x^{w_i \vv{e}_i}) : x^{\ell \vv{e}_i} ) = ((J : x^{(w_i+1) \vv{e}_i}) : x^{\vv{e}_i} )$, i.e., 
% \begin{equation*} 
% (J : x^{(w_i+\ell) \vv{e}_i}) = (J : x^{(w_i+\ell+1) \vv{e}_i})
% \end{equation*}
% so all $(J : x^{(w_i+\ell) \vv{e}_i})$ coincide with $(J : x^{w_i \vv{e}_i})$.  
% 
% Let $V$ denote the set of all $\vv{v} \in \NN^\numvars$ for which $\vv{0} \leq \vv{v} \leq \vv{w}$.  If $\vv{v} < \vv{w}$, let $W(\vv{v}) = \emptyset$, and otherwise, let $W(\vv{v}) = \{\vv{e}_i \, : \, \vv{v}_i = \vv{w}_i \}$.  
% 
% Given $\vv{t} \in \NN^\numvars$, if $\vv{t} \leq \vv{w}$, then $\vv{t} \in V$, so is in the above union.  Otherwise, $t_i > w_i$ for some $1 \leq i \leq \numvars$.  In this case, $\vv{t} = \vv{m} + \vv{w}$, where $m_i =  \min\{ t_i, w_i \}}$ and $\vv{w}$ is the sum of all $(t_i-w_i)\vv{e}_i$ for which $t_i>w_i$. 
% Notice that $\vv{m} \in V$, and if $t_i > w_i$, then $m_i = \min\{t_i, w_i\} = w_i$, so that $\vv{e}_i \in W(\vv{m})$, and $\vv{t}$ is also in the union. 
% 
% Finally, take $\vv{v} \in V$ for which $\NN \, W(\vv{v})$ is not empty, 
% and renumber the variables so that $W(\vv{v}) = \{ \vv{e}_1, \ldots, \vv{e}_s \}$ for some $1 \leq s \leq \numvars$, so that $v_i = w_i$ for $1 \leq i \leq s$.
% 
% Given $\vv{u} \in \NN \, W(\vv{v})$, $\vv{u} = u_1 \vv{e}_1 + \cdots + u_s \vv{e}_s$.  
% Then 
% \begin{align*}
% (J : x^{\vv{v} + \vv{u}}) &= ((J : x^{(w_1 + u_1)\vv{e}_1}) : x^{\vv{v} + \vv{u} - (w_1 + u_1) \vv{e_1}} ) \\
% &= ((J : x^{w_1 \vv{e}_1}) : x^{\vv{v} + \vv{u} - (w_1 + u_1) \vv{e_1}} ) \\
% &= (J : x^{\vv{v} + \vv{u} - u_1 \vv{e}_1  } )
% \end{align*}
% and the first coordinate of $\vv{v} + \vv{u} - u_1 \vv{e}_1$ is $v_1$.  
% We can continue by writing $(J : x^{\vv{v} + \vv{u} - u_1 \vv{e}_1  } )$ as 
% \[
% ((J : x^{(w_2 + u_2)\vv{e_2}}) : x^{\vv{v} + \vv{u} - u_1 \vv{e}_1 - (w_2+u_2) \vv{e}_2  } ) = (J : x^{\vv{v} + \vv{u} - u_1 \vv{e}_1 - u_2 \vv{e}_2 } )
% \] 
% where the first and second coordinates of $\vv{v} + \vv{u} - u_1 \vv{e}_1 - u_2 \vv{e}_2$ are $v_1$ and $v_2$, respectively. 
% Continuing in this manner, we can inductively conclude that $(J : x^{\vv{v} + \vv{u}}) = (J : x^{\vv{v}})$.
% \end{proof}
% 






\newpage


\emily[inline]{

\textbf{Important Questions}.

\begin{enumerate}
 \item Does a medium-small pair always have a medium-small sprout?
 We think the answer is NO:
 Let $A = \begin{bmatrix} 3 & 0 \\ 0 & 3 \end{bmatrix}$ and $\vv{u} = (2,2)$, so that
$(A, \vv{u})$ is small but not very small.  Then the unique special point is $\vv{s} = (2/3,2/3)$, so that if $p=2 \bmod 3$, then $[\vv{s}]_p = (2[p\%3]/3, 2[p\%3]/3) = (1/3,1/3)$.

The value of $\Theta(A, \vv{u}, \vv{s}, p)$ is $0$
using the bounds in this paper, and from this, we can find that the only element of $\Delta(A, \vv{u}, \vv{s}, p)$ is $(1,1)$, which is very small.

\item Is it true that if some digit of a critical exponent of the monomial ideal $\ideala$ equals $p-1$, then \emph{all subsequent digits} must also be $p-1$.  This seems to be true if we run into a \emph{medium small} point.  Are there points $\vv{v}$ with $\mu(A,\vv{v}, p) = p-1$ where $(A,\vv{v})$ is not medium small?  Sure, look at $A = \begin{bmatrix} 2 & 0 \\ 0 & 2 \end{bmatrix}$ and $\vv{v} = (1,1)$.  Then our Frobenius examples paper should tell us that $(A, \vv{v})$ is very small but $\mu(A, \vv{u}, p)$ should equal $1$ often.
\item We saw earlier that a medium small pair need not sprout a medium small pair.  But does a pair $(A, \vv{u})$ that is small and satisfies $\mu(A, \vv{u}, p) = p-1$ then must it sprout a pair $(B, \vv{v})$ with $\mu(B, \vv{v}, p) = p-1$?

\item Pedro pointed out the better question is that if $(A, \vv{u})$ is small and $\mu(A, \vv{u}, p) = p-1$, then is the whole critical exponent $\crit(A, \vv{u}) = 1$?
\item The answer to the last question is FALSE:  In our Frobenius examples paper, there is a critical point $1-(1/p^2) = p-1 : p-2 : \overline{p-1}$.
\end{enumerate}
}




{\small
\bibliographystyle{amsalpha}
\bibliography{bibdatabase}
}


\end{document}
