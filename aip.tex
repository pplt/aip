\documentclass{amsart}
\input{preamble.tex}

\begin{document}

\title[Fractal and arithmetic programs]{Fractal programs, arithmetic programs, and the Frobenius powers of monomial ideals}
\author{Daniel J.~Hern\'andez}
\author{Pedro Teixeira}
\author{Emily E.~Witt}
\maketitle

\newcommand{\CheckedBox}{\text{\rlap{$\checkmark$}}\Box}
\details[inline]{
TO DO LIST:
\begin{enumerate}
% \item[$\CheckedBox$] Decide on ``special'' or ``universal'' denominator and uniformize.
% \emily[inline]{I'm starting to like ``universal.''}
% \pedro[inline]{I replaced the last few occurrences of ``special'' with ``universal''.}
%\item[$\Box$]  Look at wording in proof of \Cref{less than u: L}.
%\item[$\CheckedBox$] Write essential statements/proofs.
%\item[$\CheckedBox$] Decide on name of paper.
%\item[$\CheckedBox$] Decide on name for minimal coordinate.
% \comment[inline]{Going with ``special point''.}
%\item[$\CheckedBox$] Make sprout notation.
%\comment[inline]{Going with $\sprout(A,\vv{u},p)$}
% \item[$\CheckedBox$] Replace any remaining instances of $d$ for dimension with {\tt \text{numvars}}, and fix any inconsistencies.
   % \begin{itemize}
   %    \item In the discussion after the definition of Sierpinski gasket; that could be replaced with anything else ($s$, for example).
   %    \pedro[inline]{Done.}
   %    \item In the definition of least positive residue; it would be OK to leave it alone, or replace it with anything else.
   %    \pedro[inline]{Changed to $a$ and $b$.}
   %    \item $\vv{m}$ appears in the proofs of \Cref{optimal division: L,ILL: T}; again it would be OK to leave it alone, or replace it with anything else.
   %    \emily[inline]{Like $\mathfrak{m}$, I am OK using this notation; I don't think it is confusing since vectors all have the same text styling.  We use, for instance, both $\ideala$ and $\vv{a}$.}
   %    \item In \Cref{colon-product-stabilization: L} and in the proof of \Cref{monomial-noetherian-decomposition: L}. Those would need to be replaced.
   %    \emily[inline]{Done.}
   % \end{itemize}
   %It also appeared in the general discussion of optimization, but I replaced it with $n$, as our optimization problems are in $\RR^n$ and $\ZZ^n$.
% \item[$\CheckedBox$]  Brainstorm list of the desired properties we want from examples, and what section to put them in:
% \emily[inline]{I'm happy with your examples, Pedro, I don't think we need more.}
% \begin{itemize}
%    \item Examples of algorithms (\eg $\idealm$-primary case, general setting)
%    \pedro[inline]{Done}
%    \item Maybe introduce the $\idealm$-primary and/or homogeneous case earlier, for instance, when we talk about minimal face, universal denominator, etc.
%    \pedro[inline]{Done}
%    % \item Possibly simple picture (2D or 3D) illustrating small and very small after \Cref{geometric small and very small: R}.
%    % \pedro[inline]{I included an example with a picture.}
%    % \emily[inline]{Thank you!}
% \end{itemize}
% \item[$\Box$] Put in examples. Remember to label $\canvec_1$, $\canvec_2$, $\canvec_3$ when appropriate.
% \pedro[inline]{Started working on it.}
%\item[$\CheckedBox$] Rewrite statements in terms of ``shortfall.''
% \item[$\CheckedBox$] Decide how to define matrix for collapse (remove row vs. zero row), and point out no zero columns.
%\comment[inline]{Going with dropping rows.}
%\item[$\Box$] Rewrite proofs with above convention.
%\item[$\Box$] Decide on how to define $\widehat{\witt}$.  (Sprouting graph?)
 %\item[$\CheckedBox$] Fill in/rewrite preliminaries.
 %\item[$\CheckedBox$] Reorganize and motivate the $\IP$ and $\ip$, and their connection, in Sections 5 and 6.
 %\item[$\CheckedBox$] ``Fractal linear program;'' solve $P$ in ``Sierpinski gasket''
 % \item[$\Box$] Direct proof that $\delta$/$\Delta$ are independent of $\vv{s}$.
% \item[$\Box$] Minimize and/or ``algebrafy'' statements.
 %\item[$\CheckedBox$] Background section on Frobenius powers, $\mu$, $\nu$, etc.
% \item[$\Box$] Derive some easy corollaries for critical exponents and very general hypersurfaces.  State them in introduction.
% \item[$\CheckedBox$] Generalize the definition of $\IP$ so that $\IP(A, \vv{u}q)$ becomes $\IP(A, \vv{u}, q)$?
% \comment[inline]{Changed to $\IP(A, \vv{u}, q)$}

%    \item[$\Box$] Replace ``Lemma'' with ``Proposition'', if there's no immediate application in sight.

 % \item[$\CheckedBox$] Add remark describing how to verify inequalities $A\vv{k} < \vv{v}$ using projections/collapse.
 % \comment[inline]{See \Cref{rmk: verifying inequalities using collapses}.}
      %\item[$\CheckedBox$] Add remark that points out that $\collapse{A\vv{k}} = \collapse{A}\vv{k}$.
      %\item[$\CheckedBox$] In Section 4, we should talk about both $\nu$'s and $F$-thresholds. We could then introduce $\IP(A,\vv{u},q)$, immediately relate its value to the $\nu$'s, and relate $\val \LP(A,\vv{u})$ to the normalized limit of $\IP(A,\vv{u},q)$, just like we do later for the fractal programs $\fip_p$ and the arithmetic programs $\IP_p$.  Most of this has already been written, and it should just be moved from Section 5.
      %\item[$\CheckedBox$] Similarly, introduce $\fip_p$ and $\IP_p$ together, and describe their connection right away.
      %\item[$\CheckedBox$] Prior to Definition 4.1, state our goal for describing $F$-thresholds and $\nu$'s.  Use this to motivate definition of monomial pair
      %%%%% Notation %%%%%

 % \item[$\CheckedBox$] Uniformize $\collapse{A(X)} = \collapse{A}(X)$, or add a statement about this.
 % \pedro[inline]{I believe this is done now (using $\collapse{A}X$).}
      % \item[$\CheckedBox$] Use $\vv{d}$ for defining points?
      % %Pro: opens up $\vv{a}$ for columns of $A$.  Con:  maybe $\collapse{\vv{d}}$ looks ugly?  Another con is $d$ is used for number of variables and $\RR^\numvars$.
      % Emily suggest using $\vv{c}$.  This is probably a good idea.
      % \pedro[inline]{I macroed the defining points as \texttt{defpt}, and currently defined it as $\vv{c}$.}
      %\item[$\CheckedBox$] Uniformize the way we describe programs (\eg as in Section 9).
%      \item[$\CheckedBox$] Uniformize the way we introduce collapses in statements.
 %     Daniel now prefers saying ``$\collapse{X}$ denotes the collapse of $X$ along $\O$\ldots'' without specifying what $X$ is; Pedro proposed to simply write ``Let the superscript bar denote collapse along\ldots''  I think we agreed Pedro's way is better.
  %    \pedro[inline]{Gave it a shot. Apparently, ``overbar'', ``overline'', and ``overscore'' are all accepted words for the superscript bar. I used ``overbar'', but feel free to change it, if you prefer a different term.}

      %    \item[$\CheckedBox$] Right now, we are referring to ``the'' monomial matrix associated to a monomial idea.  But, we don't want to restrict to associating columns to minimal generators, since this may not be preserved by collapse.  So, we don't seem to have a canonical monomial matrix, just one associated to every set of generators.
      % \emily[inline]{Would ``a monomial matrix'' be OK?}
      % \pedro[inline]{That sounds good to me.}
    %  \item[$\CheckedBox$] Label $\canvec_1$, $\canvec_2$, $\canvec_3$ in Figure 1, and other figures.
%      \item[$\CheckedBox$] Change ``image'' to ``optimal image'', at least in definitions. optim instead of im?
%      \item[$\Box$] Remove image of arithmetic program, restate things algebraically.
      %\item[$\CheckedBox$] Draw entire line of $\norm{\vv{s}} = \val \fip_p$.
%      \item[$\Box$] Add the analog to Corollary 2.4 for $F$-thresholds and test ideals?
%      \item[$\Box$] Does 7.10 come from 7.3, if we replace 1 with $q$ and $\IP$ with $\IP_p$? If so, we should write the proof this way, and replace the comment preceding 7.11 with a remark (that makes clear the reduction to the small case)
      % \item[$\Box$] Does Corollary 8.3 come from 7.10 too?
      % \emily[inline]{I think this is defunct now? }
   %    \item[$\Box$] Identify where ``equal'' and ``equivalent'' linear/integer programs are pointed out, and define this at that point.
   % \emily[inline]{This only seems to happen with $\IP$ and $\IP_p$ when the arithmetic constraint is automatically satisfied.  I think that the meaning will be clear to the reader, and I don't think we need to make it any more explicit by distinguishing between ``equal'' and ``equivalent.''}
 \item[$\Box$] Put ``titles'' in appropriate statements.
 \pedro[inline]{Done with definitions. We might want to remove some of them later, though (\eg the one for $\epsilon_{p^e}$ and $\delta_{p^e}$).}
 \item[$\Box$]  Describe an analog of \Cref{computing nu for large q: C}:  Explain how our proof demonstrates that $\mu(A,\vv{u},p^e) = \mu(\collapse{A}, \collapse{\vv{u}}, p^e)$ for every $p \gg 0$ and $e \geq 1$.  This follows from the fact that $\sprout_p^{\ast}(A,\vv{u}) = \sprout_p^{\ast}(\collapse{A}, \collapse{\vv{u}})$.
 \item[$\Box$] Abstract
 \item[$\Box$] Introduction
 \item[$\Box$] Outline at the end of \Cref{sec: LPs}
 \pedro[inline]{We decided not to do this, right?}
 \item[$\Box$] Section on generic hypersurfaces
 \item[$\CheckedBox$] Dissolve appendix B
% \item[$\CheckedBox$] Should we explain what \Cref{main theorem wrt diagonal: T} tells us about the difference between critical exponents and $F$-thresholds?
% \item[$\CheckedBox$] Should we explain why we have a deterministic algorithm for computing critical exponents, modulo algorithms for solving integer programs, or computing lattice points in polyhedra?
% \item[$\CheckedBox$]  It seems like if $A$ comes from a positively homogeneous $\idealm$-primary ideal, then most non-leading coefficients vanish, and it should be true that either $\crit(A,\vv{u}) = \ft{A}{\vv{u}}$ or $\crit(A,\vv{u})$ is rational with denominator a power of $p$.  Is this worth pointing out?
   \end{enumerate}
}

\setcounter{tocdepth}{1}
\tableofcontents

\section{Introduction}

\subsection{Main result}
Let $\kk$ be a field of prime characteristic $p$ with $[\kk:\kk^p] < \infty$, and let $\ideala$ and $\idealb$ be nonzero proper ideals in $\kk[x_1,\ldots,x_\numvars]$ with $\ideala \subseteq \sqrt \idealb$.
For a nonnegative integer $e$, we set
\begin{equation}
   \nu(\ideala,\idealb,p^e) \coloneqq \max\big\{\ell\in \NN : \ideala^{\ell} \not\subseteq \idealb^{[p^e]}\big\}
   \label{eq: nu definition}
\end{equation}
where $\idealb^{[p^e]} = \langle g^{p^e} : g \in \idealb \rangle$ is the $p^e$-th Frobenius power of $\idealb$.
The condition that $\ideala \subseteq \sqrt \idealb$ guarantees that each $\nu(\ideala, \idealb, p^e)$ is a well-defined integer.

Starting, instead, with ideals $\ideala$ and $\idealb$ in $\QQ[x_1,\ldots,x_\numvars]$ with $\ideala \subseteq \sqrt \idealb$, for each sufficiently large prime $p$ we have well-defined characteristic $p$ reductions $\ideala_p$ and $\idealb_p$ in $\FF_p[x_1,\ldots,x_\numvars]$; we may thus consider the numbers $\nu(\ideala_p,\idealb_p,p^e)$, and ask how these vary with $p$.
Although little is known in general, a complete answer is known when $\ideala$ is a monomial ideal.
Before getting to it, though, we examine some of the motivation behind this question.

\mustata, Takagi, and Watanabe observed that the images of the invariants $\nu(\ideala_p,\idealb_p,p^e)$ in $\FF_p$ are roots of the Bernstein--Sato polynomial of $\ideala$ at the origin, for each $p \gg 0$ \cite[Proposition~3.11]{mustata+takagi+watanabe.F-thresholds}.
Furthermore, they noticed that $\nu(\ideala_p,\idealb_p,p^e)$ oftentimes (but not always) varies with $p$ in a uniform way---a behavior that allows them to find \emph{actual} roots of the Bernstein--Sato polynomial of $\ideala$ at the origin.
They ask for conditions on $\ideala$ under which this uniformity, captured in the definition below, manifests for every $\idealb$ and $e$ \cite[Problem~3.8]{mustata+takagi+watanabe.F-thresholds}.
%This special property is captured in the following definition. 

\begin{definition}
   \label{defn: nuCool}
   A nonzero proper ideal $\ideala$ of $\QQ[x_1,\ldots,x_\numvars]$ is \emph{\nuCool} if there exists a positive integer $\denom = \denom(\ideala)$ such that the following condition holds.
   Given a proper ideal $\idealb$ in the same ring with $\ideala \subseteq \sqrt \idealb$ and a nonnegative integer $e$, there exist degree $e$ polynomials $G_r(t) \in \QQ[t]$, for every integer $1 \le r < \denom$ prime to $\denom$, such that $\nu(\ideala_p, \idealb_p, p^e) = G_r(p)$ whenever $p$ is sufficiently large and $p \equiv r \bmod \denom$.
\end{definition}

If $\ideala$ is \nuCool, then the constant term $G_r(0)$ is a root of the Bernstein--Sato polynomial of $\ideala$ at the origin, for each $r$ as above \cite[Remark~3.13]{mustata+takagi+watanabe.F-thresholds}.

Budur, \mustata, and Saito showed that monomial ideals are \nuCool \cite[Theorem~4.1]{budur+mustata+saito.roots_bs_polys}.
Specifically, they showed that if $\ideala$ is a proper, nontrivial monomial ideal in $\QQ[x_1,\ldots,x_\numvars]$, then there exists a positive integer $\denom$ with the following property:
For each ideal $\idealb$ whose radical contains $\ideala$, there are positive rational numbers $\alpha$ and $\beta_r$, for $0 \le r < \denom$, such that
\begin{equation}
   \label{eq: nu-uniformity for monomial ideals}
   \nu(\ideala_p, \idealb_p, p^e) = \alpha p^e - \beta_r
\end{equation}
whenever $p^e \gg 0$ and $p \equiv r \bmod \denom$.

In this paper we prove an analogous result for a family of analogous invariants, where the standard power $\ideala^\ell$ in \eqref{eq: nu definition} is replaced with the (generalized) Frobenius power $\ideala^{[\ell]}$, introduced by the authors in \cite{hernandez+etal.frobenius_powers}.
\pedro{We could put here the text highlighted in red below, that just explains what $\ideala^{[\ell]}$ is.}
If $\kk$ is as above and $\ideala$ and $\idealb$ are nonzero proper ideals of $\kk[x_1, \ldots, x_\numvars]$ with $\ideala \subseteq \sqrt{\idealb}$, then for each nonnegative integer $e$ we define
\[\mu(\ideala,\idealb,p^e) \coloneqq \max\big\{\ell\in \NN : \ideala^{[\ell]} \not\subseteq \idealb^{[p^e]}\big\}.\]

\begin{definition}
   \label{defn: muCool}
   A nonzero proper ideal $\ideala$ of $\QQ[x_1,\ldots,x_\numvars]$ is \emph{\muCool} if a condition analogous to that in \Cref{defn: nuCool} holds for $\mu(\ideala_p,\idealb_p,p^e)$, for each proper ideal $\idealb$ in $\QQ[x_1,\ldots,x_\numvars]$ whose radical contains $\ideala$, and each nonnegative integer $e$.
\end{definition}

Our main result shows that monomial ideals are \muCool.
\begin{thmintro}[(REF)]
   \label{main theorem}
   Every nonzero proper monomial ideal of $\QQ[x_1,\ldots,x_\numvars]$ is \muCool.
\end{thmintro}
Along the way we recover the aforementioned theorem of Budur, \mustata, and Saito (REF), interpreting the coefficients in \eqref{eq: nu-uniformity for monomial ideals} in the context of certain optimization problems, whose study constitute the core of this work. 
We also describe each coefficient of the polynomials determining $\mu(\ideala_p,\idealb_p,p^e)$, which are typically not as simple as \eqref{eq: nu-uniformity for monomial ideals}, in term of optimization problems.
The following examples give a taste of the formulas obtained.

\begin{example}
   Consider the ideals $\ideala = \ideal{x^5 y^5 z^2, x^3 y^4 z^8, x^4 y^3 z^5}$ and $\idealm = \ideal{x,y,z}$ of $\QQ[x,y,z]$.
   We shall see in \Cref{ex: ft.5} that
   \[
      \mu(\ideala_p,\idealm_p,p^e) = \frac{4}{17}p^e - \frac{3}{17}p^{e-3}  - 1
    \]
    for each $e\ge 3$ and each sufficiently large prime $p$ congruent to $11$ modulo $2170560$.
\end{example}

\begin{example}
   Now consider the ideals $\ideala = \ideal{x^{36} y^{19} z^{47}, x^{10} y^{46} z^{25}, x^{31} y^{31} z^{36}}$ and $\ideald = \ideal{x^{29},y^{24},z^{30}}$ of $\QQ[x,y,z]$.
   We shall see in \Cref{ex: new example.2} that, for $e \ge 4$,
     \[
      \mu(\ideala_p,\ideald_p,p^e) =
      \begin{cases}
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{21}{25} & \text{if $e \equiv 0 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{6}{25} & \text{if $e \equiv 1 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{16}{25} & \text{if $e \equiv 2 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{1}{25} & \text{if $e \equiv 3 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{11}{25} & \text{if $e \equiv 4 \bmod 5$}
      \end{cases}
   \]
   whenever $p \gg 0$  and $p \equiv 11 \bmod 752523984455421061348766569800$.
   \pedro{Probably it makes sense to be less precise here, and just say that this holds for infinitely many $p$ in some congruence class. }
\end{example}

\subsection{Frobenius powers}
To convey the significance of \Cref{main theorem}, we trace back some of our motivations to introduce generalized Frobenius powers, which stem from a well-known property of multiplier ideals:
if $\ideala$ is an ideal of $\CC[x_1,\ldots,x_\numvars]$ and $f \in \ideala$ is a general $\CC$-linear combination of a set of generators of $\ideala$, then
\[ \mathcal{J}(f^t) = \mathcal{J}(\ideala^t)\]
for each $t \in (0,1)$ \cite[Proposition~9.2.28]{lazarsfeld.positivity-II}.
Test ideals, which are related to multiplier ideals via reduction to prime characteristic, satisfy several of the properties of multiplier ideals, but do not fare well with regards to the one above. 
For example, if $\ideala$ is a monomial ideal in a polynomial ring in positive characteristic, then the test ideals $\tau(\ideala^t)$ are characteristic independent, while if $f$ is a linear combination of monomial generators of $\ideala$, the test ideals $\tau(f^t)$ typically depend on the characteristic, often in subtle ways.

% Aiming at understanding how the Frobenius singularities of an ideal in positive characteristic relate to those of a generic element of the ideal, in \cite{hernandez+etal.frobenius_powers} the authors extended the notion of Frobenius powers, assigning to each ideal $\ideala$ of an $F$-finite regular domain $R$ of characteristic $p>0$, and each nonnegative real number~$t$, an ideal $\ideala^{[t]}$ of $R$.
% When $t$ is an integral power of $p$, our Frobenius powers agree with the standard Frobenius powers or with the ``Frobenius roots'' of \cite{blickle+mustata+smith.discr_rat_FPTs}.

Aiming at understanding how the Frobenius singularities of an ideal in positive characteristic relate to those of a generic element of the ideal, in \cite{hernandez+etal.frobenius_powers} the authors developed a new theory of Frobenius singularities of pairs in prime characteristic called \emph{\textup{(}generalized\textup{)} Frobenius powers}. 
If $\kk$ is, again, a field of prime characteristic $p$ with $[\kk:\kk^p] <\infty$, and $\ideala$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then the Frobenius powers of $\ideala$ are a family of ideals $\ideala^{[t]}$ indexed by a nonnegative real parameter $t$, which agrees with standard Frobenius powers or the ``Frobenius roots'' of \cite{blickle+mustata+smith.discr_rat_FPTs} when $t$ is an integral power of $p$, agrees with test ideals when $\ideala$ is principal, and in general mimics much of the behavior of multiplier ideals and test ideals.

\textcolor{nicered}{When the exponent is an integer, then the corresponding Frobenius power can be described concretely in terms of generators:
   If $\ell$ is a natural number, and $\ideala$ is generated by polynomials $f_1, \ldots, f_n$, then $\ideala^{[\ell]}$ is the ideal generated by the products $f^{\vv{u}} = f_1^{u_1}\cdots f_n^{u_n}$, ranging over all points $\vv{u} \in \NN^n$ for which the multinomial coefficient $\binom{\ell}{\vv{u}}$ is nonzero modulo~$p$ \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.}
\pedro{This may be omitted; if so, just remember to remove the ``as seen in the introduction'' in Section~3, when this is brought up again.}

Suppose now that $\ideala$ is generated by monomials $x^{\vv{a}_1},\ldots,x^{\vv{a}_n}$.
Unlike the test ideals $\tau(\ideala^t)$, the Frobenius powers $\ideala^{[t]}$ strongly depend on the characteristic~$p$.
Moreover, if $f=\alpha_1x^{\vv{a}_1}+\cdots+\alpha_nx^{\vv{a}_n}$ for some $\alpha_1,\ldots,\alpha_n \in \kk$ that are algebraically independent over $\FF_p$ and generate $\kk$ over $\FF_p$, then for each $t \in (0,1)$ we have
\[\tau(f^t) = \ideal{f}^{[t]} = \ideala^{[t]}.\]

\subsection{Critical exponents}
Like multiplier and test ideals, the Frobenius powers $\ideala^{[t]}$ form a nonincreasing chain of ideals, that remains constant for small increments of the parameter, and only changes at a discrete set of rational numbers called \emph{critical exponents}---the analogues of the jumping numbers of multiplier ideals, or the $F$-jumping numbers of test ideals.

Critical exponents can be more concretely realized as rates of growth of the numbers $\mu(\ideala,\idealb,p^e)$ which are the focus of this manuscript.
If $\ideala$ and $\idealb$ are nonzero proper ideals with $\ideala \subseteq \sqrt \idealb$, then the sequence $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^\infty$ is bounded and nondecreasing; the \emph{critical exponent of $\ideala$ with respect to $\idealb$} is the limit
\[
   \crit(\ideala,\idealb) \coloneqq \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e}
   = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}.
\]
The set of all critical exponents $\crit(\ideala,\idealb)$, as $\idealb$ ranges over all nonzero proper ideals whose radicals contain $\ideala$, coincides with the set of critical exponents of the Frobenius powers of $\ideala$.

The above definition and observation have their counterparts in the theory of test ideals and $F$-jumping exponents: the limit
\[
   \ft{\ideala}{\idealb} \coloneqq \lim_{e\to \infty} \frac{\nu(\ideala,\idealb,p^e)}{p^e}
   = \sup_{e\in \NN} \frac{\nu(\ideala,\idealb,p^e)}{p^e}
\]
is called the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}, and the set of all $F$-thresholds $\ft{\ideala}{\idealb}$, as $\idealb$ varies as above, coincides with the set of $F$-jumping exponents of the test ideals of $\ideala$.

\todo[inline]{
   Mention what \Cref{main theorem} says about crits.

   Compute $\crit$ for second example; emphasize how it differs from ft.
}

\todo[inline]{
   TBC
}

% \begin{itemize}
%  \item Motivate via test ideals of general hypersurfaces.
%  \item Emphasize the uniformity result over algorithms, and tie it in with previous known results.
%  \item State main theorems.
%  \item Explain that we reduce to the case that $\idealb$ is a diagonal monomial ideal.
% \end{itemize}

% Let $\kk$ be a field of prime characteristic $p>0$ with $[\kk:\kk^p] < \infty$, and take ideals $\ideala$ and $\idealb$ in a polynomial ring over $\kk$ for which $\ideala$ is contained in $\sqrt \idealb$.
% \pedro{We might want to require these to be nonzero and proper, or else we need special conventions when $\ideala = 0$ or $\idealb = R$.}
% For a nonnegative integer $e$, we define
% %
% \[\nu(\ideala,\idealb,p^e) \coloneqq \max\big\{\ell\in \NN : \ideala^{\ell} \not\subseteq \idealb^{[p^e]}\big\}\]
% %
% where $\idealb^{[p^e]} = \langle g^{p^e} : g \in \idealb \rangle$ is the $p^e$-th Frobenius power of $\idealb$.
% The condition that $\ideala \subseteq \sqrt \idealb$ guarantees that each $\nu(\ideala, \idealb, p^e)$ is a well-defined integer.

% The \emph{growth rate} of these integers as a function of the nonnegative integer $e$ is of independent interest.
% It is not hard to see that the sequence $\big(\nu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^{\infty}$ is nondecreasing and bounded,  and we define
% \[
%    \ft{\ideala}{\idealb} \coloneqq \lim_{e \to \infty} \frac{\nu(\ideala, \idealb, p^e)}{p^e}  = \sup_{e\in \NN} \frac{\nu(\ideala,\idealb,p^e)}{p^e}
% \]
% which we call the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}.

% % \daniel{Motivate the $\nu$'s by tying them to roots of BS polynomials; motivate $F$-thresholds by relating them to behavior of test ideals.  Relate them to multiplier ideals}

% \daniel[inline]{This is essentially copied verbatim from \cite[Problem 3.8]{mustata+takagi+watanabe.F-thresholds}.  It also appeared as \cite[Problem 2.3]{budur+mustata+saito.roots_bs_polys} .  We should probably restate it more precisely, and explain its significance.}

% \begin{problem}
%    Find conditions on the ideal $\ideala$ such that the following holds.
%    Given an ideal $\idealb$ with $\ideala \subseteq \sqrt \idealb$ and a nonnegative integer $e$, there exists a positive integer $N$ and polynomials $P_i(t) \in \QQ[t]$ of degree $e$ for every $i$ that is a unit modulo $N$ such that $\nu(\ideala_p, \idealb_p, p^e) = P_i(p)$ whenever $p$ is sufficiently large and $p \equiv i \bmod N$.
%    When could $N$ be chosen independently of $\idealb$ and $e$?
% \end{problem}

% \daniel[inline]{Emphasize that when $\ideala$ is monomial and $\idealb$ is arbitrary (over $\QQ$), then the $F$-threshold of $\ideala_p$ with respect to $\idealb_p$ is independent of $p$ for all $p \gg 0$.  This is \Cref{nu-mu-reduce-monomial: C}.}

% \begin{theorem}
%    \label{general-nu-theorem: T}
%    Given a monomial ideal $\ideala$ of $\QQ[x_1, \ldots, x_\numvars]$, and an arbitrary ideal $\idealb$ of this polynomial ring with $\ideala \subseteq \sqrt{\idealb}$, there exist positive integers $\ell = \ell(\ideala)$ and  $\beta = \beta(\ideala, \idealb)$, and for every integer $1 \leq r < \ell$ relatively prime to $\ell$, a rational number $\delta(\ideala, \idealb, r)$ satisfying the following condition.
%    If $p^e > \beta(\ideala, \idealb)$ and $p^e \equiv r \bmod \ell$, then $ \nu(\ideala_p, \idealb_p, p^e) = \ft{\ideala}{\idealb} \cdot p^e - \delta(\ideala, \idealb, r)$.
% \end{theorem}

% As above, let $\kk$ be a field of prime characteristic $p>0$ with $[\kk: \kk^p]$ finite.
% If $\ideala$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then the Frobenius powers of $\ideala$ are a family of ideals $\ideala^{[t]}$ indexed by a nonnegative real parameter $t$.
% When the exponent is an integer, then the corresponding Frobenius power can be described concretely in terms of generators as follows:
% If $k$ is a natural number, and $\ideala$ is generated by polynomials $f_1, \ldots, f_n$, then $\ideala^{[k]}$ is the ideal generated by the products $f^{\vv{u}} = f_1^{u_1}\cdots f_n^{u_n}$, ranging over all points $\vv{u} \in \NN^n$ for which the multinomial coefficient $\binom{k}{\vv{u}}$ is nonzero modulo~$p$  \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.

% Now, if $\idealb$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$ with $\ideala \subseteq \sqrt{\idealb}$, then in analogy with the above definitions, given a nonnegative integer $e$, we define
% \[\mu(\ideala,\idealb,p^e) \coloneqq \max\big\{\ell\in \NN : \ideala^{[\ell]} \not\subseteq \idealb^{[p^e]}\big\}.\]
% Then $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^{\infty}$ is a nondecreasing bounded sequence, and
% \begin{equation}\label{eq: crit as a limit of mus}
%    \crit(\ideala,\idealb) \coloneqq \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e} = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}
% \end{equation}
% is the \emph{critical exponent of $\ideala$ with respect to $\idealb$}.

% \begin{theorem}
%    \label{general-mu-theorem: T}
%    Given a monomial ideal $\ideala$ of $\QQ[x_1, \ldots, x_\numvars]$, there exists a positive integer $\ell = \ell(\ideala)$, and for every ideal $\idealb$ with $\ideala \subseteq {\idealb}$ and for every integer $1 \leq r < \ell$ relatively prime to $\ell$, there exist a positive integer $\beta = \beta(\ideala, \idealb)$ and a sequence $\big(\epsilon(\ideala, \idealb, r, e)\big)_{e=1}^{\infty}$ of nonnegative rational numbers satisfying the following condition.
%    If $p > \beta$ and $p \equiv r \bmod \ell$, then
%    \[ \mu(\ideala_p, \idealb_p, p^e) = \ft{\ideala}{\idealb} \cdot p^e - \sum_{s=1}^{e} \epsilon(\ideala, \idealb, r, s) \cdot p^{e-s}.\]
% \end{theorem}

\section{Notation and basic notions}

\subsection{Euclidean spaces}
\label{ss: euclidean spaces and convexity}
%We review in this subsection some of the terminology, notation, and constructions concerning Euclidean spaces used throughout the paper.
We use bold-face lower-case letters to denote points of the Euclidean space $\RR^n$, and the same letter, in regular font, to represent their coordinates (\eg $\vv{v}=(v_1,\ldots,v_n)$).
The points $(0,\ldots,0)$ and $(1,\ldots,1)$ are denoted $\vv{0}$ and $\vv{1}$, and we write the standard basis vectors of $\RR^n$ as $\canvec_1,\ldots,\canvec_n$.

Given a point $\vv{u}\in \RR^n$, $\norm{\vv{u}}$ denotes its coordinate sum, $u_1+\cdots+u_n$.
The standard inner product in $\RR^n$ is denoted by the usual angle brackets: $\iprod{\vv{u}}{\vv{v}} = u_1v_1 + \cdots + u_nv_n$.
An inequality between points of $\RR^n$ is a shorthand for a system of $n$ coordinatewise inequalities; \eg $\vv{u}\le \vv{v}$ means that $u_i \le v_i$ for each $i=1,\ldots,n$.
In the same vein, operations on numbers are extended to points in $\RR^n$ in a coordinatewise fashion; for instance, $\up{\vv{u}}=(\up{u_1},\ldots,\up{u_n})$.

We say that a point $\vv{u}$ in a coordinate subspace $\mathcal{S}$ of $\RR^n$ is a \emph{positive} (respectively, \emph{nonnegative}) point of $\mathcal{S}$ if $\vv{u}$ is a positive (respectively, nonnegative) linear combination of the standard basis vectors that span $\mathcal{S}$.
We extend this to all points in $\RR^n$, via projection: we say that $\vv{u} \in \RR^n$ is \emph{positive in $\mathcal{S}$} (respectively, \emph{nonnegative in $\mathcal{S}$}) if its projection on $\mathcal{S}$ is a positive (respectively, nonnegative) point of $\mathcal{S}$.
Finally, given $\vv{u},\vv{v}\in \RR^n$, we say that \emph{$\vv{u}$ is less than} (respectively, \emph{less than or equal to}) \emph{$\vv{v}$ in $\mathcal{S}$} if $\vv{v}-\vv{u}$ is positive (respectively, nonnegative) in $\mathcal{S}$.

Note that with these conventions, $\vv{u} < \vv{v}$ if and only if $\vv{u}$ is less than $\vv{v}$ both in $\mathcal{S}$ and in its orthogonal complement $\mathcal{S}^\perp$.

\subsection{Monomial matrices, monomial ideals, and pairs}
\label{monomial newton preliminaries: ss}

We work in the polynomial ring $\kk[x_1, \ldots, x_\numvars]$ over a field $\kk$, and adopt standard multi-exponent notation for denoting monomials; that is, if $\vv{u} \in \NN^\numvars$, then $x^{\vv{u}} = x_1^{u_1} \cdots x_\numvars^{u_\numvars}$.

\begin{definition}[Monomial matrices]
\label{monomial matrix: D}
A \emph{monomial matrix} is a matrix over $\ZZ$ with nonnegative, nonzero rows and columns.
If $A$ is an $\numvars \times n$ monomial matrix, then we call $\ZZ^n$ the \emph{domain lattice} and $\ZZ^\numvars$ the \emph{target lattice} of $A$.
\end{definition}

\begin{remark}[Connections with monomial ideals]
   \label{monomial matrix ideal: R}
   Consider a proper monomial ideal~$\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$.
   Given a generating set $x^{\vv{a}_1}, \ldots, x^{\vv{a}_n}$ for $\ideala$, not necessarily minimal, with the property that each variable of the ambient polynomial ring appears in some generator, the matrix
   \[
      A= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}
   \]
   is an  $\numvars \times n$ monomial matrix.
   Clearly, as this process depends on the choice of a distinguished generating set for the ideal $\ideala$, there are many monomial matrices $A$ we can assign to $\ideala$, though each such matrix will necessarily have $m$ rows.
\end{remark}

\begin{remark}[Generators of powers in terms of monomial matrices]
   \label{generators-via-exponent-matrix: R}
   If $\ideala$ is a proper monomial ideal, and $A= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}$ is a monomial matrix associated to $\ideala$, then the generators of powers of $\ideala$ can be described compactly in terms of the matrix $A$.
   Indeed, this follows from the fact that the product $(x^{\vv{a}_1})^{k_1} \cdots (x^{\vv{a}_n})^{k_n}$ can be written as $x^{A \vv{k}} = x^{k_1 \vv{a}_1 + \cdots + k_n \vv{a}_n}$.
   Thus, $\ideala^\ell$ is generated by all monomials of the form $x^{A \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}} = \ell$.
\end{remark}

\begin{definition}[Diagonal ideals]
   A  \emph{diagonal ideal} of $\kk[x_1, \ldots, x_{\numvars}]$ is any \emph{proper} ideal of the form $\ideald = \langle x_1^{u_1}, \ldots, x_{\numvars}^{u_{\numvars}} \rangle$.
   In this case,  we call $\ideald$ the diagonal ideal associated to the \emph{positive} point $\vv{u} = (u_1, \ldots, u_{\numvars}) \in \ZZ^{\numvars}$.
\end{definition}

\begin{definition}[Pairs]
\label{pairs: D}
   A \emph{monomial pair} $(A, \vv{u})$ consists of an $\numvars \times n$ monomial matrix $A$, and a positive point $\vv{u}$ of $\ZZ^\numvars$, the target lattice of $A$.
    An \emph{$A$-pair} is a monomial pair whose first entry is $A$.

   An \emph{ideal pair} $(\ideala, \ideald)$ consists of a proper monomial ideal $\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$, along with a diagonal ideal $\ideald$ of the same ambient polynomial ring.
\end{definition}

\begin{remark}[Association of pairs]
\label{associate of pairs: R}
 As in \Cref{monomial matrix ideal: R}, we may associate to each ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$ a monomial pair $(A, \vv{u})$.  Observe that, though there need not be a canonical choice for the $\numvars \times n$ matrix $A$, the positive point $\vv{u} \in \ZZ^\numvars$ is uniquely determined by the diagonal ideal $\ideald$.
\end{remark}

\subsection{Optimization} \label{optimization: S}  Optimization problems play a central role in this paper.  Here, we briefly recall the basic framework of standard \emph{programming}.

Suppose that $\mathcal{X}$ is either $\RR^n$ or $\ZZ^n$.  By a \emph{program $\Omega$ in the ambient space $\mathcal{X}$}, we mean an optimization problem seeking to maximize some given linear \emph{objective function} $\RR^n \to \RR$ on some subset of $\mathcal{X}$ defined by a system of linear inequalities, called the \emph{constraints} of the program $\Omega$. If $\mathcal{X} = \RR^n$, then the points in $\mathcal{X}$ satisfying these constraints define a polyhedron in $\RR^n$, while if $\mathcal{X} = \ZZ^n$, then the points in $\mathcal{X}$ satisfying these constraints instead consist of the lattice points in some polyhedron in $\RR^n$.  In either case, we call this set of points in $\mathcal{X}$ the \emph{feasible set} of the program.  We denote it by $\feas \Omega$, and say that the points in this set are \emph{feasible} for the program $\Omega$.

To distinguish between these cases, we refer to a program in $\mathcal{X} = \RR^n$ as a {real linear program}, or \emph{linear program} for short, and to a program in $\mathcal{X}=\ZZ^n$ as an {integer linear program}, or \emph{integer program} for short.

Every program $\Omega$ we consider in this article has the property that the values taken on by the objective function on $\feas \Omega$ are bounded from above, and in this case, the maximum value achieved by the objective function on this feasible set is called the \emph{value} of the program $\Omega$, and is denoted $\val \Omega$.  The subset of $\feas \Omega$ where the objective function achieves this maximum value is called the \emph{optimal set} of $\Omega$, and is denoted $\opt \Omega$.   When $\Omega$ is a linear program in $\RR^n$, its optimal set is a face of the polyhedron $\feas \Omega$ in $\RR^n$.

\section{Connections with optimization}
\label{sec: LPs}

Throughout this section, we consider an ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$, as described in \Cref{pairs: D}.
Our goal here, and for much of the rest of the article, is to study the integers $\nu(\ideala, \ideald, p^e)$ and $\mu(\ideala, \ideald, p^e)$ and rational numbers $\ft{\ideala}{\ideald}$ and $\crit(\ideala, \ideald)$ defined in the introduction.
As will soon be apparent, it is natural to do so in terms of various optimization problems.

\begin{remark} \label{reduction to diagonal :R}
   This context might seem restrictive, given that our ultimate goal is to understand the nature of those numerical invariants when the diagonal ideal $\ideald$ is replaced with an arbitrary ideal $\idealb$.
   However, as we explain in \Cref{monomial-reduction: A}, understanding the situation for all ideal pairs $(\ideala, \ideald)$ with $\ideala$ fixed, but $\ideald$ varying, leads to \Cref{general-nu-theorem: T,general-mu-theorem: T}.
\end{remark}

To transition from algebra to optimization, fix a monomial pair $(A, \vv{u})$ associated to $(\ideala, \ideald)$, as described in \Cref{associate of pairs: R}.  In particular, $A$ is an $\numvars \times n$ monomial matrix, $\vv{u} \in \ZZ^\numvars$ is a positive lattice point, and
\[ \ideald = \langle x^{u_1}, \ldots, x^{u_{\numvars}} \rangle \subseteq \kk[x_1, \ldots, x_{\numvars}] \] is the diagonal ideal associated to $\vv{u}$.

\subsection{Relations with integer and linear programs}
We start by studying the integers $\nu(\ideala, \ideald, p^e)$ and rational numbers $\ft{\ideala}{\ideald}$; as touched on in \Cref{reduction to diagonal :R}, we will later be able to use the results established in this restrictive setting to obtain more general ones.
First, recall that for each $q$ a power of $p$, the integer $\nu(\ideala, \ideald, q)$ is defined as
\[\nu(\ideala,\ideald,q) = \max\big\{\ell \in \NN : \ideala^{\ell} \not\subseteq \ideald^{[q]}\big\}.\]

As noted in \Cref{generators-via-exponent-matrix: R},  the ideal $\ideala^{\ell}$ is generated by all monomials of the form $x^{A\vv{k}}$, with $\vv{k}\in \NN^n$ and $\norm{\vv{k}} = \ell$.  Furthermore, as $\ideald^{[q]}$ is the diagonal ideal associated to $\vv{u}q$, we have that $\ideala^{\ell} \not\subseteq \ideald^{[q]}$ if and only if there is some generator $x^{A \vv{k}}$ of $\ideala^{\ell}$ with $A\vv{k} < \vv{u}q$.  Thus, computing $\nu(\ideala,\ideald,q)$ is equivalent to maximizing the value of $\norm{\vv{k}}$, with $\vv{k} \in \ZZ^n$, and subject to the constraints $\vv{k} \geq \vv{0}$ and $A\vv{k} < \vv{u}q$.
This observation motivates the following definition.

\begin{definition}[The integer program $\IP$]
\label{IP: D}
   If $q$ is a positive integer, then $\IP(A, \vv{u}, q)$ is the integer program in the domain lattice of $A$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}q - \vv{1}$.
\end{definition}

It is easy to deduce from the fact that the matrix $A$ is a monomial matrix (\ie has nonnegative, nonzero rows and columns) that the feasible set of $\IP(A,\vv{u},q)$ is finite, and hence this integer program has a well-defined value.
Moreover, the discussion preceding \Cref{IP: D} demonstrates that
%
\begin{equation}
\label{nu as program value: eq}
\nu(\ideala,\ideald,q) = \val \IP(A,\vv{u},q).
\end{equation}

We now shift our attention from the integers $\nu(\ideala, \ideald, q)$ to the $F$-threshold $\ft{\ideala}{\ideald}$.  First, note that \eqref{nu as program value: eq} and the definition of $\ft{\ideala}{\ideald}$ imply that
%
\begin{equation}
\label{ft as limit of normalized program values: eq}
\ft{\ideala}{\ideald} = \lim_{e\to\infty} \frac{\nu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP(A,\vv{u},p^e)}{p^e}.
\end{equation}

Continuing with our theme, we seek to describe this number in terms of a certain optimization program, which we define below.

\begin{definition}[The linear program $\LP$]
\label{LP: D}
 $\LP(A, \vv{u})$ is the linear program in the domain of $A$ which consists of maximizing $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}$.
\end{definition}

Once again, the fact that $A$ is monomial implies that the feasible set of the linear program $\LP(A,\vv{u})$ is bounded, and therefore a polytope in the domain of $A$.  Consequently, $\LP(A,\vv{u})$ has a well-defined value.

\begin{proposition}
\label{ft as val LP: P}
The value of $\LP(A, \vv{u})$ equals the $F$-threshold $\ft{\ideala}{\ideald}$.
\end{proposition}

\begin{proof}
  Recall that, as $A$ is an $\numvars \times n$ monomial matrix, the domain of $A$ is $\RR^n$, and the domain lattice of $A$ is $\ZZ^n$.  If $\vv{k} \in \ZZ^n$ is optimal for $\IP(A,\vv{u},q)$, then the scaled point $\vv{k}/q$ is feasible for $\LP = \LP(A, \vv{u})$, so $\val \LP \geq \val \IP(A, \vv{u}, q)/q$ for all $q$.
   Thus, $\val \LP$ is at least equal to the limits appearing in \eqref{ft as limit of normalized program values: eq}.

   Conversely, given an optimal point $\vv{t} \in \RR^n$ for $\LP$,
   define $\vv{t}_q \in \ZZ^n$ as the point whose $i$-th coordinate is $0$ if $t_i=0$, and otherwise equals $\lceil q t_i \rceil - 1$, the greatest integer less than $q t_i$.
   By design, and the fact that $A$ is a monomial matrix, the $i$-th entry of $A \vv{t}_q$ is either less than the $i$-th entry of $A (q \vv{t})$, which itself is less than or equal to $u_iq$, by the feasibility of $\vv{t}$ for $\LP$, or equals $0$,  in which case it is also less than $u_i q$ since $\vv{u}$ is positive. This observation demonstrates that $\vv{t}_q$ is feasible for $\IP(A, \vv{u}, q)$, and so
   \[\val \IP(A, \vv{u}, q) \geq \norm{\vv{t}_q} \geq \sum_{i=1}^n \big(\lceil q t_i \rceil - 1\big) \geq q \norm{\vv{t}} -n = q \cdot \val \LP - n.\]
   Dividing by $q$ and taking the limit as $q$ tends to infinity, we find that the limits in \eqref{ft as limit of normalized program values: eq} are at least $\val \LP$, which completes the proof.
\end{proof}

\subsection{Relations with arithmetic and fractal programs}

We now turn our attention to the integers $\mu(\ideala, \ideald, p^e)$ and rational numbers $\crit(\ideala,\ideald)$.
First, recall that for each $q$ a power of $p$, the integer $\mu(\ideala, \ideald, q)$ is defined as
\[\mu(\ideala,\ideald,q) \coloneqq \max\big\{ \ell \in \NN : \ideala^{[\ell]} \not\subseteq \ideald^{[q]}\big\},\]
where $\ideala^{[\ell]}$ is the $\ell$-th (generalized) Frobenius power of $\ideala$.

As noted in the introduction, if $\idealb$ is an ideal of a ring of characteristic $p$ with generators $g_1, \ldots, g_n$, then $\idealb^{[\ell]}$ is the ideal generated by the products $g_1^{k_1}\cdots g_n^{k_n}$, ranging over $\vv{k} \in \NN^n$ with $\norm{\vv{k}}=\ell$, and for which  $\binom{\ell}{\vv{k}} =
\frac{\ell!}{k_1 ! \cdots k_n !}$ is nonzero modulo $p$  \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.
In light of this, \Cref{generators-via-exponent-matrix: R} tells us that $\ideala^{[\ell]}$ is generated by the monomials of the form $x^{A \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}}=\ell$ and $\binom{\ell}{\vv{k}} \not\equiv 0 \bmod p$.  As in the previous subsection, we may conclude that $\mu(\ideala,\ideald,q)$ is the maximum value of $\norm{\vv{k}}$, with $\vv{k} \in \NN^n$ subject to the linear constraint $A\vv{k} < \vv{u}q$, but also subject to the highly nonlinear constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not\equiv 0 \bmod{p}$.  Motivated by this, we introduce a variant of an integer program that we call an \emph{arithmetic integer program}.
%As this new constraint is arithmetic in nature, we call such an optimization problem an \emph{arithmetic integer program}.

\begin{definition}[The arithmetic integer program $\IP_p$]
\label{aip: D}
If $q$ is a power of $p$, then $\IP_p(A, \vv{u}, q)$ is the \emph{arithmetic integer program} in the domain lattice of $A$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the linear constraints $\vv{k} \geq \vv{0}$ and $A \vv{k} \leq \vv{u}q - \vv{1}$, and the arithmetic constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not \equiv 0 \bmod p$.
\end{definition}

We define the terms \emph{feasible, optimal}, and \emph{value} relative to the arithmetic program $\IP_p(A, \vv{u}, q)$ in analogy with those for the integer program $\IP(A, \vv{u}, q)$.

\begin{remark}[A characterization of the arithmetic constraint]
   \label{dickson: R}
   \pedro{
      I changed the notation here, as $n$ appeared with multiple meanings.
   }
   Consider $\ell \in \NN$ and $\vv{k} \in \NN^n$.
   In base $p$, we express these quantities as $\ell = \sum_{e=0}^s \ell_e p^e$ and $\vv{k}=\sum_{e=0}^s \vv{k}_e p^e$ where $0\le \ell_e < p$ and $\vv{0}\le\vv{k}_e < p  \vv{1}$ for each $0 \leq e \leq s$, and where $\ell_s$ and $\vv{k}_s$ are allowed to be zero.
   In any case, \cite{dickson.multinomial} then tells us that $\binom{\ell}{\vv{k}}\equiv \binom{\ell_0}{\vv{k}_0}\binom{\ell_1}{\vv{k}_1}\cdots \binom{\ell_s}{\vv{k}_s} \mod{p}$.

   In particular, the multinomial coefficient $\binom{\ell}{\vv{k}}$ is nonzero modulo $p$ if and only if $\norm{\vv{k}_e}=\ell_e$ for each $e$, a condition that is sometimes described by saying that the entries of the vector $\vv{k}$ sum to $\ell$ \emph{without carrying} in base $p$.
   In light of this, the arithmetic constraint in \Cref{aip: D} is equivalent to the condition that all terms $\vv{k}_e$ of the base $p$ expansion of the lattice point $\vv{k}$ have coordinate sum less than $p$.
\end{remark}

% \begin{remark}[A characterization of the arithmetic constraint]
%  \label{dickson: R}
%    Consider $n \in \NN$ and $\vv{n} \in \NN^n$.
%    In base $p$, we may uniquely express these quantities as $n= \sum_{e=0}^s n_e \, p^e$ and $\vv{n}=\sum_{e=0}^s \vv{n}_e \, p^e$
% %\begin{equation*}
% %n= \sum_{e=0}^s n_e \, p^e \quad \text{and} \quad \vv{n}=\sum_{e=0}^s \vv{n}_e \, p^e
% %\end{equation*}
% where $0\le n_e < p$ and $\vv{0}\le\vv{n}_e < p  \vv{1}$ for each $0 \leq e \leq s$, and where $n_s$ and $\vv{n}_s$ are allowed to be zero.
% In any case, \cite{dickson.multinomial} then tells us that
% $\binom{n}{\vv{n}}\equiv \binom{n_0}{\vv{n}_0}\binom{n_1}{\vv{n}_1}\cdots \binom{n_s}{\vv{n}_s} \mod{p}$.
% %\[
% %    \binom{n}{\vv{n}}\equiv \binom{n_0}{\vv{n}_0}\binom{n_1}{\vv{n}_1}\cdots \binom{n_t}{\vv{n}_t} \mod{p}.
% %\]

% In particular, the multinomial coefficient $\binom{n}{\vv{n}}$ is nonzero mod $p$ if and only if $\norm{\vv{n}_e}=n_e$ for each $e$, a condition that is sometimes described by saying that the entries of the vector $\vv{n} \in \NN$ sum to $n$ \emph{without carrying} in base $p$.

% In light of this, the arithmetic constraint in \Cref{aip: D} is equivalent to the following condition:  If
%  $\vv{k} = \vv{k}_0 + \vv{k}_1 \, p\cdots + \vv{k}_s \, p^s$ is the base $p$ expansion of the nonnegative lattice point $\vv{k}$, then $\norm{\vv{k}_e} < p$ for all $0 \leq e \leq s$.
% \end{remark}

Clearly, the feasible set of $\IP_p(A, \vv{u}, q)$ lies in the feasible set of $\IP(A, \vv{u},q)$, and is therefore finite.
In particular, this arithmetic program has a well-defined value, and the discussion preceding \Cref{aip: D} tells us that
\begin{equation}
\label{mu as program value: eq}
\mu(\ideala,\ideald,q) = \val \IP_p(A,\vv{u},q).
\end{equation}

Turning to the critical exponents $\crit(\ideala, \ideald)$, the identity \eqref{mu as program value: eq} implies that
\begin{equation}
\label{crit as limit of normalized program values: eq}
\crit(\ideala,\ideald) = \lim_{e\to\infty} \frac{\mu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP_p(A,\vv{u},p^e)}{p^e}.
\end{equation}
In what follows, in analogy with \Cref{ft as val LP: P}, we seek to relate these quantities to the value of a variant of a linear program that we call a \emph{fractal linear program}.  To do so, we require the following concept.

\begin{definition}[Sierpi\'nski gasket]
\label{sierpinski: D}
   The \emph{Sierpi\'nski $p$-gasket of dimension $n$} is the set $\sierp_{p,n}$ consisting of all points $\vv{t}\in \RR^n$ for which there exist $s \in \ZZ$ and a sequence of points $( \vv{t}_e )_{e=s}^\infty$ in $\NN^n$ such that $\norm{\vv{t}_e} < p$ for all $e \geq s$, and
 \[
\vv{t} = \sum_{e=s}^{\infty} \frac{\vv{t}_e}{p^e}.
 \]
\end{definition}

Note that the integer $s \in \ZZ$ in \Cref{sierpinski: D} can be negative.
It is also immediate that $\vv{t} \in \sierp_{p,n}$ if and only if $p^k  \vv{t} \in \sierp_{p,n}$ for some (equivalently, for every) integer $k \in \ZZ$; this reflects the self-symmetry observed in \Cref{fig: sierpinski 3-gasket}.
In particular, when determining whether $\vv{t} \in \RR^n$ lies in $\sierp_{p,n}$, we may rescale by a power of $p$  and assume that $\vv{t} \in [0,1]^n$.

Recall that every point $t \in [0,1]$ either has a unique base $p$ expansion, which is necessarily non-terminating, or else $p^k t \in \NN$ for some $k \in \ZZ$, in which case $t$ has both a terminating and a non-terminating expansion.
Thus, if $\vv{t} \in [0,1]^n$ is such that no component of $p^k \vv{t}$ is an integer for each $k \in \NN$, then there is a unique sequence $( \vv{t}_e )_{e=1}^{\infty}$ in $ \NN^n$ such that $\vv{t} = \sum_{e=1}^{\infty} \frac{\vv{t}_e}{p^e}$, and such point lies in ${\sierp}_{p,n}$ if and only if $\norm{\vv{t}_e} < p$ for every  $e$.
However, things can be more subtle when some $p^k \vv{t}$ has an integer component.

\begin{example}
If $p=2$, then $(1/4, 1/4) \in \sierp_{2,2}$.  Indeed, for the first component, take the non-terminating binary expansion $\frac{1}{4} = \frac{1}{2^3} + \frac{1}{2^4} + \frac{1}{2^5} + \cdots$, and for the second component, simply take the expansion $\frac{1}{4} = \frac{1}{2^2}$.  Note that if one instead considered the non-terminating expansion for both components, or the terminating expansion for both components, then the resulting expansion of $(1/4, 1/4)$ would fail to satisfy the condition in \Cref{sierpinski: D}.
\end{example}

This description of the Sierpi\'nski $p$-gasket in terms of expansions is not hard to translate geometrically into its description as a fractal.

\begin{example}
\label{sierpinski triangle: E}
The set $\sierp_{2,2} \cap [0,1]^2$ is the familiar Sierpi\'nski triangle, together with the line segments connecting $(1,0)$ to $(1,1)$, and $(1,1)$ to $(0,1)$.
Indeed, the points $\vv{t}$ in the unit square $[0,1]^2$ that have \emph{no} binary expansion $\vv{t} = \sum_{e=1}^{\infty}\frac{\vv{t}_e}{2^e}$ as above with $\norm{\vv{t}_1} < 2$ are precisely the points in the open triangle  $T = \{ (a,b) \in \RR^2 : a,b < 1, a+b > 1 \}$.
At the next stage, the points $\vv{t} \in [0,1]^2$ with \emph{no} expansion $\vv{t} = \sum_{e=1}^{\infty}\frac{\vv{t}_e}{2^e}$ with both  $\norm{\vv{t}_1} < 2$ and $\norm{\vv{t}_2} < 2$ are those in the union of open triangles $T$ and $\frac{1}{2} T$.  The condition on expansions at the third place removes three additional open triangles from this set, namely $\frac14 T$, $\frac14 T + (\frac12,0)$, and $\frac14 T + (0,\frac12)$, and we continue analogously.
\end{example}

As suggested by \Cref{sierpinski triangle: E}, each $\sierp_{p,n}$  can be realized by removing a union of open simplices from $\RRnn^n$, and hence, is a closed set.
\Cref{fig: sierpinski 3-gasket} illustrates the self-similarity of the $2$-dimensional Sierpi\'nski $3$-gasket.

\begin{figure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_a.pdf}
  \caption{Restriction to $[0,1]^2$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_b.pdf}
  \caption{Restriction to $[0,9]^2$}
\end{subfigure}
\caption{The $2$-dimensional Sierpi\'nski 3-gasket}
\label{fig: sierpinski 3-gasket}
\end{figure}

Remarkably, the critical exponent of the ideal pair $(\ideala, \ideald)$ described in \eqref{crit as limit of normalized program values: eq} can be described in terms of the Sierpi\'nski $p$-gasket, providing a geometric interpretation for this value.
To motivate our approach, we first note that the feasible set of the linear program $\LP(A, \vv{u})$, whose value equals the $F$-threshold $\ft{\ideala}{\ideald}$ by \Cref{ft as val LP: P}, is simply the closure with respect to the Euclidean topology of the set $\{ \vv{t} \in \RR^n : \vv{t} \geq \vv{0} \text{ and } A\vv{t} < \vv{u} \}$.
In what follows, we consider a similar optimization problem,  replacing the conditions that $\vv{t} \in \RR^n$ and $\vv{t} \geq \vv{0}$ with the ``fractal constraint" that $\vv{t} \in \sierp_{p,n}$.

\begin{definition}[The fractal linear program $\fip_p$]
\label{fractal program: D}
The \emph{fractal linear program} $\fip_p(A,\vv{u})$ consists of maximizing the objective function $\vv{t}\mapsto \norm{\vv{t}}$ on the Euclidean closure of the set \[ \{ \vv{t} \in \sierp_{p,n} : A \vv{t} < \vv{u} \}.\]  We call this closure the feasible set of $\fip_p(A, \vv{u})$, and denote it by $\feas \fip_p(A, \vv{u})$.
\end{definition}

\begin{remark}
Note that the closure in the above definition need not agree with the closed set $\{ \vv{t} \in \sierp_{p,n} : A \vv{t} \le \vv{u} \}$.
For example, if $A$ is the $2\times 2$ identity matrix, $\vv{u} = (1,1)$, and $p=2$, then the closure of the set $\{ \vv{t} \in \sierp_{2,2} : A \vv{t} < \vv{u} \}$ is simply the classical Sierpi\'nski triangle---the set of points $\vv{t}$ in $\sierp_{2,2}$ with $\norm{\vv{t}} \le 1$.
The set $\{ \vv{t} \in \sierp_{2,2} : A \vv{t} \le \vv{u} \}$, on the other hand, also includes the line segments from $(1,0)$ to $(1,1)$, and from $(1,1)$ to $(0,1)$.
\end{remark}

The discussion preceding \Cref{fractal program: D} implies that $\feas \fip_p(A, \vv{u})$ is contained in the feasible set of $\LP(A, \vv{u})$, and hence, is bounded.
Thus, $\feas \fip_p(A, \vv{u})$ is compact, and so the value of $\fip_p(A, \vv{u})$ can be defined as
\[
   \max \{ \norm{\vv{t}}: \vv{t} \in \feas \fip_p(A, \vv{u}) \} = \sup \{ \norm{\vv{t}} : \vv{t} \in \sierp_{p,n}, A \vv{t} < \vv{u} \}
\]
which is a well-defined real number.
As usual, we define the optimal set of $\fip_p(A, \vv{u})$ to be the set $\opt \fip_p(A, \vv{u})$ of feasible points where this maximum is attained.

\begin{example} \label{ex: feas fip}
   Consider the fractal linear program $\fip_p = \fip_p(A, \vv{u})$, where
\[ A = \begin{bmatrix}
 3&11\\ 11&2 \\ 5&10 \\ 2&0
 \end{bmatrix}
\quad \text{and} \quad \vv{u} = \begin{bmatrix} 1 \\ 1 \\ 1 \\ \end{bmatrix}.
\]
\Cref{fig: feas fip} illustrates the key features of the program $\fip_p$ for small values of $p$.
The feasible set for $ \fip_p$ is displayed in dark blue, the feasible set for $\LP = \LP(A,\vv{u})$ in gray, and the line of points with coordinate sum equal to $\val \fip_p$ in green.
Thus,  $\opt \fip_p$ is simply the intersection of the blue points and green points.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}
  \centering
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char2.pdf}\hskip .04\textwidth
   \captionsetup{labelformat=empty}
   \caption{$p=2$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
\includegraphics[width=.9\textwidth]{pictures/ex4_char3.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=3$}
\end{subfigure}

\bigskip

\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char5.pdf}\hskip .04\textwidth
  \captionsetup{labelformat=empty}
  \caption{$p=5$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char7.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=7$}
\end{subfigure}
\caption{The feasible and optimal sets of $\fip_p(A, \vv{u})$ for $A$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{fig: feas fip}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\Cref{table: feas fip details} provides a more precise description of these quantities.
It is worth mentioning that when $p=5$, the optimal sets of $\fip_p$ and $\LP$ agree, and consequently so do their values.
On the other hand, if $p=2$, $3$, or $7$, then $\val \fip_p < \val \LP$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF TABLE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{table}
\begin{center}
\begingroup
\setlength{\tabcolsep}{8pt} % Default value: 6pt
\renewcommand{\arraystretch}{1.4} % Default value: 1
\begin{tabular}{ccc}
  \toprule
  $p$ & $\val \fip_p$ & $\opt \fip_p$  \\
  \midrule
  $2$ & $\frac18$ & $\conv\big(\big(\frac1{20}, \frac3{40}\big),\big(\frac1{12}, \frac1{24}\big)\big)$ \\
  $3$ & $\frac19$ & $\conv\big(\big(\frac{1}{36}, \frac1{12}\big),\big(\frac7{81}, \frac2{81}\big)\big)$ \\
  $5$ & $\frac7{50}$ & $\big\{\big(\frac2{25}, \frac3{50}\big) \big\}$  \\
  $7$ & $\frac{34}{245}$ & $\big\{\big(\frac{19}{245}, \frac3{49}\big) \}$ \\
  \bottomrule
\end{tabular}
\endgroup
% The \begingroup ... \endgroup pair ensures the separation
% parameters only affect this particular table, and not any
% sebsequent ones in the document.
\end{center}
\medskip
\caption{The values and optimal sets of $\fip_p(A, \vv{u})$ for $A$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{table: feas fip details}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{example}

\begin{proposition}
   The value of $\fip_p(A,\vv{u})$ equals $\crit(\ideala, \ideald)$.
\end{proposition}

\begin{proof}
   If $e \in \NN$, then the constraints of $\IP_p(A, \vv{u}, p^e)$ imply that $p^{-e}  \feas \IP_p(A, \vv{u}, p^e)$ lies in $\feas \fip_p(A,\vv{u})$.
   It then follows from this and \eqref{crit as limit of normalized program values: eq} that
   %
   \[
      \val\fip_p(A,\vv{u}) \ge \displaystyle \lim_{e \to \infty}\frac{\val\IP_p(A,\vv{u}, p^e)}{p^e} = \crit(\ideala, \ideald).
   \]

   Next, fix a point $\vv{t} \in \sierp_{p,n}$ with $A \vv{t} < \vv{u}$.
   By definition of $\sierp_{p,n}$, we may fix an integer $s$, and a sequence $( \vv{t}_i )_{i=s}^\infty$ in $\NN^n$ with $\norm{\vv{t}_i} < p$ for all $i \geq s$, such that $\vv{t} = \sum_{i=s}^{\infty} \frac{\vv{t}_i}{p^i}$.
   For each nonnegative integer $e \geq s$, set $\vv{t}^\star_{p^e} = \sum_{i=s}^{e} \frac{\vv{t}_i}{p^i}$.

   We claim that $p^e  \vv{t}^\star_{p^e}$ is feasible for $\IP_p(A, \vv{u}, p^e)$.
   To see why, first note that \Cref{dickson: R} tells us that this point satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p^e)$.
   Furthermore, $\vv{t}^{\star}_{p^e} \leq \vv{t}$, and so $A \vv{t}^{\star}_{p^e} \leq A \vv{t} < \vv{u}$, which demonstrates that $p^e \vv{t}^\star_{p^e}$ satisfies the linear constraints of $\IP_p(A, \vv{u}, p^e)$.
   Dividing by $p^e$ and taking limits, we find that
   \[
      \crit(\ideala, \ideald) = \lim_{e \to \infty} \frac{\val \IP_p(A, \vv{u}, p^e)}{p^e} \geq \lim_{e \to \infty}   \norm{\vv{t}^\star_{p^e}} = \norm{\vv{t}}.
   \]

   We have just shown that the objective function $\vv{t} \mapsto \norm{\vv{t}}$ is at most $\crit(\ideala, \ideald)$ on the set $\{ \vv{t} \in \sierp_{p,n} : A \vv{t} < \vv{u} \}$, and so the same must be true on the closure of this set, which is the feasible set of $\fip_p(A, \vv{u})$.
   Restated,  $ \val \fip_p(A, \vv{u})$ is at most $\crit(\ideala,  \ideald)$, and so equality holds.
\end{proof}

\subsection{An outline}

\ \daniel[inline]{I imagine placing an outline here that points out the steps we are going to take to solve all of these optimization problems.}

\section{Connections with Newton polyhedra}
\label{s: newton}
Here, as in \Cref{sec: LPs},  we use $A$ to denote a fixed $\numvars \times n$ monomial matrix.
In fact, throughout this section, we fix an $A$-pair $(A, \vv{u})$, so that $\vv{u}$ is a point in $\NN^\numvars$ with positive entries.
Our goal is to study the linear program $\LP(A, \vv{u})$ in terms of the \emph{Newton polyhedron} associated to the matrix $A$.

\subsection{Newton polyhedra and their faces}

For the reader's convenience, we start this section with a brief account of the terminology, basic facts, and notations associated with polyhedral geometry that will be used here and throughout the paper.

A (convex) \emph{polyhedron} in $\RR^n$ is a subset of $\RR^n$ obtained by intersecting finitely many closed halfspaces or, equivalently, a set consisting of all points $\vv{x}\in \RR^n$ satisfying an inequality of the form $A\vv{x}\le \vv{b}$, where $A$ is a matrix with $n$ columns.
The (convex) \emph{cone generated by $\vv{u}_1,\ldots,\vv{u}_k \in \RR^n$}, denoted $\cone(\vv{u}_1,\ldots,\vv{u}_k)$, is the set consisting of all \emph{conical combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative real numbers.
Likewise, the \emph{convex hull of $\vv{u}_1,\ldots,\vv{u}_k$}, denoted $\conv(\vv{u}_1,\ldots,\vv{u}_k)$, is the set of all \emph{convex combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative and $\sum_{i=1}^k \lambda_i = 1$.
The convex hull of a finite set of points is called a \emph{polytope}.

If $\mathcal{U}$ and $\mathcal{V}$ are subsets of $\RR^n$, their \emph{Minkowski sum} is the set
\[\mathcal{U}+\mathcal{V} \coloneqq \{\vv{u}+\vv{v}: \vv{u}\in \mathcal{U}\text{ and }\vv{v}\in \mathcal{V}\}.\]
The \emph{Minkowski--Weyl Theorem} asserts that a subset $\mathcal{P}$ of $\RR^n$ is a polyhedron if and only if $\mathcal{P}$ is the Minkowski sum of a polytope and a finitely generated cone.
The cone in this decomposition is the set of all directions $\vv{v} \in \RR^n$ in which $\mathcal{P}$ recedes, that is, $\vv{u} + \lambda \vv{v} \in \mathcal{P}$ for every $\vv{u} \in \mathcal{P}$ and $\lambda > 0$; it is uniquely determined by $\mathcal{P}$, and called the \emph{recession cone of $\mathcal{P}$}.
The Minkowski--Weyl Theorem gives us a couple of useful characterizations of polytopes: a polyhedron $\mathcal{P}$ is a polytope if and only if it is bounded or, equivalently, has a trivial recession cone.

\begin{definition}[Newton polyhedron]
The \emph{Newton polyhedron} associated to the monomial matrix $A$ is the polyhedron in $\RR^\numvars$ given by
\[ \N = \conv( \col(A) ) + \cone( \canvec_1, \ldots, \canvec_\numvars), \]
where $\col(A)$ is the set of columns of $A$, and $\canvec_1, \ldots, \canvec_\numvars$ are the standard basis vectors of $\RR^\numvars$.
\end{definition}

\begin{definition}[Faces]
   \label{defn: face}
   A proper nonempty subset $\O$ of $\N$ is a \emph{face} of $\N$ if there exists $\defpt \in \RR^\numvars$ and a nonnegative real number $\alpha$ are such that the inner product $\iprod{\defpt}{\vv{v}}$ is at least $\alpha$ for all $\vv{v} \in \N$, with equality if and only if $\vv{v} \in \O$.
   We say that $\defpt$ \emph{defines} $\O$ in $\N$.
   If $\O$ is not contained in any proper coordinate subspace of $\RR^\numvars$, we call it a \emph{standard} face of $\N$.
\end{definition}

\begin{remark}
   \label{rmk: nonnegativity of defining point}
   The requirement that the number $\alpha$ in \Cref{defn: face} be nonnegative is an arbitrary convention, which will play a role in \Cref{alpha=1: convention} below.
   We observe that the defining point $\defpt$ must be nonnegative as well.
   Indeed, if $\vv{v} \in \O$, then $\vv{v} + \canvec_i \in \N$, and thus $c_i = \iprod{\defpt}{\vv{v} + \canvec_i} -\alpha \ge 0$, for each $i$.
\end{remark}

The following proposition gives an explicit Minkowski--Weyl decomposition for the faces of a Newton polyhedron.

\begin{proposition}
   \label{prop: MW for faces}
   Let $\O$ be a face of the Newton polyhedron $\N$ associated to the monomial matrix $A$, and suppose $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
   Set $\rb(\O) =  \{ \canvec_i \in \RR^\numvars : \iprod{\defpt}{\canvec_i} = 0\}$.
   Then
   \[\O =  \conv( \col(A) \cap \O ) + \cone(\rb(\O))\]
   where we agree that $\cone(\emptyset) = \{\vv{0}\}$.
   In particular, the supporting indices of $\defpt$ depend only on $\O$, and $\O$ is bounded if and only if $\defpt$ is positive.
\end{proposition}

\begin{proof}
   Suppose $\iprod{\defpt}{\vv{v}} = \alpha$ for all $\vv{v} \in \O$.
   Then the same holds for every $\vv{v} \in\conv( \col(A) \cap \O ) + \cone(\rb(\O)) \subseteq \N$, showing that this sum is contained in  $\O$.
   To prove the reverse containment, let $\vv{v} \in \O$.
   Since $\vv{v} \in \N$, we can write $\vv{v} = A \vv{s} + \vv{w}$, with $\vv{s}, \vv{w}\ge \vv{0}$ and $\norm{\vv{s}} = 1$.
   Denoting the $i$-th column of $A$ by $\vv{a}_i$, we have $\iprod{\defpt}{\vv{a}_i} = \alpha$ if $\vv{a}_i \in \O$, and $\iprod{\defpt}{\vv{a}_i} > \alpha$ otherwise.
   Thus, 
   \begin{align*}
     \alpha = \iprod{\defpt}{\vv{v}} &= \iprod{\defpt}{A\vv{s}} + \iprod{\defpt}{\vv{w}}
     = \sum_{i=1}^n \iprod{\defpt}{\vv{a}_i} s_i + \iprod{\defpt}{\vv{w}}\\
     &\ge \alpha \norm{\vv{s}} + \iprod{\defpt}{\vv{w}} = \alpha + \iprod{\defpt}{\vv{w}}
   \end{align*}
   Since $\defpt$ and $\vv{w}$ are nonnegative, $\iprod{\defpt}{\vv{w}}$ must be zero and the inequality above must be an equality, which is the case if and only if $s_i = 0$ whenever $\vv{a}_i \notin \O$.
   This shows that $\vv{w} \in \cone(\rb(\O))$ and $A\vv{s} \in \conv(\col(A) \cap \O)$, so $\vv{v} = A\vv{s} + \vv{w} \in \conv( \col(A) \cap \O ) + \cone(\rb(\O))$.
\end{proof}

% \begin{proof}
%    Suppose $\iprod{\defpt}{\vv{v}} = \alpha$ for all $\vv{v} \in \O$.
%    Then the same holds for every $\vv{v} \in\conv( \col(A) \cap \O ) + \cone(\rb(\O)) \subseteq \N$, showing that this sum is contained in  $\O$.
%    To prove the reverse containment, let $\vv{v} \in \O$.
%    Since $\vv{v} \in \N$, we know that $\vv{v} \ge A \vv{s}$ for some $\vv{s}\ge \vv{0}$ with $\norm{\vv{s}} = 1$.
%    Denoting the $i$-th column of $A$ by $\vv{a}_i$, the nonnegativity of $\defpt$ implies that
%    \[
%       \alpha = \iprod{\defpt}{\vv{v}} \ge \iprod{\defpt}{A\vv{s}} = \sum_{i=1}^n \iprod{\defpt}{\vv{a}_i} s_i
%    \]
%    where $\iprod{\defpt}{\vv{a}_i} = \alpha$ if $\vv{a}_i \in \O$, or $\iprod{\defpt}{\vv{a}_i} > \alpha$ otherwise.
%    The displayed inequality, together with the facts that $\vv{s}\ge \vv{0}$ and $\norm{\vv{s}} = 1$, tells us that $s_i = 0$ whenever $\vv{a}_i \notin \O$, and therefore $A\vv{s} \in \conv(\col(A)\cap \O) \subseteq \O$.
%    As $\iprod{\defpt}{\vv{v}-A\vv{s}} = 0$, the nonnegativity of $\vv{v} - A\vv{s}$ and $\defpt$ implies that $\vv{v} - A\vv{s} \in \cone(\rb(\O))$, showing that $\vv{v} \in \conv( \col(A) \cap \O ) + \cone(\rb(\O))$.
% \end{proof}

\begin{definition}[Recession basis and subspace]
   If $\defpt \in \RR^\numvars$ defines $\O$, then the \emph{recession basis} of $\O$ is the set $\rb(\O)$ of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that the $i$-th coordinate of $\defpt$ is zero, and the \emph{recession subspace} of $\O$ is the subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.
\end{definition}

\Cref{prop: MW for faces} shows that these definitions depend only on $\O$, but not on the choice of the defining point $\defpt$.
It also shows that the cone generated by $\rb(\O)$ is the recession cone of $\O$, motivating our choice of terminology.

In this article, we are largely concerned with standard faces, and for those we shall adopt a helpful convention.

\begin{convention}
\label{alpha=1: convention}
Take $\O \subseteq \RR^\numvars$, $\defpt \in \RR^\numvars$, and $\alpha \in \RR$ as in \Cref{defn: face}.
If $\O$ is standard, then $\alpha$ must be positive, which allows us to rescale $\defpt$ so as to assume that $\alpha = 1$.
Thus, throughout this article, we always assume that defining points of standard faces have been normalized in this way.
\end{convention}

This convention leads to the following useful observation, whose simple proof uses ideas of the proof of \Cref{prop: MW for faces}.

\begin{proposition}\label{prop: inner product with columns of A}
   Suppose $\defpt \in \RR^\numvars$ defines a standard face $\O$ of the Newton polyhedron $\N$ associated to the monomial matrix $A$.
   Let $\vv{s} \in \RR^n$, and suppose $\vv{s} \ge \vv{0}$ or, more generally, that $s_i \ge 0$ whenever the $i$-th column of $A$ is not in $\O$.
   Then $\iprod{\defpt}{A\vv{s}} \ge \norm{\vv{s}}$, and equality holds if and only if $s_i = 0$ whenever the $i$-th column of $A$ is not in $\O$.
   \qed
\end{proposition}

% \begin{proof}
% If $\vv{a}_i$ denotes the $i$-th column of $A$, then \Cref{alpha=1: convention} and the assumption on $\vv{s}$ imply that $\iprod{\defpt}{\vv{a}_i}  s_i \geq s_i$ for every $1 \leq i \leq n$, with equality if and only if $s_i = 0$ or $\vv{a}_i \in \O$.
% Thus,
% \[ \iprod{\defpt}{A\vv{s}} = \sum_{i=1}^n \iprod{\defpt}{\vv{a}_i} s_i \geq  \sum_{i=1}^n s_i  = \norm{\vv{s}},\]
% and equality holds if and only if $s_i = 0$ whenever $\vv{a}_i \notin \O$.
% \end{proof}


\subsection{The $F$-threshold of a monomial pair}

\begin{definition}[Minimal face]
   The \emph{minimal face} of $(A, \vv{u})$ is the face $\mf(A, \vv{u})$ of $\N$ that is minimal, with respect to inclusion, among the faces containing the unique point where the cone generated by $\vv{u}$ intersects the boundary of $\N$.
\end{definition}

Note that the intersection of two faces of $\N$ is also a face of $\N$.
Thus, as minimality here is with respect to inclusion, it follows that there is a unique such minimal face.
Note also that the positivity of $\vv{u}$ implies that $\mf(A,\vv{u})$ is a standard face of $A$.

The \emph{relative interior} of a subset $\mathcal{U}$ of $\RR^n$, denoted $\ri \mathcal{U}$, is its interior relative to the smallest affine subset of $\RR^n$ containing $\mathcal{U}$.
The relative interior of a polyhedron is simply the subset of all points not contained in any proper face.
The minimality of $\mf(A,\vv{u})$ implies, then, that the cone generated by $\vv{u}$ intersects the boundary of $\N$ at a point in the relative interior of $\mf(A,\vv{u})$.

\begin{proposition}
   \label{FT descriptions: P}
   The following numbers coincide\textup:
   \begin{enumerate}[$(1)$]
      \item\label{value} The value of the linear program $\LP(A, \vv{u})$.
      \item\label{limit} The limit of $q^{-1}\val \IP(A,\vv{u},q)$ as $q$ tends to infinity.
      \item\label{lambda} The unique positive real number $\lambda$ with the property that the scaled point $\lambda^{-1}\vv{u}$ lies in the boundary of $\N$.
      \item\label{new ip} The inner product $\iprod{\vv{c}}{\vv{u}}$, where $\vv{c} \in \RR^\numvars$ is a point defining the minimal face $\mf(A, \vv{u})$ in $\N$ \textup(adhering to \Cref{alpha=1: convention}\textup).
   \end{enumerate}
\end{proposition}

As noted in \Cref{ft as val LP: P}, if $(A,\vv{u})$ is a monomial pair associated to the ideal pair $(\ideala,\ideald)$, then the quantity appearing in \Cref{FT descriptions: P}\ref{value} can be described algebraically as the $F$-threshold of $(\ideala,\ideald)$.
This motivates the following definition.

\begin{definition}[$F$-threshold of a monomial pair]
\label{FT: D}
   The \emph{$F$-threshold} of a monomial pair $(A, \vv{u})$, denoted $\ft{A}{\vv{u}}$, is the number described in \Cref{FT descriptions: P}.
\end{definition}

\begin{proof}[Proof of \Cref{FT descriptions: P}]
   \Cref{ft as val LP: P} and \eqref{ft as limit of normalized program values: eq} tell us that the quantities in \ref{value} and \ref{limit} agree.  In what follows, let $\lambda$ be as in \ref{lambda}.
   Let $\O = \mf(A,\vv{u})$, and fix a point $\vv{c} \in \RR^\numvars$ defining $\O$ in $\N$.
   Our choice of $\lambda$ allows us to write $\vv{u} = \lambda \vv{w}$ for some $\vv{w} \in \O$, and in view of \Cref{alpha=1: convention}, it follows that $\iprod{\vv{c}}{\vv{u}} = \lambda \iprod{\vv{c}}{\vv{w}} = \lambda$.
   This establishes the equality of the numbers described in \ref{lambda} and \ref{new ip}.

   To conclude our proof, it remains to show that $\val \LP = \lambda$, where $\LP = \LP(A, \vv{u})$.
   Toward this, note that if $\vv{s} \in \feas \LP$, then $\vv{s}\ge \vv{0}$ and $A \vv{s} \leq \vv{u}$, and consequently $\norm{\vv{s}} \le \iprod{\vv{c}}{A \vv{s}} \leq \iprod{\vv{c}}{\vv{u}} = \lambda$, where the first inequality follows from \Cref{prop: inner product with columns of A}, and the second from the nonnegativity of $\vv{c}$.
   This shows that the value of $\LP$ is at most $\lambda$.
   On the other hand, since $\lambda^{-1}\vv{u} \in \N$, we have $\lambda^{-1}\vv{u} \ge A\vv{s}$ for some $\vv{s} \geq \vv{0}$ with $\norm{\vv{s}} = 1$.
   Multiplying by $\lambda$, we see that  $\lambda\vv{s}$ is feasible for $\LP$, and so the value of $\LP$ is at least $\lambda$.
\end{proof}

\begin{example}\label{ex: ft}
   We examine the different characterizations of $\ft{A}{\vv{u}}$ given in \Cref{FT descriptions: P}, for
   \[A=\begin{bmatrix}5&3&4\\ 5&4&3\\ 2&8&5\end{bmatrix} \quad \text{and} \quad \vv{u} =
      \begin{bmatrix} 1 \\ 1\\ 1 \end{bmatrix}.\]
   The Newton polyhedron $\N$ of $A$ is shown in \Cref{fig: newton polyhedron}.
   \begin{figure}
   \centering
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron.pdf}\\[1.4mm]
      \caption{The Newton polyhedron of $A$}
      \label{fig: newton polyhedron}
   \end{subfigure}
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/splitting_polytope.pdf}
      \caption{The feasible region of $\LP(A,\vv{u})$}
      \label{fig: splitting polytope}
   \end{subfigure}
      \caption{Illustration for \Cref{ex: ft}}
   \label{fig: newton polyhedron and splitting polytope}
   \end{figure}
   The point $(17/4)\cdot \vv{u}$, shown in white, lies in the relative interior of the face
   \[\O = \conv(\col(A)) + \cone(\canvec_2).\]
   Thus, $\mf(A,\vv{u}) = \O$, and the description given in \Cref{FT descriptions: P}\ref{lambda} tells us that $\ft{A}{\vv{u}} = 4/17$.

   The minimal face $\O$ is defined by the point $\defpt = (3/17, 0, 1/17)$, so \Cref{FT descriptions: P}\ref{new ip} tells us that
   $\ft{A}{\vv{u}} = \iprod{\defpt}{\vv{u}} = 4/17$.

   From yet another perspective, \Cref{fig: splitting polytope} shows the feasible region of the linear program $\LP = \LP(A,\vv{u})$, with its optimal set
   \[\opt \LP = \conv\bigg(\bigg(\frac1{17}, 0, \frac3{17}\bigg),\bigg(\frac2{17}, \frac1{17}, \frac1{17}\bigg)\bigg)\]
   highlighted in green.
   Thus, \Cref{FT descriptions: P}\ref{value} tells us that
   \[\ft{A}{\vv{u}} = \val \LP = \bigg\|\bigg(\frac1{17}, 0, \frac3{17}\bigg)\bigg\| = \frac4{17}.\]
\end{example}

\begin{example}
   \label{ex: m-primary homogeneous case}
   Let $\idealm$ be the maximal ideal of  $\kk[x_1,\ldots,x_\numvars]$ generated by the variables, and let $\ideala$ be an $\idealm$-primary ideal generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Let $\vv{w} = (\deg x_1,\ldots,\deg x_\numvars)$.
   For convenience, set $\deg \vv{t} \coloneqq \iprod{\vv{w}}{\vv{t}}$ for each $\vv{t} \in \RR^\numvars$, so that for every nonegative lattice point $\vv{u}$ we have $\deg \vv{u} = \deg x^\vv{u}$.

   Let $A$ be a monomial matrix associated to $\ideala$.
   Then the convex hull $\O$ \hl{of the degree $d$ columns of $A$}
   \pedro{
      Because $A$ may be associated to a non-minimal set of generators; could also just take the convex hull of columns corresponding to powers of the variables.
   }
   is a face of the Newton polyhedron $\N$ of $A$, and consists precisely of all nonnegative points $\vv{t} \in \RR^\numvars$ with $\deg \vv{t}  = d$.
   Moreover, this face is the minimal face of \emph{every} $A$-pair $(A,\vv{u})$, and since $\frac d{\deg \vv{u}}\vv{u} \in \O$, \Cref{FT descriptions: P}\ref{lambda} shows that for every such pair we have
   \[
      \ft{A}{\vv{u}} = \frac{\deg \vv{u}}{d}.
   \]

   From the perspective of \Cref{FT descriptions: P}\ref{new ip}, the positive point $\vv{c} = \vv{w}/d$ defines $\O$ in $\N$, and again we obtain
   \[
      \ft{A}{\vv{u}} = \iprod{\vv{c}}{\vv{u}} = \frac{\deg \vv{u}}{d}.
   \]
\end{example}

\subsection{Characterizing optimal points of $\LP(A,\vv{u})$}

\Cref{prop: MW for faces} above implies that $\vv{u}$ is a conical combination of the columns of $A$ lying in $\O = \mf(A,\vv{u})$ and the standard basis vectors in the recession basis of $\O$.
Typically, there are many ways to express $\vv{u}$ as such a conical combination, and as we see below, the set of all such expressions parameterizes  $\opt \LP(A, \vv{u})$.

\begin{proposition}\label{opt set: P}
   A point $\vv{s} \in \RR^n$ is optimal for $\LP(A, \vv{u})$ if and only if it satisfies the following conditions.
\begin{enumerate}[$(1)$]
\item  \label{mc coords: e} The coordinates of $\vv{s}$ are nonnegative, and the $i$-th coordinate of $\vv{s}$ is zero whenever the $i$-th column of $A$ is not contained in $\O = \mf(A, \vv{u})$.
\item  \label{mc decomposition: e} $\vv{u} = A \vv{s} + \vv{w}$ for some $\vv{w} \in  \cone(\rb(\O))$.
%\item  \label{mc sum: e}$\norm{\vv{s}} = \ft{A}{\vv{u}}$.
\end{enumerate}
\end{proposition}

\begin{proof}
   Set $\LP = \LP(A, \vv{u})$ and $\lambda = \val \LP $, and fix $\defpt \in \RR^\numvars$ that defines the face $\O = \mf(A, \vv{u})$ in the Newton polyhedron of $A$.
   Let $\vv{s} \in \RR^n$ and set $\vv{w} = \vv{u} - A\vv{s}$.
   By \Cref{prop: inner product with columns of A,FT descriptions: P},
   %
   \begin{equation}\label{eq 1}
      \lambda = \iprod{\defpt}{\vv{u}} = \iprod{\defpt}{A \vv{s}} + \iprod{\defpt}{\vv{w}} \geq \norm{\vv{s}} + \iprod{\defpt}{\vv{w}}.
   \end{equation}
   %
   If $\vv{s}$ is optimal for $\LP$, then $\vv{s} \ge \vv{0}$, $\vv{w} \ge \vv{0}$, and $\norm{\vv{s}} = \lambda$, and \eqref{eq 1} shows that $\iprod{\defpt}{A \vv{s}} = \norm{\vv{s}}$ and $\iprod{\defpt}{\vv{w}} = 0$.
   The first identity and \Cref{prop: inner product with columns of A} show that $\vv{s}$ satisfies~(1); the second identity shows that $\vv{w}\in \cone(\rb(\O))$, so $\vv{s}$ satisfies~(2).
   Conversely, if $\vv{s}$ satisfies (1) and (2), then $\vv{s}$ is feasible for $\LP$, $\iprod{\defpt}{A \vv{s}} = \norm{\vv{s}}$, and $\iprod{\defpt}{\vv{w}} = 0$.
   By \eqref{eq 1}, $\norm{\vv{s}} = \lambda$, so $\vv{s}$ is optimal for $\LP$.
\end{proof}

The previous proposition allows us to show the existence of a ``universal'' denominator for the vertices---that is, faces of dimension zero---of $\opt\LP(A,\vv{u})$, dependent only on the monomial matrix $A$, and not on $\vv{u}$.
For that, we shall need the following well-known characterization of the vertices of a polyhedron, whose proof can be found, for instance, in \cite[Theorem~3.34]{conforti+etal.integer_programming}.

\begin{lemma}
   \label{prop: characterization of vertices}
   Let $\mathcal{P}$ be the polyhedron defined by a system of inequalities $M \vv{x} \le \vv{b}$, where $M\in \RR^{s\times t}$, and let $\vv{v} \in \mathcal{P}$.
   For a subset $I$ of $\{1,\ldots,s\}$, let $M_I$ and $\vv{b}_I$ be the matrix and vector obtained by selecting the $i$-th rows of $M$ and $\vv{b}$, for each $i\in I$.
   Then $\vv{v}$ is a vertex of $\mathcal{P}$ if and only if there exists $I \subseteq \{1,\ldots,s\}$ such that $M_I$ is a nonsingular square matrix and $\vv{v} = M_I^{-1}\vv{b}_I$.
\qed
\end{lemma}

\begin{theorem}
\label{uniform denominators for vertices:  T}
Given a monomial matrix $A$, there exists a positive integer $\denom = \denom(A)$ such that for every $A$-pair $(A, \vv{u})$, every vertex of $\opt \LP(A, \vv{u})$ is rational with denominator $\denom$.
\end{theorem}

\begin{proof}
   By \Cref{opt set: P}, $\opt \LP(A,\vv{u})$ is defined by the inequalities $A\vv{s} \le \vv{u}$ and $\vv{s}\ge \vv{0}$, where equality is required in a prescribed set of coordinates.
   Thus, if $M$ is the matrix obtained by stacking $A$, $-A$, the identity matrix $I_n$, and $-I_n$, and $\vv{b}$ is the column vector obtained by stacking $\vv{u}$, $-\vv{u}$, and $\vv{0}\in \RR^{2n}$, then $\opt \LP(A,\vv{u})$ is defined by a subsystem of $M \vv{x} \le \vv{b}$.
   Let $\denom$ be the least common multiple of the nonzero $n\times n$ minors of $M$.
   Then by \Cref{prop: characterization of vertices}, every vertex of $\opt \LP(A,\vv{u})$ is rational, with denominator $\denom$.
\end{proof}

\subsection{Special points and universal denominators}

Technicalities that arise in future sections whenever the minimal face of $(A, \vv{u})$ is unbounded force us to consider a certain distinguished subset of optimal points, in which we require a strengthening of condition \ref{mc decomposition: e} in \Cref{opt set: P}.

\begin{definition}[Special point]
   \label{mc: D}
   Let $\O = \mf(A, \vv{u})$.
   A point $\vv{s}$ is a \emph{special point} for $(A, \vv{u})$ if it satisfies the following conditions.
   \begin{enumerate}
      \item $\vv{s} \in \opt \LP(A, \vv{u})$.
      \item \label{item: special condition of special points}
      $\vv{u} = A \vv{s} + \vv{w}$ for a point $\vv{w}$ in the relative interior of $\cone(\rb(\O))$ or, equivalently, a positive point $\vv{w}$ of $\rs(\O)$, with the convention that $\vv{w}=\vv{0}$ when $\rb(\O)$ is empty.
   \end{enumerate}
   The set of all such points is denoted $\sp(A, \vv{u})$, and the set of all such points with rational coordinates is denoted $\sp_{\QQ}(A, \vv{u})$.
\end{definition}

\begin{proposition}
   \label{opt versus mc: P}
   If $\O = \mf(A, \vv{u})$ is bounded, then $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$.
   Otherwise, $\sp(A, \vv{u})$ is a nonempty convex set lying between $\opt \LP(A, \vv{u})$ and its relative interior, $\ri \opt \LP(A, \vv{u})$.
\end{proposition}

\begin{proof}
   If $\O$ is bounded, then $\rb(\O) = \emptyset$, and so $\cone( \rb(\O)) = \{\vv{0} \}$.
   Thus, in view of \Cref{opt set: P}, condition \eqref{item: special condition of special points} in \Cref{mc: D} is automatically fulfilled, and $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$.

   Next, set $\lambda = \ft{A}{\vv{u}}$ and assume that $\O$ is unbounded.
   The minimality of $\O$ implies that $\lambda^{-1}\vv{u}$ is not in any proper face of $\O$, and therefore, must lie in its relative interior.
   Furthermore, as the relative interior operation on convex sets commutes with Minkowski sums---see, \eg \cite[Theorem 4.10(b)]{vantiel.convex_analysis}---the decomposition in \Cref{prop: MW for faces}  implies that $\vv{u} = \vv{v} + \vv{w}$ with $\vv{v} \in \lambda \conv(\col(A) \cap \O)$ and $\vv{w} \in \ri \cone(\rb(\O))$.  Any realization of $\vv{v}$ as $\lambda$ times a convex combination of the points in $\col(A) \cap \O$ then determines a special point.

   We have just shown that $\sp(A, \vv{u})$ is nonempty, and it is clear that this set is convex.
   Before proceeding to show that $\sp(A, \vv{u})$ contains the relative interior of the optimal set of $\LP = \LP(A,\vv{u})$, recall that the relative interior of a polytope consists of all convex combinations with \emph{positive coefficients} of the vertices of the polytope, while the polytope itself consists of all convex combinations of its vertices.

  Let $\vv{s} \in \ri \opt \LP$, and suppose $\vv{s}$ is not special for $(A,\vv{u})$.
  Then there exists some $i$ with $\canvec_i \in \rb(\O)$ for which $A\vv{s}$ agrees with $\vv{u}$ in the $i$-th coordinate.
  The characterization of relative interior above then implies that the same is true for every \emph{vertex} of $\opt \LP$, and consequently for every \emph{point} of $\opt \LP$.
  But this shows that $\sp(A,\vv{u})$ is empty---a contradiction.
\end{proof}

\begin{example}
   \label{ex: ft.1}
   The containments asserted in \Cref{opt versus mc: P} may all be proper.
   Indeed, if $A$, $\vv{u}$, and $\O$ are as in \Cref{ex: ft}, then $\opt \LP(A,\vv{u})$, highlighted in green in \Cref{fig: splitting polytope}, is the line segment connecting $\vv{s}_0 = (2/17, 1/17, 1/17)$ and $\vv{s}_1 = (1/17, 0, 3/17)$.
   Its relative interior excludes both $\vv{s}_0$ and $\vv{s}_1$, while the set of special points for $(A,\vv{u})$ excludes only $\vv{s}_0$.
   Indeed, setting $\vv{s}_t=(1-t)\vv{s}_0 + t \vv{s}_1$, where $0\le t\le 1$, $\vv{u} - A\vv{s}_t = \frac{3}{17}\,t \canvec_2$ is a positive point of $\rs(\O)$ if and only if $0<t\le 1$.
\end{example}

% Consider the monomial matrix \[ A = \begin{bmatrix} a & 0 & c \\ 0 & b & c \\ 0 & 0 & d \end{bmatrix} \]
% where $a,b,c$ are positive integers with $1/a + 1/b = 1/c$ and $d$ is any integer with $d>c$.  The maximal face of the splitting polytope is the edge connecting the points \[ \left( \frac{d-c}{da}, \frac{d-c}{db}, \frac{1}{d} \right) \text{ and } \left( \frac{1}{a}, \frac{1}{b}, 0 \right).\]  On the other hand, it is easy to check that the special points for $(A, \vv{1})$ consist of the points on this edge except for the first of these two  points.

\begin{definition}[Universal denominator]
   \label{universal denominator: D}
   Let $A$ be a monomial matrix.
   A \emph{universal denominator} for $A$ is a positive integer $\denom = \denom(A)$ such that for every $A$-pair $(A, \vv{u})$, there exists a point $\vv{s} \in \sp(A, \vv{u})$ so that $\denom \vv{s}$ has integer coordinates.
\end{definition}

\begin{theorem}
   \label{universal-denominators-exist:  T}
   Universal denominators exist.
\end{theorem}

\begin{proof}
   Let $A$ be a monomial matrix.
   Let $\denom_{\circ}$ be an integer satisfying the property described in \Cref{uniform denominators for vertices:  T} relative to $A$, and fix an $A$-pair $(A, \vv{u})$.
   If $\O = \mf(A, \vv{u})$ is bounded, then $\sp(A, \vv{u}) = \opt \LP(A, \vv{u})$ by \Cref{opt versus mc: P}, and so every vertex in this set has denominator~$\denom_{\circ}$.

   Next, suppose $\O$ is unbounded, so that $A$ has at least two rows.
   Let $m$ be the number of rows of $A$ and, without loss of generality, suppose that $\rb(\O) = \{ \canvec_1, \ldots, \canvec_t \}$ for some $1 \leq t \leq \numvars-1$.
   As demonstrated in the  proof of \Cref{opt versus mc: P}, for every index  $1 \leq i \leq t$, there exists a vertex $\vv{s}_i$ of $\opt \LP(A, \vv{u})$ for which $A \vv{s}_i$ is less than $\vv{u}$ in the $i$-th coordinate.
   Choosing \emph{positive} integers $\numvars_1, \ldots, \numvars_t$ that sum to $\numvars-1$, it then follows from the definition of special point that the point
   \[ \frac{ \numvars_1 \vv{s}_1 + \cdots + \numvars_t  \vv{s}_t}{\numvars-1}  \]
   lies in $\sp_{\QQ}(A, \vv{u})$ and has denominator $(\numvars-1)\denom_{\circ}$.
\end{proof}

\begin{example}
   \label{ex: m-primary homogeneous case 2}
   As in \Cref{ex: m-primary homogeneous case}, let $A$ be a monomial matrix associated to an $\idealm$-primary ideal generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Then $d$ is a universal denominator for $A$.
   Indeed, among the columns of $A$ we must have degree $d$ multiples $a_1\canvec_1,\ldots,a_\numvars\canvec_\numvars$ of the standard basis vectors of $\RR^\numvars$.
   For concreteness, suppose these are the first $\numvars$ columns of $A$.
   The convex hull $\O$ of these columns is the minimal face of every $A$-pair $(A,\vv{u})$.
   For every such pair, the point
   \[\vv{s} = \Big(\frac{u_1}{a_1},\ldots,\frac{u_\numvars}{a_\numvars},0,\ldots,0\Big)\]
   satisfies the conditions of \Cref{opt set: P}, and is therefore an optimal point for $(A,\vv{u})$.
   Since $\O$ is bounded, it follows that $\vv{s}$ is a special point.
   Finally, note that since $\deg a_i\canvec_i = d$ for every $i$, $d$ is a multiple of every $a_i$, and thus a denominator for $\vv{s}$.
\end{example}

\subsection{Discreteness of $F$-thresholds}

The following is a consequence of the discreteness of the $F$-jumping exponents of an ideal in a regular ring \cite[Theorem~3.1]{blickle+mustata+smith.discr_rat_FPTs}.
However, to keep our discussion self-contained, we include an elementary proof in our specialized setting.

\begin{proposition}
   \label{discreteness: P}
   Given a monomial matrix $A$ and a real number $\beta > 0 $, there are only finitely many numbers of the form $\ft{A}{\vv{u}}$ that are less than $\beta$.
\end{proposition}

\begin{proof}
   It suffices to show that there are only finitely many numbers $\ft{A}{\vv{u}}$ less than $\beta$ with $\mf(A, \vv{u}) = \O$ being fixed.
   Consider such a pair, and suppose $\defpt$ defines $\O$ in the Newton polyhedron of $A$.
   Then $\ft{A}{\vv{u}} = \iprod{\defpt}{\vv{u}}$, and the nonnegativity of $\defpt$ implies that, as $\vv{u}$ ranges over positive integral points, this inner product takes on only finitely many values less than $\beta$.
   Indeed, when $c_i \ne 0$, the upper bound $\beta$ allows only finitely many choices for $u_i$, while when $c_i = 0$, the value of $u_i$ does not affect the inner product.
\end{proof}

\section{Collapsing}

This section concerns an operation used to get around some technical difficulties that arise when dealing with an unbounded minimal face.
Recall that if a face $\O$ of a Newton polyhedron in $\RR^\numvars$ is defined by a point~$\defpt$, then its recession basis is the set $\rb(\O)$ consisting of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that $c_i = 0$, and its recession subspace is the subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.

\begin{definition}[Collapsing]
\label{collapse: D}
 Suppose that $\O$ is a proper face of the Newton polyhedron $\N$ of a monomial matrix $A$ with $\numvars$ rows.

\begin{enumerate}
   \item The set $\rb(\O)^{\perp}$ is the complement of $\rb(\O)$ in $\{ \canvec_1, \ldots, \canvec_\numvars \}$, and $\rs(\O)^\perp$ is the subspace of $\RR^\numvars$ spanned by $\rb(\O)^\perp$, that is, the orthogonal complement of $\rs(\O)$ in $\RR^\numvars$.
   (The assumption that $\O \neq \N$ implies that $\rb(\O)^{\perp} \neq \emptyset$.)
   \item The \emph{collapsing along $\O$} is the projection map $\RR^\numvars \to \RR^{\#\rb(\O)^\perp}$ that deletes the $i$-th coordinate of a point whenever $\canvec_i \in \rb(\O)$, while preserving the order of the remaining coordinates.
   The images of points or sets under this projection are called \emph{collapses} of these objects along $\O$.
   \item The \emph{collapse} of $A$ along $\O$ is the matrix obtained from $A$ by collapsing each of its columns along $\O$, or in other words, the matrix obtained by deleting the $i$-th row of $A$ whenever $\canvec_i\in \rb(\O)$.
\end{enumerate}
\end{definition}

Below, we adopt the notation established in \Cref{collapse: D}, and we use an overbar to denote the collapse along $\O$.

\begin{remark}
   \label{rmk: collapse of a matrix}
   It is clear from the definition that $\collapse{A\vv{k}} = \collapse{A}\vv{k}$, for each $\vv{k}$ in the domain of $A$.
\end{remark}

\begin{remark}
   \label{collapse of a defining vector: R}
   If $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then $\collapse{\defpt}$ is a positive point consisting precisely of the nonzero coordinates of $\defpt$.
   Consequently, $\iprod{\defpt}{\vv{u}} = \iprod{\collapse{\defpt}}{\collapse{\vv{u}}}$ for every $\vv{u} \in \RR^\numvars$. \daniel[inline]{Restate this?}
\end{remark}

\begin{remark}
   \label{collapse of monomial is monomial: R}
   The collapsed matrix $\collapse{A}$ is monomial.
   Indeed, each row of $\collapse{A}$ is a row of $A$, and hence is nonzero.
   On the other hand, if $\defpt \in \RR^\numvars$ defines $\O$, then \Cref{collapse of a defining vector: R} implies that the inner product of $\collapse{\defpt}$ with every column of $\collapse{A}$ is at least $1$.
   In particular, the columns of $\collapse{A}$ are nonzero.
\end{remark}

\begin{proposition}\label{collapse of Newton polyhedron: P}
   Let $\O$ be a face of the Newton polyhedron $\N$ of a monomial matrix $A$.
   As above, we use an overbar to denote collapse along $\O$.
   Then $\collapse{\N}$ is the Newton polyhedron of $\collapse{A}$, and $\collapse{\O}$ is a bounded face of $\collapse{\N}$.
   In addition, if $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then $ \collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$.
\end{proposition}

\begin{proof}
   Taking the equation defining $\N$ and collapsing it along $\O$, we obtain
   \[ \collapse{\N} = \ol{\conv( \col(A))} + \ol{\cone(\canvec_1, \ldots, \canvec_\numvars)} = \conv( \col(\collapse{A}) ) + \cone(\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars).\]
   The nonzero vectors among $\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars$ are precisely the basis vectors in  $\RR^{\#\rb(\O)^\perp}$, so this agrees with the definition of the Newton polyhedron of $\collapse{A}$.

   Given \Cref{collapse of a defining vector: R}, it is not difficult to verify that $\collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$ whenever $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
   The positivity of $\collapse{\defpt}$ then implies that $\collapse{\O}$ is bounded.
   Alternatively, one may collapse the identity in \Cref{prop: MW for faces} along $\O$ to see that the collapsed face $\collapse{\O}$ is the polytope $\conv( \collapse{ \col(A) \cap \O}) = \conv( \col(\collapse{A}) \cap \collapse{\O})$.
\end{proof}

Below, we describe the relationship between collapses and other notions introduced in \Cref{sec: LPs,s: newton}.

\begin{proposition}
   \label{collapse of mf and mc: P}
   Consider a monomial pair $(A, \vv{u})$, and let an overbar denote collapse along $\O = \mf(A, \vv{u})$.
   Then the following hold.
   \begin{enumerate}[$(1)$]
      \item $\mf(\collapse{A}, \collapse{\vv{u}}) = \collapse{\O}$ and $\ft{A}{\vv{u}} = \ft{\collapse{A}}{\collapse{\vv{u}}}$.
      \item Each optimal point for $\LP(A, \vv{u})$ is also optimal for $\LP(\collapse{A}, \collapse{\vv{u}})$.
      \item Each special point for $(A, \vv{u})$ is a special point for $(\collapse{A}, \collapse{\vv{u}})$.
   \end{enumerate}
\end{proposition}

\begin{proof}
   Set $\lambda = \ft{A}{\vv{u}}$, so that $\lambda^{-1} \vv{u}$ lies in the relative interior of $\O$.
   It is clear that a projection preserves relative interiors, and so $\lambda^{-1}\collapse{\vv{u}}$ must lie in the relative interior of $\collapse{\O}$, a  face of $\collapse{\N}$ by \Cref{collapse of Newton polyhedron: P}.
   This shows that $\collapse{\O}= \mf(\collapse{A},\collapse{\vv{u}})$ and $\lambda = \ft{\collapse{A}}{\collapse{\vv{u}}}$.
   Consequently,
   \[ \val \LP(A, \vv{u}) = \ft{A}{\vv{u}} = \ft{\collapse{A}}{\collapse{\vv{u}}} = \val \LP(\collapse{A}, \collapse{\vv{u}}). \]
   Since each row of $\collapse{A}$ is a row of $A$, the constraints of $\LP(\collapse{A}, \collapse{\vv{u}})$ are a subset of those of $\LP(A, \vv{u})$, and hence $\feas \LP(A,\vv{u})$ is a subset of $\feas \LP(\collapse{A},\collapse{\vv{u}})$.
   It follows that any optimal point for $\LP(A, \vv{u})$ must be optimal for $\LP(\collapse{A}, \collapse{\vv{u}})$.
   The boundedness of $\collapse{\O}$, \Cref{opt versus mc: P}, and the preceding observation allows us to conclude that
   \begin{equation*}
      \sp(A, \vv{u}) \subseteq \opt \LP(A, \vv{u}) \subseteq \opt \LP(\collapse{A}, \collapse{\vv{u}}) = \sp(\collapse{A}, \collapse{\vv{u}}).
   \qedhere
\end{equation*}
\end{proof}

\begin{example}
   \label{ex: ft.2}
   Let $A$ and $\vv{u}$ be as in \Cref{ex: ft}.
   Then $\O = \mf(A,\vv{u}) = \conv(\col(A)) + \cone(\canvec_2)$, so $\rb(\O) = \{\canvec_2\}$.
   \Cref{fig: newton polyhedron of collapse} shows the Newton polyhedron of the collapse $\collapse{A}$ of $A$ along $\O$ (compare with \Cref{fig: newton polyhedron}).
   \begin{figure}
   \centering
   \begin{subfigure}{.49\textwidth}
      \centering

      \ \\[.1mm] \

      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron_of_collapse.pdf}\\[2mm]
      \caption{The Newton polyhedron of $\collapse{A}$}
      \label{fig: newton polyhedron of collapse}
   \end{subfigure}
   \begin{subfigure}{.49\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/opt_for_collapse_may_change.pdf}
      \caption{The feasible region of $\LP(\collapse{A},\collapse{\vv{u}})$}
      \label{fig: splitting polytope of collapse}
   \end{subfigure}
   \caption{Illustration for \Cref{ex: ft.2}}
   \label{fig: collapse}
   \end{figure}
   The point $(17/4)\cdot\collapse{\vv{u}}$, shown in white, lies in the relative interior of $\collapse{\O}$, shown in blue; thus, $\collapse{\O} = \mf(\collapse{A},\collapse{\vv{u}})$ and $\ft{\collapse{A}}{\collapse{\vv{u}}} = 4/17 = \ft{A}{\vv{u}}$.

   The feasible region of $\LP(A,\vv{u})$, shown in \Cref{fig: splitting polytope}, is properly contained in the feasible region for $\LP(\collapse{A},\collapse{\vv{u}})$, shown in \Cref{fig: splitting polytope of collapse}, which highlights the difference between those sets in yellow.
   \Cref{fig: splitting polytope of collapse} also shows that the optimal set of $\LP(A,\vv{u})$ is properly contained in the optimal set of $\LP(\collapse{A},\collapse{\vv{u}})$, highlighting the difference between these sets in red.
   Thus, the containment established in \Cref{collapse of mf and mc: P}(2) may be proper---in which case so is the one in (3), since every optimal point for $\LP(\collapse{A},\collapse{\vv{u}})$ is special for $(\collapse{A},\collapse{\vv{u}})$, due to the boundedness of $\collapse{\O}$.
\end{example}

\daniel[inline]{I think we'll need this for the section on applications to generic hypersurfaces}

\begin{proposition}
\label{collapse of a collapse is a collapse: P} Every composition of collapsings is a collapsing.
\end{proposition}

\begin{proof}
Consider a face $\O$ of a Newton polyhedron $\N \subseteq \RR^\numvars$.   Set $\ell = \# \rb(\O)^{\perp}$ and let $\pi: \RR^\numvars \to \RR^{\ell}$ be the collapsing projection along $\O$.  In addition, fix a face $\mathcal{F}$ of $\pi(\N)$,  which \Cref{collapse of Newton polyhedron: P} tells us is a Newton polyhedron in $\RR^{\ell}$.  Set $s=\# \rb(\mathcal{F})^{\perp}$ and let $\rho: \RR^{\ell} \to \RR^s$ be the collapsing projection along $\mathcal{F}$.

We will now show that $\sigma \coloneqq \rho \circ \pi: \RR^\numvars \to \RR^s$ is the collapsing projection along some face of $\N$.  Let $\canvec_1, \ldots, \canvec_\numvars \in \RR^\numvars$ and $\vv{f}_1, \ldots, \vv{f}_s \in \RR^s$ be the standard basis vectors for each Euclidean space.  After reordering these, we may assume that $\sigma: \RR^\numvars \to \RR^s$ maps $\canvec_i$ to $\vv{f}_i$ for each $1 \leq i \leq s$, and to $\vv{0}$ otherwise.   Next, let  $\iota:  \RR^s \hookrightarrow \RR^\numvars$ be the $\RR$-linear map defined by $\vv{f}_i \mapsto \canvec_i$.

Once again, \Cref{collapse of Newton polyhedron: P} implies that $\sigma(\N) = \rho(\pi(\N))$ is a Newton polyhedron.  Consider a standard compact face of $\mathcal{L}$ of $\sigma(\N)$, for instance, the collapsed face $\rho(\mathcal{F})$.    If $\mathcal{L}$ is defined by a point $\vv{b} \in \RR^s$, then \Cref{prop: MW for faces}  tells us that $\vv{b}$ is positive, and the fact that
\[ \iprod{\vv{b}}{\sigma(\vv{u})} = \iprod{\iota(\vv{b})}{\vv{u}} \] for every $\vv{u} \in \RR^\numvars$ implies that $\sigma^{-1}(\mathcal{F})$ is a standard face of $\N$ defined by $\iota(\vv{b})$.  By construction, the $i$-th entry of $\iota(\vv{b})$ is not zero if and only if $1 \leq i \leq s$, so that $\rb(\sigma^{-1}(\mathcal{L}))^{\perp} = \{ \canvec_1, \ldots, \canvec_s \}$, from which it follows that $\sigma$ is the collapsing projection along the face $\sigma^{-1}(\mathcal{F})$ of $\N$.
\end{proof}

\section{An auxiliary integer program}

\subsection{Canonical feasible points}

We highlight a simple construction that associates to any point in $\sp_{\QQ}(A, \vv{u})$ a feasible point for $\IP(A, \vv{u}, q)$.
As a part of this, we call upon some basic notions from modular arithmetic.

\begin{definition}[Least positive residue]
   If $a, b \in \ZZ$ are positive, then $\lpr{a}{b}$ is the \emph{least positive residue} of $a$ modulo $b$, that is, $a \equiv \lpr{a}{b} \bmod b$ and $1 \leq \lpr{a}{b} \leq b$.
\end{definition}

\begin{definition}[The bracket operation]
   \label{tail: D}
   Let $q$ be a positive integer.
   If $\lambda = a/b$ for some \emph{positive} integers $a$ and $b$, then we define
   \[ \tail{\lambda}_q \coloneqq \frac{ \lpr{aq}{b}}{b}. \]
   This expression is clearly independent of the choice of the integers $a$ and $b$.
   In addition, we set  $[0]_q = 0$, and if $\vv{s} \in \QQ^n$ is nonnegative, we define $\tail{\vv{s}}_q$ as the point in $\QQ^n$ obtained by applying this operation to each coordinate of $\vv{s}$.
\end{definition}

\begin{remark}
   \label{tail-basics: R}
   If $q \in \ZZ$ is positive and $\lambda = a/b$ with $a$ and $b$ positive integers, then $\tail{\lambda}_q$ is positive and rational, at most $1$,  and depends on  $q$ modulo $b$, but not on $q$ itself.
   Furthermore,
   \[ \lambda q - \tail{\lambda}_q = \frac{aq-\lpr{aq}{b}}{b} \]
   is an integer, and in fact, is the \emph{greatest integer less than $\lambda q$}, that is, $\up{\lambda q} - 1$.
   This number agrees with $\down{ \lambda q}$ if and only if $\lambda q$ is not an integer.
\end{remark}

\begin{lemma}
   \label{less than u: L}
   Suppose that $\vv{s}$ is a special point for a monomial pair $(A, \vv{u})$.
   If $\vv{t}$ is a point in the domain of $A$ with $\vv{0} \leq \vv{t} \leq \vv{s}$, with the latter bound strict in every coordinate in which $\vv{s}$ is positive, then $A \vv{t} < \vv{u}$.
\end{lemma}

\begin{proof}
   Set $\O = \mf(A, \vv{u})$.
   As $\vv{s} \in \sp(A, \vv{u})$, we can write $\vv{u} = A \vv{s} + \vv{w}$,
   where $\vv{w}$ is a positive point of $\rs(\O)$.
   The inequality $\vv{t} \leq \vv{s}$ induces the bound $A \vv{t} \leq A \vv{s} = \vv{u} - \vv{w}$, which shows that $A\vv{t}$ is less than $\vv{u}$ in $\rs(\O)$ (recall that by this, we mean that the $i$-th coordinate of $A\vv{t}$ is less than $u_i$ whenever $\canvec_i\in \rs(\O)$).
   To conclude the proof, it suffices to show that the same is true in the complementary subspace $\rs(\O)^{\perp}$.

   Let an overbar denote collapse along $\O$.
   The assumption on $\vv{t}$ implies that $\collapse{A}( \vv{s} - \vv{t})$ and $\collapse{A} \vv{s} = \collapse{\vv{u}}$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{A}$.
   Therefore, since $\collapse{\vv{u}} = \collapse{A} \vv{s}$ is positive, the same must be true for $\collapse{A}(\vv{s} - \vv{t})$.
   In other words, $\collapse{A} \vv{t} < \collapse{A} \vv{s} = \collapse{\vv{u}}$, which shows that $A \vv{t}$ is less than  $\vv{u}$ in $\rs(\O)^{\perp}$.
\end{proof}

\begin{remark}
   \label{rmk: verifying inequalities using collapses}
   In the above proof, we used for the first time what will turn out to be a recurring technique in the remainder of this article:
   In order to verify an inequality between points in $\RR^\numvars$, we prove that the inequality holds in the recession subspace $\rs(\O)$ and that it holds for the collapses of the points along $\O$.
   The latter shows that the inequality we are trying to verify also holds in the complementary subspace $\rs(\O)^\perp$, and thus holds in $\RR^\numvars = \rs(\O) \oplus \rs(\O)^\perp$.
\end{remark}

\begin{theorem}
   \label{canonical-feasible: T}
   If $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ and $q$ is a positive integer, then
   \[ \vv{s}q - \tail{\vv{s}}_q \in \feas \IP(A, \vv{u}, q).\]
   We call $\vv{s}q - \tail{\vv{s}}_q$ a \emph{canonical feasible point} for $\IP(A,\vv{u},q)$.
\end{theorem}

\begin{proof}
   \Cref{tail-basics: R} tells us that if $\vv{t} = \vv{s} - (1/q) {\tail{\vv{s}}_q}$, then $\vv{t}q = \vv{s}q -\tail{\vv{s}}_q$ has nonnegative integer coordinates, and $\vv{t}$ satisfies the hypotheses of \Cref{less  than u: L}, which shows that $A (\vv{s} q - \tail{\vv{s}}_q ) =  A\vv{t}q <  \vv{u}q$.
\end{proof}

\begin{remark}[Comparisons with canonical feasible points]
   \label{comparison: R}
   Adopt the context of \Cref{canonical-feasible: T}, and fix a point $\vv{k}$ that is feasible for $\IP = \IP(A, \vv{u}, q)$.
   Our goal is to describe some natural constraints on the difference between $\vv{k}$ and the canonical feasible point described in \Cref{canonical-feasible: T}.
   Toward this, set
   \[ \vv{h} =  \vv{k} - \vv{s}q + \tail{\vv{s}}_q \]
   and let an overbar denote the collapse along the face $\O = \mf(A, \vv{u})$.

   Notice that if $s_i = 0$, then $h_i  = k_i \geq 0$ by the nonnegativity constraint of $\IP$.
   The definition of $\vv{h}$ and the constraints of $\IP$ also tell us that $A ( \vv{s}q-\tail{\vv{s}}_q + \vv{h}) = A \vv{k} < \vv{u}q = A \vv{s}q + \vv{w}q$, where $\vv{w}$ is a positive point of $\rs(\O)$.
   Collapsing this inequality, keeping in mind that $\collapse{\vv{w}} = \vv{0}$, and rearranging terms, shows that $\collapse{A} \vv{h} < \collapse{A} \tail{\vv{s}}_q$.
   This motivates us to study another integer program, which will be formally introduced in the next subsection.
\end{remark}

\subsection{Another integer program}

\begin{definition}[Monomial list]
   A \emph{monomial list} $(A, \vv{u}, \vv{s}, q)$ consists of the following data.
   \begin{enumerate}
      \item A monomial pair $(A, \vv{u})$.
      \item A rational special point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
      \item A positive integer $q$.
   \end{enumerate}
   We call a monomial list whose first term is the matrix $A$ an \emph{$A$-list}.
\end{definition}

\begin{definition}[The auxiliary integer program $\ip$]
   \label{aux program: D}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, the integer program $\ip(A, \vv{u}, \vv{s}, q)$ in the domain lattice of $A$ consists of maximizing the function $\vv{h} \mapsto \norm{\vv{h}}$, subject to the constraints that the $i$-th coordinate of $\vv{h}$ is nonnegative whenever the $i$-th coordinate of $\vv{s}$ is zero, and $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$, where the overbar denotes collapse along the minimal face $\mf(A, \vv{u})$.
\end{definition}

Recall that since each row of $\collapse{A}$ is a row of $A$, the inequalities determined by $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$ are a subset of those in $A \vv{h}  < A \tail{\vv{s}}_q$.
Also note that because $\collapse{A}$ is a monomial matrix, the inequality $\collapse{A} \vv{h}  < \collapse{A} \tail{\vv{s}}_q$ imposes upper bounds on all coordinates of $\vv{h}$, and thus $\ip(A, \vv{u}, \vv{s}, q)$ has a well-defined value.

\begin{example}
   \label{ex: ft.3}
   Let $A$ and $\vv{u}$ be as in \Cref{ex: ft,ex: ft.1,ex: ft.2}, and consider the special point $\vv{s}=(1/17,0,3/17)$.
   The constraints for $\ip = \ip(A,\vv{u},\vv{s},q)$ in this case are $h_2 \ge 0$ and $\collapse{A}\vv{h} < \collapse{A}\tail{\vv{s}}_q$, where
   \[\collapse{A} = \begin{bmatrix}5&3&4\\ 2&8&5\end{bmatrix}. \]
   \begin{figure}
      \includegraphics[width=.5\textwidth]{pictures/Theta.pdf}
      \caption{The feasible set for the integer program $\ip(A,\vv{u},\vv{s},q)$ in \Cref{ex: ft.3}, with $\lpr{q}{17}=11$}
      \label{fig: Theta}
   \end{figure}
   \Cref{fig: Theta} shows a portion of the (unbounded) polyhedron defined by the above inequalities, in the case where $\lpr{q}{17}=11$, together with the feasible points for $\ip$.
   In this case the value of $\ip$ is $1$, and the optimal set---a subset of which is shown in red in \Cref{fig: Theta}---is infinite.
   In fact, the optimal set consists precisely of all points of the form $(k,k,1-2k)$, $(k+1,k,-2k)$, and $(k+2,k,-1-2k)$, with $k\in \NN$.
   The situation is analogous for $q$ in every other congruence class modulo $17$.
\end{example}

\Cref{comparison: R} tells us that if $(A, \vv{u}, \vv{s}, q)$ is a monomial list and $\vv{k}$ is feasible for $\IP(A, \vv{u}, q)$, then $\vv{k} - \vv{s}q + \tail{\vv{s}}_q$ is feasible for  $\ip (A, \vv{u}, \vv{s}, q)$.
In particular,
\begin{equation}
   \label{ineq between deficits}
   \val \IP(A, \vv{u}, q) \le \ft{A}{\vv{u}}q - \norm{\tail{\vv{s}}_q} + \val \ip (A, \vv{u}, \vv{s}, q)
\end{equation}
where we have used that $\vv{s} \in \opt \LP(A,\vv{u})$ and so $\norm{\vv{s}} = \val \LP(A,\vv{u}) = \ft{A}{\vv{u}}$.
The next proposition gives conditions under which equality holds.

\begin{proposition}
   \label{uniform value: P}
   Consider a monomial list $(A, \vv{u}, \vv{s}, q)$, and a denominator $\denom$ for the special point $\vv{s}$.
   If $\vv{h} \in \opt \ip(A, \vv{u}, \vv{s}, q)$, and $q/\denom$ is greater than every coordinate of $\vv{1} - \vv{h}$ and every coordinate of $A \vv{h}$, then the point $\vv{s}q - \tail{\vv{s}}_q + \vv{h}$ is optimal for $\IP(A, \vv{u}, q)$.
   Consequently, equality holds in \eqref{ineq between deficits}.
\end{proposition}

\begin{proof}
   Let an overbar denote collapse along $\O = \mf(A, \vv{u})$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   \Cref{tail-basics: R} tells us that $\vv{k}$ has integer coordinates, and we claim that $\vv{k} \geq \vv{0}$.
   Indeed, if $s_i$ is zero, then so is $\tail{s_i}_q$, and $k_i = h_i \ge 0$, by the feasibility of  $\vv{h}$ for $\ip = \ip(A, \vv{u}, \vv{s}, q)$.
   On the other hand, if $s_i$ is positive, then it must be at least $1/\denom$, and so
   $k_i = s_iq-\tail{s_i}_q+h_i \ge q/d - 1 + h_i$, and the last expression is nonnegative by assumption.

   To proceed, write $\vv{u} = A \vv{s} + \vv{w}$, where $\vv{w}$ is a positive point of $\rs(\O)$, as in \Cref{mc: D}.
   Now, $\vv{k}$ is feasible for $\IP = \IP(A, \vv{u}, q)$ if and only if
   \[ A\vv{k} = A (\vv{s}q - \tail{\vv{s}}_q + \vv{h})  < \vv{u}q = A {\vv{s}}q + \vv{w}q\]
   which we rewrite as
   \begin{equation}
      \label{equivalent ineq: e}
      A \vv{h} < A \tail{\vv{s}}_q + \vv{w}q
   \end{equation}
   and prove using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
   As $\vv{u}=A\vv{s}+\vv{w}$ has integer coordinates, it follows that $\denom$ is also a denominator for $\vv{w}$.
   This and the positivity of $\vv{w}$ in $\rs(\O)$ imply that $\vv{w}q$ is greater than $q\vv{1}/d$ in $\rs(\O)$, which in turn is greater than $A\vv{h}$, by assumption.
   Thus, \eqref{equivalent ineq: e} holds in $\rs(\O)$.
   Collapsing along $\O$, on the other hand, \eqref{equivalent ineq: e} becomes $\collapse{A} \vv{h} < \collapse{A} \tail{\vv{s}}_q$, which holds by the feasibility of $\vv{h}$ for $\ip$, and shows that \eqref{equivalent ineq: e} also holds in $\rs(\O)^\perp$.

   In summary, we have just shown that $\vv{k}$ is feasible for $\IP$, and so
   \[ \val \IP \geq \norm{\vv{k}} = \ft{A}{\vv{u}} \cdot q - \norm{\tail{\vv{s}}_q} + \val \ip\]
   and equality holds by \eqref{ineq between deficits}.
\end{proof}

We now move toward establishing a useful bound for the value of $\ip(A, \vv{u}, \vv{s}, q)$.

\begin{lemma}
   \label{tail projection: L}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, then $\collapse{A}\tail{\vv{s}}_q$ is a positive lattice point, where the overbar denotes collapse along $\mf(A,\vv{u})$.
\end{lemma}

\begin{proof}
   By construction, $\vv{s}q - \tail{\vv{s}}_q $ has nonnegative integer coordinates, and the identity $\collapse{\vv{u}} q =\collapse{A} \vv{s} q = \collapse{A} ( \vv{s}q - \tail{\vv{s}}_q ) +\collapse{A} \tail{\vv{s}}_q$ then shows that $\collapse{A} \tail{\vv{s}}_q$ must also have integer coordinates.
   To see that this point is positive, note that $\collapse{\vv{u}} = \collapse{A} \vv{s}$ and $\collapse{A} \tail{\vv{s}}_q$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{A}$.
   It is then easy to see that since $\collapse{\vv{u}} = \collapse{A} \vv{s}$ is positive, so is $\collapse{A} \tail{\vv{s}}_q$.
\end{proof}

\begin{proposition}
   \label{bounded value: P}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list, then
   \[0 \leq  \val  \ip(A, \vv{u}, \vv{s}, q) < \norm{\tail{\vv{s}}_q}.\]
\end{proposition}

\begin{proof}
   Fix a point $\defpt \in \RR^\numvars$ that defines $\O  = \mf(A, \vv{u})$ in the Newton polyhedron of $A$, and let an overbar denote collapse along $\O$.
   Let $\vv{h}$ be optimal for $\ip = \ip(A, \vv{u}, \vv{s}, q)$.
   If the $i$-th column of $A$ does not lie in $\O$, then $s_i$ is zero, and consequently $h_i$ is nonnegative.
   \Cref{prop: inner product with columns of A,rmk: collapse of a matrix,collapse of a defining vector: R} then tell us that
   \begin{equation}
      \label{bound in inner product: e}
      \val \ip = \norm{\vv{h}} \leq \iprod{\defpt}{A \vv{h}} = \iprod{\collapse{\defpt}}{\collapse{A} \vv{h}}.
   \end{equation}
   Those same results applied to $\tail{\vv{s}}_q$ give us
   \begin{equation}
      \label{norm of tail: e}
      \norm{\tail{\vv{s}}_q} =  \iprod{\defpt}{A \tail{\vv{s}}_q} = \iprod{\collapse{\defpt}}{\collapse{A} \tail{\vv{s}}_q}.
   \end{equation}
   These observations and the constraint $\collapse{A}\vv{h} <\collapse{A} \tail{\vv{s}_q}$ combine to tell us that
   \[ \val\ip \leq \iprod{\collapse{\defpt}}{\collapse{A} \vv{h}} < \iprod{\collapse{\defpt}}{\collapse{A} \tail{\vv{s}}_q} = \norm{\tail{\vv{s}}_q}.\]
   Finally, the positivity of $\collapse{A}\tail{\vv{s}}_q$ established in \Cref{tail projection: L} implies that $\vv{0}$ is feasible for $\ip$, and thus $\val \ip \ge 0$.
\end{proof}

\subsection{Some finiteness properties}

We now explore finiteness properties concerning the nature of these programs as, for a fixed monomial matrix $A$, we vary the $A$-list $(A, \vv{u}, \vv{s}, q)$.
The following theorem underlies some of our later finiteness results.

\begin{theorem}
   \label{finitely many secondary programs: T}
   If $A$ is fixed, then there are only finitely many integer programs of the form $\ip(A, \vv{u}, \vv{s}, q)$ as we vary over all $A$-lists $(A, \vv{u}, \vv{s}, q)$.
\end{theorem}

\begin{proof}
   Consider a monomial list $(A, \vv{u}, \vv{s}, q)$.
   As $A$ is fixed, there are only finitely many possibilities for $\O = \mf(A, \vv{u})$, and only finitely many possibilities for the set of supporting indices of any point $\vv{s} \in \sp_{\QQ}(A ,\vv{u})$.

   Next, let $\collapse{A}$ be the collapse of $A$ along the face $\O$.
   If $\vv{s} \in \sp_{\QQ}(A, \vv{u})$, then $\vv{0} \leq \tail{\vv{s}}_q \leq \vv{1}$ for every positive integer $q$.
   Consequently, $\vv{0} \leq \collapse{A} \tail{\vv{s}}_q \leq \collapse{A}\, \vv{1}$, and as \Cref{tail projection: L} tells us that $\collapse{A} \tail{\vv{s}}_q$ has integer coordinates, it follows that there are only finitely many possibilities for this point.
\end{proof}

\begin{corollary}\label{finitely many coord sums: C}
   If $A$ is fixed, then there are only finitely many rational numbers of the form $ \norm{\tail{\vv{s}}_q}$ as we vary over all $A$-lists $(A, \vv{u}, \vv{s}, q)$.
\end{corollary}

\begin{proof}
   This follows from \eqref{norm of tail: e} and the proof of \Cref{finitely many secondary programs: T}.
\end{proof}

\section{Toward solving $\IP$}
\label{solving: S}

Throughout this section, $(A, \vv{u})$ is a monomial pair and $q$ is positive integer.
Our goal here is to demonstrate that the value and the \hl{image of $\opt\IP(A, \vv{u}, q)$ under $A$}
\pedro{Replaced ``optimal image'' with this; maybe we'll want to rephrase this.}
vary with $q$ in a uniform way as $q$ tends to infinity.

\subsection{Shortfall and deficit}

The constraints of the integer program $\IP(A,\vv{u},q)$ and of the arithmetic integer program $\IP_p(A,\vv{u},q)$ imply that for every subset $\mathcal{F}$ of their feasible sets, the image of $\mathcal{F}$ under $A$, denoted $A(\mathcal{F})$, consists of points in the target lattice of $A$ that are less than $\vv{u}q$.
In particular, the Minkowski difference $\vv{u}q-A(\mathcal{F})$ consists of positive lattice points in the target lattice of $A$.

\begin{definition}[Shortfall for $\IP$ and $\IP_p$]
   The \emph{shortfall} of the integer program $\IP(A, \vv{u}, q)$ is the Minkowski difference
   \[ \short \IP(A, \vv{u}, q) = \vv{u}q - A( \opt \IP(A, \vv{u}, q)).\]
   The shortfall of the arithmetic integer program $\IP_p(A, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

The preceding discussion shows that the shortfall of either program consists of positive lattice points in the target lattice of $A$.

\begin{remark}[Algebraic interpretation of shortfalls]
\label{shortfall motivation: R}
Let $(A,\vv{u})$ be a monomial pair associated to an ideal pair $(\ideala,\ideald)$.
If $q$ is a power of $p$, $\IP = \IP(A,\vv{u},q)$, and $\nu = \nu(\ideala,\ideald,q) = \val \IP$, then the shortfall of $\IP$ can be interpreted as the ``leftovers'' of $\ideala^\nu$ modulo $\ideald^{[q]}$.

More precisely, the discussion preceding \Cref{IP: D} tells us that the generators of $\ideala^{\nu}$ not contained in $\ideald^{[q]}$ are precisely the monomials of the form $x^{A \vv{k}}$, with $\vv{k}$ in the domain lattice of $A$ satisfying $\norm{\vv{k}} = \nu$ and $A\vv{k}<\vv{u}q$.
Keeping in mind that $\nu= \val \IP$, these conditions on $\vv{k}$ are equivalent to $\vv{k}$ being optimal for $\IP$.
Thus, the generators of $\ideala^{\nu}$ not in $\ideald^{[q]}$ are precisely the monomials of the form $x^{\vv{w}}$, with the exponent vector $\vv{w}$ lying in $A(\opt \IP) = \vv{u}q - \short \IP$.
In other words,
\begin{equation}
\label{algebraic shortfall PI general: e}
 \ideala^{\nu(\ideala, \ideald, q)} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP(A,\vv{u},q)} \bmod \ideald^{[q]}.
 \end{equation}
Likewise, one can show that
\begin{equation}
\label{algebraic shortfall PI_p general: e}
\ideala^{[\mu(\ideala, \ideald, q)]} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP_p(A,\vv{u},q)} \bmod \ideald^{[q]}
\end{equation}
giving us an algebraic interpretation for the shortfall of the arithmetic integer program $\IP_p(A,\vv{u},q)$.
\end{remark}

If $\vv{k}$ is optimal for $\IP = \IP(A,\vv{u},q)$ or $\IP_p = \IP_p(A,\vv{u},q)$, then $A\vv{k} < \vv{u}q$.
For sufficiently small positive $\epsilon$, we have $A(\vv{k}+\epsilon\vv{1}) < \vv{u}q$, so $(\vv{k}+\epsilon \vv{1})/q$ is feasible for $\LP(A,\vv{u})$.
Thus, $\norm{\vv{k}}/q < \val \LP(A,\vv{u}) = \ft{A}{\vv{u}}$, showing that the values of $\IP$ and $\IP_p$ are strictly less than $\ft{A}{\vv{u}}q$.
The notion of \emph{deficit} is introduced to measure how far those values are from this natural upper bound.

\begin{definition}[Deficit for $\IP$ and $\IP_p$]
   The \emph{deficit} of the integer program $\IP(A, \vv{u}, q)$ is positive rational number
   \[ \deficit \IP(A, \vv{u}, q) = \ft{A}{\vv{u}}q - \val \IP(A, \vv{u}, q).\]
   The deficit of the arithmetic integer program $\IP_p(A, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

We now extend the definitions of shortfall and deficit to the auxiliary integer program $\ip(A,\vv{u},\vv{s},q)$.

\begin{definition}[Shortfall and deficit for $\ip$]
   \label{deficit and shortfall ip: D}
   The \emph{shortfall} of the integer program $\ip = \ip(A, \vv{u}, \vv{s}, q)$ is the set
   \[ \short \ip = \collapse{A} \tail{\vv{s}}_q - \collapse{A} (\opt \ip)\]
   where the overbar denotes collapse along $\mf(A, \vv{u})$.
   The \emph{deficit} of $\ip$ is the positive rational number
   \[ \deficit \ip = \norm{\tail{\vv{s}}_q} - \val \ip. \]
\end{definition}

\Cref{tail projection: L} and the constraints of $\ip$ imply that the shortfall of $\ip$ consists of positive lattice points, while \Cref{bounded value: P} shows that the deficit of $\ip$ is indeed positive.

Our next proposition will show that, even though the optimal set of an integer program $\ip$ may be infinite, as shown in \Cref{ex: ft.3}, its shortfall is always finite.
For that, we shall need the following simple boundedness result.

\begin{lemma}
   \label{bounded polytope: L}
   Let $\vv{c}$ and $\vv{u}$ be points in $\RR^\numvars$, and suppose that $\vv{c}$ has positive coordinates.
   If $\alpha$ is any real number, then the polyhedron consisting of all points $\vv{v} \in \RR^\numvars$ such that  $\vv{v} \le \vv{u}$ and $\iprod{\vv{c}}{\vv{v}} \geq \alpha$ is bounded.
\end{lemma}

\begin{proof}
   It suffices to show that the given set is bounded from below.
   For each $\vv{v}$ in that set and each $i$ we have $\vv{v}\le \vv{u} + (v_i - u_i)\canvec_i$.
   As $\vv{c}$ has positive coordinates, $\alpha\le \iprod{\vv{c}}{\vv{v}}\le \iprod{\vv{c}}{\vv{u} + (v_i -u_i)\canvec_i} = \iprod{\vv{c}}{\vv{u}} + c_i(v_i - u_i)$, so $v_i \ge (\alpha + c_iu_i - \iprod{\vv{c}}{\vv{u}})/c_i$.
\end{proof}

\begin{proposition}
   \label{finite image: P}
   The shortfall of $\ip(A, \vv{u}, \vv{s}, q)$ is finite.
\end{proposition}

\begin{proof}
   Suppose $\defpt$ defines $\O  = \mf(A, \vv{u})$ in the Newton polyhedron of $A$, and let an overbar denote collapse along $\O$.
   If $\vv{h}$ is optimal for $\ip = \ip(A, \vv{u}, \vv{s}, q)$, then \eqref{bound in inner product: e} implies that $\val \ip = \norm{\vv{h}} \leq \iprod{\collapse{\defpt}}{\collapse{A} \vv{h}}$, and so $\collapse{A} \vv{h}$ is a lattice point in the polyhedron of all points $\vv{v}$ with $\vv{v} \le \collapse{A} \tail{\vv{s}}_q$ and $\iprod{\collapse{\defpt}}{\vv{v}} \geq \val \ip$.
   The positivity of $\collapse{\defpt}$ and \Cref{bounded polytope: L} then tell us that this polyhedron is bounded.
   Thus, $\collapse{A}(\opt \ip)$ is finite, and therefore so is $\short \ip$.
\end{proof}

\begin{example}
   In the situation of \Cref{ex: ft.3}, we have seen that the optimal set for $\ip = \ip(A,\vv{u},\vv{s},q)$ consists of three infinite families of points.
   A direct computation shows that each of those families provides a unique point in the shortfall of $\ip$, and that $\short\ip = \{(3,1),(2,4),(1,7)\}$.
   % \begin{align*}
   %   P_1 &= \{(k,k,1-2k): k\in \NN\},\\
   %   P_2 &= \{(k+1,k,-2k): k\in \NN\},\\
   %   P_3 &= \{(k+2,k,-1-2k): k\in \NN\}.
   % \end{align*}
   % For $\vv{h} \in \opt\ip$ we have
   % \[
   %    \collapse{A}\tail{\vv{s}}_p -\collapse{A}\vv{h} =
   %    \begin{cases}
   %       (3,1) & \text{if $\vv{h}\in P_1$}\\
   %       (2,4) & \text{if $\vv{h}\in P_2$}\\
   %       (1,7) & \text{if $\vv{h}\in P_3$}
   %    \end{cases}
   % \]
%   Thus, in this case $\short\ip = \{(3,1),(2,4),(1,7)\}$.
\end{example}

\Cref{finite image: P,finitely many secondary programs: T} give us the following result.

%\emily[inline]{Restate?}
\begin{theorem}[Existence of finite sets of representatives]
   \label{fsr-exist: T}
   Given a monomial matrix $A$, there exists a finite subset $\fsr = \fsr(A)$ of the domain lattice of $A$ such that for each integer program $\ip = \ip(A, \vv{u}, \vv{s}, q)$ we have
   \[\short \ip = \collapse{A}\tail{\vv{s}}_q - \collapse{A}(\fsr \cap \opt \ip).\]
   % For every $A$-list $(A, \vv{u}, \vv{s}, q)$, and for every $\vv{v}$ in the image of $\opt\ip(A, \vv{u}, \vv{s}, q)$ under $\collapse{A}$, the collapse of $A$ along $\mf(A,\vv{u})$, there exists $\vv{h} \in \fsr \cap \opt \ip(A, \vv{s}, \vv{u}, q)$ with $\collapse{A} \vv{h} =  \vv{v}$.
\end{theorem}

\begin{proof}
   \Cref{finite image: P} implies that for every monomial list $(A, \vv{u}, \vv{s}, q)$,  there exists a \emph{finite} subset $\fsr(A, \vv{u}, \vv{s}, q)$ of $\opt \ip (A, \vv{u}, \vv{s}, q)$ such that
   \[  \collapse{A}(\opt \ip (A, \vv{u}, \vv{s}, q) ) = \collapse{A}(\fsr(A, \vv{u}, \vv{s}, q)). \]
   \Cref{finitely many secondary programs: T} then implies that these sets may be chosen in such a way so that $\fsr(A) = \bigcup \fsr(A, \vv{u}, \vv{s}, q)$ is finite, where the union is over all $A$-lists.
\end{proof}

\subsection{Relating the two integer programs}
\label{relating-programs: ss}

\begin{proposition}
   \label{uniform value and image: P}
   Given a monomial matrix $A$, there exists $\beta = \beta(A) \in \ZZ$ satisfying the following condition\textup:
   If $(A, \vv{u})$ is a monomial pair, $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ is a point with denominator $\denom$, and $q>\beta \denom$, then
   \[ \deficit \IP(A, \vv{u}, q) = \deficit \ip(A, \vv{u}, \vv{s}, q) \]
   and
   \[ \ol{\short \IP(A, \vv{u}, q)} = \short \ip(A, \vv{u}, \vv{s}, q),\]
   where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
\end{proposition}

\begin{proof}
   Let $\fsr$ be as in \Cref{fsr-exist: T}, and $\beta$ be the maximum among all coordinates of all points of $\vv{1} - \fsr$ and $A(\fsr)$.
   Fix an $A$-pair $(A, \vv{u})$ and a point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
   If $\denom$ is a denominator for $\vv{s}$, fix an integer $q > \beta \denom$, and set $\IP = \IP(A,\vv{u},q)$ and $\ip = \ip(A,\vv{u},\vv{s},q)$.
   \Cref{uniform value: P} then shows that
   \begin{equation}\label{eq: comparing values}
       \val \IP = \ft{A}{\vv{u}}q - \norm{\tail{\vv{s}}_q}+\val\ip,
   \end{equation}
   so $\deficit \IP = \deficit \ip$.
   Let $\vv{h}$ be a point in the domain lattice of $A$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   Multiplying by $\collapse{A}$ and noting that $\collapse{A}\vv{s} = \collapse{\vv{u}}$, we obtain
   \begin{equation}\label{eq: comparing differences}
   \collapse{\vv{u}}q - \collapse{A}\vv{k} = \collapse{A}\tail{\vv{s}}_q - \collapse{A} \vv{h}.
   \end{equation}
   If $\vv{k}\in \opt\IP$, then $\vv{h}$ is feasible for $\ip$ by \Cref{comparison: R}, and therefore optimal for $\ip$ by \eqref{eq: comparing values}.
   Equation~\eqref{eq: comparing differences} then shows that $\ol{\short\IP}\subseteq \short \ip$.
   Conversely, if $\vv{h} \in \fsr \cap \opt\ip$, then \Cref{uniform value: P} shows that $\vv{k}\in \opt \IP$.
   \Cref{fsr-exist: T} and \eqref{eq: comparing differences} then give us the reverse containment, $\short \ip \subseteq \ol{\short\IP}$.
\end{proof}

The above result leads to a fundamental observation.

\begin{corollary}
   \label{independence: C}
%    Fix a monomial pair $(A, \vv{u})$ and an integer $q>0$.  If $\collapse{A}$ is the collapse of $A$ along $\O = \mf(A, \vv{u})$, then the quantities
% \[   \delta(A, \vv{u}, \vv{s}, q)  = \norm{\tail{\vv{s}}_q}  - \val \ip(A, \vv{u}, \vv{s}, q)\] and
% \[ \Delta(A, \vv{u}, \vv{s}, q)  = \collapse{A} \tail{\vv{s}}_q - \im  \ip( A, \vv{u}, \vv{s}, q)  \]
The deficit and the shortfall of $\ip(A, \vv{u}, \vv{s}, q)$ do not depend on $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
\end{corollary}

\begin{proof}
   Fix $\vv{s}$ and $\vv{s}'$ in $\sp_{\QQ}(A, \vv{u})$, as well as a common denominator $\denom$ for these points.
   As the deficits and shortfalls of $\ip(A,\vv{u},\vv{s},q)$  and $\ip(A,\vv{u},\vv{s}',q)$ clearly depend only on $q$ modulo $\denom$, it suffices to show that they agree whenever $q \gg 0$, but this follows from \Cref{uniform value and image: P}.
\end{proof}

\begin{definition}[Universal deficit and shortfall]
\label{independence: D}
Given a monomial pair $(A, \vv{u})$ and positive integer $q$, we define the \emph{universal deficit} and \emph{universal shortfall} of $(A,\vv{u},q)$ as follows\textup:
 \[ \udeficit(A, \vv{u}, q) = \deficit\ip( A, \vv{u}, \vv{s}, q)\] and
\[\ushort(A, \vv{u}, q) = \short\ip( A, \vv{u}, \vv{s}, q), \]
where  $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
\end{definition}

%\begin{remark} Above, we referred to \Cref{uniform value and image: P} to deduce the independence of $\delta(A, \vv{u}, q)$ and $\Delta(A, \vv{u}, q)$ on the rational point $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.  Though it seems likely that this can be established with a more direct argument, we have yet to identify one.
%\end{remark}

%\emily[inline]{Maybe we should restate \Cref{finitely many deltas for a fixed A: R} more precisely. }
%
\begin{remark}[A finiteness property]
   \label{finitely many deltas for a fixed A: R}
   Given a monomial matrix $A$, there are only finitely many universal deficits $\udeficit(A, \vv{u}, q)$ and universal shortfalls $\ushort(A, \vv{u}, q)$, as we vary over all $A$-pairs $(A,\vv{u})$ and all positive integers $q$.
   Indeed, this follows immediately from \Cref{finitely many secondary programs: T}.
\end{remark}

\begin{remark}[Invariance of universal deficit and shortfall under collapse]
   \label{comparing deltas: R}
   If $(A, \vv{u}, \vv{s}, q)$ is a monomial list and $(\collapse{A}, \collapse{\vv{u}})$ is the collapse of $(A ,\vv{u})$ along $\mf(A, \vv{u})$, then \Cref{collapse of mf and mc: P} implies that $(\collapse{A}, \collapse{\vv{u}}, \vv{s}, q)$ is also a monomial list, and it is then clear from \Cref{aux program: D} that $\ip(A, \vv{u}, \vv{s}, q) = \ip(\collapse{A}, \collapse{\vv{u}}, \vv{s}, q)$.
   Consequently,
   \[ \udeficit(A, \vv{u}, q) = \udeficit(\collapse{A}, \collapse{\vv{u}}, q)\]
   and
   \[\ushort(A, \vv{u},q) = \ushort(\collapse{A}, \collapse{\vv{u}}, q),\]
   and one may replace the point in $\sp_{\QQ}(A, \vv{u})$ in \Cref{independence: D} with one in $\sp_{\QQ}(\collapse{A}, \collapse{\vv{u}})$ without affecting the universal deficit and shortfall.
\end{remark}

\begin{remark}[Uniform periodicity of universal shortfall and deficit]
   \label{pair periodicity: R}
   Given a monomial matrix $A$, there exists a positive integer $\denom$ such that for every $A$-pair $(A,\vv{u})$, $\udeficit(A, \vv{u}, q)$ and $\ushort(A,\vv{u},q)$ only depend on $q$ modulo $\denom$.
   Indeed, if $\denom$ is a universal denominator for $A$, as in \Cref{universal denominator:  D}, then we may compute $\udeficit(A, \vv{u}, q)$ and $\ushort(A, \vv{u}, q)$ for every $A$-pair $(A, \vv{u})$ and every $q$ using a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
   Then
   \[
      \udeficit(A, \vv{u}, q) = \udeficit(A, \vv{u}, r)
   \]
   and
   \[
      \ushort(A, \vv{u}, q) = \ushort(A, \vv{u}, r)
   \]
   whenever $q \equiv r \bmod \denom$.
\end{remark}

\pedro[inline]{
   Maybe add somewhere that if $\denom$ is a universal denominator for $A$, then it is also a denominator for the universal deficit.
}


% \begin{remark}
%    \label{pair periodicity: R}
%    If $(A, \vv{u})$ is fixed, then the universal deficit and shortfall of $(A, \vv{u}, q)$ are periodic in $q$.
%    Indeed, if $\denom$ is the denominator of some point in $\sp_{\QQ}(A, \vv{u})$, then
%    \begin{equation}
%       \label{periodicity: e}
%       \begin{split}
%       \udeficit(A, \vv{u}, p) &= \udeficit(A, \vv{u}, q)\\
%       &\text{and}\\
%       \ushort(A, \vv{u}, p) &= \ushort(A, \vv{u}, q)
%    \end{split}
%    \end{equation}
%    whenever $p \equiv q \bmod \denom$.
%    In fact, \Cref{comparing deltas: R} tells us that the same is true if instead $\denom$ is the denominator of a point in $\sp_{\QQ}(\collapse{A}, \collapse{\vv{u}})$.
% \end{remark}

% \begin{remark}
%    \label{pair periodicity: R}
%    If only $A$ is specified, then there exists a uniform integer $\denom$ such that \eqref{periodicity: e} holds for every monomial pair $(A, \vv{u})$ whenever $p \equiv q \bmod \denom$.
%    Indeed, if $\denom$ is as a universal denominator, as in \Cref{universal denominator:  D}, then we may compute  $\udeficit(A, \vv{u}, q)$ and $\ushort(A, \vv{u}, q)$ for all monomial pairs $(A, \vv{u})$ and integers $q>0$ using a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
% \end{remark}

We record another application of universal denominators below.

\begin{theorem}
\label{uniform uniform value and image: T}
Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
If $q > \beta$ and $(A, \vv{u})$ is a monomial pair, then
\[  \deficit \IP(A, \vv{u}, q) = \udeficit(A, \vv{u}, q) \]
and
\[  \ol{ \short \IP(A, \vv{u}, q)} = \ushort (A, \vv{u}, q).\]
\end{theorem}

\begin{proof}
   Let $\denom$ be a universal denominator for $A$, so that for every $A$-pair $(A, \vv{u})$, there exists a point in $\sp_{\QQ}(A, \vv{u})$ with denominator $\denom$.
   If $\beta_{\circ}$  is any integer satisfying the condition stated in \Cref{uniform value and image: P}, then we may take $\beta = \denom \beta_{\circ}$.
\end{proof}

To interpret this result algebraically, we need to extend the notion of collapses to monomial and diagonal ideals.

\begin{definition}[Algebraic collapses]
   Let $(\ideala,\ideald)$ be an ideal pair in $R = \kk[x_1,\ldots,x_\numvars]$.
   Let $(A,\vv{u})$ be an associated monomial pair and $\O=\mf(A,\vv{u})$.
   \begin{enumerate}
      \item The \emph{collapse of $R$} (along $\O$) is the polynomial ring $\collapse{R}$ obtained from $R$ by omitting the variable $x_i$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideala$} (along $\O$) is the monomial ideal $\collapse{\ideala}$ of $\collapse{R}$ obtained from $\ideala$ by setting $x_i$ equal to $1$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideald$} (along $\O$) is the proper diagonal ideal $\collapse{\ideald}$ of $\collapse{R}$ obtained from $\ideald$ by setting $x_i$ equal to $0$ whenever $\canvec_i \in \rb(\O)$.
   \end{enumerate}
\end{definition}

Thus, $\collapse{\ideala}$ and $\collapse{\ideald}$ are the images of $\ideala$ and $\ideald$ under suitable (different) evaluation homomorphisms $R\to \collapse{R}$, designed so that $(\collapse{\ideala},\collapse{\ideald})$ is an ideal pair, and $(\collapse{A},\collapse{\vv{u}})$ is a monomial pair associated to it.

We note that the collapsed ideal pair $(\collapse{\ideala},\collapse{\ideald})$ depends on the choice of the associated monomial pair $(A,\vv{u})$ associated to $(\ideala,\ideald)$.
If this choice is irrelevant or clear from the context, then we shall omit the reference to the minimal face $\O$ when referring to collapsed ideal pairs.

% \begin{remark}[An algebraic interpretation]
%    \label{leftover p large: R}
%    Let $(A, \vv{u})$ be a monomial pair associated to an ideal pair $(\ideala, \ideald)$.
%    If $\beta = \beta(A)$ is as in \Cref{uniform uniform value and image: T}, then the first conclusion of that theorem tells us that if $q > \beta$, then
%    \[ \nu(\ideala, \ideald, q) = \ft{\ideala}{\ideald} q - \udeficit(A, \vv{u},q). \]

%    Next, we consider the algebraic implications of the description of the collapse of the optimal image of $\IP(A, \vv{u}, q)$ in \Cref{uniform uniform value and image: T}.
%    For simplicity, we first consider the case that $\O = \mf(A, \vv{u})$ is bounded.
%    In this case,  the collapse along $\O$ is the identity map, and so $\short\IP(A, \vv{u}, q) = \ushort(A, \vv{u},q)$.
% In light of this, it follows from \Cref{shortfall motivation: R} that whenever $q >\beta$,
% \[ \ideala^{\nu(\ideala, \ideald, q)} \equiv \ideal{x^{\vv{u}q-\vv{w}}: \vv{w} \in \ushort(A,\vv{u},q)} \bmod \ideald^{[q]}.\]
% In other words, the ``leftovers" of $\ideala^{\nu(\ideala, \ideald, q)}$ modulo $\ideald^{[q]}$, the diagonal ideal determined by $\vv{u}q$, differ from $\vv{u}q$ in a uniform way, at least when $q > \beta$.

% When $\O$ is unbounded, the situation is slightly more complicated. \daniel{Return to this later;  you'll need to settle on how to describe collapses first}
% \end{remark}

% The following is a consequence of \Cref{comparing deltas: R,uniform uniform value and image: T}.

% \begin{corollary}
% Given a monomial matrix $A$, there exists an integer $\beta$ with the following property\textup:  If $q > \beta$ and $(A, \vv{u})$ is a monomial pair with $\O = \mf(A, \vv{u})$, then $\val \IP(A, \vv{u}, q) = \val \IP(\collapse{A}, \collapse{\vv{u}}, q)$ and $\ol{ \im \IP(A, \vv{u}, q)} = \im \IP(\collapse{A}, \collapse{\vv{u}}, q)$ where the overbar denotes collapse along $\O$.
% \end{corollary}

% \emily[inline]{The following could just replace the above statement?  Replace integer programming language with algebraic language? For instance, as follows?}

\begin{corollary}
\label{computing nu for large q: C}
   Given a monomial ideal $\ideala$, there exists an integer $\beta = \beta(\ideala)$ with the following property\textup:
   If $q> \beta$, and $(\ideala, \ideald)$ is an ideal pair, then
   \begin{equation*}
      \nu(\ideala, \ideald, q) = \ft{\ideala}{\ideald} q - \udeficit(A, \vv{u},q) = \nu(\collapse{\ideala},\collapse{\ideald}, q). \qed
   \end{equation*}
\end{corollary}


% \pedro[inline]{
%    This lemma appeared earlier in the section, and contained things we already knew (positivity and integrality).
%    I removed those things, and what is left should go somewhere else (where it's used), maybe as a remark, maybe incorporated in another proof.
% \begin{lemma}
% \label{independence: L}
% If $\collapse{A}$ is the collapse of $A$ along $\O = \mf(A, \vv{u})$ and $q>0$ is an integer, then no column of $\collapse{A}$ is less than any point in $\ushort(A, \vv{u}, q)$.
% \end{lemma}
% \begin{proof}
%    Suppose $\vv{k}$ is optimal for $\ip = \ip(A,\vv{u},\vv{s},q)$, for some $\vv{s} \in \sp_{\QQ}(A, \vv{u})$.
%    Then optimality implies that  $\collapse{A}( \vv{k} + \canvec_i) \not < \collapse{A} \tail{\vv{s}}_q$ for each standard basis vector $\canvec_i$ in the domain of $\collapse{A}$, and thus  $\collapse{A} \canvec_i \not < \collapse{A} \tail{\vv{s}}_q - \collapse{A} \vv{k}$.
% \end{proof}


% \daniel[inline]{I think it is OK to just omit this here, as it is noted (in a slightly more general context) in \Cref{sprouts as collapsed shortfall pairs: R}, which is probably a better location anyway.}
% }

\section{Arithmetic integer programs revisited}

The remainder of this paper is dedicated to the study of the arithmetic integer programs $\IP_p(A, \vv{u}, p^e)$ described in \Cref{aip: D}, which perhaps unsurprisingly, turn out to be far more complex in nature than their non-arithmetic counterparts $\IP(A, \vv{u}, p^e)$.
Throughout this section, $e$ will denote a natural number, and $q$ will denote a power of $p$.

\subsection{A key theorem}
The following theorem plays a key role in our algorithm for computing the value of $\IP_p(A, \vv{u}, p^e)$ for $p \gg 0$, in the case that $\ft{A}{\vv{u}} \le 1$ and the matrix $A$ is associated to an $\idealm$-primary ideal, where $\idealm$ is the ideal generated by the variables.
The description of this algorithm caps off this section, and justifies the main theorem herein, \Cref{m-primary AIP: T}, which characterizes this value.
In fact, it is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{A}{\vv{u}}$, and, remarkably, depends only on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$.

\begin{theorem}
\label{general AIP: T}
If $q$ is a power of $p$, and $e$ is a nonnegative integer, then
%
\[  L \coloneqq \val \IP_p(A, \vv{u}, qp^e) -  \val \IP_p(A, \vv{u}, q)p^e  \]
is nonnegative, at most $p^e-1$, and also at most
%
\[ M \coloneqq \max \{ \val \IP_p(A, \vv{v}, p^e)  \},  \]
where the maximum is over all points $\vv{v}$ in the shortfall of $\IP_p(A, \vv{u}, q)$.\footnote{
   Recall that, as $A$ is a monomial matrix, the feasible set of $\IP_p(A, \vv{v}, q)$ is finite, and hence, so is the shortfall of this program.  In particular, this maximum value is well defined.
}

If, in addition\daniel{I don't know of any case where $M$ is at least $p^e$, but it might be true in low characteristic.}, $M$ is at most $p^e-1$,  then $L=M$, and
\[  \short \IP_p(A, \vv{u}, qp^e) = \bigcup \short \IP_p(A, \vv{v}^{\ast}, p^e), \]
where the union is over all $\vv{v}^{\ast} \in \short \IP_p(A, \vv{u}, q)$ that achieve $M$.
\end{theorem}

\begin{proof}
   It is clear that multiplying a feasible point for $\IP_p(A, \vv{u}, q)$ by $p^e$ yields a feasible point for $\IP_p(A, \vv{u}, qp^e)$, from which it follows that $L\geq 0$.


   Next, consider $\vv{g} \in \opt \IP_p(A, \vv{u}, qp^e)$.
   Dividing by $p^e$, we write
   \[ \vv{g} = \vv{h} p^e + \vv{k}, \]
   where $\vv{h}$ and $\vv{k}$ are nonnegative lattice points, and every coordinate of $\vv{k}$ is less than $p^e$.
   By \Cref{dickson: R}, the arithmetic constraint satisfied by $\vv{g}$ implies that $0 \not \equiv \binom{\norm{\vv{g}}}{\vv{g}} \equiv \binom{\norm{\vv{h}}}{\vv{h}} \binom{\norm{\vv{k}}}{\vv{k}} \bmod p$, so that both $\binom{\norm{\vv{h}}}{\vv{h}}$ and $\binom{\norm{\vv{k}}}{\vv{k}}$ must be nonzero modulo $p$.
   In particular, $\vv{h}$ satisfies the arithmetic constraint of $\IP_p(A,\vv{u},q)$, and it is easy to see that it also satisfies its linear constraint.

   Having established the feasibility of $\vv{h}$ for $\IP_p(A,\vv{u},q)$, we now demonstrate its optimality.
   Observe that, by virtue of being a remainder upon division by $p^e$, the base $p$ expansion of $\vv{k}$ is of the form $\vv{k} = \sum_{0 \leq s< e} \vv{k}_s  p^s$.
   As noted in \Cref{dickson: R}, the nonvanishing of $\binom{\norm{\vv{k}}}{\vv{k}} \bmod p$ tells us that each $\norm{\vv{k}_s}$ is less than $p$, and so it follows that $\norm{\vv{k}} < p^e$.
   If $\vv{h}$ were not optimal for $\IP_p(A, \vv{u}, q)$, then there would exist $\vv{m}$ feasible for $\IP_p(A, \vv{u}, q)$ with $\norm{\vv{m}} \geq \norm{\vv{h}} + 1$, which would lead to a point $\vv{m}p^e$ feasible for $\IP_p(A, \vv{u}, qp^e)$ whose norm is
   \[ \norm{\vv{m}}  p^e \geq \norm{\vv{h}}  p^e + p^e >  \norm{\vv{h}}  p^e + \norm{\vv{k}} = \norm{\vv{g}},\]
   which contradicts the optimality of $\vv{g}$.
   We conclude that $\vv{h} \in \opt \IP_p(A, \vv{u},q)$.

   This optimality, along with the definition of shortfalls, tells us that $\vv{v} \coloneqq \vv{u}q-A\vv{h}$ is a point in the shortfall of $\IP_p(A, \vv{u},q)$.
   We may then express the linear constraint on $\vv{g}$ imposed by $\IP_p(A, \vv{u}, qp^e)$ as
   \[ \vv{u}qp^e > A \vv{g} = A \vv{h} p^e + A \vv{k} = (\vv{u}q-\vv{v})p^e + A \vv{k}, \]
   which is equivalent to the constraint $A \vv{k} < \vv{v}p^e$.
   As we have already seen above that $\binom{\norm{\vv{k}}}{\vv{k}}$ is nonzero modulo $p$, it follows that $\vv{k} \in \feas \IP_p(A, \vv{v}, p^e)$.
   Putting everything together, we see that
   \[ L = \norm{\vv{g}}-\norm{\vv{h}}p^e = \norm{\vv{k}} \leq \min \{ p^e-1, \val \IP_p(A, \vv{v}, p^e) \} \leq \min \{ p^e-1, M \}.\]

   For the remainder of this proof, suppose that $M \leq p^e-1$.
   Consider a point  $\vv{v}^{\ast} \in \short \IP_p(A, \vv{u}, q)$ that achieves $M$, and write $\vv{v}^{\ast} = \vv{u}q - A \vv{h}^{\ast}$ for some $\vv{h}^{\ast} \in \opt \IP(A, \vv{u}, q)$.
   If $\vv{k}^{\ast} \in \opt \IP_p(A, \vv{v}^{\ast}, p^e)$, then $\norm{\vv{k}^{\ast}} = M \leq p^e-1$, and so every entry of $\vv{k}^{\ast}$ is at most $p^e - 1$.
   Thus, if $\vv{g}^{\ast} \coloneqq \vv{h}^{\ast} p^e + \vv{k}^{\ast}$, then \Cref{dickson: R} tells us that $\binom{\norm{\vv{g}^{\ast}}}{\vv{g}^{\ast}} \equiv  \binom{\norm{\vv{h}^{\ast}}}{\vv{h}^{\ast}} \binom{\norm{\vv{k}^{\ast}}}{\vv{k}^{\ast}} \not \equiv 0 \bmod p$.
   A direct computation will also show that $\vv{g}^{\ast}$ satisfies the linear constraint of  $\IP_p(A, \vv{u}, qp^e)$, which shows that $\vv{g}^{\ast}$ must be feasible for this program.
   It follows that
   \[ L \geq \norm{\vv{g}^{\ast}} - \norm{\vv{h}^{\ast}}p^e = \norm{\vv{k}^{\ast}} = M, \]
   which allows us to conclude that $L=M$, provided that $M \leq p^e-1$.

   It follows that $\vv{g}^{\ast}$ must be optimal for $\IP_p(A, \vv{u}, qp^e)$, and so the identity
   \[  \vv{v}^{\ast} p^e-A\vv{k}^{\ast} = (\vv{u}q-A\vv{h}^{\ast})p^e-A(\vv{g}^{\ast}-\vv{h}^{\ast}p^e) = \vv{u}qp^e-A \vv{g}^{\ast} \]
   demonstrates that $\vv{v}^{\ast} p^e-A\vv{k}^{\ast}$, an arbitrary point that achieves $M$ in the shortfall of $\IP_p(A, \vv{v}^{\ast}, p^e)$, lies in the shortfall of $\IP_p(A, \vv{u},qp^e)$, showing that
   \begin{equation}
      \label{general comparison of shortfalls: e}
      \bigcup_{\vv{v}^{\ast}} \short \IP_p(A, \vv{v}^{\ast}, p^e) \subseteq \short \IP_p(A, \vv{u}, qp^e).
   \end{equation}

   To establish the opposite containment, let $\vv{g}$ be the optimal point for $\IP_p(A, \vv{u}, qp^e)$ considered earlier in this argument.
   As the reader may verify, now that we know that $L=M$, the optimality of $\vv{g}$ implies that $\vv{v} \in \short \IP_p(A, \vv{u}, q)$ must also achieve $M$, and an argument similar to the one above will show that $\vv{u}qp^e - A \vv{g}$, which represents an arbitrary point in the shortfall of $\IP_p(A, \vv{u}, qp^e)$, equals $\vv{v}p^e-A\vv{k}$, a point in the shortfall of $\IP_p(A, \vv{v}, p^e)$.
   Thus, the containment of sets in \eqref{general comparison of shortfalls: e} must be an equality.
\end{proof}

We record a consequence of the bound $L \leq p^e-1$ in \Cref{general AIP: T} below.

\begin{corollary}
   \label{cor: mu comparison}
   Suppose that $(A,\vv{u})$ and $(B,\vv{v})$ are monomial pairs, not necessarily of the same dimension.
   If $\val \IP_p(A, \vv{u}, q)$ is greater than $\val \IP_p(B, \vv{v}, q)$ for some $q$, then $\val \IP_p(A, \vv{u}, qp^e)$ is greater than $\val \IP_p(B, \vv{v}, qp^e)$ for all $e$.
\end{corollary}

\begin{proof}
   \Cref{general AIP: T} gives us
   \begin{equation*}
      \val \IP_p(A, \vv{u},q)p^e \leq \val \IP_p(A, \vv{u}, qp^e) < (\val \IP_p(A, \vv{u}, q)+1)p^e,
   \end{equation*}
   as well as analogous inequalities for $(B,\vv{v})$.
   Combining these bounds with our assumption that $\val \IP_p(A, \vv{u}, q) \ge \IP_p(B, \vv{v}, q) + 1$, we see that
   \begin{align*}
     \val \IP_p(A, \vv{u}, qp^e)  &\geq \val \IP_p(A, \vv{u}, q)  p^e \\
                                  &\geq (\val \IP_p(B, \vv{v}, q)+1) p^e \\
                                  & > \val \IP_p(B, \vv{v}, qp^e). \qedhere
   \end{align*}
\end{proof}

\begin{remark}
The integer programs $\IP$ do not always satisfy the ``uniform comparison'' property of the arithmetic integer programs $\Pi_p$ in  \Cref{cor: mu comparison}.
For instance, suppose that $p \equiv 3 \bmod 4$, and let
\[
 A = \begin{bmatrix} 4 & 0 \\ 0 & 4\end{bmatrix},  \
 \vv{u} = \begin{bmatrix}3\\ 3\end{bmatrix}, \text{ and }
 \vv{v} = \begin{bmatrix}5 \\ 1\end{bmatrix}.
\]
Then for $e \geq 1$, $\IP(A, \vv{u}, p^e)$ has optimal point $\left( \frac{3p^e-1}{4},  \frac{3p^e-1}{4} \right) 
\right)$ when $e$ is odd and $\left( \frac{3p^e-3}{4}, \frac{3p^e-3}{4}\right)$ when $e$ is even, and so 
\[
\val\IP(A, \vv{u}, p^e) = \begin{cases}
\frac{3 p^e - 1}{2} & \text{if } e \text{ is odd} \\
\frac{3 p^e - 3}{2} & \text{if } e \text{ is even}
\end{cases}
\]

\noindent On the other hand, these values are ``switched'' for $\IP(A, \vv{v}, p^e)$: $\left( \frac{5p^e-3}{4}, \frac{p^e-3}{4} \right)$ is an optimal point for odd $e$,  and 
$\left( \frac{5p^e-1}{4},\frac{p^e-1}{4} \right)$ is one for even $e$, 
so that 
the program's value is $\frac{3p^e-3}{2}$ when $e$ is odd, and
equals $\frac{3p^e-1}{2}$ for even $e$.
\end{remark}


\subsection{Small and very small pairs}

\begin{definition}[Small and very small pairs]
A monomial pair $(A, \vv{u})$ is \emph{small} if $\vv{u}$ is not greater than any column of $A$, and is \emph{very small} if $\ft{A}{\vv{u}}$ is at most one.
\end{definition}

\begin{remark}[Algebraic description of small and very small pairs]
\label{algebraic small and very small: R}
  Suppose $(A, \vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$.  If $\vv{a}_i$ is the $i$-th column of $A$, then the condition that $\vv{a}_i \not < \vv{u}$ is equivalent to the condition that the generator $x^{\vv{a}_i}$ of $\ideala$ lies in $\ideald$.  In other words, $(A, \vv{u})$ is small if and only if $\ideala \subseteq \ideald$.

The algebraic characterization of a very small pair is simply that $(A, \vv{u})$ is very small if and only if the $F$-threshold of $\ideala$ with respect to $\ideald$ is at most $1$.
\end{remark}

\begin{remark}[Geometric description of small and very small pairs]
\label{geometric small and very small: R}
Given an $\numvars \times n$ monomial matrix $A$, let $\N \subseteq \RR^{\numvars}$ be its Newton polyhedron.
Geometrically, a pair $(A, \vv{u})$ is small if and only if $\vv{u}$ does not lie in the interior of the Minkowski sum $\col(A) + \cone(\canvec_1,\ldots,\canvec_\numvars)$, a subset of $\RR^{\numvars}$ sometimes called the \emph{upper staircase} determined by the columns of $A$.
On the other hand, \Cref{FT: D} and \Cref{FT descriptions: P}\ref{lambda} imply that a pair $(A, \vv{u})$ is very small if and only if $\vv{u}$ does not lie in the interior of $\N$.
It is clear from these interpretations that a very small pair must also be small, and that a small pair can fail to be very small.  %However, once the monomial matrix $A$ is fixed, there are only finitely pairs $(A, \vv{u})$ that are small, but not very small, as the region lying outside of the interior of the staircase determined by $A$, but within the Newton polyhedron $\N$, is bounded.
% \pedro[inline]{
%    Is this true?
%    If we take, say, the example below, and add a row of ones to the matrix, wouldn't this region be unbounded?
%    Don't we get infinitely many ``layers'' of black points?
% }
% \daniel[inline]{This does look like a counterexample.  Maybe I meant to say is that as we very over all small, but not very small, pairs $(A,\vv{u})$, there are only finitely many collapsed pairs $(\ol{A}, \ol{\vv{u}})$.  I think this might have been buried in an earlier version.  But, with the current proof of \Cref{small not very small value: T}, I don't think we ever called upon this ``fact".  Maybe we should even point out this example and state that there can be infinitely many pairs that are small and not very small, perhaps right before we state \Cref{small not very small value: T}. }
% \emily[inline]{Agreed, thanks for noticing this.  I've added a simple example to the remark below, and reminded the reader of this before \Cref{small not very small value: T}.  }
\end{remark}

\begin{example}
   \label{ex: small vs very small}
   \begin{figure}
      \centering
      \includegraphics[width=.5\textwidth]{pictures/small_very_small_illustration.pdf}
      \caption{Illustration for \Cref{ex: small vs very small}}
      \label{fig: small vs very small}
   \end{figure}
   \Cref{fig: small vs very small} shows the typical situation in two dimensions.
   It shows the Newton polyhedron of a matrix $A$ with two rows,
   % \daniel{Is it necessary to explicitly indicate the matrix $A$ here?  We could maybe say this is typical of the picture of two variables.}
   % \[A=
   %    \begin{bmatrix}
   %       1&3&7&10\\
   %       10&6&3&2
   %    \end{bmatrix}
   % \]
   as well as the upper staircase determined by the columns of $A$.
   If $\vv{u}$ is any of the gray points, the monomial pair $(A,\vv{u})$ is very small.
   If $\vv{u}$ is any of the black points, $(A,\vv{u})$ is small, but not very small.
   Finally, if $\vv{u}$ is any of the white points, $(A,\vv{u})$ is neither small nor very small.

   It is interesting to notice that if we were to make this a three-dimensional example by adding a nonzero constant row to the matrix $A$, we would then have infinitely many ``layers'' looking exactly like \Cref{fig: small vs very small}, and consequently we would have infinitely many small but not very small pairs.
   Indeed, this behavior can occur for $\numvars \times n$ monomial matrices $A$ for which $m > 2$.
   For a perhaps simpler (but similar) example, notice that the monomial pair $(A, \vv{u})$ associated to the ideal pair $(\ideala, \ideald)$, where $\ideala= \ideal{x^3 z, y^2z}$ and $\ideald = \ideal{x^2, y, z^t}$, is small but not very small for every $t > 1$.
\end{example}

\begin{remark}[Small pairs from shortfalls]
\label{small pairs from shortfalls: R}
If $\vv{v}$ is any point in the shortfall of some integer program $\IP = \IP(A, \vv{u}, q)$, then the pair $(A, \vv{v})$ is small.  Indeed, by definition of shortfalls, we may write $\vv{v} = \vv{u}q-A\vv{h}$ for some $\vv{h} \in \opt \IP$.  Subtracting $\vv{a}_i$, the $i$-column of $A$, from both sides of this identity yields
\[ \vv{v}-\vv{a}_i = \vv{u}q-A\vv{h}-\vv{a}_i = \vv{u}q-A(\vv{h}+\canvec_i). \]
The optimality of $\vv{h}$ implies that $\vv{h}+\canvec_i$ cannot satisfy the linear constraint of $\IP$, which shows that the right-hand side above is not positive.  In other words, $\vv{v} \not > \vv{a}_i$, and as $i$ was arbitrary, this shows that $(A, \vv{v})$ is small.

Similarly, if $\vv{v}$ is any point in the universal shortfall $\ushort(A, \vv{u}, q)$, then $(\collapse{A}, \vv{v})$ is also small, where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
\end{remark}

\begin{proposition}
   \label{trivial small value bound: P}
   If $(A, \vv{u})$ is small,  then $\val \IP_p(A, \vv{u}, p^e) \leq p^e-1$.
\end{proposition}

\begin{proof}
   For a change of pace, we give an algebraic proof.
   If $(A,\vv{u})$ is associated to the ideal pair $(\ideala, \ideald)$, then as noted in \Cref{algebraic small and very small: R}, the smallness of $(A, \vv{u})$ is equivalent to the containment $\ideala \subseteq \ideald$.
   However, this containment implies that $\ideala^{[p^e]} \subseteq \ideald^{[p^e]}$, which shows that $\val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e) \leq p^e-1$.
\end{proof}

\begin{remark}[Reduction to the small case]
   We now describe how to reduce the computation of the values of the arithmetic integer programs $\IP_p(A, \vv{u}, p^e)$ for all $e \geq 1$ to the small case, at least when $p$ is large relative to the pair $(A, \vv{u})$.
   For what follows, fix a pair $(A, \vv{u})$, and suppose that $p$ is larger than the value of the standard integer program $\IP(A, \vv{u},1)$.
   The arithmetic constraint of $\IP_p(A,\vv{u},1)$ is thus automatically satisfied, and so $\IP_p(A, \vv{u}, 1) = \IP(A, \vv{u}, 1)$.

   If $\vv{v} \in \short \IP(A,\vv{u},1)$, \Cref{small pairs from shortfalls: R} tells us that $(A, \vv{v})$ is small, and \Cref{trivial small value bound: P}  then tells us that $\val \IP_p(A, \vv{v}, p^e) \le p^e-1$.
   Setting $q=1$ in the statement of \Cref{general AIP: T}, this observation tells us that quantity $M$ defined therein is at most $p^e-1$, and that same theorem shows that
   \[ \val \IP_p(A, \vv{u},p^e) = \val \IP(A, \vv{u},1)p^e + \max \{ \val \IP_p(A, \vv{v}, p^e) \},\]
   where the maximum is over all $\vv{v} \in \short \IP(A, \vv{u},1)$.
   As noted earlier, each such pair is small, which completes our reduction.
\end{remark}

The following theorem allows us to reduce even further, to the very small case; a related statement appears as \cite[Theorem~6.4]{hernandez+etal.frobenius_powers}.
Notice that \Cref{fig: small vs very small} may be misleading in the sense that in this case, there are only finitely many $\vv{u} \in \NN^2$ for which $(A, \vv{u})$ is small, but not very small, so that the existence of $\beta$ in \Cref{small not very small value: T} is immediate.
However, as mentioned in \Cref{ex: small vs very small}, given a monomial matrix $A$, there can exist infinitely many small pairs $(A, \vv{u})$ that are not very small.

%if for all $\vv{u} = (2,1,t)$, $t>1$, if $A = \begin{bmatrix} 3 & 0 \\ 0 & 2 \\ 1 & 1 \end{bmatrix}$.

\begin{theorem}
   \label{small not very small value: T}
   Given a monomial matrix $A$, there exists an integer $\beta=\beta(A)$ with the following property\textup:
   If $(A, \vv{u})$ is small, but not very small, then  \[ \val \IP_p(A, \vv{u}, p^e) = p^e-1\] for every $p > \beta$ and $e \geq 1$.
 % \comment{Compare Theorem~6.4 of \emph{Frobenius Powers}}\emily{Maybe just add ``Cf. \cite[Theorem~6.4]{hernandez+etal.frobenius_powers}'' above?}
\end{theorem}
% \daniel[inline]{This is the "lost theorem" Pedro recovered.  I've added a new proof (the old one is commented out) that does not rely on the fact (stated in \Cref{geometric small and very small: R} without proof) that there are only finitely many small but not very small pairs}

\begin{proof}
   If we fix a universal denominator $\denom$ for $A$, then \Cref{finitely many coord sums: C} implies that there exists an integer $\beta$ such that $p/\denom > \norm{\tail{\vv{s}}_p}$ for every $A$-list $(A,\vv{u},\vv{s}, p)$ with $p > \beta$.
   In what follows, we will assume that $p > \beta$.

   Suppose that $(A,\vv{u})$ is small, but not very small, and let $\vv{s}$ be a special point for this pair with denominator $\denom$.
   \Cref{canonical-feasible: T} then states that
   \[ \vv{k} \coloneqq \vv{s}p-\tail{\vv{s}}_p \in \feas \IP(A,\vv{u},p). \]
   Since $(A,\vv{u})$ is not very small, $\norm{\vv{s}} = \ft{A}{\vv{u}} > 1$, and our choice of $\denom$ then implies that $\norm{\vv{s}} \geq 1 + 1/\denom$, so that
   \[\norm{\vv{k}} \geq p + \frac{p}\denom - \norm{\tail{\vv{s}}_p} > p,\]
   where the strict inequality follows from our choice of $p \gg 0$.

   This bound implies that there exists a point $\vv{h} \leq \vv{k}$ with $\norm{\vv{h}} = p-1$.
   Without loss of generality, assume $h_1 < k_1$, and define $\vv{g} = \vv{h}q + \canvec_1(q-1)$.
   By construction, $\vv{g} \leq \vv{k}q, \norm{\vv{g}} = qp-1$, and $\binom{\norm{\vv{g}}}{\vv{g}} \not\equiv 0 \bmod p$.
   Furthermore, the fact that $\vv{k} \in \feas \IP(A,\vv{u},p)$ implies that $A\vv{g} \leq A{\vv{k}}q < \vv{u}qp$, and so $\vv{g} \in \feas \IP_p(A,\vv{u},qp)$.
   It follows that $\val \IP_p(A,\vv{u},qp) \geq \norm{\vv{g}} = qp-1$, and \Cref{trivial small value bound: P} implies that this bound must be an equality.
\end{proof}

With these reductions in hand, we now describe how to compute the value of $\IP_p(A, \vv{u}, p)$ when $(A, \vv{u})$ is very small,  by appealing to our earlier work on the standard integer programs $\IP(A, \vv{u}, p^e)$.

% \pedro[inline]{
%    I modified the statement and proof of the following theorem to isolate the part that depends on $p\gg 0$.
%    Original statement and proof were commented out.
% }
% \daniel[inline]{This is better.  In this light, is it true that if $p \gg 0$ relative to $A$ and $(A,\vv{u})$ is small, then $\IP_p(A,\vv{u},p) = \IP(A,\vv{u},p)$ if and only if $(A,\vv{u})$ is very small?}
% \pedro[inline]{
%    If $\ft{A}{\vv{u}} > 1$, then $\val \IP(A,\vv{u},p) >  p$, for $p \gg 0$ as in the proof of the previous theorem.
%    But if that is the case \emph{and} $\IP_p(A,\vv{u},p) = \IP(A,\vv{u},p)$, then the scarcity of points with norm $p$ satisfying the arithmetic constraint of $\IP_p$ will show that a point of the form $p \canvec_i$ is feasible for these programs.
%    This would imply that $p\vv{a}_i < p \vv{u}$, hence $\vv{a}_i < \vv{u}$, so the pair isn't even small, a contradiction.
%    (Or maybe it's easier to just argue algebraically.)\\[2mm]
%    Maybe this could be a lemma? Something like\ldots
%    \begin{lemma}
%       If $(A,\vv{u})$ is very small, then the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
%       Moreover, the converse is true for $p$ sufficiently large, depending solely on $A$.
%    \end{lemma}
%    Then we can remove this from the theorem, and eliminate its proof (simply say it follows from the lemma and \Cref{uniform uniform value and image: T}).
% }
% \emily[inline]{Sounds good to me.}
% \daniel[inline]{Me too.  We could then just refer to this later, when using $p \gg 0$ toward the end of the proof of \Cref{main theorem wrt diagonal: T}, when we need to use that $\norm{\vv{h}_{l+1}}$ is at least $p$}
% \pedro[inline]{
%    I added the lemma below.
%    I did not modify the proof of \Cref{main theorem wrt diagonal: T}, though, since the fact that $\val \IP > p$ still does not appear in any statement.
% }
\begin{lemma}
   \label{ip = aip: L}
   If $(A,\vv{u})$ is very small, then the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
   Moreover, the converse is true for $p$ sufficiently large, depending solely on $A$.
\end{lemma}

\begin{proof}
   Suppose $(A,\vv{u})$ is very small.
   We have seen that
   \[ \deficit \IP(A, \vv{u}, p)  = \ft{A}{\vv{u}} p -\val \IP(A, \vv{u}, p)\]
   is positive, and since $\ft{A}{\vv{u}} \leq 1$, this implies that $\val\IP(A,\vv{u},p)\le p-1$.
   Thus, every feasible point for $\IP(A, \vv{u}, p)$ automatically satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p)$, and so these programs coincide.

   Conversely, suppose $\IP_p(A,\vv{u},p) = \IP(A,\vv{u},p)$, for $p \gg 0$ chosen as in \Cref{small not very small value: T}.
   Aiming at a contradiction, suppose $(A,\vv{u})$ is not very small, so that $\ft{A}{\vv{u}} > 1$.
   Arguing as in the proof of \loccit we conclude that $\val \IP_p(A,\vv{u},p) = \val \IP(A,\vv{u},p) >  p$.
   From here on, we argue algebraically: If the pair $(A,\vv{u})$ is associated to the ideal pair $(\ideala,\ideald)$, our last findings tell us that $\ideala^{[p]} \not\subseteq \ideald^{[p]}$, and hence $\ideala \not\subseteq \ideald$, so the pair $(A,\vv{u})$ is not even small---a contradiction.
\end{proof}

In view of the above lemma, \Cref{uniform uniform value and image: T} immediately gives us the following result.

\begin{theorem}
   \label{arithmetic uniform value and image: T}
   For every very small pair $(A,\vv{u})$, the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
   Consequently, given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $(A, \vv{u})$ is very small, and $p > \beta$, then
   \[\deficit \IP_p(A,\vv{u},p)=\deficit \IP(A,\vv{u},p) = \udeficit(A,\vv{u},p) \]
   and
   \[ \collapse{\short \IP_p(A,{\vv{u}},p)}= \collapse{\short \IP(A,{\vv{u}},p)}= \ushort(A,\vv{u},p), \]
   where the overbar denotes collapse along $\mf(A, \vv{u})$.
   \qed
\end{theorem}

% \begin{theorem}
%    \label{arithmetic uniform value and image: T}
%    Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
%    If $(A, \vv{u})$ is very small, and $p > \beta$, then the arithmetic integer program $\IP_p(A, \vv{u}, p)$ agrees with the standard integer program $\IP(A, \vv{u}, p)$.
%    In particular, if $p > \beta$, then
%    \[\deficit \IP_p(A,\vv{u},p)=\deficit \IP(A,\vv{u},p) = \udeficit(A,\vv{u},p) \]
%    and
%    \[ \collapse{\short \IP_p(A,{\vv{u}},p)}= \collapse{\short \IP(A,{\vv{u}},p)}= \ushort(A,\vv{u},p), \]
%    where the overbar denotes collapse along $\O = \mf(A, \vv{u})$.
% \end{theorem}

% \begin{proof}
%    If $\beta = \beta(A)$ is as in \Cref{uniform uniform value and image: T}, then
%    \[ \val \IP(A, \vv{u}, p) = \ft{A}{\vv{u}} \cdot p - \udeficit(A, \vv{u}, p) \]
%    for every $A$-pair $(A, \vv{u})$ and $p > \beta$.
%    Suppose from here on that $(A,\vv{u})$ is very small and $p > \beta$.
%    As $\ft{A}{\vv{u}} \leq 1$, the positivity of $\udeficit(A, \vv{u},p)$ implies that $\val\IP(A,\vv{u},p)\le p-1$.
%    Consequently, every point $\vv{k}$ that is feasible for $\IP(A, \vv{u}, p)$ automatically satisfies the arithmetic constraint of $\IP_p(A, \vv{u}, p)$.
%    We conclude that $\IP(A, \vv{u}, p) = \IP_p(A, \vv{u}, p)$, and our assertion follows from applying \Cref{uniform uniform value and image: T} once again.
% \end{proof}

\begin{remark} \label{program behavior small: R}
   \Cref{arithmetic uniform value and image: T}, together with the periodicity of universal deficits and shortfalls shown in \Cref{pair periodicity: R}, shows that for a very small pair $(A,\vv{u})$, the deficit and the collapse of the shortfall of  $\IP_p(A,\vv{u},p)$ along $\mf(A, \vv{u})$ do not depend on $p$,  but rather on the class of $p$ modulo a universal denominator.
% For $(A, \vv{u})$ very small, \Cref{arithmetic uniform value and image: T} tells us that for $p \gg 0$, the programs $\IP = \IP(A, \vv{u},p)$ and $\IP_p = \IP_p(A, \vv{u},p)$ coincide, and consequently, the collapse of the shortfall along $\O = \mf(A,\vv{u})$ of $\IP_p$ equals that of $\IP$.
% Hence, since the collapse of $\short \IP$ along $\O = \mf(A, \vv{u})$ does not depend on $p$,  but rather on the class of $p$ modulo a universal denominator (see \Cref{pair periodicity: R} and \Cref{uniform uniform value and image: T}), the collapse of $\short \IP_p$ is also independent of $p$.
\end{remark}

\begin{example}
   If $(A, \vv{u})$ is small but not very small, $\IP = \IP(A,\vv{u},p)$ and $\IP_p = \IP_p(A,\vv{u},p)$ need not agree.
   Moreover, the collapses of their shortfalls along the minimal face can also differ.
   For instance, let $A$ be the $2 \times 2$ identity matrix and $\vv{u} = (1,1)$, so that $(A,\vv{u})$ is small, but not very small.
   Notice that in this case the minimal face $\O = \mf(A,\vv{u})$ is bounded, so that collapsing along $\O$ is simply the identity.
   For any prime $p$, $\val \IP = 2p - 2$, attained by a unique optimal point, namely $(p-1,p-1)$; thus, $\short \IP = \{(1,1)\}$, which is independent of $p$, as guaranteed by \Cref{uniform uniform value and image: T}  (at least when $p \gg 0$).
   In contrast, for any odd prime $p$, the point $(\frac{p-1}{2}, \frac{p-1}{2})$ is feasible for $\IP_p$, and therefore optimal by \Cref{trivial small value bound: P}.
   Thus, $\val \IP_p = p-1$ and the point $(\frac{p+1}{2}, \frac{p+1}{2})$, which depends strongly on $p$, is an element of $\short \IP_p$.
\end{example}

The above example shows that the nature of the programs $\IP$ and $\IP_p$ for very small pairs and for small but not very small pairs can differ drastically.
This motivates our technique of reducing to the \emph{very small} setting.

\Cref{arithmetic uniform value and image: T} is fundamental and, together with \Cref{general AIP: T}, forms the basis for a process to compute the value of $\IP_p(A, \vv{u}, p^e)$ when $p$ is large.  Below, we describe this process in an important special case.  Though somewhat technical, these arguments will motivate some constructions in the general case, which is more complicated, and treated in the next section.

\subsection{The $\idealm$-primary case}
\label{m-primary: SS}

We now focus on computing the value of the arithmetic integer program $\IP_p(A,\vv{u}, p^e)$ when $A$ is associated to an $\idealm$-primary monomial ideal, where $\idealm$ is the ideal generated by the variables of the ambient polynomial ring, $(A,\vv{u})$ is very small, $p$ is large relative to $A$, and $e > 0$ is arbitrary.
The assumption that $A$ comes from an $\idealm$-primary ideal implies that the minimal face of every $A$-pair is bounded, and so the collapse along such face is the identity.
In this context, \Cref{arithmetic uniform value and image: T} becomes significantly stronger, as it computes \emph{full} shortfalls, as opposed to a properly collapsed one.
Indeed, the failure of \Cref{arithmetic uniform value and image: T} to compute full shortfalls in general accounts for much of the increased technicality present in the next section.

The main result of this subsection is the following.

\begin{theorem}
   \label{m-primary AIP: T}
   If $A$ is a monomial matrix associated to an $\idealm$-primary monomial ideal, then there exists $\beta=\beta(A)$ with the following property\textup:
   If $p > \beta$ and $(A,\vv{u})$ is very small, then $\val \IP_p(A,\vv{u},p^e)$ is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{A}{\vv{u}}$, whose non-leading coefficients are rational and depend on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$.
\end{theorem}

\begin{remark}
   In \Cref{non-leading coefficients: P}, we will show that the non-leading coefficients of this polynomial are nonpositive.
   The proof below, however, will only show that the constant coefficient is negative.
\end{remark}

Before presenting the proof, we clarify our requirements for $p\gg 0$.

\begin{remark}[On $p$ being sufficiently large]
   \label{p large m-primary: R}
   First off, we assume that $p$ is large enough so that the conclusions of \Cref{small not very small value: T,arithmetic uniform value and image: T} are valid.
   Moreover, given a collection $\S$ of very small pairs $(A,\vv{u})$, we want the subset~$\S^*$ of~$\S$ consisting of the pairs for which $\val \IP_p(A,\vv{u},p)$ is maximum to only depend on $p$ modulo some integer, and not on $p$ itself.
   We explain below how this can be accomplished by choosing $p$ sufficiently large.

   For a very small pair $(A,\vv{u})$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p).\]
   % \pedro{This is actually unnecessary, as in this case there are only finitely many small pairs.}
   % \daniel{You are right, it doesn't seem necessary here.  But, this is the kind of argument we will need later on in the most general case.  Should we just make this observation then?  Maybe we could just give the simple justification here, but also point out the general justification.}
   % \pedro{Done. Had to rearrange things a bit.}
   \Cref{finitely many deltas for a fixed A: R} tells us that, as we vary over all such pairs, $\udeficit(A,\vv{u},p)$ takes on only finitely many values, while \Cref{pair periodicity: R} tells us that its value, once $(A,\vv{u})$ is fixed, depends only on the class of $p$ modulo a universal denominator $\denom$ for $A$.
   Moreover, as in this $\idealm$-primary case there are only finitely many very small pairs, $\ft{A}{\vv{u}}$ also takes on only finitely many values.\footnote{For later use, note that this conclusion remains valid without the $\idealm$-primary assumption: when restricted to very small pairs, $\ft{A}{\vv{u}}$ is bounded above by $1$, and thus takes on only finitely many values by \Cref{discreteness: P}.}
   Thus, by choosing $p\gg 0$, with lower bound dependent only on $A$, we can select the very small pairs $(A,\vv{u})$ to be included in $\S^*$ by first selecting those with maximal $\ft{A}{\vv{u}}$ (which is independent of~$p$), and then selecting among those the pairs with minimal $\udeficit(A,\vv{u},p)$ (which only depends on $p$ modulo $\denom$).
\end{remark}

We are now ready to prove the above theorem.

\begin{proof}[Proof of \Cref{m-primary AIP: T}]
   Choose $p \gg 0$ as in \Cref{p large m-primary: R}, and fix a universal denominator $\denom$ for $A$.
   Set $\S_p = \S^*_p = \{ (A,\vv{u}) \}$ and, for each $e > 1$,
   \begin{align*}
   \S_{p^{e}} &= \{ (A,\vv{v}):  \vv{v} \in \short \IP_p(A,\vv{u},p^{e-1}) \},\\
   \S^*_{p^{e}} &= \{ (A,\vv{v}) \in \S_{p^{e}}:  \val\IP_p(A,\vv{v},p)\text{ is maximum} \}.
   \end{align*}
   Now consider the following claims:
   \begin{enumerate}[(a),leftmargin=*]
      \item\label{c1} $\val \IP_p(A,\vv{u},p^e)$ has the stated properties;
      %and its constant coefficient is either $-1$ or is of the form $ - \udeficit(A,\vv{v},p)$, for some $(A,\vv{v}) \in \S^*_{p^{e}}$;
      \item\label{c2} $\S_{p^e}$ consists of very small pairs, and only depends on $p$ modulo $\denom$ (and consequently so does $\S^*_{p^e}$, by our choice of $p\gg 0$ as in \Cref{p large m-primary: R}).
   \end{enumerate}
   For $e=1$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(A,\vv{u},p) = \ft{A}{\vv{u}}p-\udeficit(A,\vv{u},p),\]
   and claim \ref{c1} follows from \Cref{pair periodicity: R}, while \ref{c2} holds trivially.
   Fix $e\ge 1$ and suppose that claims \ref{c1} and \ref{c2} hold for $e$ and all preceding exponents.
   We now proceed to investigate these claims for $e+1$.

   We start with claim \ref{c2}.
   % If $e=1$, then $\short \IP_p(A,\vv{u},p) = \ushort(A,\vv{u},p)$ only depends on $p$ modulo $\denom$ by \Cref{pair periodicity: R}, and consequently so does $\S_{p^2} = \{ (A,\vv{v}):  \vv{v} \in \short \IP_p(A,\vv{u},p) \}$.
   % Furthermore, every pair in $\S_{p^{2}}$ is small by \Cref{small pairs from shortfalls: R,arithmetic uniform value and image: T}.
   % If $e > 1$,
   \Cref{general AIP: T} shows that
   \[\short \IP_p(A,\vv{u},p^{e}) = \bigcup_{(A,\vv{v}) \in \S^*_{p^e}} \short \IP_p(A,\vv{v}, p)
      = \bigcup_{(A,\vv{v}) \in \S^*_{p^e}} \ushort(A,\vv{v}, p).\]
   Since $\S^*_{p^e}$ and each $\ushort(A,\vv{v}, p)$ only depend on $p$ modulo $\denom$, so does $\S_{p^{e+1}} = \{(A,\vv{v}): \vv{v}\in \short \IP_p(A,\vv{u},p^{e})\}$.
   Moreover, since $\S^*_{p^e}$ consists of very small pairs, the above decomposition, \Cref{small pairs from shortfalls: R}, and \Cref{arithmetic uniform value and image: T} tell us that every pair in $\S_{p^{e+1}}$ is small.
   We have therefore verified most of claim \ref{c2}, except that $\S_{p^{e+1}}$ might contain a small but not very small pair.

   Suppose that is not the case.
   \Cref{general AIP: T,trivial small value bound: P} show that
   \begin{equation}
      \label{recurrence: E}
      \val \IP_p(A,\vv{u},p^{e+1}) = \val \IP_p(A,\vv{u},p^e)p + M,
   \end{equation}
   where $M = \val\IP_p(A,\vv{v},p)$ for any  $(A,\vv{v}) \in \S^*_{p^{e+1}}$.
   Since $(A,\vv{v})$ is very small, \Cref{arithmetic uniform value and image: T} gives us
   \[\val \IP_p(A,\vv{u},p^{e+1}) = (\val \IP_p(A,\vv{u},p^e) + \ft{A}{\vv{v}}) p - \udeficit(A,\vv{v},p),\]
   which, in view of our assumption on $\val \IP_p(A,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   So, in this case claims \ref{c1} and \ref{c2} hold for $e+1$.

   Suppose now that $\S_{p^{e+1}}$ contains a small but not very small pair.
   Engaging the full firepower of \Cref{general AIP: T}, as well as \Cref{small not very small value: T}, we obtain
   \begin{equation}
      \label{tail: E}
      \val \IP_p(A,\vv{u},p^{e+k}) = \val \IP_p(A,\vv{u},p^e)p^k + p^k - 1,\text{ for all }k\in \NN,
   \end{equation}
   which, given our assumption on $\val \IP_p(A,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   Thus, even though \ref{c2} does not hold for $e+1$, we were able to verify \ref{c1} not only for $e+1$, but for all subsequent exponents.
\end{proof}

\begin{remark}[An algorithm]
   \label{m-primary algorithm: R}
   The above proof gives, in this $\idealm$-primary, very small case, an algorithm to compute $\val\IP_p(A,\vv{u},p^e)$ not only up to a specific $e$, but for \emph{all} $e \ge 1$.
   Indeed, as we iterate \eqref{recurrence: E}, one of two situations will occur that will allow us to determine the \emph{entire} remainder of the sequence.

   First, with a bit of luck we may come across a set $\S_{p^e}$ that contains a small but not very small pair, and \eqref{tail: E} gives us the remainder of the sequence.
   In the absence of such luck, note that in this $\idealm$-primary case there are only finitely many small $A$-pairs.
   Thus, there are only finitely many distinct sets $\S_{p^e}$, and once one of these sets repeats, the numbers $M$ that appear in the recurrence \eqref{recurrence: E} will cycle from that point onward.

   All of this is formalized in Algorithm~\ref{alg}, which takes a very small pair $(A,\vv{u})$ and a positive representative $r$ for a congruence class modulo a universal denominator $\denom$ for $A$, and returns a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for the values of $\IP_p(A,\vv{u},p^e)$ with $p$ in the given congruence class---a convenient way to pack the entire sequence of values we are after.
   More explicitly, the rational function $G(\pp,\tt)$ returned can be written as a power series
   \[G(\pp,\tt) = \sum_{e=1}^\infty G_e(\pp)\tt^e,\]
   where each $G_e(\pp)$ is a polynomial in $\pp$ such that
   \[ \val \IP_p(A,\vv{u},p^e) = G_e(p)\]
   for any sufficiently large prime $p\equiv r\bmod \denom$.
   Moreover, if $(A,\vv{u})$ is associated to the ideal pair $(\ideala,\ideald)$, then for all such primes the critical exponent $\crit(\ideala,\ideald)$ can be obtained by evaluating $G(\pp,\tt)(1-\pp\tt)$ at $\big(p,\frac1p\big)$.

  This algorithm relies on the ability to solve several linear programs---each time an $F$-threshold is evaluated---and several integer programs---each time a universal deficit or shortfall is computed.
   Given the computational complexity of solving such programs, our algorithm is bound to be highly inefficient or impractical for large matrices or large $r$.
   Somewhat surprisingly, a preliminary implementation in \emph{Macaulay2} \cite{M2} by the authors fares well on small examples.
\end{remark}

% \pedro[inline]{
%    Should we get into more details?
%    E.g., present pseudo-code such as Algorithm~\ref{alg}, or discuss practical (or impractical) matters like the computability of the shortfalls?
% }
% \emily[inline]{The pseudocode looks good.  If we can find a succinct way to touch on computability, I'm for it.}
% \pedro[inline]{
%    I gave it a shot.
%    I changed the notation in the pseudo-code a bit: I'm using $r$ to denote the representative of the congruence class mod $\denom$, to emphasize that it need not be prime.
%    I'm now using $\S_e$ (and likewise for $\S^*$), as $\S_{p^e}$ does not make sense anymore, and $\S_{r^e}$ causes confusion then $r=1$, as it does not tell us the level we are in.
%    I guess $\S_{\pp^e}$ would be another option.
% }
% \daniel[inline]{I prefer the second option, to keep things consistent with upcoming notation.}
% \pedro[inline]{Went with second one.}

\setlength{\algomargin}{0em}
\begin{algorithm}\caption{The $\idealm$-primary case}
   \label{alg}
\Indp
\SetInd{1.55em}{0em}
\DontPrintSemicolon
\medskip
\SetKwInput{Input}{input}\SetKwInput{Output}{output}
\Input{ \\
   $\bullet$ a very small pair $(A,\vv{u})$, associated to an $\idealm$-primary ideal\\
   $\bullet$ a positive representative $r$ for a congruence class modulo a universal denominator $\denom$
}
\medskip
\Output{ \\ $\bullet$ a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for $\val\IP_p(A,\vv{u},p^e)$, with $p\equiv r \bmod \denom$
}
\medskip
\Begin{
   \medskip
$\S_{\pp},\  \S^*_{\pp} \leftarrow \{(A,\vv{u})\}$\;
$e \leftarrow 1$\;
%\texttt{done} $\leftarrow$ \texttt{false}\;
$M_1 \leftarrow \ft{A}{\vv{u}}\pp - \udeficit(A,\vv{u},r)$\;
\medskip
\While{\texttt{\em true}}{
   $e\leftarrow e+1$\;
   \nl$\S_{\pp^e} \leftarrow \big\{(A,\vv{v}): \vv{v} \in \bigcup_{(A,\vv{v}^*) \in \S^*_{\pp^{e-1}}} \ushort(A,\vv{v}^*,r)\big\}$\;\label{line1}
   \If{$\exists k < e: \S_{\pp^k} = \S_{\pp^e}$}{
      \KwRet{$\dfrac{\sum_{1\le i<k} M_i\tt^i}{1-\pp\tt}+\dfrac{\sum_{k\le i<e} M_i\tt^i}{(1-\pp\tt)(1-\tt^{e-k})}$}
   }
   \nl$\epsilon \leftarrow \max \{\ft{A}{\vv{v}}: (A,\vv{v}) \in \S_{\pp^e}\}$\;\label{line2}
   \If{$\epsilon >1$}{
      \KwRet{$\dfrac{\sum_{1\le i<e}M_i\tt^i}{1-\pp\tt} + \dfrac{(\pp - 1)\tt^e}{(1-\pp \tt)(1-\tt)}$}
   }
   \nl$\text{\texttt{aux}} \leftarrow \{(A,\vv{v})\in \S_{\pp^e}: \ft{A}{\vv{v}} = \epsilon\}$\;\label{line3}
   \nl$\delta \leftarrow \min\{\udeficit(A,\vv{v},r): (A,\vv{v})\in \text{\texttt{aux}}\}$\;\label{line4}
   \nl$\S^*_{\pp^e} \leftarrow \{(A,\vv{v})\in \text{\texttt{aux}}: \udeficit(A,\vv{v},r) = \delta\}$\;\label{line5}
   $M_e \leftarrow \epsilon \pp - \delta$\;
}
}
\end{algorithm}

\section{Sprouting graphs} \label{sprouting: S}
Now that we have a grasp on the value of the arithmetic integer program $\Pi_p(A, \vv{u}, p^e)$ when the matrix $A$ is associated to an $\idealm$-primary monomial ideal, we broaden our scope to address the case of an arbitrary monomial matrix.
In order to do so, we first build a technical framework in which to carry out our investigation, starting with the \emph{directed sprouting graph}.

\subsection{The sprouting graph of a monomial matrix}

\begin{definition}[Descendant]
   A \emph{descendant} of a monomial matrix $A$ is any monomial matrix $B$ obtained from $A$ by deleting some (possibly, none) of its columns.
\end{definition}

\begin{definition}[$p$-sprout]
   \label{p-sprout: D}
   Consider a monomial pair $(A,\vv{u})$, and let an overbar denote collapse along $\mf(A,\vv{u})$.
   We say that $(B, \vv{v})$ is a \emph{$p$-sprout} of $(A, \vv{u})$ whenever the following conditions are satisfied.
   \begin{enumerate}
      \item $B = \collapse{A}$, the collapse of $A$ along $\O = \mf(A, \vv{u})$.
      \item $\vv{v}$ is any point in $\ushort(A, \vv{u}, p) = \ushort(B, \collapse{\vv{u}}, p)$.
   \end{enumerate}
\end{definition}

\begin{remark}
   \label{p-sprout: R}
   As noted in \Cref{collapse of monomial is monomial: R}, the collapse of a monomial matrix along a face of its Newton polyhedron is monomial.
   This and the positivity of points in shortfalls show that the $p$-sprout of a monomial pair is also a monomial pair.  Furthermore, \Cref{small pairs from shortfalls: R,finitely many deltas for a fixed A: R} tell us that there are only finitely many $p$-sprouts of a fixed monomial pair, and that each such sprouted pair is small.
 \end{remark}

\begin{remark}[Sprouts as collapsed shortfall pairs]
   \label{sprouts as collapsed shortfall pairs: R}
   Throughout this remark, suppose that $p$ is large enough relative to $A$ so that the conclusion of \Cref{arithmetic uniform value and image: T} holds.
   Let us call an $A$-pair $(A,\vv{w})$ a \emph{$p$-shortfall pair associated to $(A,\vv{u})$} if $\vv{w} \in \short \IP_p(A,\vv{u},p)$.
%   \daniel{I don't think this is an equality unless $\mf(A,\vv{u})$ is bounded.  Am I missing something?}
%   \emily{No, I removed the ``$= \ushort(A,\vv{u},p)$'' since our intention is to choose a point in the actual shortfall.}
   Recall that $p$-shortfall pairs played an important role in the process for computing $\val \IP_p(A,\vv{u},p^e)$ described in \Cref{m-primary: SS} when $A$ is associated to an $\idealm$-primary ideal.

   It follows immediately from \Cref{p-sprout: D} and \Cref{arithmetic uniform value and image: T} that a $p$-sprout of a pair $(A,\vv{u})$ is the same as the collapse of a $p$-shortfall pair of $(A,\vv{u})$ along the face $\O=\mf(A,\vv{u})$.  In particular, when $\O$ is bounded, then there is no difference between $p$-sprouts and $p$-shortfall pairs of $(A,\vv{u})$.
\end{remark}

\begin{definition}[The directed sprouting graph]
   Let $A$ be a monomial matrix.
   We define $\graph_p(A)$ to be the set consisting of all very small $A$-pairs, and once $\graph_q(A)$ has been defined for some $q$ a power of $p$, we then define $\graph_{qp}(A)$ to be the set consisting of all $p$-sprouts of all pairs in $\graph_q(A)$.

   We define the vertices of the graph $\sprout_p(A)$ to be the disjoint union
   \[ \bigsqcup_{e=1}^{\infty} \graph_{p^e}(A). \]
   A vertex in the $p^e$-th component of the above disjoint union is said to be of \emph{level} $p^e$.
   The directed edges in $\sprout_p(A)$ are defined only between points of consecutive levels:
   There is a directed edge from a vertex of level $q$ to one of level $qp$ if the latter is a $p$-sprout of the former.
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary1: R}
   Consider a monomial matrix $A$.
   In this remark, we gather some basic facts concerning the graph $\sprout_p(A)$.
\begin{enumerate}
\item The set $\graph_p(A)$ of very small $A$-pairs is independent of $p$, and can be infinite, depending on the geometry of the Newton polyhedron of $A$.

\item \label{elementary1 small pairs} \Cref{p-sprout: R} tells us that every vertex of $\sprout_p(A)$ is a small monomial pair.  Furthermore, if $(B,\vv{v})$ is a vertex of $\sprout_p(A)$, then $B$ must be among the finitely many descendants of $A$.

\item \label{elementary1 periodic in e} Applying \Cref{finitely many deltas for a fixed A: R} and the finiteness of each universal shortfall to $A$ and to each of its descendant monomial matrices, we see that $\bigcup_{e>1} \graph_{p^e}(A)$ is a finite set, and the recursive nature of their construction then implies that the sets $\graph_{p^e}(A)$ are eventually periodic in $e$.

\item \label{elementary1 periodic in p} Furthermore, \Cref{pair periodicity: R} tells us that if $\denom$ is a universal denominator for $A$ and all of its finitely many descendants, then the sprouting graph  $\sprout_p(A)$ | meaning, all of its vertices \emph{and} arrows | depends on the class of $p$ modulo $\denom$.
\end{enumerate}
\end{remark}


\begin{lemma}
   \label{positive-polynomial: L}
   Given a real number $w > 0$, and a set $\Omega$ of real numbers that is bounded from above, there exists an integer $\beta = \beta(w, \Omega)$ satisfying the following condition\textup:
   If $p > \beta$, then for every integer $e \geq 1$, and for every $\omega_1, \ldots, \omega_e \in \Omega$, we have that $wp^{e} >  \omega_1 p^{e-1} + \cdots + \omega_{e-1} p + \omega_e$.
\end{lemma}

\begin{proof}
   Given a positive upper bound $\lambda$ for $\Omega$, let $\beta = \lambda/w  + 1$.
   Then for $p>\beta$, $\omega_1 p^{e-1} + \cdots + \omega_{e-1}  p + \omega_e$ is at most $\lambda(p^{e-1} + p^{e-2} + \cdots + 1) = \lambda \cdot \frac{p^e-1}{p-1}$, which, in turn, is less than $\lambda (p^e-1) \cdot w/\lambda < w p^e$.
\end{proof}

\begin{theorem}[Iterated lifting]
\label{ILL: T}
   For each monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $p>\beta$ and \[ (A_1, \vv{u}_1) \to (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)\] is a path in $\sprout_p(A)$, then for every $1 \leq i \leq e$, there exists a point $\vv{k}_i$ in the optimal set of the standard integer program $\IP(A_i, \vv{u}_i,p)$  such that
   \[
      \vv{k}_1 p^{e-1} + \vv{k}_2 p^{e-2} + \cdots + \vv{k}_{e-1} p + \vv{k}_e
   \]
   is feasible for $\IP(A_1, \vv{u}_1, p^e)$.
 \end{theorem}

\begin{proof}
   We start by describing what it means for $p$ to be large.
   Toward this, let $M_1, \ldots, M_l$ be the finitely many descendents of  $A$.
   Fix a positive integer $\denom$ that is a universal denominator for all $M_i$, as guaranteed by \Cref{universal-denominators-exist:  T}, and a finite set of representatives $\fsr(M_i)$ for each $M_i$, as in \Cref{fsr-exist: T}.
   Set $\fsr = \fsr(M_1) \cup \cdots \cup \fsr(M_l)$, and let $\Omega$ be the set consisting of all coordinates of all points in $A(\fsr)$.
   We stress that $\fsr$ and $\Omega$ are finite sets determined by $A$, and do not depend in any way on $p$.

   The finiteness of $\fsr$  and \Cref{positive-polynomial: L}
   imply that there exists an integer $\beta = \beta(\denom, \fsr)$ for which the following conditions hold for $p > \beta$.
    \begin{align}
      \tag{$\heartsuit$} \label{p-big-1}
      &\text{$\frac{p}{\denom}$ is greater than any coordinate of any point in $\vv{1} - \fsr$;}\qquad\qquad\quad \\
      \tag{$\diamondsuit$} \label{p-big-2}
      &\text{$\frac{p^e}{\denom} > \sum_{i=1}^e \omega_i p^{e-i}$ for every $e \geq 1$ and $\omega_1, \ldots, \omega_e \in \Omega$.}
    \end{align}
    In what follows, we assume that $p$ is chosen so as to satisfy \eqref{p-big-1} and \eqref{p-big-2}.

    Consider a finite path
    \[ (A_1, \vv{u}_1) \to (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e) \]
    in $\sprout_p(A)$.
    For every $1 \leq i \leq e$, set $\O_i = \mf(A, \vv{u}_i)$, and fix a special point $\vv{s}_i \in \sp(A_i, \vv{u}_i)$ with denominator $\denom$.
    If $1 \leq i < e$, then the sprouting $(A_i, \vv{u}_i) \to (A_{i+1}, \vv{u}_{i+1})$ tells us that $A_{i+1}$ is the collapse of $A_i$ along $\O_i$, and that
    \[
       \vv{u}_{i+1} \in \ushort(A_i, \vv{u}_i, q)= A_{i+1} \tail{\vv{s}_i}_p - A_{i+1}(\opt \ip( A_i, \vv{u}_i, \vv{s}_i, p)).
    \]
    Then \Cref{fsr-exist: T} and our choice of $\fsr$ allow us to fix a point $\vv{h}_i$ in $\fsr \cap \opt \ip ( A_i, \vv{u}_i, \vv{s}_i, p)$ such that $\vv{u}_{i+1} = A_{i+1} \tail{\vv{s}_i}_p - A_{i+1} \vv{h}_i$.
    Finally, let $\vv{h}_e$ be any point in the nonempty set $\fsr \cap \opt \ip ( A_e, \vv{u}_e, \vv{s}_e, p)$.

    Next, for every $1 \leq i \leq e$,  we define $\vv{k}_i \coloneqq \vv{s}_i p - [\vv{s}_i]_p + \vv{h}_i$.
    Observe that \eqref{p-big-1} and \eqref{p-big-2} imply that for every $1 \leq i \leq e$, the quantity $p/\denom$ is greater than every coordinate of $\vv{1}-\vv{h}_i$ and every coordinate of $A_i \vv{h}_i$.
    It then follows from \Cref{uniform value: P} that
    \begin{equation}
       \label{optimality-for-each-component: e}
       \vv{k}_i \in \opt \IP(A_i, \vv{u}_i,p).
    \end{equation}

    We will now induce on $e$ to prove that $\sum_{i=1}^e \vv{k}_i p^{e-i} \in \feas\IP(A_1, \vv{u}_1, p^e)$.
    When $e = 1$, this follows from \eqref{optimality-for-each-component: e}.
    Next, suppose that $e \geq 2$.
    Our induction hypothesis applied to the truncated path
    \[ (A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e) \]
    tells us that $\vv{k}^{\ast} = \sum_{i=2}^e \vv{k}_i p^{e-i} \in \feas \IP(A_2, \vv{u}_2, p^{e-1})$.
    To complete the induction step, we must show that $\vv{k}_1 p^{e-1} + \vv{k}^{\ast}$ is feasible for $\IP(A_1, \vv{u}_1, p^e)$.
    However, \eqref{optimality-for-each-component: e} implies that this point has nonnegative integer coordinates, and hence, we must only show that $A_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$.

    To do so, recall that our choice of $\vv{s}_1 \in \sp(A_1, \vv{u}_1)$ allows us to write $\vv{u}_1 = A_1 \vv{s}_1 + \vv{w}$, where $\vv{w}$ is a positive point of $\rs(\O_1)$.
    This expression implies that the universal denominator $\denom$ is also a denominator for $\vv{w}$.
    It then follows from the definition of $\vv{k}_1$ and this expression for $\vv{u}_1$ that the inequality $A_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$ is equivalent to
    \begin{equation}
       \label{target-inequality: e}
       A_1( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + A_1\vv{k}^{\ast} < \vv{w} p^e.
    \end{equation}

    We prove this inequality using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
    First we verify that the inequality holds in $\rb(\O_1)^{\perp}$, by verifying that it holds after collapsing along $\O_1$.
    As $A_2$ is the collapse of $A_1$ along $\O_1$ and $\vv{w}\in \rs(\O_1)$, this means verifying that
    \[A_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + A_2\vv{k}^{\ast} < \vv{0}.\]
    But $A_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) = -\vv{u}_2$, by our choice of $\vv{h}_1$, so this inequality reduces to $-\vv{u}_2 p^{e-1} + A_2 \vv{k}^{\ast} < \vv{0}$, which holds as $\vv{k}^{\ast} \in \feas \IP(A_2, \vv{u}_2, p^{e-1})$.

    We now prove that \eqref{target-inequality: e} holds in $\rs(\O_1)$, by verifying that the stronger inequality
    \[ \sum_{i=1}^{e} A_1 \vv{h}_i p^{e-i} = A_1 \vv{h}_1 p^{e-1} + A_1 \vv{k}^{\ast} < \vv{w}p^e \]
    holds in $\rs(\O_1)$.
    However, as $\vv{w}$ is positive in $\rs(\O_1)$ and has denominator $\denom$, $\vv{w} p^e$ is greater than or equal to $p^e \vv{1} / \denom$ in $\rs(\O_1)$, while every coordinate of $\sum_{i=1}^{e} A_1 \vv{h}_i p^{e-i}$ is of the form $\sum_{i=1}^{e} \omega_i  p^{e-i}$ for some $\omega_1, \ldots, \omega_e \in \Omega$.
    Thus, the condition \eqref{p-big-2} tells us that this stronger inequality holds in $\rs(\O_1)$.

    We have just verified that \eqref{target-inequality: e} holds throughout $\rs(\O_1) \oplus \rs(\O_1)^{\perp}$, which allows us to conclude the induction step, and hence, our proof.
\end{proof}


\subsection{Subgraphs associated to pairs}
\emily{Transition added}
We now consider certain subgraphs of the directed sprouting graph, whose definitions are motivated by the sets with the same names used in the $\idealm$-primary setting, which appear in the proof of \Cref{m-primary AIP: T}, and from which \Cref{m-primary algorithm: R} is built from.

\begin{definition}[Subgraphs associated to very small pairs]
   Suppose that $(A,\vv{u})$ is very small, and define $\S_p(A,\vv{u})$ to be the set consisting solely of $(A,\vv{u})$.
   Next, suppose that $\S_q(A,\vv{u})$ has been defined for some $q=p^e$.
   \begin{enumerate}
      \item If $\S_q(A,\vv{u})$ is nonempty and consists only of very small pairs, then define $\S^{\ast}_q(A,\vv{u})$ to be the set of all $(B,\vv{v})$ in $\S_q(A,\vv{u})$ that first maximize $\ft{B}{\vv{v}}$, and only then minimize $\udeficit(B,\vv{v},p)$.  We then~define~$\S_{qp}(A,\vv{u})$ to be the set of all $p$-sprouts of all pairs in $\S^{\ast}_q(A,\vv{u})$.
      \item Otherwise, we define $\S_q^{\ast}(A,\vv{u})=\S_{qp}(A,\vv{u}) = \emptyset$.
   \end{enumerate}
   By definition, each $\S_{p^e}(A,\vv{u})$ and $\S^{\ast}_{p^e}(A,\vv{u})$ is a subset of $\graph_{p^e}(A)$, which we identify with the vertices of $\sprout_p(A)$ of level $p^e$.
   We then define $\sprout_p^{\ast}(A,\vv{u})$ to be the induced subgraph of $\sprout_p(A)$ on the set of vertices
   \[ \bigsqcup_{e=1}^{\infty} \S^{\ast}_{p^e}(A,\vv{u}). \]
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary2: R}
   Suppose $(A,\vv{u})$ is very small.
   In this remark, we gather some basic facts concerning the graph $\sprout^{\ast}_p(A,\vv{u})$.
   \begin{enumerate}
      \item  \label{elementary2 lowest level}
      The only vertex of $\sprout_p^{\ast}(A,\vv{u})$ of level $p$ is $(A,\vv{u})$.
      \item \label{elementary2 small pairs}
      It follows from \Cref{elementary1: R}\eqref{elementary1 small pairs} that $\S_{q}(A,\vv{u})$, when non-empty, consists of small pairs whose monomial matrix is among the finitely many descendants of $A$.
      Furthermore, $\S_{qp}(A,\vv{u}) = \emptyset$ if and only if $\S_q(A,\vv{u}) = \emptyset$ or $\S_q(A,\vv{u})$ contains a pair that is not very small, which itself holds if and only if $\S_{q}^{\ast}(A,\vv{u})= \emptyset$.
      Moreover, $\S_q^{\ast}(A,\vv{u})$ is either empty, or contains only very small pairs.
      \item \label{elementary2 periodic in e}
      Arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in e}, we see that $\bigcup_{e=1}^{\infty} \S_{p^e}(A,\vv{u})$ and  $\bigcup_{e=1}^{\infty} \S^{\ast}_{p^e}(A,\vv{u})$ are finite, and that each of the sets $\S_{p^e}(A,\vv{u})$ and $\S^{\ast}_{p^e}(A,\vv{u})$ are eventually periodic in $e$.
      \item \label{elementary2 periodic in p}
      Similarly, arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in p}, the graph $\sprout_p^{\ast}(A,\vv{u})$ depends only on $p$ modulo any universal denominator $\denom$ for $A$  and all of its finitely many descendants.
   \end{enumerate}
\end{remark}

\begin{example}
   \label{ex: ft.4}
   \begin{figure}
      \centering
      \includegraphics[width=.85\textwidth]{pictures/sprouting_graph.pdf}
      \caption{The sprouting subgraph for \Cref{ex: ft.4}}
      \label{fig: sprouting graph}
   \end{figure}
   \Cref{fig: sprouting graph} shows the sprouting subgraph associated to the pair $(A,\vv{u})$ in our running example, initiated in \Cref{ex: ft}.
   As in \Cref{ex: ft.3}, we consider the case where $p$ is congruent to $11$ modulo a universal denominator for $A$.
   The overbar represents collapse along $\mf(A,\vv{u})$.
   The figure shows $\S_{p^e}(A,\vv{u})$ for $e=1,\ldots,4$, with $\sprout^*_p(A,\vv{u})$ shown in green.
   The nodes shown in red are pairs that are not very small, which cause $\sprout^*_p(A,\vv{u})$ to terminate.
   % \daniel[inline]{So what is the critical exponent?  This has a denominator a power of $p$, because of terminal red points.  Does it have the kind of intermediary powers of $p$ what we don't see in our examples paper?}
   % \pedro[inline]{
   %    No intermediate powers here; the critical exponent is $\frac4{17}-\frac3{17 p^3}$.
   % }
\end{example}

\begin{example}
   \label{ex: new example}
   \begin{figure}
      \centering
      \includegraphics[width=.6\textwidth]{pictures/sprouting_graph_4.pdf}
      \caption{The sprouting subgraph for \Cref{ex: new example}}
      \label{fig: sprouting graph 2}
   \end{figure}
   \Cref{fig: sprouting graph 2} shows the first nine levels of the sprouting subgraph associated to the pair $(A,\vv{u})$, where
   \[
      A = \begin{bmatrix} 36&10&31 \\ 19&46&31 \\ 47&25&36 \end{bmatrix}
      \quad\text{and} \quad
      \vv{u} =\begin{bmatrix} 29 \\ 24 \\ 30 \end{bmatrix}
   \]
   when $p$ is congruent to $11$ modulo a universal denominator for $A$.
   The matrix $B$ consists of the last two rows of $A$, while $C$ consists of the last row.
   Unlike the previous example, here $\sprout^*_p(A,\vv{u})$ is infinite---the last five levels shown in the picture repeat indefinitely.
\end{example}

% \begin{example}
%    \label{ex: new example}
%    \begin{figure}
%       \centering
%       \includegraphics[width=.5\textwidth]{pictures/sprouting_graph_3.pdf}
%       \caption{The sprouting subgraph for \Cref{ex: new example}}
%       \label{fig: sprouting graph 2}
%    \end{figure}
%    \Cref{fig: sprouting graph 2} shows the first seven levels of the sprouting subgraph associated to the pair $(A,\vv{u})$, where
%    \[
%       A = \begin{bmatrix} 6&12&9 \\ 14&5&11 \\ 14&6&9 \\4&6&1 \end{bmatrix}
%       \quad\text{and} \quad
%       \vv{u} =\begin{bmatrix} 5 \\ 6 \\ 6 \\ 10 \end{bmatrix}
%    \]
%    when $p$ is congruent to $5$ modulo a universal denominator for $A$.
%    The matrix $B$ is obtained from $A$ by deleting the last row;  $C$ is obtained from $B$ by deleting the middle row; finally, $D$ and $E$ are the first and second rows of $C$, respectively.
%    Unlike the previous example, here $\sprout^*_p(A,\vv{u})$ is infinite---the last two levels shown in the picture repeat indefinitely.
% \end{example}

\begin{definition}[Numbers associated to the levels of $\sprout^*_p(A,\vv{u})$]
   \label{epsilon delta: D}
   If $(A,\vv{u})$ is very small, and $\S^{\ast}_{p^e}(A,\vv{u}) \neq \emptyset$, then we define
   \begin{align*}
     \epsilon_{p^e}(A,\vv{u}) & \coloneqq \ft{B}{\vv{v}} \\
     \delta_{p^e}(A,\vv{u}) & \coloneqq \udeficit(B,\vv{v},p)
   \end{align*}
   where $(B,\vv{v})$ is any pair in $\S^{\ast}_{p^e}(A,\vv{u})$.
   Observe that, by definition of $\S^{\ast}_{p^e}(A,\vv{u})$, these numbers are independent of the choice of $(B,\vv{v}) \in \S^{\ast}_{p^e}(A,\vv{u})$.
\end{definition}

\begin{proposition}
   \label{p large graph: P}
   Given a monomial matrix $A$, there exists $\beta = \beta(A)$ with the following property\textup:
   If $p > \beta$, $(A,\vv{u})$ is very small, and $\S_{p^e}^{\ast}(A,\vv{u})$ is non-empty, then
   \[
      \max \{ \val \IP_p(B,\vv{v},p) : (B,\vv{v}) \in \S_{p^e}(A,\vv{u}) \} = \epsilon_{p^e}(A,\vv{u}) p-\delta_{p^e}(A,\vv{u})
   \]
   and the subset of $\S_{p^e}(A,\vv{u})$ of pairs that achieve this maximum is $\S^{\ast}_{p^e}(A,\vv{u})$.
\end{proposition}

\begin{proof}
   First, choose $p$ to be large enough so that the conclusions of \Cref{arithmetic uniform value and image: T} hold for $A$, as well as for each of its finitely many descendants.
   In particular, for such primes, $\val \IP_p(B,\vv{v},p) = \ft{B}{\vv{v}}p-\udeficit(B,\vv{v},p)$  for each vertex $(B,\vv{v})$ of $\sprout_p^{\ast}(A,\vv{u})$, and the existence of $\beta(A)$ as above then follows from arguments similar to those made in \Cref{p large m-primary: R}.
\end{proof}

\begin{definition}[Depth of $\sprout_p^{\ast}(A,\vv{u})$]
   If $(A,\vv{u})$ is very small, then $\mathcal{Q}_p(A,\vv{u})$ denotes the largest level of any vertex in the graph $\sprout_p^{\ast}(A,\vv{u})$.
   Formally,
   \[
      \mathcal{Q}_p(A,\vv{u}) \coloneqq \inf \{ q :  \S^{\ast}_{qp}(A,\vv{u}) = \emptyset \}.
   \]
\end{definition}

\begin{remark}
   As noted in \Cref{elementary2: R}\eqref{elementary2 lowest level}, if $(A,\vv{u})$ is very small, then $\S^{\ast}_p(A,\vv{u}) = \{ (A,\vv{u} )\}$, which shows that $\Q_p(A,\vv{u})$ is at least $p$.
   Furthermore, \Cref{elementary2: R}\eqref{elementary2 periodic in e}  implies that the issue of whether $\Q_p(A,\vv{u}) = \infty$ can be determined by checking whether $\S_{qp}(A,\vv{u}) \neq \emptyset$ for a finite number of $q$.
   Finally, \Cref{elementary2: R}\eqref{elementary2 periodic in p} implies that $\log_p \Q_p(A,\vv{u})$ depends only on $(A,\vv{u})$, and on the class of $p$ modulo any universal denominator for $A$, but not $p$ itself.
\end{remark}

\subsection{The main theorem}

Having the necessary concepts and definition in hand, we now turn to the proof of our main theorem, which extends \Cref{m-primary AIP: T} to arbitrary monomial matrices.

\begin{lemma}\label{lem: upper bound for higher mu}
   Given a monomial matrix $A$, there exists an integer $\beta= \beta(A)$ for which the following holds\textup:
   For each $p>\beta$, if $(A, \vv{u})$ is very small, and $(A_1, \vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ is a path in $\sprout^{\ast}_p(A,\vv{u})$,  then
   \[
      \val \IP_p(B, \vv{v}, p^e) \leq \sum_{s=1}^e \val \IP_p(A_s, \vv{u}_s, p)p^{e-s}
   \]
   for any vertex $(B, \vv{v})$ of $\sprout^{\ast}_p(A,\vv{u})$ of the same level as $(A_1, \vv{u}_1)$.
\end{lemma}

\begin{proof}
   Choose $p$ large enough so that the conclusions of \Cref{arithmetic uniform value and image: T} hold for $A$ and for each of its finitely many descendants, and also so that \Cref{p large graph: P} holds for $A$.
   This proposition then implies that $\val \IP_p(B,\vv{v},p)$ equals $\val \IP_p(A_1, \vv{u}_1, p)$, by virtue of both being vertices of the same level in the graph $\sprout_p^{\ast}(A, \vv{u})$.
   This establishes the result when $e = 1$.

   Next, consider a path $(A_1,\vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ with $e \geq 2$, and suppose that the result holds for all shorter paths.
   Invoking \Cref{general AIP: T} for the pair $(B,\vv{v})$, keeping in mind that  $\val \IP_p(B,\vv{v},p) =  \val \IP_p(A_1,\vv{u}_1,p)$, we see that
    \[
      \val \IP_p(B,\vv{v},p^e) \leq \val \IP_p(A_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (B,\vv{w},p^{e-1}) \}, \\
    \]
    where the maximum above is over all $p$-shortfall pairs derived from $(B,\vv{v})$, that is, over all pairs $(B,\vv{w})$ with $\vv{w} \in \short \IP_p(B,\vv{v},p)$.

    Let an overbar denote collapse along $\O=\mf(B,\vv{v})$.
    If the pair $(B,\vv{w})$ is as above, then the linear constraints of $\IP_p(\collapse{B}, \collapse{\vv{w}}, p^{e-1})$ are a subset of the linear constraints of $\IP_p(B, \vv{w}, p^{e-1})$, while their arithmetic constraints are identical.
    Therefore, the value of $\IP_p(B,\vv{w},p^{e-1})$ is at most the value of $\IP_p(\collapse{B}, \collapse{\vv{w}}, p^{e-1})$.  On the other hand, as noted in \Cref{sprouts as collapsed shortfall pairs: R}, the collapsed pairs $(\collapse{B}, \collapse{\vv{w}})$ of this form are precisely the $p$-sprouts of $(B,\vv{v})$.
    Thus,
    \[
      \val \IP_p(B,\vv{v},p^e) \leq \val \IP_p(A_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (C,\vv{z},p^{e-1}) \}, \\
   \]
   where the maximum above is over all $p$-sprouts $(C,\vv{z})$ of $(B,\vv{v})$.
   Therefore, to complete our inductive step, it suffices to show that
   \begin{equation}\label{ineq}
      \val \IP_p(C,\vv{z},p^{e-1}) \le \sum_{s=2}^e \val \IP_p(A_s,\vv{u}_s,p) p^{e-s}
   \end{equation}
   for each $p$-sprout $(C,\vv{z})$ of $(B,\vv{v})$.
   In what follows, we fix such a $p$-sprout.

   Let $q$ be the common level of $(B,\vv{v})$ and $(A_1, \vv{u}_1)$ in $\sprout^{\ast}_p(A,\vv{u})$.
   Being a $p$-sprout of $(B,\vv{v})$, it follows that $(C,\vv{z}) \in \S_{qp}(A,\vv{u})$, while our assumption that $e \geq 2$ implies that $S^{\ast}_{qp}(A,\vv{u})$ is non-empty, as it contains $(A_2, \vv{u}_2)$.
   Below, we establish \eqref{ineq} in cases, depending on whether $(C,\vv{z}) \in \S^{\ast}_{qp}(A,\vv{u})$.

   If $(C,\vv{z}) \notin \S^{\ast}_{qp}(A,\vv{u})$, then $\val \IP_p(C,\vv{z}, p)< \val \IP_p(A_2, \vv{u}_2, p)$ by \Cref{p large graph: P}, and consequently $\val \IP_p(C, \vv{z},p^{e-1}) < \val\IP_p(A_2,\vv{u}_2, p^{e-1})$ by \Cref{cor: mu comparison}.
   The induction hypothesis applied to $(A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)$ and $(A_2,\vv{u}_2)$ itself gives \eqref{ineq}.
   On the other hand, if $(C, \vv{z}) \in \S^{\ast}_{qp}(A,\vv{u})$, then it is on the same level in $\sprout_p^{\ast}(A,\vv{u})$ as $(A_2, \vv{u}_2)$, and  our induction hypothesis applied to the path $(A_2, \vv{u}_2) \to \cdots \to (A_e, \vv{u}_e)$ and the point $(C, \vv{z})$ once again gives us \eqref{ineq}, completing the proof.
\end{proof}

\begin{theorem}
   \label{main theorem wrt diagonal: T}
   Given a monomial matrix $A$, there exists an integer $\beta = \beta(A)$ with the following property\textup:
   If $p > \beta$ and $(A,\vv{u})$ is very small, then $\val \IP_p(A,\vv{u},p^e)$ is a polynomial of degree $e$ in $p$.
   The leading coefficient of this polynomial is $\ft{A}{\vv{u}}$, and all non-leading coefficients are nonpositive and rational.
   Furthermore, these coefficients depend on $(A,\vv{u})$ and the class of $p$ modulo any universal denominator for $A$, but not on $p$ itself.

   More explicitly, if $e$ is an integer with $1 \leq e \leq \log_p \Q_p(A,\vv{u})$, then
   \[
      \val \IP_p(A,\vv{u}, p^e) =  \ft{A}{\vv{u}}  p^e - \sum_{1 \leq s < e} ( \delta_{p^s}(A,\vv{u}) - \epsilon_{p^{s+1}}(A,\vv{u}))  p^{e-s} - \delta_{p^e}(A,\vv{u}).
   \]
   Furthermore, if $\Q = \Q_p(A,\vv{u})$ is finite, then
   \[
      \val \IP_p(A,\vv{u}, \Q q) = \val \IP_p(A,\vv{u}, \Q)  q + q-1
   \]
   for every $q$ a power of $p$.
\end{theorem}

\begin{proof}
   Choose $p \gg 0$ so that the conclusions of \Cref{ILL: T,small not very small value: T,arithmetic uniform value and image: T,lem: upper bound for higher mu} are valid.
   Set $\Q = \Q_p(A,\vv{u})$.
   If $e$ is an integer satisfying $1 \leq e \leq \log_p\Q$, then $S_{p^e}^{\ast}(A,\vv{u})$ is nonempty, and by construction of $\sprout_p^{\ast}(A,\vv{u})$, there exists a path $(A,\vv{u}) = (A_1, \vv{u}_1) \to \cdots \to (A_e, \vv{u}_e)$ in this graph.
   This path in $\sprout_p^{\ast}(A,\vv{u})$ also defines a path in $\sprout_p(A)$, and so \Cref{ILL: T} tells us that there exist points $\vv{k}_1,\ldots,\vv{k}_e$ in the domain lattice of $A$ with each $\vv{k}_s \in \opt \IP(A_s, \vv{u}_s, p)$ for which the point $\vv{k} \coloneqq \sum_{s=1}^e \vv{k}_s p^{e-s}$ is feasible for the standard integer program $\IP(A, \vv{u}, p^e)$.

   However, as noted in \Cref{elementary2: R}\eqref{elementary2 small pairs}, each of the vertices $(A_s, \vv{u}_s)$ is very small, and  \Cref{arithmetic uniform value and image: T} then implies that $\IP(A_s,\vv{u}_s,p) = \IP_p(A_s, \vv{u}_s, p)$.
   \Cref{trivial small value bound: P} then tells us that $\norm{\vv{k}_s} \le p - 1$, and \Cref{dickson: R} shows that the point $\vv{k}$ satisfies the arithmetic constraint of the arithmetic program $\IP_p(A,\vv{u},p^e)$, so that
   \begin{align*}
     \val \IP_p(A,\vv{u},p^e) \geq  \norm{\vv{k}} & = \sum_{s=1}^e \val \IP_p(A_s,\vv{u}_s,p) p^{e-s} \\
                                                  & = \sum_{s=1}^e (\epsilon_{p^s}(A,\vv{u})p - \delta_{p^s}(A,\vv{u})) p^{e-s}.
   \end{align*}
   \Cref{lem: upper bound for higher mu} then implies that we must have equality throughout.
   Noticing that $\epsilon_p(A,\vv{u}) = \ft{A}{\vv{u}}$, this is simply a rearrangement of our first claim.

   Next, suppose that $\Q$ is finite.
   By definition of $\Q$, we know that $\S_{\Q}^{\ast}(A,\vv{u})$ is nonempty, while $\S^{\ast}_{\Q p}(A,\vv{u})$ is empty, so that $\S_{\Q p}(A,\vv{u})$ must contain a pair that is not very small.
   Set $l=\log_p \Q$.
   Then there exists a path
   \[
      (A,\vv{u}) = (B_1,\vv{v}_1) \to \cdots \to (B_{l}, \vv{v}_{l})
   \]
   in $\sprout_p^{\ast}(A,\vv{u})$, which extends to a path
   \[
      (A,\vv{u}) = (B_1,\vv{v}_1) \to \cdots \to (B_{l}, \vv{v}_{l}) \to (B_{l+1}, \vv{v}_{l+1})
   \]
   in $\sprout_p(A)$ whose terminal vertex is small, but not very small.
   \Cref{ILL: T}, applied to this second path, tells us that there exist points $\vv{h}_1,\ldots, \vv{h}_{l+1}$ with each $\vv{h}_s \in \opt \IP(B_s, \vv{v}_s, p)$, and such that
   \[
      \vv{h} \coloneqq \sum_{s=1}^{l+1} \vv{h}_s p^{l+1-s} \in \feas \IP(A,\vv{u}, \Q p).
   \]
   Arguing as in the proof of \Cref{small not very small value: T}, our choice of $p \gg 0$ guarantees that the value of the standard linear program $\IP(B_{l+1}, \vv{v}_{l+1},p)$ is greater than~$p$.
   Therefore, $\norm{\vv{h}_{l+1}} > p$, and so there exists a point $\vv{g} \leq \vv{h}_{l+1}$ with $\norm{\vv{g}} = p-1$.
   Without loss of generality, suppose that the inequality $\vv{g} \leq \vv{h}_{l+1}$ is strict in the first entry, so that $\vv{0} \leq \vv{g} + \canvec_1 \leq \vv{h}_{l+1}$.

   Fix an integer $e \geq 1$, and consider the point
   \[
      \vv{m} \coloneqq \sum_{s=1}^{l} \vv{h}_s p^{e+l-s} + (\vv{g}+\canvec_1)p^{e-1} - \canvec_1,
   \]
   which is obtained from $\vv{h}p^{e-1}$ by replacing $\vv{h}_{l+1}p^{e-1}$ with  $(\vv{g}+\canvec_1)p^{e-1} - \canvec_1$, which is less than or equal to $\vv{h}_{l+1} p^{e-1}$, by our choice of $\vv{g}$.
   Therefore, $\vv{m} \leq \vv{h}p^{e-1}$, and the feasibility of $\vv{h}$ for $\IP(A,\vv{u}, \Q p)$ then implies that $\vv{m} \in \feas \IP(A,\vv{u}, \Q p^e)$.

   To see that $\vv{m}$ satisfies the arithmetic constraint of $\IP_p(A,\vv{u}, \Q p^e)$, observe that the base $p$ expansion of $\vv{m}$ is given by
   \[
      \vv{m} = \sum_{s=1}^{l} \vv{h}_s p^{e+l-s} + \vv{g}p^{e-1} + (p-1) \canvec_1 \cdot p^{e-2} + \cdots + (p-1)\canvec_1
   \]
   and note that $\norm{\vv{h}_s} = \epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u}) < p$ for each $1 \leq s \leq l$, by virtue of the first path above lying entirely in $\sprout_p^{\ast}(A,\vv{u})$.
   Thus, $\vv{m}$ is feasible for $\IP_p(A,\vv{u}, \Q p^e)$, and this and our earlier work show that
   \begin{align*}
     \val \IP_p(A,\vv{u}, \Q p^e) \geq \norm{\vv{m}} & = \sum_{s=1}^l (\epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u})) p^{e+l-s} + p^e-1 \\
                                                     & = \Big ( \sum_{s=1}^l (\epsilon_{p^s}(A,\vv{u})p-\delta_{p^s}(A,\vv{u})) p^{l-s} \Big ) p^e + p^e-1 \\
                                                     & = \val \IP_p(A,\vv{u}, \Q) p^e + p^e-1,
   \end{align*}
   and \Cref{general AIP: T} further implies that equality must hold throughout.

   To conclude our proof, it remains to show that the non-leading coefficients in $\val \IP_p(A,\vv{u},p^e)$ are nonpositive, but this is done in \Cref{non-leading coefficients: P}.
\end{proof}

\begin{remark}[An algorithm]
   \label{algorithm: R}
   Like in the $\idealm$-primary case, our methods provide us with an algorithm that, at least in theory, returns the formulas given in \Cref{main theorem wrt diagonal: T} for \emph{all} $e \ge 1$.
   In fact, the pseudocode presented in Algorithm~\ref{alg} applies to the general case with minimal modifications:
   $\S_{\pp^e}$ should be defined as the set consisting of all $p$-sprout of all elements in $\S^*_{\pp^{e-1}}$ in line \ref{line1}, and $A$ should be replaced with a descendant $B$ in lines \ref{line2}--\ref{line5}.
   This algorithm terminates because $\sprout^*_p(A,\vv{u})$ is either finite or its levels eventually repeat cyclically, as pointed out in \Cref{elementary2: R}\eqref{elementary2 periodic in e}.
   All of the considerations made in \Cref{m-primary algorithm: R} about the potential inefficiency and impracticality of the algorithm for the $\idealm$-primary case still apply in the general case.
\end{remark}

\begin{example}
   \label{ex: ft.5}
   \Cref{table: running example data} shows the data associated to the pair $(A,\vv{u})$ in our running example, whose sprouting subgraph is shown in \Cref{fig: sprouting graph}.
   \begin{table}
      \begin{center}
         \begingroup
         \setlength{\tabcolsep}{8pt} % Default value: 6pt
         \renewcommand{\arraystretch}{1.4} % Default value: 1
         \begin{tabular}{cccc}
           \toprule
           $e$ & $\epsilon_{p^e}(A,\vv{u})$ & $\delta_{p^e}(A,\vv{u})$ & $\val\IP_p(A,\vv{u},p^e)$ \\
           \midrule
           1 & $\frac{4}{17}$ & $\frac{10}{17}$ & $\frac{4}{17}p - \frac{10}{17}$\\
           2 & $\frac{10}{17}$ & $\frac{8}{17}$ & $\frac{4}{17}p^2 - \frac{8}{17}$ \\
           3 & $\frac{8}{17}$ & $\frac{20}{17}$ & $\frac{4}{17}p^3 - \frac{20}{17}$\\
           \bottomrule
         \end{tabular}
         \endgroup
         % The \begingroup ... \endgroup pair ensures the separation
         % parameters only affect this particular table, and not any
         % sebsequent ones in the document.
      \end{center}
      \caption{The data obtained for \Cref{ex: ft.5}}
      \label{table: running example data}
   \end{table}
   For any $e \ge 3$ we have
   \[
      \val\IP_p(A,\vv{u},p^e) = \frac{4}{17}p^e - \frac{20}{17}p^{e-3} + p^{e-3} - 1
       = \frac{4}{17}p^e - \frac{3}{17}p^{e-3}  - 1.
    \]
    If $(A,\vv{u})$ is associated to an ideal pair $(\ideala,\ideald)$, then
    \[\crit(\ideala,\ideald) = \frac{4}{17} - \frac{3}{17p^3}\]
    for sufficiently large $p$ congruent to $11$ modulo a universal denominator for~$A$.
\end{example}

\begin{example}
   \label{ex: new example.2}
   \Cref{table: new example data} shows the data associated to the pair $(A,\vv{u})$ in \Cref{ex: new example}, corresponding to the seven levels of the sprouting subgraph shown in \Cref{fig: sprouting graph 2}.
   \begin{table}
      \begin{center}
         \begingroup
         \setlength{\tabcolsep}{8pt} % Default value: 6pt
         \renewcommand{\arraystretch}{1.4} % Default value: 1
         \begin{tabular}{cccc}
           \toprule
           $e$ & $\epsilon_{p^e}(A,\vv{u})$ & $\delta_{p^e}(A,\vv{u})$ & $\val\IP_p(A,\vv{u},p^e)$ \\
           \midrule
           1 & $\frac{624}{773}$ & $\frac{680}{773}$ & $\frac{624}{773}p - \frac{680}{773}$\\
           2 & $\frac{773}{881}$ & $\frac{574}{881}$ & $\frac{624}{773}p^2 - \frac{1551}{681013}p - \frac{574}{881}$ \\
           3 & $\frac{574}{881}$ & $\frac{147}{881}$ & $\frac{624}{773}p^3 - \frac{1551}{681013}p^2 - \frac{147}{881}$ \\
           4 & $\frac{1}{25}$ & $\frac{11}{25}$ & $\frac{624}{773}p^4 - \frac{1551}{681013}p^3 - \frac{2794}{22025}p - \frac{11}{25}$ \\
           5 & $\frac{11}{25}$ & $\frac{21}{25}$ & $\frac{624}{773}p^5 - \frac{1551}{681013}p^4 - \frac{2794}{22025}p^2 - \frac{21}{25}$ \\
           6 & $\frac{21}{25}$ & $\frac{6}{25}$ & $\frac{624}{773}p^6 - \frac{1551}{681013}p^5 - \frac{2794}{22025}p^3 - \frac{6}{25}$ \\
           7 & $\frac{6}{25}$ & $\frac{16}{25}$ & $\frac{624}{773}p^7 - \frac{1551}{681013}p^6 - \frac{2794}{22025}p^4 - \frac{16}{25}$ \\
           8 & $\frac{16}{25}$ & $\frac{1}{25}$ & $\frac{624}{773}p^8 - \frac{1551}{681013}p^7 - \frac{2794}{22025}p^5 - \frac{1}{25}$ \\
           9 & $\frac{1}{25}$ & $\frac{11}{25}$ & $\frac{624}{773}p^9 - \frac{1551}{681013}p^8 - \frac{2794}{22025}p^6 - \frac{11}{25}$ \\
           \bottomrule
         \end{tabular}
         \endgroup
         % The \begingroup ... \endgroup pair ensures the separation
         % parameters only affect this particular table, and not any
         % sebsequent ones in the document.
      \end{center}
      \caption{The data obtained for \Cref{ex: new example.2}}
      \label{table: new example data}
   \end{table}
   For any $e\ge 4$ we have
   \[
      \val\IP_p(A,\vv{u},p^e) =
      \begin{cases}
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{21}{25} & \text{if $e \equiv 0 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{6}{25} & \text{if $e \equiv 1 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{16}{25} & \text{if $e \equiv 2 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{1}{25} & \text{if $e \equiv 3 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{1551}{681013}p^{e-1} - \frac{2794}{22025}p^{e-3} - \frac{11}{25} & \text{if $e \equiv 4 \bmod 5$}
      \end{cases}
   \]
   \endgroup
   If $(A,\vv{u})$ is associated to an ideal pair $(\ideala,\ideald)$, then
   \[\crit(\ideala,\ideald) = \frac{624}{773} - \frac{1551}{681013 p} - \frac{2794}{22025 p^3}\]
   for any sufficiently large prime $p$ congruent to $11$ modulo a universal denominator for $A$.
\end{example}

% \begin{example}
%    \label{ex: new example.2}
%    \Cref{table: new example data} shows the data associated to the pair $(A,\vv{u})$ in \Cref{ex: new example}, corresponding to the seven levels of the sprouting subgraph shown in \Cref{fig: sprouting graph 2}.
%    \begin{table}
%       \begin{center}
%          \begingroup
%          \setlength{\tabcolsep}{8pt} % Default value: 6pt
%          \renewcommand{\arraystretch}{1.4} % Default value: 1
%          \begin{tabular}{cccc}
%            \toprule
%            $e$ & $\epsilon_{p^e}(A,\vv{u})$ & $\delta_{p^e}(A,\vv{u})$ & $\val\IP_p(A,\vv{u},p^e)$ \\
%            \midrule
%            1 & $\frac{65}{112}$ & $\frac{101}{112}$ & $\frac{65}{112}p - \frac{101}{112}$\\
%            2 & $\frac{101}{112}$ & $\frac{57}{112}$ & $\frac{65}{112}p^2 -\frac{57}{112}$ \\
%            3 & $\frac{1}{2}$ & $\frac{1}{2}$ & $\frac{65}{112}p^3 - \frac{1}{112}p - \frac12$ \\
%            4 & $\frac{35}{72}$ & $\frac{31}{72}$ & $\frac{65}{112}p^4 - \frac{1}{112}p^2 - \frac{1}{72}p - \frac{31}{72}$ \\
%            5 & $\frac13$ & $\frac23$ & $\frac{65}{112}p^5 - \frac{1}{112}p^3 - \frac{1}{72}p^2 - \frac{7}{72}p -\frac23$ \\
%            6 & $\frac23$ & $\frac13$ & $\frac{65}{112}p^6 - \frac{1}{112}p^4 - \frac{1}{72}p^3 - \frac{7}{72}p^2 -\frac13$ \\
%            7 & $\frac13$ & $\frac23$ & $\frac{65}{112}p^7 - \frac{1}{112}p^5 - \frac{1}{72}p^4 - \frac{7}{72}p^3 -\frac23$ \\
%            \bottomrule
%          \end{tabular}
%          \endgroup
%          % The \begingroup ... \endgroup pair ensures the separation
%          % parameters only affect this particular table, and not any
%          % sebsequent ones in the document.
%       \end{center}
%       \caption{The data obtained for \Cref{ex: new example.2}}
%       \label{table: new example data}
%    \end{table}
%    For any $e\ge 5$ we have
%      \[
%       \val\IP_p(A,\vv{u},p^e) =
%       \begin{cases}
%          \frac{65}{112}p^e - \frac{1}{112}p^{e-2} - \frac{1}{72}p^{e-3} - \frac{7}{72}p^{e-4} - \frac23 & \text{if $e$ is odd}\\
%          \frac{65}{112}p^e - \frac{1}{112}p^{e-2} - \frac{1}{72}p^{e-3} - \frac{7}{72}p^{e-4} - \frac13 & \text{if $e$ is even}
%       \end{cases}
%    \]
%    If $(A,\vv{u})$ is associated to an ideal pair $(\ideala,\ideald)$, then
%    \[\crit(\ideala,\ideald) = \frac{65}{112} - \frac1{112 p^2} - \frac1{72 p^3} - \frac7{72 p^4} \]
%    for any sufficiently large prime $p$ congruent to $5$ modulo a universal denominator for $A$.
% \end{example}

\subsection{Concerning non-leading coefficients}

We now address the nonpositivity of the non-leading coefficients, claimed in \Cref{main theorem wrt diagonal: T}.

\begin{lemma}
   \label{non-leading coefficients: L}
   If $(B, \vv{v})$ is a $p$-sprout of $(A, \vv{u})$, then
   \[
      \udeficit(A, \vv{u}, p) \geq \ft{B}{\vv{v}}
   \]
   with equality if $A$ is a monomial matrix associated to an $\idealm$-primary monomial ideal that is generated by monomials of the same degree, with respect to some positive $\ZZ$-grading.
\end{lemma}

% \pedro[inline]{
%    Here, we don't really just mean homogeneous, but actually generated by monomials of the same degree.
% \daniel[inline]{You are right. I updated the statement.}
% }

\begin{proof}
   Let $\N$ be the Newton polyhedron of $A$, let an overbar denote collapse along $\O=\mf(A,\vv{u})$, and choose a point~$\defpt$ that defines the face $\O$ in $\N$.
   By definition, $B$ is the collapse of $A$ along $\O$, and $\vv{v} \in \ushort(A,\vv{u},p)$.
   \Cref{collapse of Newton polyhedron: P} tells us that $\collapse{\O}$ is a face of $\collapse{\N}$, the Newton polyhedron of $B=\collapse{A}$, defined in $\collapse{\N}$ by the collapsed point $\collapse{\vv{c}}$.
   \Cref{FT descriptions: P}\ref{lambda} then shows that $\frac1{\ft{B}{\vv{v}}}\cdot \vv{v} \in \collapse{\N}$, so by \Cref{alpha=1: convention} we have $\iprod{\collapse{\vv{c}}}{\vv{v}} \ge \ft{B}{\vv{v}}$.
   But since $\vv{v} \in \ushort(A, \vv{u}, p)$, we may write $ \vv{v} = B \tail{\vv{s}}_p - B \vv{h}$ for some $\vv{s} \in \sp_{\QQ}(A, \vv{u})$ and $\vv{h}$  optimal for $\ip = \ip(A, \vv{u}, \vv{s}, p)$, and \eqref{bound in inner product: e} and \eqref{norm of tail: e} allow us to conclude that
   \[
      \ft{B}{\vv{v}} \le \iprod{\collapse{\defpt}}{\vv{v}} \leq \norm{\tail{\vv{s}}_p} - \val \ip= \udeficit(A, \vv{u}, p).
   \]

   We now address the last assertion.
   Suppose $A$ is associated to an $\idealm$-primary ideal $\ideala$ generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Then homogeneity implies that the convex hull of the columns of $A$ corresponding to monomials of degree $d$ is a proper face $\O$ of $\N$.
   The positivity of the grading implies that the point $\defpt$ defining this face must be positive.
   Thus, $\O$ must be bounded, and in particular, collapsing along $\O$ is simply the identity.
   Finally, the $\mathfrak{m}$-primary assumption further implies that $\mf(A, \vv{u}) = \O$ for every pair $(A,\vv{u})$.
   Given this, one may retrace the steps above to see that every inequality involving the inner product of $\defpt = \collapse{\defpt}$ with another point must be, in fact, an equality.
\end{proof}

\begin{proposition}
\label{non-leading coefficients: P}
The non-leading coefficients appearing in the polynomial expressions described in \Cref{main theorem wrt diagonal: T} are rational and nonpositive.
\end{proposition}

\begin{proof}
   Fix a pair $(A,\vv{u})$, and set $\Q=\Q_p(A,\vv{u})$.
   By \Cref{main theorem wrt diagonal: T}, the non-leading coefficients under consideration are the rational numbers $-(\delta_{q}(A,\vv{u})-\epsilon_{qp}(A,\vv{u}))$ whenever $q < \Q$, the rational number $-(\delta_{\Q}(A,\vv{u}) - 1)$ whenever $\Q$ is finite, the rational numbers $-\delta_q(A,\vv{u})$ whenever $q\le \Q$, and $-1$.

   The proofs that the coefficients of the first and second type are nonpositive are similar, so we will only consider the coefficients of the second type.
   Toward this, suppose that $\Q$ is finite.
   In this case, $\S^{\ast}_{\Q p}(A,\vv{u})$ is empty, and so there is an edge $(B,\vv{v}) \to (C,\vv{z})$ in $\sprout_p(A)$ whose initial pair lies in $\S^{\ast}_{\Q}(A,\vv{u})$, and whose terminal pair is not very small. \Cref{non-leading coefficients: L} then tells us that $\delta_{\Q}(A,\vv{u}) = \udeficit(B,\vv{v},p)$ is at least $\ft{C}{\vv{z}}$, which is greater than $1$ as $(C,\vv{z})$ is not very small.
   Thus, $-(\delta_\Q(A,\vv{u})-1)$ is negative.
\end{proof}

\subsection{Critical exponents versus $F$-thresholds}
\label{crit versus ft: SS}

Let us now investigate what \Cref{main theorem wrt diagonal: T} tells us about the the difference between critical exponents and $F$-thresholds of monomial ideals, at least from the perspective of reduction to sufficiently large prime characteristic.
Recall that if $\ideala$ and $\idealb$ are ideals in an $F$-finite regular ring, then whenever these numbers are defined, the critical exponent of $\ideala$ with respect to $\idealb$ is at most the $F$-threshold $\ideala$ with respect to $\idealb$, and both are known to be rational \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}.

Suppose that $p \gg 0$ so that the conclusions of \Cref{main theorem wrt diagonal: T} hold for some fixed monomial~matrix~$A$.  Consider a very small monomial pair $(A,\vv{u})$, associated to an ideal pair $(\ideala,\ideald)$, and set $\Q = \Q_p(A,\vv{u})$.
If $\Q$ is infinite, then  \Cref{main theorem wrt diagonal: T} implies that
% \pedro[inline]{
%    I don't think we defined $\crit(A,\vv{u})$.
%    Should we?
%    Or should we simply use $\crit(\ideala,\ideald)$?  \daniel[inline]{The second option is OK, but we haven't introduced the ideal pair at this point}
%    \pedro[inline]{
%       I modified things, going with algebraic notation wherever possible.
%       Not sure if I like the mixed notation, as in \eqref{eq: crit infinite case}.
%       Maybe we should just define $\crit(A,\vv{u})$.
%    }
% }
\begin{equation}\label{eq: crit infinite case}
\crit(\ideala,\ideald)=\ft{\ideala}{\ideald} - \sum_{s=1}^{\infty} \frac{\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})}{p^s}.
\end{equation}
In this case, \Cref{elementary2: R}\eqref{elementary2 periodic in e} implies that the terms $\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})$ are eventually periodic in $s$, which demonstrates that $\crit(\ideala,\ideald)$ is rational.

On the other hand, when $\Q$ is finite, \Cref{main theorem wrt diagonal: T} instead implies that
\begin{align*}
\crit(\ideala,\ideald)& = \frac{\mu(\ideala,\ideald, \Q) +1}{\Q} \\
& = \ft{\ideala}{\ideald} -  \sum_{1 \leq s < \log_p \Q} \frac{\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})}{p^s} -  \frac{ \delta_{\Q}(A,\vv{u})-1}{\Q}
\end{align*}
and so $\crit(\ideala,\ideald)$ is again rational, with denominator a power of $p$.

Thus, if $p \gg 0$ and $(A,\vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$, then
\[ \ft{\ideala}{\ideald} - \crit(\ideala, \ideald) = \sum_{s=1}^{\infty} \frac{ \sigma_{p^s}(\ideala,\ideald)}{p^s} \]
where $\{ \sigma_{p^e}(\ideala,\ideald) \}_{e=1}^{\infty}$ is a sequence of nonnegative rational numbers that is eventually periodic, and depends on the pair $(A,\vv{u})$ and on the class of $p$ modulo any universal denominator for $A$, but not on the value of $p$ itself.

\begin{remark}
   Consider a very small pair $(A,\vv{u})$ associated to an ideal pair $(\ideala,\ideald)$, where $\ideala$ is an $\idealm$-primary ideal generated by monomials of the same degree $d$ under some positive $\ZZ$-grading, as in \Cref{ex: m-primary homogeneous case}.
   \Cref{non-leading coefficients: L} shows that the terms $\delta_{p^s}(A,\vv{u})-\epsilon_{p^{s+1}}(A,\vv{u})$ appearing in \eqref{eq: crit infinite case} are all zero.
   Thus, for sufficiently large $p$, $\crit(\ideala,\ideald)$ is either equal to $\ft{\ideala}{\ideald} = \deg \vv{u}/d$, if $\Q=\Q(A,\vv{u})$ is infinite, or it is a rational number with denominator a power of $p$ otherwise.
   To make this more explicit, note that $d$ is a universal denominator for $A$, as shown in \Cref{ex: m-primary homogeneous case 2}, and hence a denominator for $\delta_\Q(A,\vv{u})$.
   Thus, we have
   \[\crit(\ideala,\ideald) = \frac{\deg \vv{u}}{d} - \frac{r}{d\Q},\]
   where $r$ is a positive integer congruent to $\Q\deg\vv{u}$ modulo $d$.
   This explains the form of the various formulas obtained by the authors in \cite[Theorems~3.6, 4.8, and~5.5]{hernandez+etal.frobenius_examples}.
%    \pedro[inline]{Daniel: is this what you had in mind, or did you want to say more?
%       \daniel[inline]{All I would add is that in the second case, the critical exponent looks like $\ft{A}{\vv{u}}-r/\Q$ with $r \in \QQ$ is such that this fraction is an integer divided by $\Q$.  Really, I just wanted to explain why all of the critical exponents in our Examples paper looked the way they did.  There aren't any weird intermediate terms there in the case that a critical exponent is not the $F$-threshold.  Is this worth mentioning?}
%       \pedro[inline]{
%          I think so, and gave it a shot above.
%       }
%    }
   % \pedro[inline]{Maybe we could bring up this case more often throughout the paper; \eg as an example when introducing minimal face, universal denominator, etc. \emily[inline]{Sure}}
\end{remark}
% \daniel[inline]{Summarize what the constant terms are.  Namely, $-\delta_{p^e}(A,\vv{u})$ and $-1$.  This will come up when looking at the roots of the BS-polynomials}
% \emily[inline]{See below.}
% \daniel[inline]{Thanks.}


\todo[inline]{
   Find appropriate places for the next statement.  Proof calls upon \Cref{non-leading coefficients: L}.
}



%\newpage
%
%\section{Applications to generic hypersurfaces}
%
%\subsection{Generic hypersurfaces in large characteristics}
%
%
%\begin{theorem}  Given a collection of non-constant monomials $\mathcal{M}$, there exists $\beta = \beta(\mathcal{M})$ with the following property:  If $p > \beta$, then the test ideals of a generic polynomial over a field of characteristic $p$ supported at $\mathcal{M}$
%
%\end{theorem}
%
%\subsection{Generic hypersurfaces in characteristic zero}

\begin{proposition}
   Given a monomial matrix $A$, fix a universal denominator $\denom$ for all the descendants of $A$ \textup(\eg take the least common multiple of universal denominators of each of its finitely many descendants\textup).
   Then there exists $\beta = \beta(A)$ such that whenever $p>\beta$ and $p \equiv 1 \bmod \denom$,
\[
 \val\IP_p(A,\vv{u},p^e) = (p^e-1) \cdot \ft{A}{\vv{u}}
\]
for every very small $A$-pair $(A, \vv{u})$, and all $e \geq 1$.
In particular, for such $p$ we have $\crit(A,\vv{u}) = \ft{A}{\vv{u}}$.
\end{proposition}

% \pedro[inline]{
%    I modified the statement, replacing $\mu$ with $\val\IP_p$, to be consistent with previous theorems.
%    However, we should think if we want to state these big theorems in terms of $\mu(\ideala,\ideald,p^e)$ instead.
% }
\begin{proof}
We first prove the following claim:

\begin{claim}
   If $B$ is a descendant of $A$, $(B, \vv{v})$ is a very small pair, and $p \equiv 1 \bmod d$, then $\udeficit(B, \vv{v}, p) = \ft{B}{\vv{v}}$.
\end{claim}

Let $\vv{s}$ be a special point for $(B, \vv{v})$ with denominator $\denom$, so that $\norm{\vv{s}} = \ft{B}{\vv{v}} \leq 1$, and $\vv{s} = \vv{t}/\denom$, where $\vv{t}$ has nonnegative integer coordinates bounded above by $\denom$.
Since $p \equiv 1 \bmod \denom$, this means that $\tail{s_i}_p$ equals $\lpr{t_i p}{d}/d = t_i/d$ if $s_i \neq 0$, and equals $0$ otherwise; \ie $\tail{\vv{s}}_p = \vv{s}$.
If $\Theta = \Theta(B, \vv{v}, \vv{s}, p)$, we have that $0 \leq \val \Theta < \norm{\vv{s}} = \ft{B}{\vv{v}} \leq 1$  by \Cref{bounded value: P}, forcing the value of the integer program $\Theta$ to be $0$.
Hence $\udeficit(B, \vv{v}, p) = \deficit \Theta = \norm{\vv{s}} - \val\Theta = \ft{B}{\vv{v}}$, proving the claim.\\[2mm]
Observe that if $(C, \vv{w})$ is a $p$-sprout of a pair $(B, \vv{v})$ as above, then $\ft{C}{\vv{w}} \leq \udeficit(B, \vv{v}, p) = \ft{B}{\vv{v}}$ by \Cref{non-leading coefficients: L} and the above claim, so that $(C, \vv{w})$ is also very small.
Hence $\S^\ast_{q}(A, \vv{u})$ is nonempty for every $q$, and consequently, $\Q(A,\vv{u})$ is infinite.

Fix $(B, \vv{v}) \in \S_{q}^\ast$ for some $q$, and let an overbar denote collapse along $\O = \mf(B, \vv{v})$.
The proof of the claim shows that a special point $\vv{s}$ for $(B,\vv{v})$ with denominator $\denom$ satisfies $\tail{\vv{s}}_p = \vv{s}$, and $\vv{0} \in \opt \Theta(B,\vv{v},\vv{s},p)$.
Hence $\overline{\vv{v}} = \overline{B}\vv{s} = \overline{B}\tail{\vv{s}}_p - \overline{B} \, \vv{0} \in \ushort(B, \vv{v}, p)$, and $(\overline{B}, \overline{\vv{v}}) \in \S_{pq}(A, \vv{u})$.

The claim implies that $\S^\ast_{pq}(A, \vv{u})$ consists of the pairs in $\S_{pq}(A, \vv{u})$ with maximum $F$-threshold.
We know $\ft{\overline{B}}{\overline{\vv{v}}} = \ft{B}{\vv{v}}$ by \Cref{collapse of mf and mc: P}, and
that the $F$-threshold of any $p$-sprout of $(B, \vv{v})$ is bounded above by $\ft{B}{\vv{v}}$ by our earlier observation.
Hence $(\overline{B}, \overline{\vv{v}}) \in \S^\ast_{pq}(A, \vv{u})$.

Inductively, we conclude that for each $e\ge 1$, there exists a path $(A,\vv{u}) = (A_1,\vv{u}_1) \to \cdots \to (A_e,\vv{u}_e)$ in $\sprout^*(A,\vv{u})$, where each pair is the collapse of the previous one along its minimal face.
Consequently, $\udeficit(A_i,\vv{u}_i,p) = \ft{A_i}{\vv{u}_i} = \ft{A}{\vv{u}}$, for each $1\le i \le e$.
Then for each such $i$, $\epsilon_{p^i}(A,\vv{u}) = \delta_{p^i}(A,\vv{u}) = \ft{A}{\vv{u}}$, and the desired formula follows from
\Cref{main theorem wrt diagonal: T}.
% First, consider the following claim:
%
% \vspace{.2cm}
%
% \noindent \emph{Claim.} If $C$ is a descendant of $A$ and $(C, \vv{z})$ is a very small pair, then $\udeficit(C, \vv{z}, p) = \ft{C}{\vv{z}}$.
%
% \vspace{.2cm}
%
% Toward the claim, let $\vv{s}$ be a special point for $(C, \vv{z})$ with denominator $\denom$, so that $\norm{\vv{s}} = \ft{C}{\vv{z}} \leq 1$, and $\vv{s} = \vv{t}/\denom$, where $\vv{t}$ has nonnegative integer coordinates bounded above by $\denom$.
% Since $p \equiv 1 \bmod \denom$, this means that $\tail{s_i}_p$ equals $\lpr{t_i p}{d}/d = t_i/d$ if $s_i \neq 0$, and equals $0$ otherwise; \ie
% $\tail{\vv{s}}_p = \vv{s}$.
% If  $\Theta = \Theta(C, \vv{z}, \vv{s}, p)$, we have that $0 \leq \val \Theta < \norm{\vv{s}} = \ft{C}{\vv{z}} \leq 1$  by \Cref{bounded value: P}, forcing the value of the integer program $\Theta$ to be $0$.  Hence $\udeficit(C, \vv{z}, p) = \deficit \Theta = \norm{\vv{s}} - \val\Theta = \ft{C}{\vv{z}}$.
%
% Let $\lambda = \ft{A}{\vv{u}}$. We now proceed by induction to show that $\epsilon_{p^s}(A,\vv{u})  =  \delta_{p^s}(A,\vv{u}) = \lambda$ for all $s \geq 1$ (so that in particular, $\mathcal{Q}_p(A,\vv{u})$ is infinite).
% For $s=1$, notice that $\S_p^\ast = \{ (A, \vv{u} ) \}$, so that
% $\lambda = \epsilon_{p^s}(A,\vv{u}) = \delta_{p^s}(A,\vv{u})$ by the above claim.
%
% Suppose now that $\epsilon_{p^s}(A,\vv{u})  =  \delta_{p^s}(A,\vv{u}) = \lambda$ for some $s \geq 1$.  Take any $(B, \vv{v}) \in \S_{p^s}^\ast$, and let an overbar denote collapse along $\O = \mf(B, \vv{v})$.
% By \Cref{collapse of mf and mc: P},
% $\ft{\overline{B}}{\overline{\vv{v}}} = \ft{B}{\vv{v}}  = \lambda$, and
% noting \Cref{comparing deltas: R}, $\udeficit(\overline{B}, \overline{\vv{v}}, p) = \udeficit(B, \vv{v}, p) = \lambda$ as well.
%
% If $\vv{r}$ is a special point for $(\overline{B}, \overline{\vv{v}} )$, then $\vv{0}$ is feasible for $\Theta(B,\vv{v},\vv{r},p)$, as pointed out in the proof of \Cref{bounded value: P}.
% This means that $\overline{\vv{v}} = \overline{B}\vv{r} = \overline{B}\tail{\vv{r}}_p - \overline{B} \, \vv{0}$ is in $\ushort(B, \vv{v}, p)$, and so $(\overline{B}, \overline{\vv{v}}) \in \S_{p^{s+1}}(A, \vv{u})$.
%
% Given an arbitrary $p$-sprout $(\overline{B}, \vv{w})$ of $(B, \vv{v})$, we have that
% $\ft{\overline{B}}{\vv{w}} \leq
% \udeficit(B, \vv{v}, p) = \lambda$ by \Cref{non-leading coefficients: L},  and in particular, $(\overline{B}, \vv{w})$ is very small.
% Moreover, if $\ft{\overline{B}}{\vv{w}}$ achieves the maximum value among all such $p$-sprouts, namely $\lambda = \ft{\overline{B}}{\overline{\vv{v}}}$, then by our claim above,  $\udeficit(\overline{B},\vv{w},p) = \lambda = \udeficit(\overline{B}, \overline{\vv{v}}, p)$.
% Hence $(\overline{B}, \overline{\vv{v}}) \in \S_{p^{s+1}}^\ast(A, \vv{u})$,
% and since we have already found that $\ft{\overline{B}}{\overline{\vv{v}}} = \udeficit(\overline{B}, \overline{\vv{v}}, p)= \lambda$,
%  we conclude that
%  $\epsilon_{p^{s+1}}(A,\vv{u})  =  \delta_{p^{s+1}}(A,\vv{u}) = \lambda$, completing our inductive proof.
%
%
% Finally, after replacing each $\epsilon_{p^s}(A,\vv{u})$ and $\delta_{p^s}(A,\vv{u})$, for  $1 \leq s \leq e$, with $\lambda$ in the statement of
% \Cref{main theorem wrt diagonal: T}, we confirm that $\val \Pi_p(A, \vv{u}, p^e) = p^e \lambda - \lambda = (p^e-1)\lambda$, for all $p$ greater than some integer $\beta = \beta(A)$.
\end{proof}

% \pedro[inline]{
%    We can probably shorten the proof a bit:
%    First notice that the claim and \Cref{non-leading coefficients: L} imply that $p$-sprouts of very small pairs are themselves very small; in particular, $\S^*_q(A,\vv{u})$ is nonempty, for each $q$, and $\Q(A,\vv{u})$ is infinite.
%    Let $(B,\vv{v}) \in \S^*_q(A,\vv{u})$.
%    The proof of the claim shows that $(\collapse{B},\collapse{\vv{v}})$ is a $p$-sprout of $(B,\vv{v})$, and therefore an element of $\S_{pq}(A,\vv{u})$.
%    Now notice that the claim implies that a pair in $\S_{pq}(A,\vv{u})$ lies in $\S^*_{pq}(A,\vv{u})$ if and only if it has maximal $F$-threshold.
%    This observation, combined with \Cref{non-leading coefficients: L} and the claim, tells us that $(\collapse{B},\collapse{\vv{v}}) \in \S^*_{pq}(A,\vv{u})$.
%    This shows that for each $e\ge 1$ there exists a path $(A,\vv{u}) = (A_1,\vv{u}_1) \to \cdots \to (A_e,\vv{u}_e)$ in $\sprout^*(A,\vv{u})$ where each pair is the collapse of the previous one along its minimal face, and consequently $\udeficit(A_i,\vv{u}_i,p) = \ft{A_i}{\vv{u}_i} = \ft{A}{\vv{u}}$, for each $1\le i \le e$.
% }
% \emily[inline]{OK, I removed the explicit induction and pruned it down. Feel free to edit further if you see fit.}
% \pedro[inline]{Maybe add a quick corollary about crits?}

\section{Consequences on generic hypersurfaces} \label{generic-hypersurfaces: S}

\begin{remark}
\Cref{main theorem wrt diagonal: T} tells us that that under its assumptions, the constant term of $\val \IP_p(A,\vv{u},p^e)$ as a polynomial in $p$ is $- \delta_{p^e}(A,\vv{u})$ for
  $1 \leq e \leq \log_p \Q_p(A,\vv{u})$, and is $-1$ for $e > \log_p \Q_p(A,\vv{u})$.
\end{remark}

\appendix

\section{Monomial ideals and reduction}
\label{monomial-reduction: A}

\daniel[inline]{
\begin{enumerate}
\item  I changed the order of things here.  Can we talk about this more once everyone is able to take a look at the new organization?
\item I think that we should start the appendix with an overview, but I think we should discuss what we think the main points are first.  For me, the main point is \Cref{mon-operation-modulo-p: T}, which states that $\mon$ commutes with reduction modulo $p \gg 0$.  But, we should also maybe highlight \Cref{reduce-to-monomial-case: C,invariants associated to a monomial ideal in large characteristic: C}, since these are what we cite in the main part of the article.
\item We may want to carefully contrast \Cref{mon-operation-modulo-p: T} with \cite[Lemma 6.1]{budur+mustata+saito.roots_bs_polys_monomial}.  The BMS result is very closely related, and our proof follows the roadmap established by them, but fills in a lot of details (\eg BMS simply asserts \Cref{monomial-noetherian-decomposition: L} but doesn't give a proof), and also works in the full framework of reduction to prime characteristic.

However, we should also make clear that  \Cref{mon-operation-modulo-p: T} is not just a translation of BMS to this general framework.  The main mathematical merit of our generalization is that it concerns the $\mon$ operation in polynomial rings, while the BMS result concerns the $\mon$ operation (which they don't actually define) in a kind of odd way, and only in localizations of polynomial rings at the origin.
\end{enumerate}
}

\begin{definition}[The $\mon$ operator on ideals]
\label{monomialization: D}
If $T$ is a domain, and $I$ is an ideal of $T[x_1, \ldots, x_\numvars]=T[x]$, then $\mon(I)$ is the ideal of $T[x]$ generated by all monomials $x^{\vv{u}} \in T[x]$ such that there exists $0 \neq \tau \in T$ with the property that $\tau x^{\vv{u}} \in I$.% That is, \[ \mon(I) = \langle x^{\vv{u}}: x^{\vv{u}} \in I \rangle \subseteq \kk[x_1, \ldots, x_\numvars].\]
\end{definition}


\begin{remark}[A single multiplier $\tau$ suffices]
\label{single multiplier: R}
%Adopt the context of \Cref{monomialization: D}.
Clearly, if $T$ is a field, then $x^{\vv{u}} \in \mon(I)$ if and only if $x^{\vv{u}} \in I$.
On the other hand, if $T$ is a domain, but not a field, then one can find a single multiplier $0 \neq \tau \in T$ with the property that $x^{\vv{u}} \in \mon(I)$ if and only if $\tau x^{\vv{u}} \in I$ for every monomial $x^{\vv{u}} \in T[x]$.  Indeed, if $x^{\vv{u}_1}, \ldots, x^{\vv{u}_n}$ are a generating set for the monomial ideal $\mon(I)$, and $\tau_1, \ldots, \tau_n \in T$ are nonzero elements such that $\tau_i x^{\vv{u}_i} \in I$ for every $i$, then $\tau\coloneqq \tau_1 \cdots \tau_n$ does the trick.
\end{remark}

%\daniel[inline]{Add transition}
\subsection{Results in a fixed prime characteristic}
%\emily{Transition added}
Throughout this subsection, $\kk$ is a field of prime characteristic $p$ and $R=\kk[x_1,\ldots,x_\numvars]$.
Our main result here is \Cref{reduce-to-monomial-case: C}, which allows us to apply our results on arithmetic integer programs to compute the values $\mu(\ideala,\idealb,p^e)$, or the critical exponent $\crit(\ideala, \idealb)$, where $\ideala$ and $\idealb$ are nonzero proper ideals in $R$, with $\ideala$ a monomial ideal, and $\ideala \subseteq \sqrt \idealb$.
Indeed, \Cref{reduce-to-monomial-case: C} will show that one can compute these values after replacing $\idealb$ with $\mon(\idealb)$, and even with a diagonal ideal.

\begin{lemma}[$\mon$ commutes with standard Frobenius powers] \label{frobenius-powers+mon-commute: L}
   % Suppose that $\kk$ is a field of characteristic $p>0$.
   If $\idealb$ is an ideal of $R$,
   % $\kk[x_1, \ldots, x_\numvars] = \kk[x]$,
   then $\mon(\idealb^{[p^e]}) = \mon(\idealb)^{[p^e]}$ for every $e \in \NN$.
\end{lemma}

\begin{proof}
   Set $\idealc = \mon(\idealb)$ and $q=p^e$.
   As $\idealc^{[q]} \subseteq \idealb^{[q]}$, it follows that $\idealc^{[q]} = \mon(\idealc^{[q]}) \subseteq \mon(\idealb^{[q]})$.
   To prove the reverse containment, it suffices to prove that any monomial in $\idealb^{[q]}$ must lie in $\idealc^{[q]}$.

   Let $x^{\vv{u}} \in \idealb^{[q]}$, and write $\vv{u} = \vv{v}q + \vv{w}$, where $\vv{v}$ and $\vv{w}$ are points in $\NN^\numvars$, and $\vv{0} \leq \vv{w} < \vv{1}q$.
   As $x^{\vv{u}} = x^{\vv{v}q} x^{\vv{w}} \in \idealb^{[q]}$, the fact that
   %$\kk[x]$ is free over $\kk[x]^q$
   $R$ is free over $R^q$ implies that $x^{\vv{w}} \in ( \idealb^{[q]}: x^{\vv{v}q}) = (\idealb:x^{\vv{v}})^{[q]}$.
   Applying the $q$-th root operation to this inclusion then shows that $\langle 1 \rangle = \langle x^{\vv{w}} \rangle^{[1/q]}  \subseteq (\idealb: x^{\vv{v}})$,  where the first equality follows from the bounds on $\vv{w}$ noted above.   Therefore, $x^{\vv{v}} \in \idealb$, so $x^{\vv{v}} \in \mon(\idealb) = \idealc$, and we conclude that $x^{\vv{u}} \in \langle x^{\vv{v}q} \rangle \subseteq \idealc^{[q]}$.
\end{proof}

% \pedro[inline]{
%    We can also make the argument more explicit (but longer) and avoid $[1/q]$-th powers:
%    As $x^{\vv{u}} = x^{\vv{v}q} x^{\vv{w}} \in \idealb^{[q]}$, we can write
%    \[x^{\vv{v}q} x^{\vv{w}} = \sum_i f_i g_i^q\]
%    for some $f_i \in R$ and $g_i \in \idealb$.
%    Observing that $x^{\vv{w}}$ is part of a basis for $R$ over $R^q$, for each $i$ let $a_i^q\in R^q$ be the $x^\vv{w}$-coordinate of $f_i$ in that basis.
%    Comparing $x^\vv{w}$-coordinates in the above equation we see that
%    \[x^{\vv{v}q} = \sum_i a_i^q g_i^q\]
%    and taking $q$-th roots we see that $x^\vv{v} \in \idealb$.
% }

\begin{lemma}
   \label{quasi-diagonal to diagonal: L}
   % Suppose that $\kk$ is a field of characteristic $p>0$, and that
   Suppose $\ideala$ and $I$ are nonzero proper ideals of 
   %$\kk[x_1, \ldots, x_\numvars]$,
   $R$, where $\ideala$ is a monomial ideal, $I$ is generated by positive powers of a proper subset of the variables, and $\ideala \subseteq \sqrt{I}$.
   Then there exists a diagonal ideal $\ideald$ in
   % $\kk[x_1, \ldots, x_\numvars]$
   $R$ associated to a positive point in $\NN^\numvars$ such that $\mu(\ideala, I, p^e) = \mu(\ideala, \ideald, p^e)$ for every natural number $e$.
\end{lemma}

\begin{proof}
   Reordering the variables, if necessary, we may assume that $I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$, where $1 \leq t < \numvars$ and $w_i > 0$ for each $i$.
   Let $A$ be a monomial matrix associated to $\ideala$, and let $B$ be the matrix consisting of the first $t$ of the $\numvars$ rows of $A$.
   Since $\ideala \subseteq \sqrt I = \ideal{x_1, \ldots, x_t}$, every monomial generator of $\ideala$ is divisible by some $x_i$ with $1 \leq i \leq t$, and thus every column of the truncated matrix $B$ is nonzero.
   Hence $B$ is a monomial matrix, and so if we define $\vv{w} = (w_1, \ldots, w_t) \in \NN^t$, it follows that the feasible set of the linear program $\LP(B, \vv{w})$ is compact.
   Therefore, there exists a positive integer $M$ such that the inner product of the $i$-th row of $A$ and any point in $\feas \LP(B, \vv{w})$ is less than $M$ for each $t < i \leq m$.

   Let $\vv{u} = (\vv{w},M,\ldots,M)\in \NN^\numvars$.
   We claim that the feasible sets of the arithmetic integer programs $\IP_p(A,\vv{u},p^e)$ and $\IP_p(B,\vv{w},p^e)$ coincide for each~$e$.
   Indeed, each linear constraint of $\IP_p(B, \vv{w}, p^e)$ is a constraint of $\IP_p(A, \vv{u},p^e)$, each additional linear constraint of $\IP_p(A, \vv{u},p^e)$ is automatically satisfied on $\IP_p(B, \vv{w},p^e)$ by our choice of $M$, and the arithmetic constraints of these programs are identical.
   Now, if $\ideald$ is the diagonal ideal associated to the point $\vv{u}$, then
   \[
     \mu(\ideala, I, p^e) = \val\IP_p(B, \vv{w}, p^e)  = \val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e)
  \]
  for every $e$.
\end{proof}

\begin{theorem}
   \label{reduce-to-monomial-case: C}
   %Suppose that $\kk$ is a field of characteristic $p>0$, and that
   Suppose $\ideala$ and $\idealb$ are nonzero proper ideals of
   % $\kk[x_1, \ldots, x_\numvars]$
   $R$ with $\ideala$ a monomial ideal and $\ideala \subseteq \sqrt{\idealb}$.
   If we set $\idealc = \mon(\idealb)$,  then there exists a diagonal ideal $\ideald$ in
   % $\kk[x_1, \ldots, x_\numvars]$
   $R$ associated to a positive point in $\NN^\numvars$ such that $\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e) = \mu(\ideala, \ideald, p^e)$ for every natural number $e$.  In particular, $\crit(\ideala,\idealb) = \crit(\ideala, \idealc) = \crit(\ideala, \ideald)$.
\end{theorem}

\begin{proof}
   Since $\ideala$ is a monomial ideal, a Frobenius power of $\ideala$ sits in $\idealb^{[p^e]}$ if and only if it sits in $\mon(\idealb^{[p^e]})$, which equals $\idealc^{[p^e]}$ by \Cref{frobenius-powers+mon-commute: L}.
   Thus, \[\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e)\text{ for every $e\in \NN$.}\]
   Next, recall that the monomial ideal $\idealc = \mon(\idealb)$ can be written as an intersection $\idealc = I_1 \cap \cdots \cap I_n$, where each $I_i$ is generated by some subset of the variables raised to positive powers (see, \eg \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA}).
   Thus, as $\idealc^{[p^e]} = I_1^{[p^e]} \cap \cdots \cap I_n^{[p^e]}$, 
   \[
      \mu(\ideala, \idealc, p^e) = \max\{\mu(\ideala, I_i, p^e): 1\le i\le n\}\text{ for every $e\in \NN$}.
   \]
   By \Cref{quasi-diagonal to diagonal: L}, the above remains true after replacing each $I_i$ with a suitable diagonal ideal $\ideald_i$ associated to a positive point of $\NN^\numvars$.
   Furthermore, though the $\ideald_i$ that achieve the maximum may vary with $e$, \Cref{cor: mu comparison} guarantees that there exists an ideal $\ideald$ among the $\ideald_i$ such that
   \[\mu(\ideala, \idealc, p^e) = \mu(\ideala, \ideald, p^e)\text{ for every $e\in \NN$}.\qedhere\]
\end{proof}

% \begin{proof}
%    As $\ideala$ is monomial, a Frobenius power of $\ideala$ sits in $\idealb^{[p^e]}$ if and only if it sits in $\mon(\idealb^{[p^e]})$, which equals
% $\idealc^{[p^e]}$ by \Cref{frobenius-powers+mon-commute: L}.  Thus, \[\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e).\]

% Next, recall that the monomial ideal $\idealc = \mon(\idealb)$ can be written as an intersection $\idealc = I_1 \cap \cdots \cap I_n$, where each $I_i$ is generated by some subset of the ambient variables raised to positive powers (\eg see \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA}).  Thus, as $\idealc^{[p^e]} = I_1^{[p^e]} \cap \cdots \cap I_n^{[p^e]}$, it follows that $\mu(\ideala, \idealc, p^e)$ is the maximum among the  $\mu(\ideala, I_i, p^e)$.    Furthermore, though the ideals that achieve this maximum may vary as $e$ grows, \Cref{cor: mu comparison} guarantees that there exists an ideal $I$ among the $I_i$ such that $\mu(\ideala, \idealc, p^e) = \mu(\ideala, I, p^e)$ for every $e$.
% \pedro{
%    Here we are using a result about $\mu$'s with respect to diagonal ideals (associated to positive points).
%    It seems that we need to do the reduction to diagonal ideals that is done below beforehand.
%    Maybe in a lemma?
% }
% After possibly reordering the variables,  we may assume that there exists $1 \leq t \leq \numvars$ and positive integers $w_i$ for each $1 \leq i \leq t$ such that $I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$.

% Let $A$ be a monomial matrix associated to $\ideala$, which necessarily has $m$ rows, and let $B$ be the matrix consisting of the first $t$ rows of $A$.  If some column of the truncated matrix $B$ were zero, then some monomial generator of $\ideala$ would not be divisible by $x_i$  for all $1 \leq i \leq t$, which is impossible, since  $\ideala \subseteq \idealc \subseteq I = \ideal{x_1^{w_1}, \ldots, x_t^{w_t}}$ and each $w_i$ is positive. Hence $B$ is a monomial matrix,  and so if we define $\vv{w} = (w_1, \ldots, w_t) \in \NN^t$,   it follows that the feasible set of the linear program $\LP(B, \vv{w})$ is compact.  Therefore, there exists a positive integer $M$ such that the inner product of the $i$-th row and any point in the feasible set of $\LP(B, \vv{w})$ is less than $M$ for each $t < i \leq m$.

% Let $\vv{u} \in \NN^n$ be the vector whose $i$-th coordinate is $w_i$ for $1 \leq i \leq t$, and is $M$ for $t < i \leq \numvars$.  We claim that the feasible sets of the arithmetic integer programs $\IP_p(A,\vv{u},p^e)$ and $\IP_p(B,\vv{w},p^e)$ agree for each natural number $e$.  Toward this,  note that the arithmetic constraints of these programs are identical, and also that the program $\IP_p(A, \vv{u}, p^e)$  has \emph{at least} as many linear constraints as $\IP_p(B, \vv{w},p^e)$, and so
% $\feas \IP_p(A, \vv{u}, p^e)$ lies in $\feas \IP_p(B, \vv{w}, p^e)$.

% Next, consider a point $\vv{k} \in \feas \IP_p(B, \vv{w},p^e)$.  Then, the normalized point $\vv{k}/p^e$ must lie in $\feas\LP(B,\vv{w})$, and so the inner product of $\vv{k}/p^e$ with the $i$-th row of $A$ is less than $M$ for each $t < i \leq m$.    Restated, the inner product of $\vv{k}$ with the $i$-th row of $A$ is less than $u_ip^e = Mp^e$ for each $t < i \leq m$, while the feasibility of $\vv{k}$ for $\IP_p(B,\vv{w},p^e)$ implies that the inner product of the $i$-th row of $A$ is less than $w_ip^e = u_ip^e$ for $1 \leq i \leq t$.  In other words, $A \vv{k} < \vv{u}p^e$, which implies that $\vv{k} \in \feas \IP_p(A,\vv{u},p^e)$, and establishes our claim.

% In summary, if $e$ is an arbitrary natural number, then
% \begin{align*}
%  \mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e) = \mu(\ideala, I, p^e) & = \val\IP_p(B, \vv{w}, p^e) \\
%  & = \val \IP_p(A, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e)
% \end{align*}
% where $\ideald$ is the diagonal ideal associated to the positive point $\vv{u} \in \NN^\numvars$.
% \end{proof}

\pedro[inline]{
   Perhaps we should add a remark saying that the analogous result for $\nu$s was proven in \cite[Section~4]{budur+mustata+saito.roots_bs_polys_monomial}.
} 
 
\subsection{Reduction to prime characteristic}

We now briefly recall the process of reduction to prime characteristic, at least in the context of polynomial rings.  To start, we recall some fundamental facts, both of which may be thought of as corollaries of Noether Normalization.  We provide references for their proofs, and also refer those unfamiliar with these statements to \cite[Chapter 3]{hernandez.thesis} for more details.
% \daniel[inline]{This is my thesis.  Should we cite something more official?   I don't have any books here in El Paso, but I think that at least generic freeness appears in Matsumura, but maybe in an unrecognizable form.}
% \pedro[inline]{
%    Maybe we can cite both your thesis (which is a nice place to find everything) and some more official reference?
%    Generic freeness is Theorem~24.1 in Matsumura. (It's a little more general, but recognizable.)
%    The result in the second remark can be found in Bourbaki, Commutative Algebra, V.3.4, Corollary 1.
% }

\begin{remark}[Generic freeness; see {\cite[Theorem~24.1]{matsumura}}] \label{generic-freeness}
   Suppose that $A$ is a Noetherian domain,  and that $S$ is a finitely generated $A$-algebra.
   Generic freeness states that if $M$ is a finitely generated $S$-module, then there exists  $0 \neq \ell \in A$ such that $A[\ell^{-1}] \otimes_A M$, the localization of $M$ at $\ell$, is free as a module over $A[\ell^{-1}]$.
\end{remark}

\begin{remark}[On maximal ideals; see {\cite[V.3.4, Corollary~1]{bourbaki.commalg}}]
   \label{maximal ideals: R}
   Suppose that $A$ is a domain of characteristic zero that is finitely generated as an algebra over $\ZZ$.
   Then every maximal ideal of $A$ contains a positive prime integer, and all but finitely many such prime integers are contained in some maximal ideal of $A$.
   Furthermore, the quotient of $A$ by any maximal ideal is a finite field.
\end{remark}

\begin{remark}[Reduction to prime characteristic]
   \label{reduction: R}
   Let $R = \kk[x_1, \ldots, x_\numvars]$ be a polynomial ring over a field $\kk$ of characteristic zero.
   If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$, then we set $R_A=A[x_1, \ldots, x_\numvars]$, and if $I$ is an ideal of $R$, then $I_A$ denotes any ideal of $R_A$ that extends to $I$ under the inclusion $R_A \hooklongrightarrow R$, provided such an ideal exists.
   In this case, we call $I_A$ an $A$-model of $I$.\footnote{Observe that every ideal $I$ of $R$ has an $A$-model for a suitable $A$; indeed, one may take $A$ to be the $\ZZ$-subalgebra of $\kk$ generated by the finitely many coefficients in $\kk$ appearing in some finite ideal-generating set for $I$.}

   Suppose that $I$ and $A$ are as above, and that $I_A$ exists.
   If $\idealm \in \mspec(A)$, then $I_A(\idealm)$ is the extension of $I_A$ to $R_{A}(\idealm) \coloneqq A/\idealm[x_1, \ldots, x_\numvars]$ under the quotient map $R_A \longrightarrow R_A(\idealm)$.
   As noted in \Cref{maximal ideals: R}, the finite generation of $A$ over $\ZZ$ implies that $A/\idealm$ is a finite field, and for this reason, we may regard $I_A(\idealm)$ as a prime characteristic model of~$I$.
   Furthermore, as the point $\idealm \in \mspec(A)$ varies, we obtain models $I_A(\idealm)$ of $I$ over finite fields of all but finitely many characteristics.
\end{remark}

This process greatly simplifies in the special case that $\kk=\QQ$.  Indeed, every ideal $I$ of $R=\QQ[x_1, \ldots, x_\numvars]$ is generated by a set $G$ of polynomials with integer coefficients.  Given such a generating set, we may then take $A=\ZZ$, and let $I_A$ be the ideal generated by $G$ in $R_A=\ZZ[x_1, \ldots, x_\numvars]$.  If  $\idealm$ is the maximal ideal of $A=\ZZ$ generated by a prime integer $p$, then $I_A(\idealm)$ is the ideal of $R_A(\idealm) = \FF_p[x_1, \ldots, x_\numvars]$  generated by the image of $G$.

It is also easy to talk about reduction to prime characteristic for monomial ideals:
If $\kk$ is a field of characteristic zero, and $I$ is a monomial ideal in $R=\kk[x_1, \ldots, x_\numvars]$ generated by a collection of monomials $G$, then $I_A = GR_A = GA[x_1, \ldots, x_\numvars]$ is a canonical $A$-model for every finitely generated $\ZZ$-subalgebra $A$ of $\kk$, and $I_A(\idealm) = GR_A(\idealm)$ for every $\idealm \in \mspec(A)$.

In this subsection, we shall need to work with arbitrary $A$-models for an ideal $I \subseteq R$, even when $I$ is monomial and, as described above, has a canonical $A$-model.  As we see below, non-canonical models may have certain undesirable qualities, after reduction to low characteristic.

\begin{example}
Consider the ideals $I=\langle x, y \rangle \in \QQ[x,y]$ and $I_{\ZZ} = \langle 2x, 3x+y \rangle \subseteq \ZZ[x,y]$.  Clearly, though $I_{\ZZ}$ is a $\ZZ$-model for $I$, it is a bit of an unusual choice of one.
Regardless, if we reduce $I_{\ZZ}$ modulo $2$, we get the ideal $\langle x+y \rangle \subseteq \FF_2[x,y]$, which is not monomial, and in fact contains no monomials.  Fortunately, if we instead reduce $I_{\ZZ}$ modulo any prime $p \neq 2$, then we get $\langle x, y \rangle \subseteq \FF_p[x,y]$.
\end{example}

In \Cref{expansion of monomial mod most p is monomial: C} below, we see that the behavior suggested by this example holds more generally.  That is, even if one starts with a non-monomial model, most reductions of a monomial ideal to prime characteristic will be monomial.

We start with a useful technical lemma.

\begin{proposition}
   \label{comparing expansions:  P}
   Suppose $A$ is a Noetherian domain.
   Given ideals $I \subseteq J$ of $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A\setminus\{0\}$ and $\rho \in \NN \cup \{ \infty \}$ with the following property\textup:
   If $B$ is any $A[\ell^{-1}]$-algebra, then $B \otimes_A (J/I) \cong JB[x]/IB[x]$, and this is a free $B$-module of rank $\rho$.
   In particular, $IB_{\circ}[x]=JB_{\circ}[x]$ for some particular $A[\ell^{-1}]$-algebra $B_{\circ}$ if and only if $IB[x]=JB[x]$ for every $A[\ell^{-1}]$-algebra $B$.
\end{proposition}

\begin{proof}
   \pedro{Shortened this proof a bit. The old one was commented out.}
   Localizing the exact sequence $0 \to I \to J \to J/I \to 0$ of finitely generated $A[x]$-modules at $\ell \in A \setminus \{0\}$, we obtain the exact sequence of $A[\ell^{-1}]$-modules
   \[0 \to A[\ell^{-1}] \otimes_A I \to A[\ell^{-1}] \otimes_A J \to A[\ell^{-1}] \otimes_A (J/I) \to 0.\]
   By generic freeness we may choose $\ell$ so that $A[\ell^{-1}] \otimes_A (J/I)$ is a free $A[\ell^{-1}]$-module of rank $0 \leq \rho \leq \infty$, so the localized sequence is split exact.
   As split exactness is preserved by base change, if $B$ is an $A[\ell^{-1}]$-algebra, then tensoring with $B$ over $A[\ell^{-1}]$ gives the split exact sequence of $B$-modules 
   \begin{equation}
      \label{eq: exact seq}
      0 \to B \otimes_A I \to B \otimes_A J \to B \otimes_A (J/I) \to 0
   \end{equation}
   that terminates on a free $B$-module of rank $\rho$.
   In particular, the inclusion $I \subseteq J$ leads to an injection $B\otimes_A I \hookrightarrow B\otimes_A J$, and by replacing $\ell$ by a nonzero $A$-multiple, we may assume that this observation also holds for the inclusions $I\subseteq A[x]$ and $J \subseteq A[x]$.
   The injection $B\otimes_A I \hookrightarrow B\otimes_A A[x] \cong B[x]$ shows that $B \otimes_A I \cong I B[x]$.
   Likewise, $B \otimes_A J \cong JB[x]$, so \eqref{eq: exact seq} tells us that $B \otimes_A (J/I) \cong J B[x]/I B[x]$.
\end{proof}

% \begin{proof} Consider the exact sequence $0 \to J \to A[x] \to A[x]/J \to 0$ of finitely generated $A[x]$-modules.  This sequence remains exact when regarding its terms as $A$-modules, and as the localization $A[\ell^{-1}]$ of $A$ at $0 \neq \ell \in A$ is flat over $A$, we have that
% \[ 0 \to A[\ell^{-1}] \otimes_A J \to A[\ell^{-1}] \otimes_A A[x] \to A[\ell^{-1}] \otimes_A (A[x]/J) \to 0 \]
% is an exact sequence of $A[\ell^{-1}]$-modules.
% By generic freeness over $A$, we may assume that the last term is free over $A[\ell^{-1}]$.
% Thus, as it terminates on a free module, this sequence is a split exact sequence of $A[\ell^{-1}]$-modules, and as split exactness is preserved by base change, taking the tensor product of this sequence with an $A[\ell^{-1}]$-algebra $B$ over $A[\ell^{-1}]$ yields a split exact sequence  of $B$-modules
% %
% \[ 0 \to B \otimes_A J \to B \otimes_A A[x] \to B \otimes_A (A[x]/J) \to 0. \]
% %
% The middle term above is isomorphic to $B[x_1, \ldots, x_\numvars]=B[x]$,  and the first non-trivial map, which is injective, then identifies $B \otimes_A J$ with $JB[x]$.

% Next, consider the exact sequence $0 \to I \to J \to J/I \to 0$.  Once again, by generic freeness, after replacing $\ell$ with a nonzero $A$-multiple, we may also assume that
% %
% $0 \to A[\ell^{-1}] \otimes_A I \to A[\ell^{-1}] \otimes_A J \to A[\ell^{-1}] \otimes_A (J/I) \to 0$
% is a split exact sequence of $A[\ell^{-1}]$-modules that terminates on a free $A[\ell^{-1}]$-module of free rank $0 \leq \rho \leq \infty$.  Thus, if $B$ is an $A[\ell^{-1}]$-algebra, then
% %
% \[ 0 \to B \otimes_A I \to B \otimes_A J \to B \otimes_A (J/I) \to 0\]
% %
% is exact over $B$, and terminates on a free $B$-module of rank $\rho$.  However, we have already seen earlier that $B \otimes_A J \cong JB[x]$, from which it follows that the above exact sequence is isomorphic to the exact sequence
%  \[ 0 \to I  B[x] \to J B[x] \to  J B[x] /IB[x]  \to 0\]
%  of $B$-modules whose last term is free of rank $\rho$.
% \end{proof}

\begin{corollary}
\label{containment in radical mod p: C}
Let $\kk$ be a field of characteristic zero, and suppose that $I$ and $J$ are ideals of $R = \kk[x_1, \ldots, x_\numvars]$ with $I \subseteq \sqrt{J}$.  If $A$ is any finitely generated $\ZZ$-subalgebra of $\kk$ that supports models $I_A$ and $J_A$, then there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that $I_A(\idealm) \subseteq \sqrt{J_A(\idealm)}$ for every $\idealm \in \mathcal{U}$.
\end{corollary}

\begin{proof}
   Fix $t \in \NN$ such that $I^t \subseteq J$, and $\ell \in A \setminus \{0\}$ that satisfies the conclusion of \Cref{comparing expansions:  P} relative to the containment of ideals $J_A \subseteq I_A^t + J_A$ in $R_A$.
   As $R = \kk[x]$, we have $I_A^t \kk[x]  = I^t \subseteq J = J_A \kk[x]$, which is equivalent to $J_A \kk[x] = I_A^t \kk[x] + J_A \kk[x] = (I_A^t +J_A)\kk[x]$.
   Setting $B_{\circ} = \kk$ in \Cref{comparing expansions:  P}, we see that
%
\begin{equation}
\label{step in radical containment: e}
 J_A B[x] = (I_A^t +J_A)B[x]
\end{equation}
%
for every $A[\ell^{-1}]$-algebra $B$.

Next, let $\mathcal{U}$ denote the set of all points $\idealm \in \mspec(A)$ such that $\operatorname{char}(A/\idealm) \nmid \ell$.  Note that $\mathcal{U}$ is an open dense (\ie open and nonempty) subset of $\mspec(A)$.  If $\idealm \in \mathcal{U}$, then $A/\idealm$ is an $A[\ell^{-1}]$-algebra, and setting $B=A/\idealm$ in \eqref{step in radical containment: e} tells us that
%
$J_A (\idealm) = I_A(\idealm)^t + J_A(\idealm)$,
%
which implies that $I_A(\idealm)^t \subseteq J_A(\idealm)$.
\end{proof}

% \begin{proof}
%    Fix $t \in \NN$ such that $I^t \subseteq J$, and suppose that $0 \neq \ell \in A$ satisfies the conclusion of \Cref{comparing expansions:  P} relative to the containment of ideals $J_A \subseteq I_A^t + J_A$ in $R_A$.

% As $R=\kk[x_1, \ldots, x_\numvars] = \kk[x]$, we have that $I_A \kk[x] = I_A R = I$, and likewise, that $J_A\kk[x] = J$.  Therefore, the containment $I^t \subseteq J$ may be written as $I_A^t \kk[x] \subseteq J_A \kk[x]$
% %
% which is equivalent to the equality of ideals $J_A \kk[x] = I_A^t \kk[x] + J_A \kk[x] = (I_A^t +J_A)\kk[x]$.  Given this, we may then set $B_{\circ} = \kk$ in \Cref{comparing expansions:  P} to see that
% %
% \begin{equation}
% \label{step in radical containment: e}
%  J_A B[x] = (I_A^t +J_A)B[x]
% \end{equation}
% %
% for every $A[\ell^{-1}]$-algebra $B$.

% Next, let $\mathcal{U}$ denote the set of all points $\idealm \in \mspec(A)$ such that $\operatorname{char}(A/\idealm) \nmid \ell$.  Note that $\mathcal{U}$ is an open dense (\ie open and nonempty) subset of $\mspec(A)$.  If $\idealm \in \mathcal{U}$, then $A/\idealm$ is an $A[\ell^{-1}]$-algebra, and setting $B=A/\idealm$ in \eqref{step in radical containment: e} tells us that
% %
% $J_A (\idealm) = I_A(\idealm)^t + J_A(\idealm)$
% %
% which implies that $I_A(\idealm)^t \subseteq J_A(\idealm)$.
% \end{proof}

\begin{corollary}
   \label{expansion of monomial mod most p is monomial: C}
   Let $\kk$ be a field of characteristic zero, and suppose that $I$ is a monomial ideal of $R=\kk[x_1, \ldots, x_\numvars]$.
   If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$, then there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that $I_A(\idealm)$ is a monomial ideal for every $\idealm \in \mathcal{U}$.
\end{corollary}

%\daniel[inline]{FYI:  This argument should show that if $I_A$ and $I'_A$ are two different $A$-models for $I$, then their reductions modulo $\idealm$ agree for most $\idealm$}
\begin{proof}
   Let $G$ be a collection of monomials such that $I=G\kk[x]$.
   Then $GR_A$ and $L \coloneqq I_A + G R_A$ are also $A$-models of $I$, so that $I_A \kk[x] = L\kk[x] = G \kk[x] = I$.
   Choosing $\ell \in A \setminus \{0\}$ so that the conclusion of \Cref{comparing expansions:  P} holds for the containments $I_A \subseteq L$ and $GR_A \subseteq L$, \Cref{comparing expansions:  P} implies that
      \[
      I_A B[x] = L B[x] = G B[x]
   \]
 for every $A[\ell^{-1}]$-algebra $B$.    Thus, if $\mathcal{U} = \{ \idealm \in \mspec(A) : \operatorname{char}(A/\idealm) \nmid \ell \}$,  then for each $\idealm \in \mathcal{U}$, we may set $B=A/\idealm$ above to see that $I_A(\idealm) = G R_A(\idealm)$.
\end{proof}

\begin{proposition}
   \label{colon mod p: P}
   Let $A$ be a Noetherian domain.
   Given an ideal $J$ and an element $f$ of $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A \setminus \{0\}$ such that
   \[
      (J:_{A[x]} f)B[x] = (JB[x] :_{B[x]} f)
   \]
   for any $A[\ell^{-1}]$-algebra $B$.
\end{proposition}

\begin{proof}
   The argument of the proof of \Cref{comparing expansions:  P} applied to the exact sequence
    \[
       0 \to (J :_{A[x]} f) \to A[x] \stackrel{f}{\longrightarrow} (f A[x] + J)/J \to 0
    \]
    shows the existence of $\ell \in A \setminus \{0\}$ such that the sequence
    \[
       0 \to B \otimes_A (J :_{A[x]} f) \to B \otimes_A A[x] \stackrel{f}{\longrightarrow} B \otimes_A ((f A[x] + J)/J) \to 0
    \]
    is split exact for every $A[\ell^{-1}]$-algebra $B$.
    The isomorphism $B \otimes_A A[x] \cong B[x]$ induces an isomorphism between the above exact sequence and
    \[
       0 \to (J :_{A[x]} f) B[x] \to  B[x] \stackrel{f}{\longrightarrow} (f A[x] + J)B[x]/JB[x] \to 0
    \]
    and since the last term above equals $(fB[x] + JB[x])/JB[x]$, that sequence shows that $(J:_{A[x]} f)B[x] = (JB[x] :_{B[x]} f)$.
\end{proof}

% \begin{proof}
%     Consider the exact sequence
%     \[
%        0 \to (J :_{A[x]} f) \to A[x] \stackrel{f}{\longrightarrow} (f A[x] + J)/J \to 0
%     \]
%     of finitely generated $A[x]$-modules.
%     We may tensor this exact sequence of $A$-modules with the flat $A$-module $A[\ell^{-1}]$ over $A$ to obtain an exact sequence of $A[\ell^{-1}]$-modules, where $0 \neq \ell \in A$.
%     By generic freeness, we may assume that the last term in such a sequence is free over $A[\ell^{-1}]$, and so if we further tensor this sequence with an $A[\ell^{-1}]$-algebra $B$ over $A[\ell^{-1}]$, we obtain
%     \[
%        0 \to B \otimes_A (J :_{A[x]} f) \to B \otimes_A A[x] \stackrel{f}{\longrightarrow} B \otimes_A ((f A[x] + J)/J) \to 0
%     \]
%     which is  a split exact sequence of $B$-modules.
%     Furthermore, as in the proof of \Cref{comparing expansions:  P}, the isomorphism $B \otimes_A A[x] \cong B[x_1, \ldots, x_\numvars]=B[x]$ induces an isomorphism between the above exact sequence and the exact sequence
%     \[
%        0 \to (J :_{A[x]} f) B[x] \to  B[x] \stackrel{f}{\longrightarrow} (f A[x] + J)B[x]/JB[x] \to 0.
%     \]
%     However, the last term above equals $(fB[x] + JB[x])/JB[x]$, which shows that
%     \begin{align*}
%       (J:_{A[x]} f)B[x] &= \ker ( B[x] \stackrel{f}{\longrightarrow} (fB[x] + JB[x])/JB[x])\\
%       & = (JB[x] :_{B[x]} f). \qedhere
%     \end{align*}
% \end{proof}

\begin{corollary}[The formation of colon ideals commutes with most reductions to prime characteristic]
   \label{colon mod p: C}
   Let $\kk$ be a field of characteristic zero, and consider an ideal $I$ of $R=\kk[x_1, \ldots, x_\numvars]$.
   If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$ that supports a model $I_A$, and $f \in R_A$, then  $(I_A :_{R_A} f)$ is an $A$-model of $(I:_R f)$.
   Furthermore, there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that
   \[ ((I :_R f))_A(\idealm) \coloneqq (I_A :_{R_A} f) R_A(\idealm) = (I_A(\idealm) :_{R_A(\idealm)} f_A(\idealm)) \]
   for every $\idealm \in \mathcal{U}$, where $f_A(\idealm)$ denotes the image of $f$ under the quotient map $R_A \to R_A(\idealm)$.
 \end{corollary}

 \begin{proof}
    Suppose that $\ell \in A \setminus \{0\}$ satisfies the conclusion of \Cref{colon mod p: P} relative to the ideal $J=I_A$ and the polynomial $f \in R_A$.  We may then take $B=\kk$ in \Cref{colon mod p: P} to see that $(I_A:_{R_A} f)R = (I :_{R} f)$, which shows that $(I_A :_{R_A} f)$ is an $A$-model for $(I :_R f)$.
    Now, if $\mathcal{U} = \{\idealm \in \mspec(A) : \operatorname{char}(A/\idealm) \nmid \ell\}$, then for each $\idealm \in \mathcal{U}$, we may instead take $B=A/\idealm$ in \Cref{colon mod p: P} to see that
    \[
       (I_A:_{R_A} f)R_A(\idealm) = (I_A(\idealm) :_{R_A(\idealm)} f_A(\idealm)).
       \qedhere
    \]
\end{proof}

% \begin{proof}
% Suppose that $0 \neq \ell \in A$ satisfies the conclusion of \Cref{colon mod p: P} relative to the ideal $J=I_A$ and polynomial $f \in R_A$.  We may then take $B=\kk$ in \Cref{colon mod p: P} to see that $(I_A:_{R_A} f)R = (I :_{R} f)$, which demonstrates that $(I_A :_{R_A} f)$ is an $A$-model for $(I :_R f)$.  Next, let $\mathcal{U}$ denote the set of all points $\idealm \in \mspec(A)$ such that the characteristic of $A/\idealm$ does not divide $\ell$.  If $\idealm \in \mathcal{U}$, then we may instead take $B=A/\idealm$ in \Cref{colon mod p: P} to see that
% \[  (I_A:_{R_A} f)R_A(\idealm) = (I_A(\idealm) :_{R_A(\idealm)} f_A(\idealm)) \]
% which concludes our proof, as the left-most term above is $((I :_R f))_A(\idealm)$.
% \end{proof}

In \Cref{all monomial colons: C} below, we will show that the element $\ell$ in \Cref{colon mod p: P} can be chosen independently of $f$ when $f$ is a monomial.
In its proof, we will use a basic property of colon ideals:  If $I$ is an ideal of an arbitrary commutative ring $R$, then
\begin{equation}
\label{iterated colon: e}
 (I: ab) = ((I: a): b) \text{ for every } a,b \in R.
\end{equation}

%%% ORIGINAL VERSION
% \begin{lemma}
%    \label{monomial-noetherian-decomposition: L}
%    Given a Noetherian ring $A$, and an ideal $J$ of $A[x_1, \ldots, x_\numvars]$, there exists a finite subset $\mathcal{V}$ of $\NN^\numvars$, and for every $\vv{v} \in \mathcal{V}$ a finite subset $\mathcal{W}(\vv{v})$ of the set of standard basis vectors of $\ZZ^\numvars$, such that
%    \[ \NN^\numvars = \bigcup_{\vv{v}\in \mathcal{V}} (\vv{v} + \NN \mathcal{W}(\vv{v})) \]
%    and such that $(J:x^{\vv{v}}) = (J: x^{\vv{v}+\vv{w}})$ for every $\vv{v} \in \mathcal{V}$ and $\vv{w} \in  \NN \mathcal{W}(\vv{v})$.
% \end{lemma}

%    \daniel[inline]{Can we easily modify the proof to get $\sqcup$ instead of $\cup$?  We don't need it for our argument, and neither did BMS, but they did claim it was a disjoint union.}
%    \pedro[inline]{
%       It's not bad (but probably not worth the trouble, since we don't need it):\\[2mm]
%       Suppose $\vv{t} = \vv{v} +\vv{w}$, with $\vv{v}\in\mathcal{V}$ and $\vv{w} \in \NN \mathcal{W}(\vv{v})$.
%       If $t_i > u_i$, then $w_i \ne 0$, and therefore $v_i = u_i$.
%       If $t_i < u_i$, then $v_i < u_i$, so $w_i = 0$ and $v_i = t_i$.
%       If $t_i = u_i$, then again $w_i = 0$ (since $w_i>0$ and $v_i<u_i$ cannot happen) and $v_i = t_i$.
%       IOW, $\vv{v}$ is uniquely determined by $\vv{t}$, and therefore so is $\vv{w}$.
%    }
%    \emily[inline]{I don't think we need to include it. }

% \begin{proof} %\daniel{Thanks for the proof, Emily!}
%    Observe that if $\vv{u}, \vv{w} \in \NN^\numvars$, then $(J : x^{\vv{u}}) \subseteq (J : x^{\vv{u}+\vv{w}})$.
%    For each $1 \leq i \leq \numvars$, \hl{let $u_i$ be the smallest nonnegative integer for which $(J : x_i^{u_i}) = (J : x_i^{u_i+1})$},
% \pedro{Do we need to be this precise? Can't we just take a single $N\gg 0$ so that all chains $\{(J:x_i^n)\}_n$ are stable for $n\ge N$?}
% \emily{Yes, that's OK.}
%    which is well defined since the polynomial ring is Noetherian.
%    Then for all integers $\ell \geq 0$, $((J : x_i^{u_i}) : x_i^{\ell} ) = ((J : x_i^{u_i+1}) : x_i^{\ell} )$, \ie
%    \begin{equation*}
%       (J : x_i^{u_i+\ell}) = (J : x_i^{u_i+\ell+1})
%    \end{equation*}
%    so all $(J : x_i^{u_i+\ell})$ coincide with $(J : x_i^{u_i})$.
%    Repeated uses of \eqref{iterated colon: e} then show that
%    \begin{equation}
%       \label{colon stabilization: e}
%       (J:x^{\vv{v} + \vv{w}}) = (J:x^\vv{v}) \text{ provided $v_i \ge u_i$ whenever $w_i \ne 0$.}
%    \end{equation}
%    Let $\mathcal{V}$ denote the set of all $\vv{v} \in \NN^\numvars$ for which $\vv{0} \leq \vv{v} \leq \vv{u} = (u_1,\ldots,u_\numvars)$.
%    If $\vv{v} < \vv{u}$, let $\mathcal{W}(\vv{v}) = \emptyset$, and otherwise, let $\mathcal{W}(\vv{v}) = \{\canvec_i \, : \, v_i = u_i \}$.

%    Given $\vv{t} \in \NN^\numvars$, if $\vv{t} \leq \vv{u}$, then $\vv{t} \in \mathcal{V}$, so $\vv{t}$ is in the union in the statement.
%    Otherwise, $t_i > u_i$ for some $1 \leq i \leq \numvars$.
%    In this case, $\vv{t} = \vv{v} + \vv{w}$, where $v_i =  \min\{ t_i, u_i \}$ and $\vv{w}$ is the sum of all $(t_i-u_i)\canvec_i$ for which $t_i>u_i$.
%    Notice that $\vv{v} \in \mathcal{V}$, and if $t_i > u_i$, then $v_i = \min\{t_i, u_i\} = u_i$, so that $\canvec_i \in \mathcal{W}(\vv{v})$, and $\vv{t}$ is also in the union.

%    Finally, if $\vv{v} \in \mathcal{V}$ and $\vv{w} \in \NN\mathcal{W}(\vv{v})$, then $v_i = u_i$ whenever $w_i >0$, and thus $(J : x^{\vv{v} + \vv{u}}) = (J : x^{\vv{v}})$ by \eqref{colon stabilization: e}.
%    % Finally, take $\vv{v} \in \mathcal{V}$ for which $\NN\mathcal{W}(\vv{v})$ is not empty, and renumber the variables so that $\mathcal{W}(\vv{v}) = \{ \canvec_1, \ldots, \canvec_s \}$ for some $1 \leq s \leq \numvars$, so that $v_i = w_i$ for $1 \leq i \leq s$.
%    % Given $\vv{u} \in \NN \mathcal{W}(\vv{v})$, $\vv{u} = u_1 \canvec_1 + \cdots + u_s \canvec_s$.
%    % Then
%    % \begin{align*}
%    %   (J : x^{\vv{v} + \vv{u}}) &= ((J : x^{(w_1 + u_1)\canvec_1}) : x^{\vv{v} + \vv{u} - (w_1 + u_1) \vv{e_1}} ) \\
%    %                             &= ((J : x^{w_1 \canvec_1}) : x^{\vv{v} + \vv{u} - (w_1 + u_1) \vv{e_1}} ) \\
%    %                             &= (J : x^{\vv{v} + \vv{u} - u_1 \canvec_1  } )
%    % \end{align*}
%    % and the first coordinate of $\vv{v} + \vv{u} - u_1 \canvec_1$ is $v_1$.
%    % We can continue by writing $(J : x^{\vv{v} + \vv{u} - u_1 \canvec_1  } )$ as
%    % \[
%    %    ((J : x^{(w_2 + u_2)\canvec_2}) : x^{\vv{v} + \vv{u} - u_1 \canvec_1 - (w_2+u_2) \canvec_2  } ) = (J : x^{\vv{v} + \vv{u} - u_1 \canvec_1 - u_2 \canvec_2 } )
%    % \]
%    % where the first and second coordinates of $\vv{v} + \vv{u} - u_1 \canvec_1 - u_2 \canvec_2$ are $v_1$ and $v_2$, respectively.
%    % Continuing in this manner, we can inductively conclude that $(J : x^{\vv{v} + \vv{u}}) = (J : x^{\vv{v}})$.
% \end{proof}

% \begin{lemma}
% \label{mon-operation-modulo-p: L}
% Suppose that $A$ is a Noetherian domain.  Given an ideal $J$ of the polynomial ring $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $0 \neq \ell \in A$ with the following property:  If $B$ is any $A[\ell^{-1}]$-algebra \hl{that happens to be a field}, then
% \[ \mon(J) B[x] = \mon(JB[x]).\]
%  \end{lemma}

%  \begin{proof}
%     Let $\mathcal{V}$ and $\mathcal{W}(\vv{v})$ be the finite subsets of $\NN^\numvars$ described in \Cref{monomial-noetherian-decomposition: L}, relative to the ideal $J$ of $A[x]$, so that $\NN^\numvars = \bigcup_{\vv{v} \in \mathcal{V}} (\vv{v}+\NN \mathcal{W}(\vv{v}))$, and
%     \[
%        (J :_{A[x]} x^{\vv{v}})  = (J:_{A[x]} x^{\vv{v}+\vv{w}}) \text{ for every } \vv{v} \in \mathcal{V} \text{ and } \vv{w} \in  \NN  \mathcal{W}(\vv{v}).
%     \]
%     In particular,
%     \[
%        (J :_{A[x]} x^{\vv{v}})  = (J:_{A[x]} x^{\vv{v}+\canvec_i}) \text{ for every } \vv{v} \in \mathcal{V} \text{ and } \canvec_i \in  \mathcal{W}(\vv{v}).
%     \]
%     Suppose that $0 \neq \ell \in A$ is such that the conclusion of \Cref{comparing expansions:  P} holds for each of the finitely many containments of ideals $(J :_{A[x]} x^{\vv{v}}) \subseteq A[x]$ with $\vv{v} \in \mathcal{V}$.  In particular, if $(J :_{A[x]} x^{\vv{v}}) B_{\circ}[x] = B_{\circ}[x]$ for some $A[\ell^{-1}]$-algebra $B_{\circ}$, then $(J :_{A[x]} x^{\vv{v}}) B[x] = B[x]$ for every $A[\ell^{-1}]$-algebra $B$.


% Similarly, after further localizing (that is, replacing $\ell$ with a nonzero $A$-multiple), we may also assume that the conclusions of \Cref{colon mod p: P}   hold for each of the colon ideals $(J:_{A[x]} x^{\vv{v}})$ and $(J:_{A[x]} x^{\vv{v}+\canvec_i})$ for every $\vv{v} \in \mathcal{V}$ and $\canvec_i \in \mathcal{W}(\vv{v})$.  In particular, if $B$ is an $A[\ell^{-1}]$-algebra, then
% \begin{align*}  (J B[x] :_{B[x]} x^{\vv{v}}) & = (J :_{A[x]} x^{\vv{v}}) B[x] \\ & = (J :_{A[x]} x^{\vv{v}+\canvec_i}) B[x] =(J B[x]:_{B[x]} x^{\vv{v}+\canvec_i})
% \end{align*}
% for every $\vv{v} \in \mathcal{V}$ and $\canvec_i \in  \mathcal{W}(\vv{v})$.  Keeping in mind the basic properties of colon ideals recalled in \eqref{iterated colon: e}, the equality of the outermost colon ideals above implies the stronger equality $(J B[x] :_{B[x]} x^{\vv{v}}) = (J B[x]:_{B[x]} x^{\vv{v}+\vv{w}})$ for every $\vv{v} \in \mathcal{V}$ and $\vv{w} \in \NN \mathcal{W}(\vv{v})$.  Putting everything together, we have that
% \begin{equation}
% \label{interesting expansion of colon ideals: e}
% (J :_{A[x]} x^{\vv{v}}) B[x] = (J B[x] :_{B[x]} x^{\vv{v}}) =(J B[x]:_{B[x]} x^{\vv{v}+\vv{w}})
% \end{equation}
% for every $A[\ell^{-1}]$-algebra $B$, and for every $\vv{v} \in \mathcal{V}$ and $\vv{w} \in \NN \mathcal{W}(\vv{v})$.

% We require one more condition on $\ell$.  As described in \Cref{single multiplier: R}, we may fix $0 \neq a \in A$ such that if $x^{\vv{u}} \in  A[x]$,  then $x^{\vv{u}} \in \mon(J)$ if and only if $ax^{\vv{u}} \in J$.  After replacing $\ell$ with $a \ell$, we may also assume that $a$ is a unit in $A[\ell^{-1}]$.  With this, we are now finally prepared to prove that $\mon(J)B[x]=\mon(JB[x])$ for every $A[\ell^{-1]}$-algebra $B$ that also happens to be a field.

% Let $B$ be as above, and suppose that $x^{\vv{u}} \in \mon(J)$.  Then $a x^{\vv{u}} \in J$, and so $a x^{\vv{u}} \in JB[x]$.  Furthermore, as $a$ is a unit in $A[\ell^{-1}]$, it must map to a unit in $B$, which implies that $x^{\vv{u}} \in \mon(JB[x])$.   Notice that, as $x^{\vv{u}} \in \mon(J)$ was arbitrary, this demonstrates that $\mon(J) B[x]$ lies in $\mon(J B[x])$.

% Next, suppose $x^{\vv{u}} \in \mon(JB[x])$, so that there exists $0 \neq b \in B$ such that $bx^{\vv{u}} \in JB[x]$.  However, if we write $\vv{u}=\vv{v}+\vv{w}$ for some $\vv{v} \in \mathcal{V}$ and $\vv{w} \in \mathcal{W}(\vv{v})$, then we may rewrite this containment as
% $bx^{\vv{v}+\vv{w}} = bx^{\vv{u}} \in JB[x]$, and so
% \[ b \in ( J B[x] :_{B[x]} x^{\vv{v}+\vv{w}} ) = ( J B[x] :_{B[x]} x^{\vv{v}}) = ( J  :_{A[x]} x^{\vv{v}})B[x] \]
% where the equality of colon ideals comes from \eqref{interesting expansion of colon ideals: e}.

% \daniel[inline]{This next part seems too good to be true.  Is it correct?}
% The assumption that $B$ is a field now comes into play, as the above containment implies that $(J:_{A[x]} x^{\vv{v}}) B[x] = B[x]$.  However, our choice of $\ell$ then guarantees that this same equality must also hold after replacing $B$ with the fraction field $\mathbb{L}$ of $A$.  In this case, the equality $(J:_{A[x]} x^{\vv{v}}) \mathbb{L}[x] = \mathbb{L}[x]$ implies that $1$ may be written as an $\LL[x]$-linear combination of polynomials in $(J :_{A[x]} x^{\vv{v}})$, and after simultaneously clearing the denominators of every $\LL[x]$-coefficient in such an expression, it follows that there exists $0 \neq \alpha \in A$ with $\alpha \in (J:_{A[x]} x^{\vv{v}})$.    Thus, $\alpha x^{\vv{v}} \in J$, which implies that $x^{\vv{v}} \in \mon(J)$.   Therefore, in $B[x]$, we have that $x^{\vv{u}} = x^{\vv{v}+\vv{w}} \in x^{\vv{v}} B[x] \subseteq \mon(J) B[x]$.  We conclude that $\mon(JB[x]) \subseteq \mon(J)B[x]$, and so $\mon(JB[x]) = \mon(J)B[x]$.
% \daniel[inline]{If this seems correct, maybe we could push things to rid of the hypothesis that $B$ is a field.  Does the multiplier $a$ that works to test membership in $\mon(J)$ also work to test membership in $\mon(JB)$ for any $A[\ell^{-1}]$-algebra $B$?  If so, then we can replace $b$ above with $a$.  Then, we have that $a \in (J :_{A[x]} x^{\vv{v}}) B[x]$, and after maybe augmenting $\ell$ earlier in the proof, maybe this says that
% \[ ((J :_{A[x]} x^{\vv{v}}):_{A[x]} a)B[x] = B[x] \]
% If all of this is legit, then we could replace $B$ with the fraction field, and as above, conclude that a nonzero multiple of $a$ lies in $(J:_{A[x]} x^{\vv{v}})$, and then conclude as above.  What do you guys think?  If this is correct, should we just add it?  Note that, for our application, it really makes no difference.}
% \end{proof}

%% REPLACEMENT PROPOSED BY PEDRO
% \pedro[inline]{
%    Below is a possible replacement for the last two lemmas.
%    It's somewhat shorter (but still understandable, I think).
%    I chose to relieve the second lemma of some of the burden, and not to worry much about the formalism of the decomposition in \Cref{monomial-noetherian-decomposition: L}.
% }

% \begin{lemma}
%    \label{uniform monomial containment: L}
%    Suppose that $A$ is a Noetherian domain.
%    Given an ideal $J$ of the polynomial ring $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A\setminus\{0\}$ with the following property\textup:
%    If a monomial $x^\vv{u}$ lies in $JB_{\circ}[x]$ for some particular $A[\ell^{-1}]$-algebra $B_{\circ}$, then $x^\vv{u}$ lies in  $JB[x]$ for every $A[\ell^{-1}]$-algebra $B$.
% \end{lemma}

% \begin{proof}
%    We will show the existence of $\ell \in A\setminus\{0\}$ with the following properties:
%    \begin{enumerate}[$(1)$,leftmargin=*]
%       \item If $(J :_{A[x]} x^\vv{u})B_\circ[x] = B_\circ[x]$ for some monomial $x^\vv{u}$ and some $A[\ell^{-1}]$-algebra $B_\circ$, then $(J :_{A[x]} x^\vv{u})B[x] = B[x]$ for every $A[\ell^{-1}]$-algebra $B$.
%       \item $(J :_{A[x]} x^\vv{u})B[x] = (JB[x]:_{B[x]} x^\vv{u})$, for every monomial $x^\vv{u}$ and every $A[\ell^{-1}]$-algebra $B$.
%    \end{enumerate}
%    The result will then follow easily:
%    If $x^\vv{u} \in JB_{\circ}[x]$, then $(J :_{A[x]} x^\vv{u})B_\circ[x] = (JB_\circ[x]:_{B_\circ[x]} x^\vv{u}) = B_\circ[x]$, and thus for every $A[\ell^{-1}]$-algebra $B$ we have $(JB[x]:_{B[x]} x^\vv{u}) = (J :_{A[x]} x^\vv{u})B[x] = B[x]$, whence $x^\vv{u}\in JB[x]$.
%    \pedro{Maybe we can just say that the result follows easily from the claim, and leave it at that?}

%    The existence of $\ell$ satisfying (1) will follow from \Cref{comparing expansions:  P} applied to the containments $(J:_{A[x]}x^\vv{u}) \subseteq A[x]$, once we verify that there are only finitely many ideals $(J:_{A[x]} x^\vv{u})$.
%    As $A[x]$ is Noetherian, we may choose $N\in \NN$ such that all the ascending chains $\{(J:_{A[x]}x_i^n)\}_{n\in \NN}$, with $i=1,\ldots,\numvars$, are stable for $n\ge N$.
%    We claim that each colon ideal $(J:_{A[x]}x^\vv{u})$ is equal to $(J:_{A[x]}x^\vv{v})$ for some $\vv{v} \le N\vv{1}$, which establishes the desired finiteness.
%    Indeed, if $\vv{v} = (v_1,\ldots,v_\numvars)$ with $v_i = \min\{u_i,N\}$, then repeated applications of \eqref{iterated colon: e} and our choice of $N$ show that $(J:_{A[x]}x^\vv{u}) = (J:_{A[x]}x^\vv{v})$.

%    Suppose $\ell$ satisfies (1).
%    By possibly replacing $\ell$ with a nonzero $A$-multiple, we may assume that $\ell$ also satisfies the conclusion of \Cref{colon mod p: P} for the finitely many ideals $(J:_{A[x]} x^\vv{v})$ with $\vv{v} \le (N+1)\vv{1}$.
%    If $B$ is an $A[\ell^{-1}]$-algebra, then our choice of $\ell$ and $N$ show that, for each $i=1,\ldots,\numvars$,
%    \begin{equation*}
%      (JB[x]:_{B[x]} x_i^{N+1}) = (J:_{A[x]}x_i^{N+1})B[x]
%                                = (J:_{A[x]}x_i^N)B[x]
%                                =(JB[x]:_{B[x]} x_i^{N}).
%    \end{equation*}
%    Repeated uses of \eqref{iterated colon: e} then show that all chains $\{(JB[x]:_{B[x]}x_i^n)\}_{n\in \NN}$ are stable for $n\ge N$.
%    Now, for each monomial $x^\vv{u}$ we have $(JB[x]:_{B[x]}x^{\vv{u}})=(JB[x]:_{B[x]}x^{\vv{v}})$ for $\vv{v}\le N\vv{1}$ constructed exactly as above, and
%    \begin{equation*}
%      (JB[x]:_{B[x]}x^{\vv{u}})=(JB[x]:_{B[x]}x^{\vv{v}})
%      = (J:_{A[x]} x^{\vv{v}})B[x]
%      = (J:_{A[x]} x^{\vv{u}})B[x].
%    \end{equation*}
%    Thus, $\ell$ satisfies both (1) and (2), and the lemma follows.
% \end{proof}

% \begin{lemma}
%    \label{mon operation vs extensions: L}
%    Suppose that $A$ is a Noetherian domain.
%    Given an ideal $J$ of the polynomial ring $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A\setminus\{0\}$ with the following property\textup:
%    If $B$ is any $A[\ell^{-1}]$-algebra \hl{that happens to be a field}, then
%    \[ \mon(J) B[x] = \mon(JB[x]).\]
% \end{lemma}

% \begin{proof}
%    Choose $\ell \in A\setminus\{0\}$ such that the conclusion of \Cref{uniform monomial containment: L} holds.
%    By \Cref{single multiplier: R}, there exists $a \in A\setminus\{0\}$ such that $x^{\vv{u}} \in \mon(J)$ if and only if $ax^{\vv{u}} \in J$.
%    After replacing $\ell$ with $a \ell$, we may assume that $a$ is a unit in $A[\ell^{-1}]$.

%    Let $B$ be an $A[\ell^{-1}]$-algebra that happens to be a field, and suppose that $x^{\vv{u}} \in \mon(J)$.
%    Then $a x^{\vv{u}} \in J$, and so $a x^{\vv{u}} \in JB[x]$.
%    As $a$ is a unit in $A[\ell^{-1}]$, it must map to a unit in $B$, which implies that $x^{\vv{u}} \in \mon(JB[x])$.
%    This shows that $\mon(J) B[x] \subseteq \mon(J B[x])$.

%    Next, suppose $x^{\vv{u}} \in \mon(JB[x])$.
%    As $B$ is a field, this just means that $x^{\vv{u}} \in JB[x]$.
%    By \Cref{uniform monomial containment: L}, this containment remains valid after replacing $B$ with $A[\ell^{-1}]$.
%    Writing $x^{\vv{u}}$ as an $A[\ell^{-1},x]$-linear combination of elements of $J$ and clearing denominators we see that $\ell^n x^\vv{u} \in J$ for some~$n$, so $x^{\vv{u}} \in \mon(J)B[x]$.
%    Thus, $\mon(JB[x]) \subseteq \mon(J)B[x]$, concluding the proof.
% \end{proof}

% \pedro[inline]{
%    Proposed substitution ends here.
% }

%% NEW VERSION BY DANIEL
\begin{corollary}
   \label{all monomial colons: C}
   Let $A$ be Noetherian domain.
   Given an ideal $J$ of $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A \setminus \{0\}$ such that
   \[ (J:_{A[x]} x^{\vv{u}}) B[x] = (JB[x]:_{B[x]} x^{\vv{u}})\]
   for every $A[\ell^{-1}]$-algebra $B$ and every monomial $x^{\vv{u}} \in A[x]$.   
\end{corollary}

\begin{proof}
   As $A[x]$ is Noetherian, there is $t \in \NN$ such that $(J:_{A[x]}x_i^t)=(J:_{A[x]}x_i^{t+1})$ for each $1 \leq i \leq \numvars$.  Define $\phi:  \NN^\numvars \to \NN^\numvars$ by $\vv{u} \mapsto (\min\{u_1, t\}, \ldots, \min \{u_\numvars,t\})$.  Our choice of $t$ and repeated applications of \eqref{iterated colon: e} then show that $(J:_{A[x]}x^\vv{u}) = (J:_{A[x]}x^{\phi(\vv{u})})$.
   If $\ell$ satisfies the conclusion of \Cref{colon mod p: P} for the finitely many colon ideals $(J:_{A[x]}x_i^t)=(J:_{A[x]}x_i^{t+1})$, and $B$ is an $A[\ell^{-1}]$-algebra, then
   \[ (JB[x]:_{B[x]} x_i^{t}) = (J:_{A[x]}x_i^{t})B[x]
                               = (J:_{A[x]}x_i^{t+1})B[x]
                               =(JB[x]:_{B[x]} x_i^{t+1}) \]
   and as above, we may conclude that $(JB[x]:_{B[x]}x^\vv{u}) = (JB[x]:_{B[x]}x^{\phi(\vv{u})})$.

After replacing $\ell$ with a nonzero multiple, we may also assume that the conclusion of \Cref{colon mod p: P} holds for the finitely many ideals $(J:_{A[x]} x^{\phi(\vv{u})})$ of $A$, and so
%
\[ (J:_{A[x]} x^{\vv{u}})B[x] = (J:_{A[x]} x^{\phi(\vv{u})})B[x] = (JB[x]:_{B[x]} x^{\phi(\vv{u})}) = (JB[x]:_{B[x]} x^{\vv{u}}). \qedhere\]
\end{proof}

\begin{theorem}
\label{mon-operation-general-expansion: T}
Let $A$ be a Noetherian domain.  Given an ideal $J$ of $A[x_1, \ldots, x_\numvars] = A[x]$, there exists $\ell \in A \setminus \{0\}$ such that 
\[ \mon(J) B[x] = \mon(JB[x])\]
for every $A[\ell^{-1}]$-algebra $B$ \hl{that happens to be a field}.
\end{theorem}


\begin{proof}
   The identity $(J:_{A[x]} x^{\vv{u}}) = (J:_{A[x]} x^{\phi(\vv{u})})$ established in the proof of \Cref{all monomial colons: C} implies that there are only finitely many ideals of the form $(J:_{A[x]} x^{\vv{u}})$.
   Thus, we may choose $\ell \in A\setminus \{0\}$ that satisfies the conclusion of \Cref{comparing expansions:  P} for every containment $(J:_{A[x]} x^{\vv{u}}) \subseteq A[x]$, as well as the conclusion of \Cref{all monomial colons: C}.

   By \Cref{single multiplier: R}, we may fix $a \in A \setminus \{0\}$ such that $x^{\vv{u}} \in \mon(J)$ if and only if $ax^{\vv{u}} \in J$.
   After replacing $\ell$ with $a \ell$, we may assume that $a$ is a unit in $A[\ell^{-1}]$.
   For the remainder of this proof, let $B$ be an $A[\ell^{-1}]$-algebra that happens to be a field.

   If $x^{\vv{u}} \in \mon(J)$, then $a x^{\vv{u}} \in J \subseteq JB[x]$.  Furthermore, as $a$ is a unit in $A[\ell^{-1}]$, it must map to a unit in $B$, which allows us to conclude that $x^{\vv{u}} \in \mon(JB[x])$.   %As $x^{\vv{u}} \in \mon(J)$ was arbitrary, this demonstrates that $\mon(J) B[x]$ lies in $\mon(J B[x])$.

   Now suppose that $x^{\vv{u}} \in \mon(JB[x])$.  As $B$ is a field, this simply means that $x^{\vv{u}} \in JB[x]$, and  \Cref{all monomial colons: C} allows us to rewrite this as
   \[(J:_{A[x]} x^{\vv{u}}) B[x] = (JB[x] :_{B[x]} x^{\vv{u}}) = B[x].\]
   \Cref{comparing expansions:  P} and our choice of $\ell$ then imply that $(J:_{A[x]} x^{\vv{u}}) A[\ell^{-1},x] = A[\ell^{-1},x]$.
   \pedro{or $A[\ell^{-1}][x]$; I prefer the simpler notation}
   Thus, $\ell^n \in (J:_{A[x]} x^{\vv{u}})$ for some $n$, so that $\ell^n x^{\vv{u}} \in J$, and hence $x^{\vv{u}} \in \mon(J)$.
\end{proof}

In the same way that \Cref{colon mod p: P} implies \Cref{colon mod p: C}, \Cref{mon-operation-general-expansion: T} implies the following result.

\begin{theorem}[The $\mon$ operation commutes with most reductions to prime characteristic]
\label{mon-operation-modulo-p: T}
Let $\kk$ be a field of characteristic zero and $I$ an ideal of $R=\kk[x_1, \ldots, x_{\numvars}]$.
If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$ that supports an $A$-model $I_A$ of $I$, then $\mon(I_A)$ is an $A$-model for $\mon(I)$.  Furthermore, there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that
\[ (\mon(I))_A(\idealm) \coloneqq \mon(I_A) R_A(\idealm) = \mon(I_A(\idealm)) \] for every point $\idealm \in \mathcal{U}$. \qed
\end{theorem}

% \begin{proof}
%     Suppose that $\ell \in A \setminus \{0\}$ satisfies the conclusion of \Cref{all monomial colons: C}.  Furthermore, the identity $(J:_{A[x]} x^{\vv{u}}) = (J:_{A[x]} x^{\phi(\vv{u})})$ established in the proof of \Cref{all monomial colons: C} implies that there are only finitely many ideals of the form $(J:_{A[x]} x^{\vv{u}})$, and so after replacing $\ell$ with a nonzero multiple, we may also suppose that $\ell$ satisfies the conclusions of \Cref{comparing expansions:  P} relative to every containment $(J:_{A[x]} x^{\vv{u}}) \subseteq A[x]$.


% We require one more condition on $\ell$.  As described in \Cref{single multiplier: R}, we may fix $0 \neq a \in A$ such that if $x^{\vv{u}} \in  A[x]$,  then $x^{\vv{u}} \in \mon(J)$ if and only if $ax^{\vv{u}} \in J$.  After replacing $\ell$ with $a \ell$, we may also assume that $a$ is a unit in $A[\ell^{-1}]$.

% For the remainder of this proof, let $B$ be an $A[\ell^{-1}]$-algebra that happens to be a field.  If $x^{\vv{u}} \in \mon(J)$, then $a x^{\vv{u}} \in J \subseteq JB[x]$.  Furthermore, as $a$ is a unit in $A[\ell^{-1}]$, it must map to a unit in $B$, which allows us to conclude that $x^{\vv{u}} \in \mon(JB[x])$.   %As $x^{\vv{u}} \in \mon(J)$ was arbitrary, this demonstrates that $\mon(J) B[x]$ lies in $\mon(J B[x])$.

% Next, instead suppose that $x^{\vv{u}} \in \mon(JB[x])$.  As $B$ is a field, this simply means that $x^{\vv{u}} \in JB[x]$, and  \Cref{all monomial colons: C} allows us to rewrite this as \[(J:_{A[x]} x^{\vv{u}}) B[x] = (JB[x] :_{B[x]} x^{\vv{u}}) = B[x].\]
% \Cref{comparing expansions:  P}, and our choice of $\ell$, then implies that $(J:_{A[x]} x^{\vv{u}}) A[\ell^{-1}] = A[\ell^{-1}]$.  Thus, $\ell^n \in (J:_{A[x]} x^{\vv{u}})$ for some $n$, so that $\ell^n x^{\vv{u}} \in J$, which implies that $x^{\vv{u}} \in \mon(J)$.
% \end{proof}

% In the same way that \Cref{colon mod p: P} implies \Cref{colon mod p: C}, \Cref{mon-operation-general-expansion: T} implies the following result.

% \begin{theorem}[The $\mon$ operation commutes with most reductions to prime characteristic]
% \label{mon-operation-modulo-p: T}
% Let $\kk$ be a field of characteristic zero, and consider an ideal $I$ of the polynomial ring $R=\kk[x_1, \ldots, x_{\numvars}]$.  If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$ that supports an $A$-model $I_A$ of $I$, then $\mon(I_A)$ is an $A$-model for $\mon(I)$.  Furthermore, with this choice of $A$-model, there exists a dense open set $\mathcal{U} \subseteq \mspec(A)$ such that
% \[ (\mon(I))_A(\idealm) \coloneqq \mon(I_A) R_A(\idealm) = \mon(I_A(\idealm)) \] for every point $\idealm \in \mathcal{U}$. \qed
% \end{theorem}


\begin{corollary}
   \label{invariants associated to a monomial ideal in large characteristic: C}
   Let $\kk$ be a field of characteristic zero, and suppose that $I$ and $J$ are ideals of  $R=\kk[x_1, \ldots, x_\numvars]$, with $I$ monomial and $I \subseteq \sqrt{J}$.
   If $A$ is a finitely generated $\ZZ$-subalgebra of $\kk$ supporting models $I_A$ and $J_A$, then there exists a monomial ideal $L \subseteq R$, an $A$-model $L_A \subseteq R_A$, and a dense open set $\mathcal{U} \subseteq \mspec(A)$ with the following property\textup:
   If $\idealm \in \mathcal{U}$ and $p = \operatorname{char}(A/\idealm)$, then there exists a diagonal ideal $\ideald$
   \daniel{
      I think we can actually pick the ideal $\ideald$ so that it is the reduction of a diagonal ideal containing $\mon(J)$, as in the proof of \Cref{reduce-to-monomial-case: C}.
      The point is that it shouldn't really involve $p$, say, in any of its generators.
      This will lead to a more complicated statement, and the proof will have to invoke the proof of \Cref{reduce-to-monomial-case: C}, as opposed to simply citing it.
      What do you guys think about this?
   }
   in $R_A(\idealm)$ associated to a positive point in $\NN^\numvars$ such that
   \[
      \mu(I_A(\idealm), J_A(\idealm), p^e) = \mu(I_A(\idealm), L_A(\idealm), p^e)  = \mu(I_A(\idealm), \ideald, p^e)
   \]
   for every $e \geq 1$.
   In particular,
   \[
      \crit(I_A(\idealm), J_A(\idealm)) = \crit(I_A(\idealm), L_A(\idealm))= \crit(I_A(\idealm), \ideald).
   \]
\end{corollary}

\begin{proof}  Let $\mathcal{U} \subseteq \mspec(A)$ be a dense open set such that the conclusion of \Cref{containment in radical mod p: C} holds for $I$ and $J$, the conclusion of \Cref{expansion of monomial mod most p is monomial: C} holds for $I$, and the conclusion of \Cref{mon-operation-modulo-p: T} holds for $J$.  Fix a point $\idealm \in \mathcal{U}$.

\Cref{expansion of monomial mod most p is monomial: C,containment in radical mod p: C} tell us that $I_A(\idealm)$ is a monomial ideal contained in the radical of $J_A(\idealm)$, while if we set $L=\mon(J)$, then \Cref{mon-operation-modulo-p: T} tells us that $L_A = \mon(J_A)$ is a model for $L$, and that $L_A(\idealm) = \mon(J_A(\idealm))$.    Our claims then follow from \Cref{reduce-to-monomial-case: C}.
\end{proof}

% \section{Frobenius powers of monomial ideals}
% 
% \emily[inline]{This appendix will likely be dissolved.  We may need to bring some of these definitions/properties to an appropriate section where they will be used.  }
% 
% \emily[inline]{I believe that none of \Cref{frobenius powers definitions: S} appears verbatim in either of our previous papers.  }
% 
% \subsection{Definitions} \label{frobenius powers definitions: S}
% 
% {
% 
% %In this section, we recall the definition and basic properties of (generalized) Frobenius powers and critical exponents, as introduced in \cite{hernandez+etal.frobenius_powers}.
% %Let $R$ be a regular domain of characteristic $p > 0$, and let $\ideala$ be an ideal of $R$.
% If $q$ is a power of $p$, then $\ideala^{[q]}$ denotes the standard $q$-th Frobenius power of $\ideala$, that is, the ideal generated by the $q$-th powers of the elements of $\ideala$.
% Given a nonnegative integer $k$, with base $p$ expansion $k = k_0 + k_1 p + \cdots + k_r p^r$, the $k$-th Frobenius power of $\ideala$ is the ideal
% \[\ideala^{[k]} \coloneqq \ideala^{k_0}\big(\ideala^{k_1}\big)^{[p]}\cdots \big(\ideala^{k_r}\big)^{[p^r]}.\]
% 
% 
% %More relevant to this article, though, is the description of $\ideala^{[k]}$ in terms of generators of $\ideala$:
% %Given $\vv{u} \in \NN^n$, we use
% %$\binom{k}{\vv{u}}$ to denote the binomial coefficient $\binom{k}{u_1,\ldots,u_n}$, which equals zero if $\norm{\vv{u}} \neq k$.
% %If $\ideala = \ideal{f_1,\ldots,f_n}$, then $\ideala^{[k]}$ is the ideal generated by the products $f_1^{u_1}\cdots f_n^{u_n}$, ranging over all $\vv{u} \in \NN^n$ for which $\binom{k}{\vv{u}}\not\equiv 0\bmod{p}$ \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.
% 
% Frobenius powers are extended to allow nonnegative real exponents, through the use of the Frobenius roots introduced in \cite{blickle+mustata+smith.discr_rat_FPTs}.
% Explicitly, for a nonnegative rational exponent of the form $k/p^e$, we define
% \[\ideala^{[k/p^e]} \coloneqq \big(\ideala^{[k]}\big)^{[1/p^e]},\]
% and for an arbitrary positive real number $t$, we define $\ideala^{[t]}$ by taking approximations of $t$ from above by such rational numbers, in a way analogous to the definition of test ideals in \loccit
% More explicitly, if $\left\{t_j\right\}_{j=1}^\infty$ is a sequence of real numbers limiting to $t$ from above, each of the form $k/p^e$ for some $k>0$ and $e \geq 0$, then $\ideala^{[t]}$ is defined the union of the ideals $\ideala^{[t_j]}$.
% 
% Like test ideals and multiplier ideals, as $t$ varies, the Frobenius powers $\ideala^{[t]}$ form a nonincreasing chain, and are right-constant for positive $t$, \ie $\ideala^{[t+\epsilon]} = \ideala^{[t]}$, for $0<\epsilon \ll 1$.
% The positive exponents where $\ideala^{[t]}$ ``jumps'' (that is, $\ideala^{[t-\epsilon]}\ne \ideala^{[t]}$, for all $0<\epsilon \le t$) are called the \emph{critical exponents} of $\ideala$.
% These are the analogues of the jumping numbers of multiplier ideals, and of the $F$-jumping exponents of test ideals, and like their counterparts, they form a discrete set of rational numbers \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}.
% 
% If $\ideala$ and $\idealb$ are nonzero proper ideals of $R$, with $\ideala \subseteq \sqrt\idealb$, the \emph{critical exponent of $\ideala$ with respect to $\idealb$} is the number
% \begin{equation}\label{eq: defn of crit(a,b)}
%    \crit(\ideala,\idealb) \coloneqq \min\big\{t\in \RRnn: \ideala^{[t]} \subseteq \idealb\big\}
%       = \sup\big\{t\in \RRnn: \ideala^{[t]} \not\subseteq \idealb\big\}.
% \end{equation}
% This is indeed a critical exponent of $\ideala$, and moreover, every critical exponent $\lambda$ of $\ideala$ is of this form, for some $\idealb$ (take, for instance, $\idealb = \ideala^{[\lambda]}$).
% 
% We now describe a more explicit realization of the critical exponents of an ideal, which is central to this paper.
% With $\ideala$ and $\idealb$ as above, given a nonnegative integer $e$, we set
% \[\mu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{[k]} \not\subseteq \idealb^{[p^e]}\big\}.\]
% Then $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_e$ is a nondecreasing bounded sequence, and
% 
% \textcolor{red}{This is already \eqref{eq: crit as a limit of mus}:
% }
% \begin{equation}
%    \crit(\ideala,\idealb) = \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e} = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}.
% \end{equation}
% % The $\mu(\ideala,\idealb,p^e)$ not only determine $\crit(\ideala,\idealb)$, but can also be recovered from $\crit(\ideala,\idealb)$, via truncations:
% % \begin{equation}\label{eq: recovering mus from crit}
% %    \mu(\ideala,\idealb,p^e) = \up{p^e\crit(\ideala,\idealb)} - 1.
% % \end{equation}
% 
% % Before moving forward, we observe that the notions introduced in the last two paragraphs run parallel to the theory of $F$-thresholds.
% % With $\ideala$ and $\idealb$ as above, the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}, denoted $\ft{\ideala}{\idealb}$, is defined as in \eqref{eq: defn of crit(a,b)}, replacing the Frobenius power $\ideala^{[t]}$ with the test ideal $\tau(\ideala^t)$.
% % There is an explicit description for $\ft{\ideala}{\idealb}$ analogous to \eqref{eq: crit as a limit of mus}, where $\mu(\ideala,\idealb,p^e)$ is replaced with
% % \[\nu(\ideala,\idealb,p^e) \coloneqq \max\big\{k\in \NN : \ideala^{k} \not\subseteq \idealb^{[p^e]}\big\}.\]
% % However, there is no analogue to \eqref{eq: recovering mus from crit}, unless $\ideala$ is a principal ideal.
% 
% 
% \subsection{Frobenius powers and critical exponents of monomial ideals}
% 
% % We now introduce some notation and gather some basic results concerning Frobenius powers and critical exponents of monomial ideals.
% % We work in a polynomial ring over a field of characteristic $p>0$, in the variables $x=x_1,\ldots,x_\numvars$.
% %
% % \begin{notation}
% %    If $\vv{u}\in \NN^\numvars$, then $\diag(\vv{u})$ denotes the \emph{diagonal ideal}
% %    \[ \diag(\vv{u}) = \ideal{x_1^{u_1},\ldots,x_\numvars^{u_\numvars}} = \ideal{x^{\vv{v}} : \vv{v} \in \NN^\numvars \text{ and } \vv{v} \not < \vv{u}}.\]
% %    When dealing with notation involving diagonal ideals, we shall typically replace $\diag(\vv{u})$ in the notation with $\vv{u}$.
% %    For instance, $\crit(\ideala,\diag(\vv{u}))$ will be simply denoted $\crit(\ideala,\vv{u})$.
% %    Likewise, we shall often replace a monomial ideal with its exponent matrix in our notation.
% % \end{notation}
% %
% % \begin{remark}\label{rmk: Frobenius powers of monomial ideals are monomial ideals}
% %    Since integral Frobenius powers and Frobenius roots of monomial ideals are themselves monomial ideals, the same is true for arbitrary Frobenius powers of monomial ideals.
% % \end{remark}
% 
% \textcolor{red}{The first equivalent below is established in \cite[Proposition 2.5]{hernandez+etal.frobenius_examples}, and the second follows immediately from \eqref{eq: defn of crit(a,b)}.}
% 
% 
% \begin{proposition}\label{prop: description of frobenius powers in terms of crits}
%    If $\ideala$ is a monomial ideal and $\vv{v} \in \NN^\numvars$ with $\vv{v}>\vv{0}$, then
%    \[ x^{\vv{v}} \in \ideala^{[t]} \iff \ideala^{[t]} \not \subseteq \diag(\vv{v}+\vv{1}) \iff \crit(\ideala, \vv{v}+\vv{1}) > t.\]
%    Consequently, $\ideala^{[t]} = \ideal{x^{\vv{v}} : \crit(\ideala, \vv{v}+\vv{1}) > t}$.
% \end{proposition}
% 
% 
% % \begin{proof}
% %    The second equivalence follows immediately from \eqref{eq: defn of crit(a,b)}.
% %    As for the first, the forward implication is trivial, since $x^\vv{v} \notin\diag(\vv{v}+\vv{1})$, and conversely, if $\ideala^{[t]} \not \subseteq \diag(\vv{v}+\vv{1})$, then there exists $x^\vv{u} \in \ideala^{[t]}$ with $\vv{u} \le \vv{v}$, so $x^\vv{v}\in \ideal{x^\vv{u}} \subseteq \ideala^{[t]}$.
% %    The final conclusion holds because $\ideala^{[t]}$ is a monomial ideal, as noted in \textcolor{red}{missing reference}.
% % \end{proof}
% 
% \textcolor{red}{The following is stated for $\idealm$-primary ideals $\ideala$ as \cite[Proposition 2.6]{hernandez+etal.frobenius_examples}.}
% 
% \begin{corollary}
%    \label{cor: every crit is crit wrt diagonal ideal}
%    If $\ideala$ is a monomial ideal, then every critical exponent of~$\ideala$ is of the form $\crit(\ideala,\vv{u})$, for some $\vv{u} > \vv{0}$ in $\NN^\numvars$.
% \end{corollary}
% 
% \begin{proof}
%    Let $\lambda$ be a critical exponent of $\ideala$, so that $\ideala^{[\lambda]}$ is properly contained in $\ideala^{[t]}$ for every $0 \le t <\lambda$.
%    Since the critical exponents of $\ideala$ form a discrete set \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}, the intersection of all such $\ideala^{[t]}$ properly contains $\ideala^{[\lambda]}$.
%    This intersection---a monomial ideal by \textcolor{red}{missing reference}---thus contains a monomial $x^\vv{v}$ not in $\ideala^{[\lambda]}$.
%    \cref{prop: description of frobenius powers in terms of crits} then shows that $\ideala^{[t]}\not\subseteq \diag(\vv{v}+\vv{1})$, whenever $0\le t < \lambda$, but $\ideala^{[\lambda]} \subseteq \diag(\vv{v}+\vv{1})$, hence $\lambda = \crit(\ideala,\vv{v}+\vv{1})$.
% \end{proof}
% 
% \daniel[inline]{
%    When we look for corollaries, our ability to compute $\crit(\ideala, \vv{u})$ with $\vv{u} > \vv{1}$ will show that the ideals $\ideala^{[\lambda]}$ also vary ``uniformly'' with respect to the class of $p$ modulo some denominator $\denom$, in a way that we can make precise.
% }
% 
% \daniel[inline]{What about adding a connection between $\ideala^{[t]}$ and $\tau(\ideala^{t'})$ where $t'$ is the greatest $F$-threshold less than $t$?  Like in the diagonal section of our examples paper?  Maybe we could wait to do this until we compare Frobenius powers and test ideals.}
% }
% 
% \emily[inline]{
% 
% \textbf{Important Questions}.
% 
% \begin{enumerate}
%  \item Does a medium-small pair always have a medium-small sprout?
%  We think the answer is NO:
%  Let $A = \begin{bmatrix} 3 & 0 \\ 0 & 3 \end{bmatrix}$ and $\vv{u} = (2,2)$, so that
% $(A, \vv{u})$ is small but not very small.  Then the unique special point is $\vv{s} = (2/3,2/3)$, so that if $p=2 \bmod 3$, then $[\vv{s}]_p = (2[p\%3]/3, 2[p\%3]/3) = (1/3,1/3)$.
% 
% The value of $\Theta(A, \vv{u}, \vv{s}, p)$ is $0$
% using the bounds in this paper, and from this, we can find that the only element of $\Delta(A, \vv{u}, \vv{s}, p)$ is $(1,1)$, which is very small.
% 
% \item Is it true that if some digit of a critical exponent of the monomial ideal $\ideala$ equals $p-1$, then \emph{all subsequent digits} must also be $p-1$.  This seems to be true if we run into a \emph{medium small} point.  Are there points $\vv{v}$ with $\mu(A,\vv{v}, p) = p-1$ where $(A,\vv{v})$ is not medium small?  Sure, look at $A = \begin{bmatrix} 2 & 0 \\ 0 & 2 \end{bmatrix}$ and $\vv{v} = (1,1)$.  Then our Frobenius examples paper should tell us that $(A, \vv{v})$ is very small but $\mu(A, \vv{u}, p)$ should equal $1$ often.
% \item We saw earlier that a medium small pair need not sprout a medium small pair.  But does a pair $(A, \vv{u})$ that is small and satisfies $\mu(A, \vv{u}, p) = p-1$ then must it sprout a pair $(B, \vv{v})$ with $\mu(B, \vv{v}, p) = p-1$?
% 
% \item Pedro pointed out the better question is that if $(A, \vv{u})$ is small and $\mu(A, \vv{u}, p) = p-1$, then is the whole critical exponent $\crit(A, \vv{u}) = 1$?
% \item The answer to the last question is FALSE:  In our Frobenius examples paper, there is a critical point $1-(1/p^2) = p-1 : p-2 : \overline{p-1}$.
% \end{enumerate}
% }

{\small
\bibliographystyle{amsalpha}
\bibliography{bibdatabase}
}


\end{document}
