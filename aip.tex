\documentclass{amsart}
\input{preamble.tex}

\usepackage{soul}

\begin{document}

\title[Fractal and arithmetic programs]{Fractal programs, arithmetic programs, and the Frobenius powers of monomial ideals}
\author{Daniel J.~Hern\'andez}
\author{Pedro Teixeira}
\author{Emily E.~Witt}
\maketitle

\newcommand{\CheckedBox}{\text{\rlap{$\checkmark$}}\Box}
\details[inline]{
TO DO LIST:
\begin{enumerate}
 \item[$\Box$] In intro, ``complain" that this paper would have been \textbf{much} shorter if we had only focused on the $\idealm$-primary case.
 \item[$\Box$] Put ``titles'' in new statements, maybe remove some?
 \item[$\Box$] Address request after \Cref{computing nu for large q: C} (wrap up proof of BMS result). \daniel[inline]{Working on it\ldots}
 \item[$\Box$] Do the same as above, replacing $\nu$ with $\mu$.
 \item[$\Box$] Do the same as above, replacing $\ideala$ with generic hypersurface.
  \item[$\Box$]  Refine the statement of, and prove \Cref{frobenius-powers-main: T}.
 \item[$\CheckedBox$] Prove \Cref{finite-representatives-small-crits: P}. 
 \pedro[inline]{This is now done, but I'm sure the proof can be improved.}
 \item[$\Box$] Figure out how to effectively compute the integral closure of a monomial ideal in \emph{Macaulay2}, or otherwise figure out how to address computability in \Cref{computibility of W: R}.
 \item[$\Box$] Produce examples describing $\ideala^{[\lambda]}$.  Candidates include our running example, and taking $\idealm^d$, and removing generators close to the axes.
 \pedro[inline]{Working on it\ldots}
 \item[$\Box$] A $\kk$-generic hypersurface with support $x^{\vv{a}_1}, \ldots, x^{\vv{a}_n}$ will refer to any linear combination of these monomials $g = z_1 x^{\vv{a}_1} + \cdots + z_n x^{\vv{a}_n}$, which may be thought of as an element of either $\kk[z][x]$ or $\kk(z)[x]$.  If $S$ denotes either of these rings, then Theorem 5.3/Corollary 5.7 in Frobenius Powers implies that $\tau(f^t) = \ideala^{[t]} S$.  Thus, we have the following result:  \emph{If the supporting monomials are fixed beforehand, and $p \gg 0$, then any the test ideals of any $\kk$-generic hypersurface, where $\kk$ is a field of characteristic $p$, with those supporting exponents are well-behaved and can be described explicitly}.
  \emily[inline]{I put a draft statement/proof as \Cref{generic-test-ideals-main: T}.}
 \item[$\Box$] Reduction to prime characteristic:  Consider a field $\mathsf{L}$ of characteristic zero, and an $\mathsf{L}$-generic hypersurface $g$ with support $x^{\vv{a}_1}, \ldots, x^{\vv{a}_n}$.  If we consider the ambient ring of $g$ to be $\kk[z][x]$, then $g$ is supported by $\ZZ$, and so $g \bmod p \in (\ZZ/p\ZZ)[z][x]$ is generic, in the same sense, for all $p$ We then understand its test ideals for $p \gg 0$, and invoking \Cref{simple-special: P} will allow us to settle the big conjecture relating test ideals and multiplier ideals for generic hypersurfaces.
 \item[$\Box$]  This is just a note: Consider $\mathscr{A} = \ZZ[z_1, \ldots, z_n]$.  If $\wp$ is a maximal ideal of $\mathscr{A}$, then the images of the variables in $\mathscr{A}/\wp$ are never algebraically independent.  In fact, the image of each variable is algebraic:  Let $\mathscr{A}_i= \ZZ[z_i] \hookrightarrow \mathscr{A}$.  Then $\wp \cap \mathscr{A}_i$ is maximal, and hence, generated by $p$ and $h \in \ZZ[z_i]$ that is irreducible modulo $p$, and so $h(z_i \bmod \wp) = 0$ in $\mathscr{A}/\wp$.  This goes to show is that if we consider a generic hypersurface $g \in \kk(z)[x]$, then its reduction is never generic in the same way.  
 \item[$\Box$] Work out consequences on Bernstein-Sato polynomials. 
\end{enumerate}
}
\newpage

\setcounter{tocdepth}{1}
\tableofcontents

\section{Introduction}

\subsection{Main result}

Let $\kk$ be a field of prime characteristic $p$ with $[\kk:\kk^p] < \infty$, and let $\ideala$ and $\idealb$ be nonzero proper ideals in the polynomial ring $\kk[x_1,\ldots,x_\numvars]$ with $\ideala \subseteq \sqrt \idealb$.
For convenience, we convey these conditions on $\ideala$ and $\idealb$ by saying that the pair $(\ideala,\idealb)$ is \emph{radically compatible}.
For a nonnegative integer $e$, we set
\begin{equation}
   \nu(\ideala,\idealb,p^e) = \max\big\{\ell\in \NN : \ideala^{\ell} \not\subseteq \idealb^{[p^e]}\big\}
   \label{eq: nu definition}
\end{equation}
where $\idealb^{[p^e]} = \langle g^{p^e} : g \in \idealb \rangle$ is the $p^e$-th Frobenius power of $\idealb$.
The assumption that $(\ideala, \idealb)$ is radically compatible ensures that $\nu(\ideala, \idealb, p^e)$ is a well-defined integer.
\pedro{Say a little about what these numbers are for and where they come up ($F$-thresholds, $F$-singularities, \ldots).}

Starting, instead, with a radically compatible pair of ideals $(\ideala,\idealb)$ in $\QQ[x_1,\ldots,x_\numvars]$, for each sufficiently large prime $p$ we have well-defined characteristic $p$ reductions $\ideala_p$ and $\idealb_p$ in $\FF_p[x_1,\ldots,x_\numvars]$ such that $(\ideala_p,\idealb_p)$ is radically compatible.
We may thus consider the numbers $\nu(\ideala_p,\idealb_p,p^e)$, and ask how these vary with $p$.
Although little is known in general, a complete answer is known when $\ideala$ is a monomial ideal.
Before getting to it, though, we first examine some of the motivation behind this question.

\mustata, Takagi, and Watanabe observed that the images of the invariants $\nu(\ideala_p,\idealb_p,p^e)$ in $\FF_p$ are roots of the Bernstein--Sato polynomial of $\ideala$ at the origin, for each $p \gg 0$ \cite[Proposition~3.11]{mustata+takagi+watanabe.F-thresholds}.
Furthermore, they noticed that $\nu(\ideala_p,\idealb_p,p^e)$ oftentimes (but not always) varies with $p$ in a uniform way---a behavior that allows them to find \emph{actual} roots of that Bernstein--Sato polynomial, as opposed to roots modulo $p$.
They ask for conditions on $\ideala$ under which this uniformity, captured in the definition below, manifests for every $\idealb$ and $e$ \cite[Problem~3.8]{mustata+takagi+watanabe.F-thresholds}.

\begin{definition}[\nuCool ideal]
   \label{defn: nuCool}
   A nonzero proper ideal $\ideala$ of $\QQ[x_1,\ldots,x_\numvars]$ is \emph{\nuCool} if there exists a positive integer $\denom = \denom(\ideala)$ such that the following condition holds.
   Given a proper ideal $\idealb$ in the same ring with $\ideala \subseteq \sqrt \idealb$ and a nonnegative integer $e$, there exist degree $e$ polynomials $G_r(t) \in \QQ[t]$, for every integer $1 \le r < \denom$ prime to $\denom$, such that $\nu(\ideala_p, \idealb_p, p^e) = G_r(p)$ whenever $p$ is sufficiently large and $p \equiv r \bmod \denom$.
\end{definition}

If $\ideala$ is \nuCool, then the constant term $G_r(0)$ is a root of the Bernstein--Sato polynomial of $\ideala$ at the origin, for each $r$ as above \cite[Remark~3.13]{mustata+takagi+watanabe.F-thresholds}.

\smallskip

Budur, \mustata, and Saito showed that monomial ideals are \nuCool \cite[Theorem~4.1]{budur+mustata+saito.roots_bs_polys_monomial}.
Specifically, they showed that if $\ideala$ is a proper, nontrivial monomial ideal in $\QQ[x_1,\ldots,x_\numvars]$, then there exists a positive integer $\denom = \denom(\ideala)$ with the following property:
For each proper ideal $\idealb$ whose radical contains $\ideala$, there are positive rational numbers $\alpha$ and $\beta_r$, for $0 \le r < \denom$, such that
\begin{equation}
   \label{eq: nu-uniformity for monomial ideals}
   \nu(\ideala_p, \idealb_p, p^e) = \alpha p^e - \beta_r
\end{equation}
whenever $p^e \gg 0$ and $p \equiv r \bmod \denom$.

In this paper, we prove an analogous result for a family of analogous invariants, where the standard power $\ideala^\ell$ in \eqref{eq: nu definition} is replaced with the (generalized) Frobenius power $\ideala^{[\ell]}$, introduced by the authors in \cite{hernandez+etal.frobenius_powers}.
If $\kk$ is as above and $(\ideala,\idealb)$ is a radically compatible pair of ideals of $\kk[x_1, \ldots, x_\numvars]$, then for each nonnegative integer $e$ we define
\[\mu(\ideala,\idealb,p^e) = \max\big\{\ell\in \NN : \ideala^{[\ell]} \not\subseteq \idealb^{[p^e]}\big\}.\]
As before, we may start with a radically compatible pair $(\ideala,\idealb)$ in $\QQ[x_1,\ldots,x_\numvars]$, and ask how the numbers $\mu(\ideala_p,\idealb_p,p^e)$ vary with $p$.

\begin{definition}[\muCool ideal]
   \label{defn: muCool}
   A nonzero proper ideal $\ideala$ of $\QQ[x_1,\ldots,x_\numvars]$ is \emph{\muCool} if a condition analogous to that in \Cref{defn: nuCool}
   \pedro{Maybe just make this explicit?}
   holds for $\mu(\ideala_p,\idealb_p,p^e)$, for each proper ideal $\idealb$ in $\QQ[x_1,\ldots,x_\numvars]$ whose radical contains $\ideala$, and each nonnegative integer $e$.
\end{definition}

Our main result shows that monomial ideals are \muCool.
\begin{thmintro}[\textcolor{nicered}{ADD CROSS-REFERENCE}]
   \label{main theorem}
   Every nonzero proper monomial ideal of $\QQ[x_1,\ldots,x_\numvars]$ is \muCool.
\end{thmintro}

Along the way we recover the aforementioned theorem of Budur, \mustata, and Saito \textcolor{nicered}{(ADD CROSS-REFERENCE)}, interpreting the coefficients in \eqref{eq: nu-uniformity for monomial ideals} in the context of certain optimization problems, whose study comprise the bulk of this work. 
We also describe each coefficient of the polynomials determining $\mu(\ideala_p,\idealb_p,p^e)$, which are typically not as simple as \eqref{eq: nu-uniformity for monomial ideals}, in term of optimization problems.
The following examples give a taste of the formulas obtained.

\begin{example}[See \Cref{ex: ft.5}]
   \label{ex1 intro}
   Consider the ideals $\ideala = \ideal{x^5 y^5 z^2, x^3 y^4 z^8, x^4 y^3 z^5}$ and $\idealm = \ideal{x,y,z}$ of $\QQ[x,y,z]$.
   We shall see that
   \[
      \mu(\ideala_p,\idealm_p,p^e) = \frac{4}{17}p^e - \frac{3}{17}p^{e-3}  - 1
    \]
    for each $e\ge 3$ and each sufficiently large prime $p$ congruent to $11$ modulo $\num{2170560}$.
\end{example}

\begin{example}[See \Cref{ex: new example.2}]
   \label{ex2 intro}
   If $\ideala = \ideal{x^{36} y^{19} z^{47}, x^{10} y^{46} z^{25}, x^{31} y^{31} z^{36}}$ and $\ideald = \ideal{x^{29},y^{24},z^{30}}$, we shall see that
%   \[
%      \mu(\ideala_p,\ideald_p,p^e) =
%      \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{\lpr{21+10e}{25}}{25}
%   \]
%   for all $e\ge 4$ and all but finitely many primes $p$ in a certain arithmetic progression.
%
   \[
    \mu(\ideala_p,\ideald_p,p^e) =
    \begin{cases}
       \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{21}{25} & \text{if $e \equiv 0 \bmod 5$}\\[1mm]
       \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{6}{25} & \text{if $e \equiv 1 \bmod 5$}\\[1mm]
       \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{16}{25} & \text{if $e \equiv 2 \bmod 5$}\\[1mm]
       \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{1}{25} & \text{if $e \equiv 3 \bmod 5$}\\[1mm]
       \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{11}{25} & \text{if $e \equiv 4 \bmod 5$}
    \end{cases}
 \]
 whenever $p \gg 0$  and $p \equiv 11 \bmod \num{752523984455421061348766569800}$.
 \pedro{
    This is a bit ridiculous;
    probably it makes sense to be less precise here, and just say that this holds for infinitely many $p$ in some congruence class.
 }
 \daniel{I actually really like the precision.  It gives a real taste of what we can do.  Maybe we can hold off to see if Emily weighs in, but in order to appreciate the glory, I restored the old version (the shortened one is still commented out here)}
 \pedro{
    I'm OK with keeping it annoyingly precise :-)
    Maybe we should include an example after \Cref{universal-denominators-exist:  T} where this monstrous number is ``computed'' (we'll just say that following the steps in the proof, this is what we get).  
 }
\end{example}

\subsection{Frobenius powers}
To convey the significance of \Cref{main theorem}, we trace back some of our motivation for introducing generalized Frobenius powers, which stem from a well-known property of multiplier ideals:
if $\ideala$ is an ideal of $\CC[x_1,\ldots,x_\numvars]$ and $f \in \ideala$ is a general $\CC$-linear combination of a set of generators of $\ideala$, then
\[ \mathcal{J}(f^t) = \mathcal{J}(\ideala^t)\]
for each $t \in (0,1)$ \cite[Proposition~9.2.28]{lazarsfeld.positivity-II}.
Test ideals, which are related to multiplier ideals via reduction to prime characteristic, satisfy several of the properties of multiplier ideals, but do not fare well with regards to the one above. 
For example, if $\ideala$ is a monomial ideal in a polynomial ring in positive characteristic, then the test ideals $\tau(\ideala^t)$ are characteristic independent, while if $f$ is a linear combination of monomial generators of $\ideala$, the test ideals $\tau(f^t)$ typically depend on the characteristic, often in subtle ways.

Aiming at understanding how the Frobenius singularities of an ideal in positive characteristic relate to those of a generic element of the ideal, in \cite{hernandez+etal.frobenius_powers} the authors developed a new theory of Frobenius singularities of pairs in prime characteristic called \emph{\textup{(}generalized\textup{)} Frobenius powers}. 
If $\kk$ is a field of prime characteristic $p$ with $[\kk:\kk^p] <\infty$, and $\ideala$ is an ideal of $\kk[x_1, \ldots, x_\numvars]$, then the Frobenius powers of $\ideala$ are a family of ideals $\ideala^{[t]}$ indexed by a nonnegative real parameter $t$, which agrees with standard Frobenius powers or the ``Frobenius roots'' of \cite{blickle+mustata+smith.discr_rat_FPTs} when $t$ is an integral power of $p$, agrees with test ideals when $\ideala$ is principal, and in general mimics much of the behavior of multiplier ideals and test ideals.

% \textcolor{nicered}{When the exponent is an integer, then the corresponding Frobenius power can be described concretely in terms of generators:
%    If $\ell$ is a natural number, and $\ideala$ is generated by polynomials $f_1, \ldots, f_n$, then $\ideala^{[\ell]}$ is the ideal generated by the products $f^{\vv{u}} = f_1^{u_1}\cdots f_n^{u_n}$, ranging over all points $\vv{u} \in \NN^n$ for which the multinomial coefficient $\binom{\ell}{\vv{u}}$ is nonzero modulo~$p$ \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.}
% \pedro{This may be omitted; if so, just remember to remove the ``as seen in the introduction'' in Section~3, when this is brought up again.}
% \emily{I think we can omit it, since it will be described when we use it.  Do you prefer to keep it?}
% \pedro{No, I think I prefer to omit it; will remove it for now.}
Suppose now that $\ideala$ is generated by monomials $x^{\vv{a}_1},\ldots,x^{\vv{a}_n}$.
Unlike the test ideals $\tau(\ideala^t)$, the Frobenius powers $\ideala^{[t]}$ strongly depend on the characteristic~$p$.
Moreover, if $f=\alpha_1x^{\vv{a}_1}+\cdots+\alpha_nx^{\vv{a}_n}$ for some $\alpha_1,\ldots,\alpha_n \in \kk$ that are algebraically independent over $\FF_p$ and generate $\kk$ over $\FF_p$, then for each $t \in (0,1)$ we have
\[\tau(f^t) = \ideal{f}^{[t]} = \ideala^{[t]}.\]

\subsection{Critical exponents}

Like multiplier and test ideals, the Frobenius powers $\ideala^{[t]}$ form a nonincreasing chain of ideals, that remains constant for small increments of the parameter, and only changes at a discrete set of rational numbers called \emph{critical exponents}---the analogues of the jumping numbers of multiplier ideals, or the $F$-jumping exponents of test ideals.

Critical exponents can be more concretely realized as rates of growth of the numbers $\mu(\ideala,\idealb,p^e)$ which are the focus of this manuscript.
If $(\ideala,\idealb)$ is a radically compatible pair of ideals in a polynomial ring over a field of characteristic $p>0$, then the sequence $\big(\mu(\ideala,\idealb,p^e)/p^e\big)_{e=0}^\infty$ is bounded and nondecreasing; the \emph{critical exponent of $\ideala$ with respect to $\idealb$} is the limit
\[
   \crit(\ideala,\idealb) = \lim_{e\to \infty} \frac{\mu(\ideala,\idealb,p^e)}{p^e}
   = \sup_{e\in \NN} \frac{\mu(\ideala,\idealb,p^e)}{p^e}.
\]
The set of all critical exponents $\crit(\ideala,\idealb)$, as $\idealb$ ranges over all nonzero proper ideals whose radicals contain $\ideala$, coincides with the set of critical exponents of the Frobenius powers of $\ideala$.

\pedro[inline]{
   Somewhere (either here, or in \Cref{sec: LPs}) we need to include the characterization of crits in terms of Frobenius powers.
}
We shall see that if $\ideala \subseteq \QQ[x_1,\ldots,x_\numvars]$ is a monomial ideal, then there exists a positive integer $\denom = \denom(\ideala)$ with the following property:
Given a proper ideal $\idealb \subseteq \QQ[x_1,\ldots,x_\numvars]$ whose radical contains $\ideala$, there exist degree $0$ rational functions $Q_r(t) \in \QQ(t)$, for every integer $1 \le r < \denom$ prime to $\denom$, such that $\crit(\ideala_p, \idealb_p) = Q_r(p)$ whenever $p$ is sufficiently large and $p \equiv r \bmod \denom$.
\pedro{
   Maybe make this an official theorem?
   We could also introduce another definition, ``crit-uniform'', or is that too much?
}

% \begin{example}
%    If $\ideala$ and $\idealm$ are as in \Cref{ex1 intro}, then 
%    \[
%       \crit(\ideala_p,\idealm_p) = \frac{4}{17} - \frac{3}{17p^3}
%     \]
%     for each sufficiently large prime $p$ congruent to $11$ modulo $\num{2170560}$.
% \end{example}

\begin{example}
   If $\ideala$ and $\ideald$ are as in \Cref{ex2 intro}, then 
   \[
      \crit(\ideala_p,\ideald_p) =
      \frac{624}{773} - \frac{\num{1551}}{\num{681013} p} - \frac{\num{2794}}{\num{22025} p^3}
   \]
   for all but finitely many primes $p \equiv 11 \bmod \num{752523984455421061348766569800}$.
\end{example}

The above definition and observations have their counterparts in the theory of test ideals and $F$-jumping exponents: the limit
\[
   \ft{\ideala}{\idealb} = \lim_{e\to \infty} \frac{\nu(\ideala,\idealb,p^e)}{p^e}
   = \sup_{e\in \NN} \frac{\nu(\ideala,\idealb,p^e)}{p^e}
\]
is called the \emph{$F$-threshold of $\ideala$ with respect to $\idealb$}, and the set of all $F$-thresholds $\ft{\ideala}{\idealb}$, as $\idealb$ varies as above, coincides with the set of $F$-jumping exponents of the test ideals of $\ideala$.
If $(\ideala,\idealb)$ is a radically compatible pair of ideals of  $\QQ[x_1,\ldots,x_\numvars]$, where $\ideala$ is a monomial ideal, then \eqref{eq: nu-uniformity for monomial ideals} shows that the $F$-threshold $\ft{\ideala_p}{\idealb_p}$ is independent of~$p$, in striking contrast with the situation for $\crit(\ideala_p,\idealb_p)$ described above.

\todo[inline]{
   TBC
}

\section{Notation and basic notions}

\subsection{Euclidean space}
\label{ss: euclidean spaces and convexity}
We use bold-face lower-case letters to denote points of the Euclidean space $\RR^n$, and the same letter in regular font to represent their coordinates (\eg $\vv{v}=(v_1,\ldots,v_n)$).
The points $(0,\ldots,0)$ and $(1,\ldots,1)$ are denoted $\vv{0}$ and $\vv{1}$, and we write the standard basis vectors of $\RR^n$ as $\canvec_1,\ldots,\canvec_n$.

Given a point $\vv{u}\in \RR^n$, $\norm{\vv{u}}$ denotes its coordinate sum, $u_1+\cdots+u_n$.
The standard inner product in $\RR^n$ is denoted by the usual angle brackets: $\iprod{\vv{u}}{\vv{v}} = u_1v_1 + \cdots + u_nv_n$.
An inequality between points of $\RR^n$ is a shorthand for a system of $n$ coordinatewise inequalities; \eg $\vv{u}\le \vv{v}$ means that $u_i \le v_i$ for each $i=1,\ldots,n$.
In the same vein, operations on numbers are extended to points in $\RR^n$ in a coordinatewise fashion; for instance, $\up{\vv{u}}=(\up{u_1},\ldots,\up{u_n})$.

We say that a point $\vv{u}$ in a coordinate subspace $\mathcal{S}$ of $\RR^n$ is a \emph{positive} (respectively, \emph{nonnegative}) point of $\mathcal{S}$ if $\vv{u}$ is a positive (respectively, nonnegative) linear combination of the standard basis vectors that span $\mathcal{S}$.
We extend this to all points in $\RR^n$, via projection: we say that $\vv{u} \in \RR^n$ is \emph{positive in $\mathcal{S}$} (respectively, \emph{nonnegative in $\mathcal{S}$}) if its projection on $\mathcal{S}$ is a positive (respectively, nonnegative) point of $\mathcal{S}$.
Finally, given $\vv{u},\vv{v}\in \RR^n$, we say that \emph{$\vv{u}$ is less than} (respectively, \emph{less than or equal to}) \emph{$\vv{v}$ in $\mathcal{S}$} if $\vv{v}-\vv{u}$ is positive (respectively, nonnegative) in $\mathcal{S}$.

Note that with these conventions, $\vv{u} < \vv{v}$ if and only if $\vv{u}$ is less than $\vv{v}$ both in $\mathcal{S}$ and in its orthogonal complement $\mathcal{S}^\perp$.

\subsection{Monomial matrices, monomial ideals, and pairs}
\label{monomial newton preliminaries: ss}

We work in the polynomial ring $\kk[x_1, \ldots, x_\numvars]$ over a field $\kk$, and adopt standard multi-exponent notation for denoting monomials; that is, if $\vv{u} \in \NN^\numvars$, then $x^{\vv{u}} = x_1^{u_1} \cdots x_\numvars^{u_\numvars}$.

\begin{definition}[Monomial matrix]
\label{monomial matrix: D}
A \emph{monomial matrix} is a matrix over $\ZZ$ with nonnegative, nonzero rows and columns.
If $\matA$ is an $\numvars \times n$ monomial matrix, then we call $\ZZ^n$ the \emph{domain lattice} and $\ZZ^\numvars$ the \emph{target lattice} of $\matA$.
\end{definition}

\begin{remark}[Connections with monomial ideals]
   \label{monomial matrix ideal: R}
   Consider a proper monomial ideal~$\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$.
   Given a generating set $x^{\vv{a}_1}, \ldots, x^{\vv{a}_n}$ for $\ideala$, not necessarily minimal, with the property that each variable of the ambient polynomial ring appears in some generator, the matrix
   \[
      \matA= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}
   \]
   is an  $\numvars \times n$ monomial matrix.
   Clearly, as this process depends on the choice of a distinguished generating set for the ideal $\ideala$, there are many monomial matrices $\matA$ we can assign to $\ideala$, though each such matrix will necessarily have $m$ rows.
\end{remark}

\begin{remark}[Generators of powers in terms of monomial matrices]
   \label{generators-via-exponent-matrix: R}
   If $\ideala$ is a proper monomial ideal, and $\matA= \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}$ is a monomial matrix associated to $\ideala$, then the generators of powers of $\ideala$ can be described compactly in terms of the matrix $\matA$.
   Indeed, this follows from the fact that the product $(x^{\vv{a}_1})^{k_1} \cdots (x^{\vv{a}_n})^{k_n}$ can be written as $x^{\matA \vv{k}} = x^{k_1 \vv{a}_1 + \cdots + k_n \vv{a}_n}$.
   Thus, $\ideala^\ell$ is generated by all monomials of the form $x^{\matA \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}} = \ell$.
\end{remark}

\begin{definition}[Diagonal ideal]
   A  \emph{diagonal ideal} of $\kk[x_1, \ldots, x_{\numvars}]$ is any \emph{proper} ideal of the form $\ideald = \langle x_1^{u_1}, \ldots, x_{\numvars}^{u_{\numvars}} \rangle$.
   In this case,  we call $\ideald$ the diagonal ideal associated to the \emph{positive} point $\vv{u} = (u_1, \ldots, u_{\numvars}) \in \ZZ^{\numvars}$.
\end{definition}

\begin{definition}[Pairs]
\label{pairs: D}
   A \emph{monomial pair} $(\matA, \vv{u})$ consists of an $\numvars \times n$ monomial matrix $\matA$, and a positive point $\vv{u}$ of $\ZZ^\numvars$, the target lattice of $\matA$.
    An \emph{$\matA$-pair} is a monomial pair whose first entry is $\matA$.
   An \emph{ideal pair} $(\ideala, \ideald)$ consists of a proper monomial ideal $\ideala$ of $\kk[x_1, \ldots, x_{\numvars}]$, along with a diagonal ideal $\ideald$ of the same ambient polynomial ring.
\end{definition}

\begin{remark}[Association of pairs]
\label{associate of pairs: R}
 As in \Cref{monomial matrix ideal: R}, we may associate to each ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$ a monomial pair $(\matA, \vv{u})$.  Observe that, though there need not be a canonical choice for the $\numvars \times n$ matrix $\matA$, the positive point $\vv{u} \in \ZZ^\numvars$ is uniquely determined by the diagonal ideal $\ideald$.
\end{remark}

\subsection{Optimization} \label{optimization: S}  Optimization problems play a central role in this paper.  Here, we briefly recall the basic framework of standard \emph{programming}.

Suppose that $\mathcal{X}$ is either $\RR^n$ or $\ZZ^n$.  By a \emph{program $\Omega$ in the ambient space $\mathcal{X}$}, we mean an optimization problem seeking to maximize some given linear \emph{objective function} $\RR^n \to \RR$ on some subset of $\mathcal{X}$ defined by a system of linear inequalities, called the \emph{constraints} of the program $\Omega$. If $\mathcal{X} = \RR^n$, then the points in $\mathcal{X}$ satisfying these constraints define a polyhedron in $\RR^n$, while if $\mathcal{X} = \ZZ^n$, then the points in $\mathcal{X}$ satisfying these constraints instead consist of the lattice points in some polyhedron in $\RR^n$.  In either case, we call this set of points in $\mathcal{X}$ the \emph{feasible set} of the program.  We denote it by $\feas \Omega$, and say that the points in this set are \emph{feasible} for the program $\Omega$.

To distinguish between these cases, we refer to a program in $\mathcal{X} = \RR^n$ as a {real linear program}, or \emph{linear program} for short, and to a program in $\mathcal{X}=\ZZ^n$ as an {integer linear program}, or \emph{integer program} for short.

Every program $\Omega$ we consider in this article has the property that the values taken on by the objective function on $\feas \Omega$ are bounded from above, and in this case, the maximum value achieved by the objective function on this feasible set is called the \emph{value} of the program $\Omega$, and is denoted $\val \Omega$.  The subset of $\feas \Omega$ where the objective function achieves this maximum value is called the \emph{optimal set} of $\Omega$, and is denoted $\opt \Omega$.   When $\Omega$ is a linear program in $\RR^n$, its optimal set is a face of the polyhedron $\feas \Omega$ in $\RR^n$.

\section{Background}
\label{background: S}

\daniel[inline]{Not sure where this should go, but it will be needed in the appendix}
\begin{lemma} 
\label{compatible to small compatible: L}
 Suppose that $(\ideala, \idealb)$ is a compatible pair of ideals in a polynomial ring over a field of characteristic $p>0$, let $t$ be the natural number such that $\ideala^t \not \subseteq \idealb$ but $\ideala^{t+1} \subseteq \idealb$, and set $\idealc = (\idealb : \ideala^t)$.   If $p > t+1$ and $e$ is a nonnegative integer, then
\[ \mu(\ideala, \idealb, p^e) = t p^e + \mu(\ideala, \idealc, p^e). \] 
\end{lemma}

\begin{proof}  Set $q=p^e$ and $s=\mu(\ideala, \idealc, p^e)$.  The containment $\ideala \subseteq \idealc$ implies that $0 \leq s < q$, and combining this with the bounds $0 \le t < p-1$, we see that 
%
\begin{align*}
\ideala^{[tq+s]} & = (\ideala^t)^{[q]} \ideala^{[s \, ]} \\ 
 \ideala^{[tq+s+1]} & = (\ideala^t)^{[q]} \ideala^{[s+1]}
\end{align*}
%
though to establish the second identity, the case $s=q-1$ must be considered separately, and requires the bound $p>t+1$.  Thus, $\ideala^{[tq+s]} \not \subseteq \idealb^{[q]}$, for otherwise, \[ \ideala^{[s]} \subseteq \big(\idealb^{[q]} : (\ideala^t)^{[q]}\big) = \idealc^{[q]}\]  contradicting our choice of $s$.  The containment $\ideala^{[tq+s+1]} \subseteq \idealb^{[q]}$ follows similarly, and we conclude that $\mu(\ideala,\idealb,q) = tq + s$. 
\end{proof}.


\section{Connections with optimization}
\label{sec: LPs}

Throughout this section, we consider an ideal pair $(\ideala, \ideald)$ in $\kk[x_1, \ldots, x_{\numvars}]$, as described in \Cref{pairs: D}.
Our goal here, and for much of the rest of the article, is to study the integers $\nu(\ideala, \ideald, p^e)$ and $\mu(\ideala, \ideald, p^e)$ and the rational numbers $\ft{\ideala}{\ideald}$ and $\crit(\ideala, \ideald)$ defined in the introduction.
As will soon be apparent, it is natural to do so in terms of various optimization problems.

\begin{remark} \label{reduction to diagonal :R}
   This context might seem restrictive, given that our ultimate goal is to understand the nature of those numerical invariants when the diagonal ideal~$\ideald$ is replaced with an arbitrary ideal $\idealb$.
   However, as we explain in \Cref{monomial-reduction: A}, understanding the situation for all ideal pairs $(\ideala, \ideald)$ with $\ideala$ fixed, but $\ideald$ varying, leads to \Cref{main theorem}.
\end{remark}

To transition from algebra to optimization, fix a monomial pair $(\matA, \vv{u})$ associated to $(\ideala, \ideald)$, as described in \Cref{associate of pairs: R}.  In particular, $\matA$ is an $\numvars \times n$ monomial matrix, $\vv{u} \in \ZZ^\numvars$ is a positive lattice point, and
\[ \ideald = \langle x^{u_1}, \ldots, x^{u_{\numvars}} \rangle \subseteq \kk[x_1, \ldots, x_{\numvars}] \] is the diagonal ideal associated to $\vv{u}$.

\subsection{Relations with integer and linear programs}
We start by studying the integers $\nu(\ideala, \ideald, p^e)$ and the rational numbers $\ft{\ideala}{\ideald}$.
%as touched on in \Cref{reduction to diagonal :R}, we will later be able to use the results established in this restrictive setting to obtain more general ones.
First, recall that for each $q$ a power of $p$, the integer $\nu(\ideala, \ideald, q)$ is defined as
\[\nu(\ideala,\ideald,q) = \max\big\{\ell \in \NN : \ideala^{\ell} \not\subseteq \ideald^{[q]}\big\}.\]
As noted in \Cref{generators-via-exponent-matrix: R},  the ideal $\ideala^{\ell}$ is generated by all monomials of the form $x^{\matA\vv{k}}$, with $\vv{k}\in \NN^n$ and $\norm{\vv{k}} = \ell$.  Furthermore, as $\ideald^{[q]}$ is the diagonal ideal associated to $\vv{u}q$, we have that $\ideala^{\ell} \not\subseteq \ideald^{[q]}$ if and only if there is some generator $x^{\matA \vv{k}}$ of $\ideala^{\ell}$ with $\matA\vv{k} < \vv{u}q$.  Thus, computing $\nu(\ideala,\ideald,q)$ is equivalent to maximizing the value of $\norm{\vv{k}}$, with $\vv{k} \in \ZZ^n$, and subject to the constraints $\vv{k} \geq \vv{0}$ and $\matA\vv{k} < \vv{u}q$.
This observation motivates the following definition.

\begin{definition}[The integer program $\IP$]
\label{IP: D}
   If $q$ is a positive integer, then $\IP(\matA, \vv{u}, q)$ is the integer program in the domain lattice of $\matA$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $\matA \vv{k} \leq \vv{u}q - \vv{1}$.
\end{definition}

It is easy to deduce from the fact that the matrix $\matA$ is a monomial matrix (\ie has nonnegative, nonzero rows and columns) that the feasible set of $\IP(\matA,\vv{u},q)$ is finite, and hence this integer program has a well-defined value.
Moreover, the discussion preceding \Cref{IP: D} demonstrates that
\begin{equation}
\label{nu as program value: eq}
\nu(\ideala,\ideald,q) = \val \IP(\matA,\vv{u},q).
\end{equation}

We now shift our attention from the integers $\nu(\ideala, \ideald, q)$ to the $F$-threshold $\ft{\ideala}{\ideald}$.  First, note that \eqref{nu as program value: eq} and the definition of $\ft{\ideala}{\ideald}$ imply that
\begin{equation}
\label{ft as limit of normalized program values: eq}
\ft{\ideala}{\ideald} = \lim_{e\to\infty} \frac{\nu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP(\matA,\vv{u},p^e)}{p^e}.
\end{equation}

Continuing with our theme, we seek to describe this number in terms of a certain optimization program, which we define below.

\begin{definition}[The linear program $\LP$]
\label{LP: D}
 $\LP(\matA, \vv{u})$ is the linear program in the domain of $\matA$ which consists of maximizing $\vv{k} \mapsto \norm{\vv{k}}$ subject to the constraints $\vv{k} \geq \vv{0}$ and $\matA \vv{k} \leq \vv{u}$.
\end{definition}

Once again, the fact that $\matA$ is monomial implies that the feasible set of the linear program $\LP(\matA,\vv{u})$ is bounded, and therefore a polytope in the domain of $\matA$.  Consequently, $\LP(\matA,\vv{u})$ has a well-defined value.

\begin{proposition}
\label{ft as val LP: P}
The value of $\LP(\matA, \vv{u})$ equals the $F$-threshold $\ft{\ideala}{\ideald}$.
\end{proposition}

\begin{proof}
  Recall that, as $\matA$ is an $\numvars \times n$ monomial matrix, the domain of $\matA$ is $\RR^n$, and the domain lattice of $\matA$ is $\ZZ^n$.  If $\vv{k} \in \ZZ^n$ is optimal for $\IP(\matA,\vv{u},q)$, then the scaled point $\vv{k}/q$ is feasible for $\LP = \LP(\matA, \vv{u})$, so $\val \LP \geq \val \IP(\matA, \vv{u}, q)/q$ for all $q$.
   Thus, $\val \LP$ is at least equal to the limits appearing in \eqref{ft as limit of normalized program values: eq}.

   Conversely, given an optimal point $\vv{t} \in \RR^n$ for $\LP$,
   define $\vv{t}_q \in \ZZ^n$ as the point whose $i$-th coordinate is $0$ if $t_i=0$, and otherwise equals $\lceil q t_i \rceil - 1$, the greatest integer less than $q t_i$.
   By design, and the fact that $\matA$ is a monomial matrix, the $i$-th entry of $\matA \vv{t}_q$ is either less than the $i$-th entry of $\matA (q \vv{t})$, which itself is less than or equal to $u_iq$, by the feasibility of $\vv{t}$ for $\LP$, or equals $0$,  in which case it is also less than $u_i q$ since $\vv{u}$ is positive. This observation demonstrates that $\vv{t}_q$ is feasible for $\IP(\matA, \vv{u}, q)$, and so
   \[\val \IP(\matA, \vv{u}, q) \geq \norm{\vv{t}_q} \geq \sum_{i=1}^n \big(\lceil q t_i \rceil - 1\big) \geq q \norm{\vv{t}} -n = q \cdot \val \LP - n.\]
   Dividing by $q$ and taking the limit as $q$ tends to infinity, we find that the limits in \eqref{ft as limit of normalized program values: eq} are at least $\val \LP$, which completes the proof.
\end{proof}

Thus, in practice, it is as difficult to effectively compute $\ft{\ideala}{\ideald}$ and $\nu(\ideala, \ideald, p^e)$ as it is to effectively solve standard linear and integer programs, which can be hard.
Nevertheless, there are still some special cases in which these quantities are easy to determine.
We consider perhaps the simplest such example below.

\begin{example}
\label{concrete-solution-to-LP-IP: E}  
Fix a positive integer $d \ge 2$, and consider the diagonal matrix 
\[ \matA = \begin{bmatrix} d & 0 \\ 0 & d \end{bmatrix}. \] 
If $\vv{u} = (s, t) \in \ZZ^2$ is a positive point, then the optimal set of $\LP(\matA,\vv{u})$ consists of the single point $(s/d, t/d)= \vv{u}/d$, and if $q$ is a positive integer, then it is not hard to verify that the optimal set of $\IP(\matA, \vv{u}, q)$ consists of the single point
\[ \left( \frac{s q  - \lpr{s q}{d}}{d},  \frac{t q  - \lpr{t q}{d}}{d} \right) = \frac{\vv{u}q - (\lpr{sq}{d}, \lpr{tq}{d})}{d} \] 
where $\lpr{a}{b}$ is the least \emph{positive} residue of $a$ modulo $b$.  Therefore, $\val \LP(\matA,\vv{u})$ equals $\norm{\vv{u}}/d$ and $\val \IP(\matA,\vv{u},q)$ equals $\val \LP(\matA,\vv{u})  q - \lpr{sq}{d}/d-\lpr{tq}{d}/d$.
\end{example}

\subsection{Relations with arithmetic and fractal programs}

We now turn our attention to the integers $\mu(\ideala, \ideald, p^e)$ and the rational numbers $\crit(\ideala,\ideald)$.
Recall that for each $q$ a power of $p$, the integer $\mu(\ideala, \ideald, q)$ is defined as
\[\mu(\ideala,\ideald,q) = \max\big\{ \ell \in \NN : \ideala^{[\ell]} \not\subseteq \ideald^{[q]}\big\},\]
where $\ideala^{[\ell]}$ is the $\ell$-th (generalized) Frobenius power of $\ideala$.

If $\idealb$ is an ideal of a ring of characteristic $p$ with generators $g_1, \ldots, g_n$, then $\idealb^{[\ell]}$ is the ideal generated by the products $g_1^{k_1}\cdots g_n^{k_n}$, ranging over $\vv{k} \in \NN^n$ with $\norm{\vv{k}}=\ell$, and for which the multinomial coefficient $\binom{\ell}{\vv{k}} =
\frac{\ell!}{k_1 !\, \cdots\, k_n !}$ is nonzero modulo~$p$ \cite[Proposition~3.5]{hernandez+etal.frobenius_powers}.
In light of this, \Cref{generators-via-exponent-matrix: R} tells us that $\ideala^{[\ell]}$ is generated by the monomials of the form $x^{\matA \vv{k}}$ with $\vv{k} \in \NN^n$ satisfying $\norm{\vv{k}}=\ell$ and $\binom{\ell}{\vv{k}} \not\equiv 0 \bmod p$.  As in the previous subsection, we may conclude that $\mu(\ideala,\ideald,q)$ is the maximum value of $\norm{\vv{k}}$, with $\vv{k} \in \NN^n$ subject to the linear constraint $\matA\vv{k} < \vv{u}q$, but also subject to the highly nonlinear constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not\equiv 0 \bmod{p}$.  Motivated by this, we introduce a variant of an integer program that we call an \emph{arithmetic integer program}.

\begin{definition}[The arithmetic integer program $\IP_p$]
\label{aip: D}
If $q$ is a power of $p$, then $\IP_p(\matA, \vv{u}, q)$ is the \emph{arithmetic integer program} in the domain lattice of $\matA$ which consists of maximizing the objective function $\vv{k} \mapsto \norm{\vv{k}}$ subject to the linear constraints $\vv{k} \geq \vv{0}$ and $\matA \vv{k} \leq \vv{u}q - \vv{1}$, and the arithmetic constraint $\binom{\norm{\vv{k}}}{\vv{k}} \not \equiv 0 \bmod p$.
\end{definition}

We define the terms \emph{feasible, optimal}, and \emph{value} relative to the arithmetic program $\IP_p(\matA, \vv{u}, q)$ in analogy with those for the integer program $\IP(\matA, \vv{u}, q)$.

\begin{remark}[A characterization of the arithmetic constraint]
   \label{dickson: R}
   Consider $\ell \in \NN$ and $\vv{k} \in \NN^n$.
   In base $p$, we express these quantities as $\ell = \sum_{e=0}^s \ell_e p^e$ and $\vv{k}=\sum_{e=0}^s \vv{k}_e p^e$ where $0\le \ell_e < p$ and $\vv{0}\le\vv{k}_e < p  \vv{1}$ for each $0 \leq e \leq s$, and where $\ell_s$ and $\vv{k}_s$ are allowed to be zero.
   In any case, \cite{dickson.multinomial} then tells us that $\binom{\ell}{\vv{k}}\equiv \binom{\ell_0}{\vv{k}_0}\binom{\ell_1}{\vv{k}_1}\cdots \binom{\ell_s}{\vv{k}_s} \mod{p}$.

   In particular, the multinomial coefficient $\binom{\ell}{\vv{k}}$ is nonzero modulo $p$ if and only if $\norm{\vv{k}_e}=\ell_e$ for each $e$, a condition that is sometimes described by saying that the entries of the vector $\vv{k}$ sum to $\ell$ \emph{without carrying} in base $p$.
   In light of this, the arithmetic constraint in \Cref{aip: D} is equivalent to the condition that all terms $\vv{k}_e$ of the base $p$ expansion of the lattice point $\vv{k}$ have coordinate sum less than $p$.
\end{remark}

Clearly, the feasible set of $\IP_p(\matA, \vv{u}, q)$ lies in the feasible set of $\IP(\matA, \vv{u},q)$, and is therefore finite.
In particular, this arithmetic program has a well-defined value, and the discussion preceding \Cref{aip: D} tells us that
\begin{equation}
\label{mu as program value: eq}
\mu(\ideala,\ideald,q) = \val \IP_p(\matA,\vv{u},q).
\end{equation}

Turning to the critical exponents $\crit(\ideala, \ideald)$, the identity \eqref{mu as program value: eq} implies that
\begin{equation}
\label{crit as limit of normalized program values: eq}
\crit(\ideala,\ideald) = \lim_{e\to\infty} \frac{\mu(\ideala,\ideald,p^e)}{p^e} = \lim_{e\to\infty} \frac{\val \IP_p(\matA,\vv{u},p^e)}{p^e}.
\end{equation}
In what follows, in analogy with \Cref{ft as val LP: P}, we seek to relate these quantities to the value of a variant of a linear program that we call a \emph{fractal linear program}.  To do so, we require the following concept.

\begin{definition}[Sierpi\'nski gasket]
   \label{sierpinski: D}
   The \emph{Sierpi\'nski $p$-gasket of dimension $n$} is the set $\sierp_{p,n}$ consisting of all points $\vv{t}\in \RR^n$ for which there exist $s \in \ZZ$ and a sequence of points $( \vv{t}_e )_{e=s}^\infty$ in $\NN^n$ such that $\norm{\vv{t}_e} < p$ for all $e \geq s$, and
 \[
\vv{t} = \sum_{e=s}^{\infty} \frac{\vv{t}_e}{p^e}.
 \]
\end{definition}

Note that the integer $s \in \ZZ$ in \Cref{sierpinski: D} can be negative.
It is immediate from the definition that $\vv{t} \in \sierp_{p,n}$ if and only if $p^k  \vv{t} \in \sierp_{p,n}$ for some (equivalently, for every) integer $k \in \ZZ$; this reflects the self-symmetry observed in \Cref{fig: sierpinski 3-gasket}.
In particular, when determining whether $\vv{t} \in \RR^n$ lies in $\sierp_{p,n}$, we may scale $\vv{t}$ by a power of $p$  and assume that $\vv{t} \in [0,1]^n$.

Recall that every number $t \in [0,1]$ either has a unique base $p$ expansion, which is necessarily non-terminating, or else $p^k t \in \NN$ for some $k \in \ZZ$, in which case $t$ has both a terminating and a non-terminating expansion.
Thus, if $\vv{t} \in [0,1]^n$ is such that no component of $p^k \vv{t}$ is an integer for each $k \in \NN$, then there is a unique sequence $( \vv{t}_e )_{e=1}^{\infty}$ in $ \NN^n$ such that $\vv{t} = \sum_{e=1}^{\infty} \frac{\vv{t}_e}{p^e}$, and such point lies in ${\sierp}_{p,n}$ if and only if $\norm{\vv{t}_e} < p$ for every  $e$.
However, things can be more subtle when some $p^k \vv{t}$ has an integer component.

\begin{example}[A point of $\sierp_{2,2}$]
   If $p=2$, then $(1/4, 1/4) \in \sierp_{2,2}$.
   Indeed, for the first component, take the non-terminating binary expansion $\frac{1}{4} = \frac{1}{2^3} + \frac{1}{2^4} + \frac{1}{2^5} + \cdots$, and for the second component, simply take the expansion $\frac{1}{4} = \frac{1}{2^2}$.
   Note that if one instead considered the non-terminating expansion for both components, or the terminating expansion for both components, then the resulting expansion of $(1/4, 1/4)$ would fail to satisfy the condition in \Cref{sierpinski: D}.
\end{example}

This description of the Sierpi\'nski $p$-gasket in terms of expansions is not hard to translate geometrically into its description as a fractal.

\begin{example}[Geometric description of $\sierp_{2,2}$]
   \label{sierpinski triangle: E}
   The set $\sierp_{2,2} \cap [0,1]^2$ is the familiar Sierpi\'nski triangle, together with the line segments connecting $(1,0)$ to $(1,1)$, and $(1,1)$ to $(0,1)$.
   Indeed, the points $\vv{t}$ in the unit square $[0,1]^2$ that have \emph{no} binary expansion $\vv{t} = \sum_{e=1}^{\infty}\frac{\vv{t}_e}{2^e}$ as above with $\norm{\vv{t}_1} < 2$ are precisely the points in the open triangle  $T = \{ (a,b) \in \RR^2 : a,b < 1, a+b > 1 \}$.
   At the next stage, the points $\vv{t} \in [0,1]^2$ with \emph{no} expansion $\vv{t} = \sum_{e=1}^{\infty}\frac{\vv{t}_e}{2^e}$ with both  $\norm{\vv{t}_1} < 2$ and $\norm{\vv{t}_2} < 2$ are those in the union of open triangles $T$ and $\frac{1}{2} T$.
   The condition on expansions at the third place removes three additional open triangles from this set, namely $\frac14 T$, $\frac14 T + (\frac12,0)$, and $\frac14 T + (0,\frac12)$, and we continue analogously.
\end{example}

As suggested by \Cref{sierpinski triangle: E}, each $\sierp_{p,n}$  can be realized by removing a union of open simplices from $\RRnn^n$, and hence, is a closed set.
\Cref{fig: sierpinski 3-gasket} illustrates the self-similarity of the $2$-dimensional Sierpi\'nski $3$-gasket.

\begin{figure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_a.pdf}
  \caption{Restriction to $[0,1]^2$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
  \centering
  \includegraphics[width=.9\linewidth]{pictures/sierpinski3_b.pdf}
  \caption{Restriction to $[0,9]^2$}
\end{subfigure}
\caption{The $2$-dimensional Sierpi\'nski 3-gasket}
\label{fig: sierpinski 3-gasket}
\end{figure}

Remarkably, the critical exponent of the ideal pair $(\ideala, \ideald)$ described in \eqref{crit as limit of normalized program values: eq} can be described in terms of the Sierpi\'nski $p$-gasket, providing a geometric interpretation for this value.
To motivate our approach, we first note that the feasible set of the linear program $\LP(\matA, \vv{u})$, whose value equals the $F$-threshold $\ft{\ideala}{\ideald}$ by \Cref{ft as val LP: P}, is simply the closure with respect to the Euclidean topology of the set $\{ \vv{t} \in \RR^n : \vv{t} \geq \vv{0} \text{ and } \matA\vv{t} < \vv{u} \}$.
In what follows, we consider a similar optimization problem,  replacing the conditions that $\vv{t} \in \RR^n$ and $\vv{t} \geq \vv{0}$ with the ``fractal constraint" that $\vv{t} \in \sierp_{p,n}$.

\begin{definition}[The fractal linear program $\fip_p$]
\label{fractal program: D}
The \emph{fractal linear program} $\fip_p(\matA,\vv{u})$ consists of maximizing the objective function $\vv{t}\mapsto \norm{\vv{t}}$ on the Euclidean closure of the set \[ \{ \vv{t} \in \sierp_{p,n} : \matA \vv{t} < \vv{u} \}.\]  We call this closure the feasible set of $\fip_p(\matA, \vv{u})$, and denote it by $\feas \fip_p(\matA, \vv{u})$.
\end{definition}

\begin{remark}
Note that the closure in the above definition need not agree with the closed set $\{ \vv{t} \in \sierp_{p,n} : \matA \vv{t} \le \vv{u} \}$.
For example, if $\matA$ is the $2\times 2$ identity matrix, $\vv{u} = (1,1)$, and $p=2$, then the closure of the set $\{ \vv{t} \in \sierp_{2,2} : \matA \vv{t} < \vv{u} \}$ is simply the classical Sierpi\'nski triangle---the set of points $\vv{t}$ in $\sierp_{2,2}$ with $\norm{\vv{t}} \le 1$.
The set $\{ \vv{t} \in \sierp_{2,2} : \matA \vv{t} \le \vv{u} \}$, on the other hand, also includes the line segments from $(1,0)$ to $(1,1)$, and from $(1,1)$ to $(0,1)$.
\end{remark}

The discussion preceding \Cref{fractal program: D} implies that $\feas \fip_p(\matA, \vv{u})$ is contained in the feasible set of $\LP(\matA, \vv{u})$, and hence, is bounded.
Thus, $\feas \fip_p(\matA, \vv{u})$ is compact, and so the value of $\fip_p(\matA, \vv{u})$ can be defined as
\[
   \max \{ \norm{\vv{t}}: \vv{t} \in \feas \fip_p(\matA, \vv{u}) \} = \sup \{ \norm{\vv{t}} : \vv{t} \in \sierp_{p,n}, \matA \vv{t} < \vv{u} \}
\]
which is a well-defined real number.
As usual, we define the optimal set of $\fip_p(\matA, \vv{u})$ to be the set $\opt \fip_p(\matA, \vv{u})$ of feasible points where this maximum is attained.

\begin{example}[A simple fractal linear program, in various characteristics]
   \label{ex: feas fip}
   Consider the fractal linear program $\fip_p = \fip_p(\matA, \vv{u})$, where
\[ \matA = \begin{bmatrix}
 3&11\\ 11&2 \\ 5&10 \\ 2&0
 \end{bmatrix}
\quad \text{and} \quad \vv{u} = \begin{bmatrix} 1 \\ 1 \\ 1 \\ \end{bmatrix}.
\]
\Cref{fig: feas fip} illustrates the key features of the program $\fip_p$ for small values of $p$.
The feasible set for $ \fip_p$ is displayed in dark blue, the feasible set for $\LP = \LP(\matA,\vv{u})$ in gray, and the line of points with coordinate sum equal to $\val \fip_p$ in green.
Thus,  $\opt \fip_p$ is simply the intersection of the blue points and green points.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}
  \centering
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char2.pdf}\hskip .04\textwidth
   \captionsetup{labelformat=empty}
   \caption{$p=2$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
\includegraphics[width=.9\textwidth]{pictures/ex4_char3.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=3$}
\end{subfigure}

\bigskip

\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char5.pdf}\hskip .04\textwidth
  \captionsetup{labelformat=empty}
  \caption{$p=5$}
\end{subfigure}
\begin{subfigure}{.49\textwidth}
\centering
  \includegraphics[width=.9\textwidth]{pictures/ex4_char7.pdf}
  \captionsetup{labelformat=empty}
  \caption{$p=7$}
\end{subfigure}
\caption{The feasible and optimal sets of $\fip_p(\matA, \vv{u})$ for $\matA$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{fig: feas fip}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\Cref{table: feas fip details} provides a more precise description of these quantities.
It is worth mentioning that when $p=5$, the optimal sets of $\fip_p$ and $\LP$ agree, and consequently so do their values.
On the other hand, if $p=2$, $3$, or $7$, then $\val \fip_p < \val \LP$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%START OF TABLE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{table}
\begin{center}
\begingroup
\setlength{\tabcolsep}{8pt} % Default value: 6pt
\renewcommand{\arraystretch}{1.4} % Default value: 1
\begin{tabular}{ccc}
  \toprule
  $p$ & $\val \fip_p$ & $\opt \fip_p$  \\
  \midrule
  $2$ & $\frac18$ & $\conv\big(\big(\frac1{20}, \frac3{40}\big),\big(\frac1{12}, \frac1{24}\big)\big)$ \\
  $3$ & $\frac19$ & $\conv\big(\big(\frac{1}{36}, \frac1{12}\big),\big(\frac7{81}, \frac2{81}\big)\big)$ \\
  $5$ & $\frac7{50}$ & $\big\{\big(\frac2{25}, \frac3{50}\big) \big\}$  \\
  $7$ & $\frac{34}{245}$ & $\big\{\big(\frac{19}{245}, \frac3{49}\big) \}$ \\
  \bottomrule
\end{tabular}
\endgroup
% The \begingroup ... \endgroup pair ensures the separation
% parameters only affect this particular table, and not any
% sebsequent ones in the document.
\end{center}
\medskip
\caption{The values and optimal sets of $\fip_p(\matA, \vv{u})$ for $\matA$ and $\vv{u}$ described in \Cref{ex: feas fip}, for small values of $p$}
\label{table: feas fip details}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%END OF FIGURE DISPLAYING FRACTAL PROGRAM DATA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{example}

\begin{proposition}
   \label{prop: value of fractal program is crit}
   The value of $\fip_p(\matA,\vv{u})$ equals $\crit(\ideala, \ideald)$.
\end{proposition}

\begin{proof}
   If $e \in \NN$, then the constraints of $\IP_p(\matA, \vv{u}, p^e)$ imply that $p^{-e}  \feas \IP_p(\matA, \vv{u}, p^e)$ lies in $\feas \fip_p(\matA,\vv{u})$.
   It then follows from this and \eqref{crit as limit of normalized program values: eq} that
   \[
      \val\fip_p(\matA,\vv{u}) \ge \displaystyle \lim_{e \to \infty}\frac{\val\IP_p(\matA,\vv{u}, p^e)}{p^e} = \crit(\ideala, \ideald).
   \]

   Next, fix a point $\vv{t} \in \sierp_{p,n}$ with $\matA \vv{t} < \vv{u}$.
   By definition of $\sierp_{p,n}$, we may fix an integer $s$, and a sequence $( \vv{t}_i )_{i=s}^\infty$ in $\NN^n$ with $\norm{\vv{t}_i} < p$ for all $i \geq s$, such that $\vv{t} = \sum_{i=s}^{\infty} \frac{\vv{t}_i}{p^i}$.
   For each nonnegative integer $e \geq s$, set $\vv{t}^\star_{p^e} = \sum_{i=s}^{e} \frac{\vv{t}_i}{p^i}$.

   We claim that $p^e  \vv{t}^\star_{p^e}$ is feasible for $\IP_p(\matA, \vv{u}, p^e)$.
   To see why, first note that \Cref{dickson: R} tells us that this point satisfies the arithmetic constraint of $\IP_p(\matA, \vv{u}, p^e)$.
   Furthermore, $\vv{t}^{\star}_{p^e} \leq \vv{t}$, and so $\matA \vv{t}^{\star}_{p^e} \leq \matA \vv{t} < \vv{u}$, which demonstrates that $p^e \vv{t}^\star_{p^e}$ satisfies the linear constraints of $\IP_p(\matA, \vv{u}, p^e)$.
   Dividing by $p^e$ and taking limits, we find that
   \[
      \crit(\ideala, \ideald) = \lim_{e \to \infty} \frac{\val \IP_p(\matA, \vv{u}, p^e)}{p^e} \geq \lim_{e \to \infty}   \norm{\vv{t}^\star_{p^e}} = \norm{\vv{t}}.
   \]

   We have just shown that the objective function $\vv{t} \mapsto \norm{\vv{t}}$ is at most $\crit(\ideala, \ideald)$ on the set $\{ \vv{t} \in \sierp_{p,n} : \matA \vv{t} < \vv{u} \}$, and so the same must be true on the closure of this set, which is the feasible set of $\fip_p(\matA, \vv{u})$.
   Restated,  $ \val \fip_p(\matA, \vv{u})$ is at most $\crit(\ideala,  \ideald)$, and so equality holds.
\end{proof}

\daniel[inline]{This isolates an argument from the appendix that I felt was more appropriate here.}
\begin{lemma} 
   \label{lifted-programs: L}
   Suppose that $\matB$ is a monomial matrix obtained by deleting some rows of a monomial matrix $\matA$ with $m$ rows.
   In fact, for the sake of concreteness, suppose that $\matB$ consists of the first $\ell$ rows of $\matA$, and is monomial.
   Given a positive point $\vv{v} \in \mathbb{Z}^{\ell}$, there is a positive point $\vv{u} \in \ZZ^{\numvars}$ such that $u_i = v_i$ for all $1 \leq i \leq \ell$, and such that the values of $\IP_p(\matA, \vv{u}, p^e)$ and $\IP_p(\matB, \vv{v}, p^e)$ coincide for all $p$ and $e$.
\end{lemma}

\begin{proof}  As $\matB$ is monomial, the feasible set of the standard linear program $\LP(\matB, \vv{v})$ is compact, and so we may fix a positive integer $\omega$ greater than every inner product of the form $\iprod{\vv{r}}{\vv{f}}$, where $\vv{r}$ ranges over the last $m-\ell$ rows of $\matA$, and $\vv{f}$ ranges over all points in $\feas \LP(\matB,\vv{v})$. In what follows, let $\vv{u} \in \ZZ^{\numvars}$ be any point with $u_i = v_i$ for $1 \leq i \leq \ell$, and whose remaining $m-\ell$ coordinates are at least $\omega$. 

To conclude, we will show that the feasible sets of $\IP_p(\matA, \vv{u}, p^e)$ and $\IP_p(\matB, \vv{v}, p^e)$ coincide for all $p$ and $e$.  First, note that the arithmetic constraints of these programs are identical, and that each linear constraint of $\IP_p(\matB, \vv{v}, p^e)$ is a linear constraint of $\IP_p(\matA, \vv{u},p^e)$.  Thus, $\feas \IP_p(\matA, \vv{u}, p^e)$ is contained in $\feas \IP_p(\matB, \vv{v}, p^e)$.  On the other hand, if $\vv{k} \in \feas \IP_p(\matB, \vv{v}, p^e)$, then the normalized point $\vv{k}/p^e$ lies in $\feas \LP(\matB, \vv{v})$, and so if $\ell < i \leq m$, its inner product with the $i$-th row of $\matA$ is less than $\omega$, and thus, less than $u_i$, which demonstrates that $\vv{k} \in \feas \IP_p(\matA, \vv{u}, p^e)$.  
\end{proof}


\section{Connections with Newton polyhedra}
\label{s: newton}
Here, as in \Cref{sec: LPs},  we use $\matA$ to denote a fixed $\numvars \times n$ monomial matrix.
In fact, throughout this section, we fix an $\matA$-pair $(\matA, \vv{u})$, so that $\vv{u}$ is a point in $\NN^\numvars$ with positive entries.
Our goal is to study the linear program $\LP(\matA, \vv{u})$ in terms of the \emph{Newton polyhedron} associated to the matrix $\matA$.

\subsection{Newton polyhedra and their faces}

For the reader's convenience, we start this section with a brief account of the terminology, basic facts, and notations associated with polyhedral geometry that will be used here and throughout the paper.

A (convex) \emph{polyhedron} in $\RR^n$ is a subset of $\RR^n$ obtained by intersecting finitely many closed halfspaces or, equivalently, a set consisting of all points $\vv{x}\in \RR^n$ satisfying an inequality of the form $\matM\vv{x}\le \vv{b}$, where $\matM$ is a matrix with $n$ columns.
The (convex) \emph{cone generated by $\vv{u}_1,\ldots,\vv{u}_k \in \RR^n$}, denoted $\cone(\vv{u}_1,\ldots,\vv{u}_k)$, is the set consisting of all \emph{conical combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative real numbers.
Likewise, the \emph{convex hull of $\vv{u}_1,\ldots,\vv{u}_k$}, denoted $\conv(\vv{u}_1,\ldots,\vv{u}_k)$, is the set of all \emph{convex combinations} of $\vv{u}_1, \ldots, \vv{u}_k$, that is, points of the form $\sum_{i=1}^k \lambda_i \vv{u}_i$, where the $\lambda_i$ are nonnegative and $\sum_{i=1}^k \lambda_i = 1$.
The convex hull of a finite set of points is called a \emph{polytope}.

If $\mathcal{U}$ and $\mathcal{V}$ are subsets of $\RR^n$, their \emph{Minkowski sum} is the set
\[\mathcal{U}+\mathcal{V} \coloneqq \{\vv{u}+\vv{v}: \vv{u}\in \mathcal{U}\text{ and }\vv{v}\in \mathcal{V}\}.\]
The \emph{Minkowski--Weyl Theorem} asserts that a subset $\mathcal{P}$ of $\RR^n$ is a polyhedron if and only if $\mathcal{P}$ is the Minkowski sum of a polytope and a finitely generated cone.
The cone in this decomposition is the set of all directions $\vv{v} \in \RR^n$ in which $\mathcal{P}$ recedes, that is, $\vv{u} + \lambda \vv{v} \in \mathcal{P}$ for every $\vv{u} \in \mathcal{P}$ and every $\lambda > 0$; it is uniquely determined by $\mathcal{P}$, and called the \emph{recession cone of $\mathcal{P}$}.
The Minkowski--Weyl Theorem gives us a couple of useful characterizations of polytopes: a polyhedron $\mathcal{P}$ is a polytope if and only if it is bounded or, equivalently, has a trivial recession cone.

\begin{definition}[Newton polyhedron]
The \emph{Newton polyhedron} associated to the monomial matrix $\matA$ is the polyhedron in $\RR^\numvars$ given by
\[ \N = \conv( \col(\matA) ) + \cone( \canvec_1, \ldots, \canvec_\numvars), \]
where $\col(\matA)$ is the set of columns of $\matA$, and $\canvec_1, \ldots, \canvec_\numvars$ are the standard basis vectors of $\RR^\numvars$.
\end{definition}

\begin{definition}[Face]
   \label{defn: face}
   A proper nonempty subset $\O$ of $\N$ is a \emph{face} of $\N$ if there exists $\defpt \in \RR^\numvars$ and a nonnegative real number $\alpha$ are such that the inner product $\iprod{\defpt}{\vv{v}}$ is at least $\alpha$ for all $\vv{v} \in \N$, with equality if and only if $\vv{v} \in \O$.
   We say that $\defpt$ \emph{defines} $\O$ in $\N$.
   If $\O$ is not contained in any proper coordinate subspace of $\RR^\numvars$, we call it a \emph{standard} face of $\N$.
\end{definition}

\begin{remark}
   \label{rmk: nonnegativity of defining point}
   The requirement that the number $\alpha$ in \Cref{defn: face} be nonnegative is an arbitrary convention, which will play a role in \Cref{alpha=1: convention} below.
   We observe that the defining point $\defpt$ must be nonnegative as well.
   Indeed, if $\vv{v} \in \O$, then $\vv{v} + \canvec_i \in \N$, and thus $c_i = \iprod{\defpt}{\vv{v} + \canvec_i} -\alpha \ge 0$, for each $i$.
\end{remark}

The following proposition gives an explicit Minkowski--Weyl decomposition for the faces of a Newton polyhedron.

\begin{proposition}[Minkowski--Weyl for faces]
   \label{prop: MW for faces}
   Let $\O$ be a face of the Newton polyhedron $\N$ associated to the monomial matrix $\matA$, and suppose $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
   Set $\rb(\O) =  \{ \canvec_i \in \RR^\numvars : \iprod{\defpt}{\canvec_i} = 0\}$.
   Then
   \[\O =  \conv( \col(\matA) \cap \O ) + \cone(\rb(\O))\]
   where we agree that $\cone(\emptyset) = \{\vv{0}\}$.
   In particular, the supporting indices of $\defpt$ depend only on $\O$, and $\O$ is bounded if and only if $\defpt$ is positive.
\end{proposition}

\begin{proof}
   Suppose $\iprod{\defpt}{\vv{v}} = \alpha$ for all $\vv{v} \in \O$.
   Then the same holds for every $\vv{v} \in\conv( \col(\matA) \cap \O ) + \cone(\rb(\O)) \subseteq \N$, showing that this sum is contained in  $\O$.
   To prove the reverse containment, let $\vv{v} \in \O$.
   Since $\vv{v} \in \N$, we can write $\vv{v} = \matA \vv{s} + \vv{w}$, with $\vv{s}, \vv{w}\ge \vv{0}$ and $\norm{\vv{s}} = 1$.
   Denoting the $i$-th column of $\matA$ by $\vv{a}_i$, we have $\iprod{\defpt}{\vv{a}_i} = \alpha$ if $\vv{a}_i \in \O$, and $\iprod{\defpt}{\vv{a}_i} > \alpha$ otherwise.
   Thus, 
   \begin{align*}
     \alpha = \iprod{\defpt}{\vv{v}} &= \iprod{\defpt}{\matA\vv{s}} + \iprod{\defpt}{\vv{w}}
     = \sum_{i=1}^n \iprod{\defpt}{\vv{a}_i} s_i + \iprod{\defpt}{\vv{w}}\\
     &\ge \alpha \norm{\vv{s}} + \iprod{\defpt}{\vv{w}} = \alpha + \iprod{\defpt}{\vv{w}}
   \end{align*}
   Since $\defpt$ and $\vv{w}$ are nonnegative, $\iprod{\defpt}{\vv{w}}$ must be zero and the inequality above must be an equality, which is the case if and only if $s_i = 0$ whenever $\vv{a}_i \notin \O$.
   This shows that $\vv{w} \in \cone(\rb(\O))$ and $\matA\vv{s} \in \conv(\col(\matA) \cap \O)$, so $\vv{v} = \matA\vv{s} + \vv{w} \in \conv( \col(\matA) \cap \O ) + \cone(\rb(\O))$.
\end{proof}

\begin{definition}[Recession basis and subspace]
   If $\defpt \in \RR^\numvars$ defines $\O$, then the \emph{recession basis} of $\O$ is the set $\rb(\O)$ of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that the $i$-th coordinate of $\defpt$ is zero, and the \emph{recession subspace} of $\O$ is the coordinate subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.
\end{definition}

\Cref{prop: MW for faces} shows that these definitions depend only on $\O$, but not on the choice of the defining point $\defpt$.
It also shows that the cone generated by $\rb(\O)$ is the recession cone of $\O$, motivating our choice of terminology.

In this article, we are largely concerned with standard faces, and for those we shall adopt a helpful convention.

\begin{convention}
\label{alpha=1: convention}
Take $\O \subseteq \RR^\numvars$, $\defpt \in \RR^\numvars$, and $\alpha \in \RR$ as in \Cref{defn: face}.
If $\O$ is standard, then $\alpha$ must be positive, which allows us to rescale $\defpt$ so as to assume that $\alpha = 1$.
Thus, throughout this article, we always assume that defining points of standard faces have been normalized in this way.
\end{convention}

This convention leads to the following useful observation, whose simple proof uses ideas of the proof of \Cref{prop: MW for faces}.

\begin{proposition}
   \label{prop: inner product with columns of A}
   Suppose $\defpt \in \RR^\numvars$ defines a standard face $\O$ of the Newton polyhedron $\N$ associated to the monomial matrix $\matA$.
   Let $\vv{s} \in \RR^n$, and suppose $\vv{s} \ge \vv{0}$ or, more generally, that $s_i \ge 0$ whenever the $i$-th column of $\matA$ is not in $\O$.
   Then $\iprod{\defpt}{\matA\vv{s}} \ge \norm{\vv{s}}$, and equality holds if and only if $s_i = 0$ whenever the $i$-th column of $\matA$ is not in $\O$.
   \qed
\end{proposition}

\subsection{The $F$-threshold of a monomial pair}

\begin{definition}[Minimal face]
   The \emph{minimal face} of $(\matA, \vv{u})$ is the face $\mf(\matA, \vv{u})$ of $\N$ that is minimal, with respect to inclusion, among the faces containing the unique point where the cone generated by $\vv{u}$ intersects the boundary of $\N$.
\end{definition}

Note that the intersection of two faces of $\N$ is also a face of $\N$.
Thus, as minimality here is with respect to inclusion, it follows that there is a unique such minimal face.
Note also that the positivity of $\vv{u}$ implies that $\mf(\matA,\vv{u})$ is a standard face of $\matA$.

The \emph{relative interior} of a subset $\mathcal{U}$ of $\RR^n$, denoted $\ri \mathcal{U}$, is its interior relative to the smallest affine subset of $\RR^n$ containing $\mathcal{U}$.
The relative interior of a polyhedron is simply the subset of all points not contained in any proper face.
The minimality of $\mf(\matA,\vv{u})$ implies, then, that the cone generated by $\vv{u}$ intersects the boundary of $\N$ at a point in the relative interior of $\mf(\matA,\vv{u})$.

\begin{proposition}
   \label{FT descriptions: P}
   The following numbers coincide\textup:
   \begin{enumerate}[$(1)$]
      \item\label{value} The value of the linear program $\LP(\matA, \vv{u})$.
      \item\label{limit} The limit of $q^{-1}\val \IP(\matA,\vv{u},q)$ as $q$ tends to infinity.
      \item\label{lambda} The unique positive real number $\lambda$ with the property that the scaled point $\lambda^{-1}\vv{u}$ lies in the boundary of $\N$.
      \item\label{new ip} The inner product $\iprod{\vv{c}}{\vv{u}}$, where $\vv{c} \in \RR^\numvars$ is a point defining the minimal face $\mf(\matA, \vv{u})$ in $\N$ \textup(adhering to \Cref{alpha=1: convention}\textup).
      \item\label{min} The minimum among all inner products $\iprod{\vv{c}}{\vv{u}}$, where $\vv{c} \in \RR^\numvars$ ranges over all points defining a standard face in $\N$ \textup(again adhering to \Cref{alpha=1: convention}\textup).
   \end{enumerate}
\end{proposition}

As noted in \Cref{ft as val LP: P}, if $(\matA,\vv{u})$ is a monomial pair associated to the ideal pair $(\ideala,\ideald)$, then the quantity appearing in \Cref{FT descriptions: P}\ref{value} can be described algebraically as the $F$-threshold of $(\ideala,\ideald)$.
This motivates the following definition.

\begin{definition}[$F$-threshold of a monomial pair]
\label{FT: D}
   The \emph{$F$-threshold} of a monomial pair $(\matA, \vv{u})$, denoted $\ft{\matA}{\vv{u}}$, is the number described in \Cref{FT descriptions: P}.
\end{definition}

\begin{proof}[Proof of \Cref{FT descriptions: P}]
   \Cref{ft as val LP: P} and \eqref{ft as limit of normalized program values: eq} tell us that the quantities in \ref{value} and \ref{limit} agree.  In what follows, let $\lambda$ be as in \ref{lambda}.
   Let $\O = \mf(\matA,\vv{u})$, and fix a point $\vv{c} \in \RR^\numvars$ defining $\O$ in $\N$.
   Our choice of $\lambda$ allows us to write $\vv{u} = \lambda \vv{w}$ for some $\vv{w} \in \O$, and in view of \Cref{alpha=1: convention}, it follows that $\iprod{\vv{c}}{\vv{u}} = \lambda \iprod{\vv{c}}{\vv{w}} = \lambda$.
   This establishes the equality of the numbers described in \ref{lambda} and \ref{new ip}.

   We now show that $\val \LP = \lambda$, where $\LP = \LP(\matA, \vv{u})$, establishing the equivalence of \ref{value}--\ref{new ip}.
   Toward this, note that if $\vv{s} \in \feas \LP$, then $\vv{s}\ge \vv{0}$ and $\matA \vv{s} \leq \vv{u}$, and consequently $\norm{\vv{s}} \le \iprod{\vv{c}}{\matA \vv{s}} \leq \iprod{\vv{c}}{\vv{u}} = \lambda$, where the first inequality follows from \Cref{prop: inner product with columns of A}, and the second from the nonnegativity of $\vv{c}$.
   This shows that the value of $\LP$ is at most $\lambda$.
   On the other hand, since $\lambda^{-1}\vv{u} \in \N$, we have $\lambda^{-1}\vv{u} \ge \matA\vv{s}$ for some $\vv{s} \geq \vv{0}$ with $\norm{\vv{s}} = 1$.
   Multiplying by $\lambda$, we see that  $\lambda\vv{s}$ is feasible for $\LP$, and so the value of $\LP$ is at least $\lambda$.

   To conclude the proof, note that because $\lambda^{-1}\vv{u}$ lies in $\N$ we have $\iprod{\vv{c}}{\vv{u}} \ge \lambda$ for every point $\vv{c}$ defining a standard face in $\N$.
   This shows that the minimum described in \ref{min} is at least $\lambda$, while \ref{new ip} shows that this minimum is at most $\lambda$.
\end{proof}

\begin{example}[A running example]
   \label{ex: ft}
   We examine the different characterizations of $\ft{\matA}{\vv{u}}$ given in \Cref{FT descriptions: P}, for
   \[\matA=\begin{bmatrix}5&3&4\\ 5&4&3\\ 2&8&5\end{bmatrix} \quad \text{and} \quad \vv{u} =
      \begin{bmatrix} 1 \\ 1\\ 1 \end{bmatrix}.\]
   The Newton polyhedron $\N$ of $\matA$ is shown in \Cref{fig: newton polyhedron}.
   \begin{figure}
   \centering
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron.pdf}\\[1.4mm]
      \caption{The Newton polyhedron of $\matA$}
      \label{fig: newton polyhedron}
   \end{subfigure}
   \begin{subfigure}{.48\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/splitting_polytope.pdf}
      \caption{The feasible region of $\LP(\matA,\vv{u})$}
      \label{fig: splitting polytope}
   \end{subfigure}
      \caption{Illustration for \Cref{ex: ft}}
   \label{fig: newton polyhedron and splitting polytope}
   \end{figure}
   The point $(17/4)\cdot \vv{u}$, shown in white, lies in the relative interior of the face
   \[\O = \conv(\col(\matA)) + \cone(\canvec_2).\]
   Thus, $\mf(\matA,\vv{u}) = \O$, and the description given in \Cref{FT descriptions: P}\ref{lambda} tells us that $\ft{\matA}{\vv{u}} = 4/17$.

   The minimal face $\O$ is defined by the point $\defpt = (3/17, 0, 1/17)$, so \Cref{FT descriptions: P}\ref{new ip} tells us that
   $\ft{\matA}{\vv{u}} = \iprod{\defpt}{\vv{u}} = 4/17$.

   From yet another perspective, \Cref{fig: splitting polytope} shows the feasible region of the linear program $\LP = \LP(\matA,\vv{u})$, with its optimal set
   \[\opt \LP = \conv\bigg(\bigg(\frac1{17}, 0, \frac3{17}\bigg),\bigg(\frac2{17}, \frac1{17}, \frac1{17}\bigg)\bigg)\]
   highlighted in green.
   Thus, \Cref{FT descriptions: P}\ref{value} tells us that
   \[\ft{\matA}{\vv{u}} = \val \LP = \bigg\|\bigg(\frac1{17}, 0, \frac3{17}\bigg)\bigg\| = \frac4{17}.\]
\end{example}

\begin{example}[The homogeneous $\idealm$-primary case]
   \label{ex: m-primary homogeneous case}
   Let $\idealm$ be the maximal ideal of  $\kk[x_1,\ldots,x_\numvars]$ generated by the variables, and let $\ideala$ be an $\idealm$-primary ideal generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Let $\vv{w} = (\deg x_1,\ldots,\deg x_\numvars)$.
   For convenience, set $\deg \vv{t} = \iprod{\vv{w}}{\vv{t}}$ for each $\vv{t} \in \RR^\numvars$, so that for every nonnegative lattice point $\vv{u}$ we have $\deg \vv{u} = \deg x^\vv{u}$.

   Let $\matA$ be a monomial matrix associated to $\ideala$.
   Then the convex hull $\O$ \hl{of the degree $d$ columns of $\matA$}
   \pedro{
      Because $\matA$ may be associated to a non-minimal set of generators; could also just take the convex hull of columns corresponding to powers of the variables.
   }
   is a face of the Newton polyhedron $\N$ of $\matA$, and consists precisely of all nonnegative points $\vv{t} \in \RR^\numvars$ with $\deg \vv{t}  = d$.
   Moreover, this face is the minimal face of \emph{every} $\matA$-pair $(\matA,\vv{u})$, and since $\frac d{\deg \vv{u}}\vv{u} \in \O$, \Cref{FT descriptions: P}\ref{lambda} shows that for every such pair we have
   \[
      \ft{\matA}{\vv{u}} = \frac{\deg \vv{u}}{d}.
   \]

   From the perspective of \Cref{FT descriptions: P}\ref{new ip}, the positive point $\vv{c} = \vv{w}/d$ defines $\O$ in $\N$, and again we obtain
   \[
      \ft{\matA}{\vv{u}} = \iprod{\vv{c}}{\vv{u}} = \frac{\deg \vv{u}}{d}.
   \]
\end{example}

\subsection{Characterizing optimal points of $\LP(\matA,\vv{u})$}

\Cref{prop: MW for faces} above implies that $\vv{u}$ is a conical combination of the columns of $\matA$ lying in $\O = \mf(\matA,\vv{u})$ and the standard basis vectors in the recession basis of $\O$.
Typically, there are many ways to express $\vv{u}$ as such a conical combination, and as we see below, the set of all such expressions parameterizes  $\opt \LP(\matA, \vv{u})$.

\begin{proposition}[A characterization of optimal points]
   \label{opt set: P}
   A point $\vv{s} \in \RR^n$ is optimal for $\LP(\matA, \vv{u})$ if and only if it satisfies the following conditions.
\begin{enumerate}[$(1)$]
\item  \label{mc coords: e} The coordinates of $\vv{s}$ are nonnegative, and the $i$-th coordinate of $\vv{s}$ is zero whenever the $i$-th column of $\matA$ is not contained in $\O = \mf(\matA, \vv{u})$.
\item  \label{mc decomposition: e} $\vv{u} = \matA \vv{s} + \vv{w}$ for some $\vv{w} \in  \cone(\rb(\O))$.
\end{enumerate}
\end{proposition}

\begin{proof}
   Set $\LP = \LP(\matA, \vv{u})$ and $\lambda = \val \LP $, and fix $\defpt \in \RR^\numvars$ that defines the face $\O = \mf(\matA, \vv{u})$ in the Newton polyhedron of $\matA$.
   Let $\vv{s} \in \RR^n$ and set $\vv{w} = \vv{u} - \matA\vv{s}$.
   By \Cref{prop: inner product with columns of A,FT descriptions: P},
   \begin{equation}\label{eq 1}
      \lambda = \iprod{\defpt}{\vv{u}} = \iprod{\defpt}{\matA \vv{s}} + \iprod{\defpt}{\vv{w}} \geq \norm{\vv{s}} + \iprod{\defpt}{\vv{w}}.
   \end{equation}
   If $\vv{s}$ is optimal for $\LP$, then $\vv{s} \ge \vv{0}$, $\vv{w} \ge \vv{0}$, and $\norm{\vv{s}} = \lambda$, and \eqref{eq 1} shows that $\iprod{\defpt}{\matA \vv{s}} = \norm{\vv{s}}$ and $\iprod{\defpt}{\vv{w}} = 0$.
   The first identity and \Cref{prop: inner product with columns of A} show that $\vv{s}$ satisfies~(1); the second identity shows that $\vv{w}\in \cone(\rb(\O))$, so $\vv{s}$ satisfies~(2).
   Conversely, if $\vv{s}$ satisfies (1) and (2), then $\vv{s}$ is feasible for $\LP$, $\iprod{\defpt}{\matA \vv{s}} = \norm{\vv{s}}$, and $\iprod{\defpt}{\vv{w}} = 0$.
   By \eqref{eq 1}, $\norm{\vv{s}} = \lambda$, so $\vv{s}$ is optimal for $\LP$.
\end{proof}

The previous proposition allows us to show the existence of a ``universal'' denominator for the vertices---that is, faces of dimension zero---of $\opt\LP(\matA,\vv{u})$, dependent only on the monomial matrix $\matA$, and not on $\vv{u}$.
For that, we shall need the following well-known characterization of the vertices of a polyhedron, whose proof can be found, for instance, in \cite[Theorem~3.34]{conforti+etal.integer_programming}.

\begin{lemma}
   \label{prop: characterization of vertices}
   Let $\mathcal{P}$ be the polyhedron defined by a system of inequalities $\matM \vv{x} \le \vv{b}$, where $\matM\in \RR^{s\times t}$, and let $\vv{v} \in \mathcal{P}$.
   For a subset $I$ of $\{1,\ldots,s\}$, let $\matM_I$ and $\vv{b}_I$ be the matrix and vector obtained by selecting the $i$-th rows of $\matM$ and $\vv{b}$, for each $i\in I$.
   Then $\vv{v}$ is a vertex of $\mathcal{P}$ if and only if there exists $I \subseteq \{1,\ldots,s\}$ such that $\matM_I$ is a nonsingular square matrix and $\vv{v} = \matM_I^{-1}\vv{b}_I$.
\qed
\end{lemma}

\begin{theorem}[Uniform denominator for vertices of optimal sets]
   \label{uniform denominators for vertices:  T}
   Given a monomial matrix $\matA$, there exists a positive integer $\denom = \denom(\matA)$ such that for every $\matA$-pair $(\matA, \vv{u})$, every vertex of $\opt \LP(\matA, \vv{u})$ is rational with denominator $\denom$.
\end{theorem}

\begin{proof}
   By \Cref{opt set: P}, $\opt \LP(\matA,\vv{u})$ is defined by the inequalities $\matA\vv{s} \le \vv{u}$ and $\vv{s}\ge \vv{0}$, where equality is required in a prescribed set of coordinates (depending on~$\vv{u}$).
   Thus, if $\matM$ is the matrix obtained by stacking $\matA$, $-\matA$, the $n \times n$ identity matrix $\matI$, and $-\matI$, and $\vv{b}$ is the column vector obtained by stacking $\vv{u}$, $-\vv{u}$, and $\vv{0}\in \RR^{2n}$, then $\opt \LP(\matA,\vv{u})$ is defined by a subsystem of $\matM \vv{x} \le \vv{b}$.
   Let $\denom$ be the least common multiple of the nonzero $n\times n$ minors of $\matM$.
   \Cref{prop: characterization of vertices} then shows that every vertex of $\opt \LP(\matA,\vv{u})$ is rational with denominator $\denom$.
\end{proof}

\subsection{Special points and universal denominators}

Technicalities that arise in future sections whenever the minimal face of $(\matA, \vv{u})$ is unbounded force us to consider a certain distinguished subset of optimal points, in which we require a strengthening of condition \ref{mc decomposition: e} in \Cref{opt set: P}.

\begin{definition}[Special point]
   \label{mc: D}
   Let $\O = \mf(\matA, \vv{u})$.
   A point $\vv{s}$ is a \emph{special point} for $(\matA, \vv{u})$ if it satisfies the following conditions.
   \begin{enumerate}
      \item $\vv{s} \in \opt \LP(\matA, \vv{u})$.
      \item \label{item: special condition of special points}
      $\vv{u} = \matA \vv{s} + \vv{w}$ for a point $\vv{w}$ in the relative interior of $\cone(\rb(\O))$ or, equivalently, a positive point $\vv{w}$ of $\rs(\O)$, with the convention that $\vv{w}=\vv{0}$ when $\rb(\O)$ is empty.
   \end{enumerate}
   The set of all such points is denoted $\sp(\matA, \vv{u})$, and the set of all such points with rational coordinates is denoted $\sp_{\QQ}(\matA, \vv{u})$.
\end{definition}

\begin{proposition}[Special points \vs the optimal set and its relative interior]
   \label{opt versus mc: P}
   If $\O = \mf(\matA, \vv{u})$ is bounded, then $\sp(\matA, \vv{u}) = \opt \LP(\matA, \vv{u})$.
   Otherwise, $\sp(\matA, \vv{u})$ is a nonempty convex set lying between $\opt \LP(\matA, \vv{u})$ and its relative interior, $\ri \opt \LP(\matA, \vv{u})$.
\end{proposition}

\begin{proof}
   If $\O$ is bounded, then $\rb(\O) = \emptyset$, and so $\cone( \rb(\O)) = \{\vv{0} \}$.
   Thus, in view of \Cref{opt set: P}, condition \eqref{item: special condition of special points} in \Cref{mc: D} is automatically fulfilled, and $\sp(\matA, \vv{u}) = \opt \LP(\matA, \vv{u})$.

   Next, set $\lambda = \ft{\matA}{\vv{u}}$ and assume that $\O$ is unbounded.
   The minimality of $\O$ implies that $\lambda^{-1}\vv{u}$ is not in any proper face of $\O$, and therefore, must lie in its relative interior.
   Furthermore, as the relative interior operation on convex sets commutes with Minkowski sums---see, \eg \cite[Theorem 4.10(b)]{vantiel.convex_analysis}---the decomposition in \Cref{prop: MW for faces}  implies that $\vv{u} = \vv{v} + \vv{w}$ with $\vv{v} \in \lambda \conv(\col(\matA) \cap \O)$ and $\vv{w} \in \ri \cone(\rb(\O))$.  Any realization of $\vv{v}$ as $\lambda$ times a convex combination of the points in $\col(\matA) \cap \O$ then determines a special point.

   We have just shown that $\sp(\matA, \vv{u})$ is nonempty, and it is clear that this set is convex.
   Before proceeding to show that $\sp(\matA, \vv{u})$ contains the relative interior of the optimal set of $\LP = \LP(\matA,\vv{u})$, recall that the relative interior of a polytope consists of all convex combinations with \emph{positive coefficients} of the vertices of the polytope, while the polytope itself consists of all convex combinations of its vertices.

  Let $\vv{s} \in \ri \opt \LP$, and suppose $\vv{s}$ is not special for $(\matA,\vv{u})$.
  Then there exists some $i$ with $\canvec_i \in \rb(\O)$ for which $\matA\vv{s}$ agrees with $\vv{u}$ in the $i$-th coordinate.
  The characterization of relative interior above then implies that the same is true for every \emph{vertex} of $\opt \LP$, and consequently for every \emph{point} of $\opt \LP$.
  But this shows that $\sp(\matA,\vv{u})$ is empty---a contradiction.
\end{proof}

\begin{example}[Running example: special and optimal points]
   \label{ex: ft.1}
   The containments asserted in \Cref{opt versus mc: P} may all be proper.
   Indeed, if $\matA$, $\vv{u}$, and $\O$ are as in \Cref{ex: ft}, then $\opt \LP(\matA,\vv{u})$, highlighted in green in \Cref{fig: splitting polytope}, is the line segment connecting $\vv{s}_0 = (2/17, 1/17, 1/17)$ and $\vv{s}_1 = (1/17, 0, 3/17)$.
   Its relative interior excludes both $\vv{s}_0$ and $\vv{s}_1$, while the set of special points for $(\matA,\vv{u})$ excludes only $\vv{s}_0$.
   Indeed, setting $\vv{s}_t=(1-t)\vv{s}_0 + t \vv{s}_1$, where $0\le t\le 1$, $\vv{u} - \matA\vv{s}_t = \frac{3}{17}\,t \canvec_2$ is a positive point of $\rs(\O)$ if and only if $0<t\le 1$.
\end{example}

% Consider the monomial matrix \[ \matA = \begin{bmatrix} a & 0 & c \\ 0 & b & c \\ 0 & 0 & d \end{bmatrix} \]
% where $a,b,c$ are positive integers with $1/a + 1/b = 1/c$ and $d$ is any integer with $d>c$.  The maximal face of the splitting polytope is the edge connecting the points \[ \left( \frac{d-c}{da}, \frac{d-c}{db}, \frac{1}{d} \right) \text{ and } \left( \frac{1}{a}, \frac{1}{b}, 0 \right).\]  On the other hand, it is easy to check that the special points for $(\matA, \vv{1})$ consist of the points on this edge except for the first of these two  points.

\begin{definition}[Universal denominator]
   \label{universal denominator: D}
   Let $\matA$ be a monomial matrix.
   A \emph{universal denominator} for $\matA$ is a positive integer $\denom = \denom(\matA)$ such that for every $\matA$-pair $(\matA, \vv{u})$, there exists a point $\vv{s} \in \sp(\matA, \vv{u})$ so that $\denom \vv{s}$ has integer coordinates.
\end{definition}

\begin{theorem}
   \label{universal-denominators-exist:  T}
   Universal denominators exist.
\end{theorem}

\begin{proof}
   Let $\matA$ be a monomial matrix.
   Let $\denom_{\circ}$ be an integer satisfying the property described in \Cref{uniform denominators for vertices:  T} relative to $\matA$, and fix an $\matA$-pair $(\matA, \vv{u})$.
   If $\O = \mf(\matA, \vv{u})$ is bounded, then $\sp(\matA, \vv{u}) = \opt \LP(\matA, \vv{u})$ by \Cref{opt versus mc: P}, and so every vertex in this set has denominator~$\denom_{\circ}$.

   Next, suppose $\O$ is unbounded, so that $\matA$ has at least two rows.
   Let $m$ be the number of rows of $\matA$ and, without loss of generality, suppose that $\rb(\O) = \{ \canvec_1, \ldots, \canvec_t \}$ for some $1 \leq t \leq \numvars-1$.
   As demonstrated in the  proof of \Cref{opt versus mc: P}, for every index  $1 \leq i \leq t$, there exists a vertex $\vv{s}_i$ of $\opt \LP(\matA, \vv{u})$ for which $\matA \vv{s}_i$ is less than $\vv{u}$ in the $i$-th coordinate.
   Choosing \emph{positive} integers $\numvars_1, \ldots, \numvars_t$ that sum to $\numvars-1$, it then follows from the definition of special point that the point
   \[ \frac{ \numvars_1 \vv{s}_1 + \cdots + \numvars_t  \vv{s}_t}{\numvars-1}  \]
   lies in $\sp_{\QQ}(\matA, \vv{u})$ and has denominator $(\numvars-1)\denom_{\circ}$.
\end{proof}

\begin{example}[A universal denominator for the homogeneous $\idealm$-primary case]
   \label{ex: m-primary homogeneous case 2}
   As in \Cref{ex: m-primary homogeneous case}, let $\matA$ be a monomial matrix associated to an $\idealm$-primary ideal generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Then $d$ is a universal denominator for $\matA$.
   Indeed, among the columns of $\matA$ we must have degree $d$ multiples $a_1\canvec_1,\ldots,a_\numvars\canvec_\numvars$ of the standard basis vectors of $\RR^\numvars$.
   For concreteness, suppose these are the first $\numvars$ columns of $\matA$.
   The convex hull $\O$ of these columns is the minimal face of every $\matA$-pair $(\matA,\vv{u})$.
   For every such pair, the point
   \[\vv{s} = \Big(\frac{u_1}{a_1},\ldots,\frac{u_\numvars}{a_\numvars},0,\ldots,0\Big)\]
   satisfies the conditions of \Cref{opt set: P}, and is therefore an optimal point for $(\matA,\vv{u})$.
   Since $\O$ is bounded, it follows that $\vv{s}$ is a special point.
   Finally, note that since $\deg a_i\canvec_i = d$ for every $i$, $d$ is a multiple of every $a_i$, and thus a denominator for $\vv{s}$.
\end{example}

\subsection{Discreteness of $F$-thresholds}

The following is a consequence of the discreteness of the $F$-jumping exponents of an ideal in a regular ring \cite[Theorem~3.1]{blickle+mustata+smith.discr_rat_FPTs}.
However, to keep our discussion self-contained, we include an elementary proof in our specialized setting.

\begin{proposition}[Discreteness of $F$-thresholds]
   \label{discreteness: P}
   Given a monomial matrix $\matA$ and a real number $\beta > 0 $, there are only finitely many numbers of the form $\ft{\matA}{\vv{u}}$ that are less than $\beta$.
\end{proposition}

\begin{proof}
   It suffices to show that there are only finitely many numbers $\ft{\matA}{\vv{u}}$ less than $\beta$ with $\mf(\matA, \vv{u}) = \O$ being fixed.
   Consider such a pair, and suppose $\defpt$ defines $\O$ in the Newton polyhedron of $\matA$.
   Then $\ft{\matA}{\vv{u}} = \iprod{\defpt}{\vv{u}}$, and the nonnegativity of $\defpt$ implies that, as $\vv{u}$ ranges over positive integral points, this inner product takes on only finitely many values less than $\beta$.
   Indeed, when $c_i \ne 0$, the upper bound $\beta$ allows only finitely many choices for $u_i$, while when $c_i = 0$, the value of $u_i$ does not affect the inner product.
\end{proof}

\section{Collapsing}

This section concerns an operation used to get around some technical difficulties that arise when dealing with an unbounded minimal face.
Recall that if a face $\O$ of a Newton polyhedron in $\RR^\numvars$ is defined by a point~$\defpt$, then its recession basis is the set $\rb(\O)$ consisting of all standard basis vectors $\canvec_i$ in $\RR^\numvars$ such that $c_i = 0$, and its recession subspace is the subspace $\rs(\O)$ of $\RR^\numvars$ spanned by $\rb(\O)$.

\begin{definition}[Collapsing]
\label{collapse: D}
 Suppose that $\O$ is a proper face of the Newton polyhedron $\N$ of a monomial matrix $\matA$ with $\numvars$ rows.

\begin{enumerate}
   \item The set $\rb(\O)^{\perp}$ is the complement of $\rb(\O)$ in $\{ \canvec_1, \ldots, \canvec_\numvars \}$, and $\rs(\O)^\perp$ is the subspace of $\RR^\numvars$ spanned by $\rb(\O)^\perp$, that is, the orthogonal complement of $\rs(\O)$ in $\RR^\numvars$.
   (The assumption that $\O \neq \N$ implies that $\rb(\O)^{\perp} \neq \emptyset$.)
   \item The \emph{collapsing along $\O$} is the projection map $\RR^\numvars \to \RR^{\#\rb(\O)^\perp}$ that deletes the $i$-th coordinate of a point whenever $\canvec_i \in \rb(\O)$, while preserving the order of the remaining coordinates.
   The images of points or sets under this projection are called \emph{collapses} of these objects along $\O$.
   \item The \emph{collapse} of $\matA$ along $\O$ is the matrix obtained from $\matA$ by collapsing each of its columns along $\O$, or in other words, the matrix obtained by deleting the $i$-th row of $\matA$ whenever $\canvec_i\in \rb(\O)$.
\end{enumerate}
\end{definition}

Below, we adopt the notation established in \Cref{collapse: D}, and we use an overbar to denote the collapse along $\O$.

\begin{remark}
   \label{rmk: collapse of a matrix}
   It is clear from the definition that $\collapse{\matA\vv{k}} = \collapse{\matA}\vv{k}$, for each $\vv{k}$ in the domain of $\matA$.
\end{remark}

\begin{remark}
   \label{collapse of a defining vector: R}
   If $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then $\collapse{\defpt}$ is a positive point consisting precisely of the nonzero coordinates of $\defpt$.
   Consequently, $\iprod{\defpt}{\vv{u}} = \iprod{\collapse{\defpt}}{\collapse{\vv{u}}}$ for every $\vv{u} \in \RR^\numvars$. \daniel[inline]{Restate this?}
\end{remark}

\begin{remark}
   \label{collapse of monomial is monomial: R}
   The collapsed matrix $\collapse{\matA}$ is monomial.
   Indeed, each row of $\collapse{\matA}$ is a row of $\matA$, and hence is nonzero.
   On the other hand, if $\defpt \in \RR^\numvars$ defines $\O$, then \Cref{collapse of a defining vector: R} implies that the inner product of $\collapse{\defpt}$ with every column of $\collapse{\matA}$ is at least $1$.
   In particular, the columns of $\collapse{\matA}$ are nonzero.
\end{remark}

% \begin{proposition}[Faces under collapsing]
%    \label{collapse of Newton polyhedron: P}
%    Let $\O$ be a face of the Newton polyhedron $\N$ of a monomial matrix $\matA$.
%    As above, we use an overbar to denote collapse along $\O$.
%    Then $\collapse{\N}$ is the Newton polyhedron of $\collapse{\matA}$, and $\collapse{\O}$ is a bounded face of $\collapse{\N}$.
%    In addition, if $\defpt \in \RR^\numvars$ defines $\O$ in $\N$, then $ \collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$.
% \end{proposition}

% \begin{proof}
%    Taking the equation defining $\N$ and collapsing it along $\O$, we obtain
%    \[ \collapse{\N} = \ol{\conv( \col(\matA))} + \ol{\cone(\canvec_1, \ldots, \canvec_\numvars)} = \conv( \col(\collapse{\matA}) ) + \cone(\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars).\]
%    The nonzero vectors among $\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars$ are precisely the basis vectors in  $\RR^{\#\rb(\O)^\perp}$, so this agrees with the definition of the Newton polyhedron of $\collapse{\matA}$.

%    Given \Cref{collapse of a defining vector: R}, it is not difficult to verify that $\collapse{\defpt}$ defines $\collapse{\O}$ in $\collapse{\N}$ whenever $\defpt \in \RR^\numvars$ defines $\O$ in $\N$.
%    The positivity of $\collapse{\defpt}$ then implies that $\collapse{\O}$ is bounded.
%    Alternatively, one may collapse the identity in \Cref{prop: MW for faces} along $\O$ to see that the collapsed face $\collapse{\O}$ is the polytope $\conv( \collapse{ \col(\matA) \cap \O}) = \conv( \col(\collapse{\matA}) \cap \collapse{\O})$.
% \end{proof}

\pedro[inline]{Previous version of following proposition is commented out.}

\begin{proposition}[Faces under collapsing]
   \label{collapse of Newton polyhedron: P}
   Let $\O$ and $\L$ be proper faces of the Newton polyhedron $\N$ of a monomial matrix $\matA$, defined by points $\defpt$ and $\vv{b}$, respectively.
   Suppose the recession basis of $\O$ is contained in the recession basis of $\L$.
   As above, we use an overbar to denote collapse along $\O$.
   Let $\pi: \N \to \collapse{\N}$ be the collapsing along $\O$, restricted to $\N$.
   Then $\collapse{\N}$ is the Newton polyhedron of $\collapse{\matA}$, $\collapse{\L}$ is a face of $\collapse{\N}$ defined by the point  $\collapse{\vv{b}}$, and $\pi^{-1}(\collapse{\L}) = \L$.
   In particular,  $\collapse{\O}$ is a face of  $\collapse{\N}$ defined by the positive point $\collapse{\vv{c}}$, and so $\collapse{\O}$ is bounded.
\end{proposition}

\begin{proof}
   Taking the equation defining $\N$ and collapsing it along $\O$, we obtain
   \[ \collapse{\N} = \ol{\conv( \col(\matA))} + \ol{\cone(\canvec_1, \ldots, \canvec_\numvars)} = \conv( \col(\collapse{\matA}) ) + \cone(\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars).\]
   The nonzero vectors among $\collapse{\canvec}_1,\ldots,\collapse{\canvec}_\numvars$ are precisely the basis vectors in  $\RR^{\#\rb(\O)^\perp}$, so this agrees with the definition of the Newton polyhedron of $\collapse{\matA}$.

   As $\rb(\O) \subseteq \rb(\L)$, the point $\collapse{\vv{b}}$ is obtained by deleting zero coordinates from $\vv{b}$.
   Thus, as in \Cref{collapse of a defining vector: R}, we have $\iprod{\vv{b}}{\vv{u}} = \iprod{\collapse{\vv{b}}}{\collapse{\vv{u}}}$ for every $\vv{u} \in \RR^\numvars$, and it is now straightforward  to verify that  $\collapse{\L}$ is a face of $\collapse{\N}$ defined by $\collapse{\vv{b}}$, and that $\pi^{-1}(\collapse{\L}) = \L$. 
\end{proof}

\details[inline]{
   Suppose that for each $\vv{u}\in \N$ we have $\iprod{\vv{b}}{\vv{u}} \ge \alpha$, with equality iff $\vv{u} \in \L$.
   Then\ldots
   \begin{enumerate}
      \item If $\collapse{\vv{u}} \in \collapse{\N}$ (where $\vv{u} \in \N$) then $\iprod{\collapse{\vv{b}}}{\collapse{\vv{u}}} = \iprod{\vv{b}}{\vv{u}} \ge \alpha$.
      \item If $\collapse{\vv{u}} \in \collapse{\L}$ (where $\vv{u} \in \L$) then $\iprod{\collapse{\vv{b}}}{\collapse{\vv{u}}} = \iprod{\vv{b}}{\vv{u}} = \alpha$.
      \item If $\collapse{\vv{u}} \in \collapse{\N}$ (where $\vv{u} \in \N$) and $\iprod{\collapse{\vv{b}}}{\collapse{\vv{u}}} =\alpha$, then  $\iprod{\vv{b}}{\vv{u}} = \alpha$, and so $\vv{u}\in \L$, and $\collapse{\vv{u}} \in \collapse{\L}$.
   \end{enumerate}
   (1)--(3) show that $\collapse{\L}$ is a face of $\collapse{\N}$ defined by $\collapse{\vv{b}}$.
   In view of this, (3) also shows that $\pi^{-1}(\collapse{\L}) \subseteq \L$; the reverse containment is trivial.
}


Below, we describe the relationship between collapses and other notions introduced in \Cref{sec: LPs,s: newton}.

\begin{proposition}[Minimal face, $F$-threshold, special and optimal points under collapsing]
   \label{collapse of mf and mc: P}
   Consider a monomial pair $(\matA, \vv{u})$, and let an overbar denote collapse along $\O = \mf(\matA, \vv{u})$.
   Then the following hold.
   \begin{enumerate}[$(1)$]
      \item $\mf(\collapse{\matA}, \collapse{\vv{u}}) = \collapse{\O}$ and $\ft{\matA}{\vv{u}} = \ft{\collapse{\matA}}{\collapse{\vv{u}}}$.
      \item Each optimal point for $\LP(\matA, \vv{u})$ is also optimal for $\LP(\collapse{\matA}, \collapse{\vv{u}})$.
      \item Each special point for $(\matA, \vv{u})$ is a special point for $(\collapse{\matA}, \collapse{\vv{u}})$.
   \end{enumerate}
\end{proposition}

\begin{proof}
   Set $\lambda = \ft{\matA}{\vv{u}}$, so that $\lambda^{-1} \vv{u}$ lies in the relative interior of $\O$.
   It is clear that a projection preserves relative interiors, and so $\lambda^{-1}\collapse{\vv{u}}$ must lie in the relative interior of $\collapse{\O}$, a  face of $\collapse{\N}$ by \Cref{collapse of Newton polyhedron: P}.
   This shows that $\collapse{\O}= \mf(\collapse{\matA},\collapse{\vv{u}})$ and $\lambda = \ft{\collapse{\matA}}{\collapse{\vv{u}}}$.
   Consequently,
   \[ \val \LP(\matA, \vv{u}) = \ft{\matA}{\vv{u}} = \ft{\collapse{\matA}}{\collapse{\vv{u}}} = \val \LP(\collapse{\matA}, \collapse{\vv{u}}). \]
   Since each row of $\collapse{\matA}$ is a row of $\matA$, the constraints of $\LP(\collapse{\matA}, \collapse{\vv{u}})$ are a subset of those of $\LP(\matA, \vv{u})$, and hence $\feas \LP(\matA,\vv{u})$ is a subset of $\feas \LP(\collapse{\matA},\collapse{\vv{u}})$.
   It follows that any optimal point for $\LP(\matA, \vv{u})$ must be optimal for $\LP(\collapse{\matA}, \collapse{\vv{u}})$.
   The boundedness of $\collapse{\O}$, \Cref{opt versus mc: P}, and the preceding observation allows us to conclude that
   \begin{equation*}
      \sp(\matA, \vv{u}) \subseteq \opt \LP(\matA, \vv{u}) \subseteq \opt \LP(\collapse{\matA}, \collapse{\vv{u}}) = \sp(\collapse{\matA}, \collapse{\vv{u}}).
   \qedhere
\end{equation*}
\end{proof}

\begin{example}[Running example: collapsing]
   \label{ex: ft.2}
   Let $\matA$ and $\vv{u}$ be as in \Cref{ex: ft}.
   Then $\O = \mf(\matA,\vv{u}) = \conv(\col(\matA)) + \cone(\canvec_2)$, so $\rb(\O) = \{\canvec_2\}$.
   \Cref{fig: newton polyhedron of collapse} shows the Newton polyhedron of the collapse $\collapse{\matA}$ of $\matA$ along $\O$ (compare with \Cref{fig: newton polyhedron}).
   \begin{figure}
   \centering
   \begin{subfigure}{.49\textwidth}
      \centering

      \ \\[.1mm] \

      \includegraphics[width=.9\textwidth]{pictures/newton_polyhedron_of_collapse.pdf}\\[2mm]
      \caption{The Newton polyhedron of $\collapse{\matA}$}
      \label{fig: newton polyhedron of collapse}
   \end{subfigure}
   \begin{subfigure}{.49\textwidth}
      \centering
      \includegraphics[width=.8\textwidth]{pictures/opt_for_collapse_may_change.pdf}
      \caption{The feasible region of $\LP(\collapse{\matA},\collapse{\vv{u}})$}
      \label{fig: splitting polytope of collapse}
   \end{subfigure}
   \caption{Illustration for \Cref{ex: ft.2}}
   \label{fig: collapse}
   \end{figure}
   The point $(17/4)\cdot\collapse{\vv{u}}$, shown in white, lies in the relative interior of $\collapse{\O}$, shown in blue; thus, $\collapse{\O} = \mf(\collapse{\matA},\collapse{\vv{u}})$ and $\ft{\collapse{\matA}}{\collapse{\vv{u}}} = 4/17 = \ft{\matA}{\vv{u}}$.

   The feasible region of $\LP(\matA,\vv{u})$, shown in \Cref{fig: splitting polytope}, is properly contained in the feasible region for $\LP(\collapse{\matA},\collapse{\vv{u}})$, shown in \Cref{fig: splitting polytope of collapse}, which highlights the difference between those sets in yellow.
   \Cref{fig: splitting polytope of collapse} also shows that the optimal set of $\LP(\matA,\vv{u})$ is properly contained in the optimal set of $\LP(\collapse{\matA},\collapse{\vv{u}})$, highlighting the difference between these sets in red.
   Thus, the containment established in \Cref{collapse of mf and mc: P}(2) may be proper---in which case so is the one in (3), since every optimal point for $\LP(\collapse{\matA},\collapse{\vv{u}})$ is special for $(\collapse{\matA},\collapse{\vv{u}})$, due to the boundedness of $\collapse{\O}$.
\end{example}

\daniel[inline]{I think we'll need this for the section on applications to generic hypersurfaces}

\begin{proposition}
\label{collapse of a collapse is a collapse: P} Every composition of collapsings is a collapsing.
\end{proposition}

\begin{proof}
Consider a face $\O$ of a Newton polyhedron $\N \subseteq \RR^\numvars$.   Set $\ell = \# \rb(\O)^{\perp}$ and let $\pi: \RR^\numvars \to \RR^{\ell}$ be the collapsing projection along $\O$.  In addition, fix a face $\mathcal{F}$ of $\pi(\N)$,  which \Cref{collapse of Newton polyhedron: P} tells us is a Newton polyhedron in $\RR^{\ell}$.  Set $s=\# \rb(\mathcal{F})^{\perp}$ and let $\rho: \RR^{\ell} \to \RR^s$ be the collapsing projection along $\mathcal{F}$.

We will now show that $\sigma \coloneqq \rho \circ \pi: \RR^\numvars \to \RR^s$ is the collapsing projection along some face of $\N$.  Let $\canvec_1, \ldots, \canvec_\numvars \in \RR^\numvars$ and $\vv{f}_1, \ldots, \vv{f}_s \in \RR^s$ be the standard basis vectors for each Euclidean space.  After reordering these, we may assume that $\sigma: \RR^\numvars \to \RR^s$ maps $\canvec_i$ to $\vv{f}_i$ for each $1 \leq i \leq s$, and to $\vv{0}$ otherwise.   Next, let  $\iota:  \RR^s \hookrightarrow \RR^\numvars$ be the $\RR$-linear map defined by $\vv{f}_i \mapsto \canvec_i$.

Once again, \Cref{collapse of Newton polyhedron: P} implies that $\sigma(\N) = \rho(\pi(\N))$ is a Newton polyhedron.  Consider a standard compact face of $\mathcal{L}$ of $\sigma(\N)$, for instance, the collapsed face $\rho(\mathcal{F})$.    If $\mathcal{L}$ is defined by a point $\vv{b} \in \RR^s$, then \Cref{prop: MW for faces}  tells us that $\vv{b}$ is positive, and the fact that
\[ \iprod{\vv{b}}{\sigma(\vv{u})} = \iprod{\iota(\vv{b})}{\vv{u}} \] for every $\vv{u} \in \RR^\numvars$ implies that $\sigma^{-1}(\mathcal{F})$ is a standard face of $\N$ defined by $\iota(\vv{b})$.  By construction, the $i$-th entry of $\iota(\vv{b})$ is not zero if and only if $1 \leq i \leq s$, so that $\rb(\sigma^{-1}(\mathcal{L}))^{\perp} = \{ \canvec_1, \ldots, \canvec_s \}$, from which it follows that $\sigma$ is the collapsing projection along the face $\sigma^{-1}(\mathcal{F})$ of $\N$.
\end{proof}

\section{An auxiliary integer program}

\subsection{Canonical feasible points}

We highlight a simple construction that associates to any point in $\sp_{\QQ}(\matA, \vv{u})$ a feasible point for $\IP(\matA, \vv{u}, q)$.
As a part of this, we call upon some basic notions from modular arithmetic.

\begin{definition}[Least positive residue]
   If $a, b \in \ZZ$ are positive, then $\lpr{a}{b}$ is the \emph{least positive residue} of $a$ modulo $b$, that is, $a \equiv \lpr{a}{b} \bmod b$ and $1 \leq \lpr{a}{b} \leq b$.
\end{definition}

\begin{definition}[The bracket operation]
   \label{tail: D}
   Let $q$ be a positive integer.
   If $\lambda = a/b$ for some \emph{positive} integers $a$ and $b$, then we define
   \[ \tail{\lambda}_q = \frac{ \lpr{aq}{b}}{b}. \]
   This expression is clearly independent of the choice of the integers $a$ and $b$.
   In addition, we set  $[0]_q = 0$, and if $\vv{s} \in \QQ^n$ is nonnegative, we define $\tail{\vv{s}}_q$ as the point in $\QQ^n$ obtained by applying this operation to each coordinate of $\vv{s}$.
\end{definition}

\begin{remark}
   \label{tail-basics: R}
   If $q \in \ZZ$ is positive and $\lambda = a/b$ with $a$ and $b$ positive integers, then $\tail{\lambda}_q$ is positive and rational, at most $1$,  and depends on  $q$ modulo $b$, but not on $q$ itself.
   Furthermore,
   \[ \lambda q - \tail{\lambda}_q = \frac{aq-\lpr{aq}{b}}{b} \]
   is an integer, and in fact, is the \emph{greatest integer less than $\lambda q$}, that is, $\up{\lambda q} - 1$.
   This number agrees with $\down{ \lambda q}$ if and only if $\lambda q$ is not an integer.
\end{remark}

\begin{lemma}
   \label{less than u: L}
   Suppose that $\vv{s}$ is a special point for a monomial pair $(\matA, \vv{u})$.
   If $\vv{t}$ is a point in the domain of $\matA$ with $\vv{0} \leq \vv{t} \leq \vv{s}$, with the latter bound strict in every coordinate in which $\vv{s}$ is positive, then $\matA \vv{t} < \vv{u}$.
\end{lemma}

\begin{proof}
   Set $\O = \mf(\matA, \vv{u})$.
   As $\vv{s} \in \sp(\matA, \vv{u})$, we can write $\vv{u} = \matA \vv{s} + \vv{w}$,
   where $\vv{w}$ is a positive point of $\rs(\O)$.
   The inequality $\vv{t} \leq \vv{s}$ induces the bound $\matA \vv{t} \leq \matA \vv{s} = \vv{u} - \vv{w}$, which shows that $\matA\vv{t}$ is less than $\vv{u}$ in $\rs(\O)$ (recall that by this, we mean that the $i$-th coordinate of $\matA\vv{t}$ is less than $u_i$ whenever $\canvec_i\in \rs(\O)$).
   To conclude the proof, it suffices to show that the same is true in the complementary subspace $\rs(\O)^{\perp}$.

   Let an overbar denote collapse along $\O$.
   The assumption on $\vv{t}$ implies that $\collapse{\matA}( \vv{s} - \vv{t})$ and $\collapse{\matA} \vv{s} = \collapse{\vv{u}}$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{\matA}$.
   Therefore, since $\collapse{\vv{u}} = \collapse{\matA} \vv{s}$ is positive, the same must be true for $\collapse{\matA}(\vv{s} - \vv{t})$.
   In other words, $\collapse{\matA} \vv{t} < \collapse{\matA} \vv{s} = \collapse{\vv{u}}$, which shows that $\matA \vv{t}$ is less than  $\vv{u}$ in $\rs(\O)^{\perp}$.
\end{proof}

\begin{remark}
   \label{rmk: verifying inequalities using collapses}
   In the above proof, we used for the first time what will turn out to be a recurring technique in the remainder of this article:
   In order to verify an inequality between points in $\RR^\numvars$, we prove that the inequality holds in the recession subspace $\rs(\O)$ and that it holds for the collapses of the points along $\O$.
   The latter shows that the inequality we are trying to verify also holds in the complementary subspace $\rs(\O)^\perp$, and thus holds in $\RR^\numvars = \rs(\O) \oplus \rs(\O)^\perp$.
\end{remark}

\begin{theorem}[A canonical feasible point]
   \label{canonical-feasible: T}
   If $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$ and $q$ is a positive integer, then
   \[ \vv{s}q - \tail{\vv{s}}_q \in \feas \IP(\matA, \vv{u}, q).\]
   We call $\vv{s}q - \tail{\vv{s}}_q$ a \emph{canonical feasible point} for $\IP(\matA,\vv{u},q)$.
\end{theorem}

\begin{proof}
   \Cref{tail-basics: R} tells us that if $\vv{t} = \vv{s} - (1/q) {\tail{\vv{s}}_q}$, then $\vv{t}q = \vv{s}q -\tail{\vv{s}}_q$ has nonnegative integer coordinates, and $\vv{t}$ satisfies the hypotheses of \Cref{less  than u: L}, which shows that $\matA (\vv{s} q - \tail{\vv{s}}_q ) =  \matA\vv{t}q <  \vv{u}q$.
\end{proof}

\begin{remark}[Comparisons with canonical feasible points]
   \label{comparison: R}
   Adopt the context of \Cref{canonical-feasible: T}, and fix a point $\vv{k}$ that is feasible for $\IP = \IP(\matA, \vv{u}, q)$.
   Our goal is to describe some natural constraints on the difference between $\vv{k}$ and the canonical feasible point described in \Cref{canonical-feasible: T}.
   Toward this, set
   \[ \vv{h} =  \vv{k} - \vv{s}q + \tail{\vv{s}}_q \]
   and let an overbar denote the collapse along the face $\O = \mf(\matA, \vv{u})$.

   Notice that if $s_i = 0$, then $h_i  = k_i \geq 0$ by the nonnegativity constraint of $\IP$.
   The definition of $\vv{h}$ and the constraints of $\IP$ also tell us that $\matA ( \vv{s}q-\tail{\vv{s}}_q + \vv{h}) = \matA \vv{k} < \vv{u}q = \matA \vv{s}q + \vv{w}q$, where $\vv{w}$ is a positive point of $\rs(\O)$.
   Collapsing this inequality, keeping in mind that $\collapse{\vv{w}} = \vv{0}$, and rearranging terms, shows that $\collapse{\matA} \vv{h} < \collapse{\matA} \tail{\vv{s}}_q$.
   This motivates us to study another integer program, which will be formally introduced in the next subsection.
\end{remark}

\subsection{Another integer program}

\begin{definition}[Monomial list]
   A \emph{monomial list} $(\matA, \vv{u}, \vv{s}, q)$ consists of the following data.
   \begin{enumerate}
      \item A monomial pair $(\matA, \vv{u})$.
      \item A rational special point $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$.
      \item A positive integer $q$.
   \end{enumerate}
   We call a monomial list whose first term is the matrix $\matA$ an \emph{$\matA$-list}.
\end{definition}

\begin{definition}[The auxiliary integer program $\ip$]
   \label{aux program: D}
   If $(\matA, \vv{u}, \vv{s}, q)$ is a monomial list, the integer program $\ip(\matA, \vv{u}, \vv{s}, q)$ in the domain lattice of $\matA$ consists of maximizing the function $\vv{h} \mapsto \norm{\vv{h}}$, subject to the constraints that the $i$-th coordinate of $\vv{h}$ is nonnegative whenever the $i$-th coordinate of $\vv{s}$ is zero, and $\collapse{\matA} \vv{h}  < \collapse{\matA} \tail{\vv{s}}_q$, where the overbar denotes collapse along the minimal face $\mf(\matA, \vv{u})$.
\end{definition}

Recall that since each row of $\collapse{\matA}$ is a row of $\matA$, the inequalities determined by $\collapse{\matA} \vv{h}  < \collapse{\matA} \tail{\vv{s}}_q$ are a subset of those in $\matA \vv{h}  < \matA \tail{\vv{s}}_q$.
Also note that because $\collapse{\matA}$ is a monomial matrix, the inequality $\collapse{\matA} \vv{h}  < \collapse{\matA} \tail{\vv{s}}_q$ imposes upper bounds on all coordinates of $\vv{h}$, and thus $\ip(\matA, \vv{u}, \vv{s}, q)$ has a well-defined value.

\begin{example}[Running example: an auxiliary integer program]
   \label{ex: ft.3}
   Let $\matA$ and $\vv{u}$ be as in \Cref{ex: ft,ex: ft.1,ex: ft.2}, and consider the special point $\vv{s}=(1/17,0,3/17)$.
   The constraints for $\ip = \ip(\matA,\vv{u},\vv{s},q)$ in this case are $h_2 \ge 0$ and $\collapse{\matA}\vv{h} < \collapse{\matA}\tail{\vv{s}}_q$, where
   \[\collapse{\matA} = \begin{bmatrix}5&3&4\\ 2&8&5\end{bmatrix}. \]
   \begin{figure}
      \includegraphics[width=.5\textwidth]{pictures/Theta.pdf}
      \caption{The feasible and optimal sets for the integer program $\ip(\matA,\vv{u},\vv{s},q)$ in \Cref{ex: ft.3}, with $\lpr{q}{17}=11$}
      \label{fig: Theta}
   \end{figure}
   \Cref{fig: Theta} shows a portion of the (unbounded) polyhedron defined by the above inequalities, in the case where $\lpr{q}{17}=11$, together with the feasible points for $\ip$.
   In this case the value of $\ip$ is $1$, and the optimal set---a subset of which is shown in red in \Cref{fig: Theta}---is infinite.
   In fact, the optimal set consists precisely of all points of the form $(k,k,1-2k)$, $(k+1,k,-2k)$, and $(k+2,k,-1-2k)$, with $k\in \NN$.
   The situation is analogous for $q$ in every other congruence class modulo $17$.
\end{example}

\Cref{comparison: R} tells us that if $(\matA, \vv{u}, \vv{s}, q)$ is a monomial list and $\vv{k}$ is feasible for $\IP(\matA, \vv{u}, q)$, then $\vv{k} - \vv{s}q + \tail{\vv{s}}_q$ is feasible for  $\ip (\matA, \vv{u}, \vv{s}, q)$.
In particular,
\begin{equation}
   \label{ineq between deficits}
   \val \IP(\matA, \vv{u}, q) \le \ft{\matA}{\vv{u}}q - \norm{\tail{\vv{s}}_q} + \val \ip (\matA, \vv{u}, \vv{s}, q)
\end{equation}
where we have used that $\vv{s} \in \opt \LP(\matA,\vv{u})$ and so $\norm{\vv{s}} = \val \LP(\matA,\vv{u}) = \ft{\matA}{\vv{u}}$.
The next proposition gives conditions under which equality holds.

\begin{proposition}[Obtaining optimal points for $\IP$ from optimal points for $\ip$]
   \label{uniform value: P}
   Consider a monomial list $(\matA, \vv{u}, \vv{s}, q)$, and a denominator $\denom$ for the special point $\vv{s}$.
   If $\vv{h} \in \opt \ip(\matA, \vv{u}, \vv{s}, q)$, and $q/\denom$ is greater than every coordinate of $\vv{1} - \vv{h}$ and every coordinate of $\matA \vv{h}$, then the point $\vv{s}q - \tail{\vv{s}}_q + \vv{h}$ is optimal for $\IP(\matA, \vv{u}, q)$.
   Consequently, equality holds in \eqref{ineq between deficits}.
\end{proposition}

\begin{proof}
   Let an overbar denote collapse along $\O = \mf(\matA, \vv{u})$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   \Cref{tail-basics: R} tells us that $\vv{k}$ has integer coordinates, and we claim that $\vv{k} \geq \vv{0}$.
   Indeed, if $s_i$ is zero, then so is $\tail{s_i}_q$, and $k_i = h_i \ge 0$, by the feasibility of  $\vv{h}$ for $\ip = \ip(\matA, \vv{u}, \vv{s}, q)$.
   On the other hand, if $s_i$ is positive, then it must be at least $1/\denom$, and so
   $k_i = s_iq-\tail{s_i}_q+h_i \ge q/d - 1 + h_i$, and the last expression is nonnegative by assumption.

   To proceed, write $\vv{u} = \matA \vv{s} + \vv{w}$, where $\vv{w}$ is a positive point of $\rs(\O)$, as in \Cref{mc: D}.
   Now, $\vv{k}$ is feasible for $\IP = \IP(\matA, \vv{u}, q)$ if and only if
   \[ \matA\vv{k} = \matA (\vv{s}q - \tail{\vv{s}}_q + \vv{h})  < \vv{u}q = \matA {\vv{s}}q + \vv{w}q\]
   which we rewrite as
   \begin{equation}
      \label{equivalent ineq: e}
      \matA \vv{h} < \matA \tail{\vv{s}}_q + \vv{w}q
   \end{equation}
   and prove using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
   As $\vv{u}=\matA\vv{s}+\vv{w}$ has integer coordinates, it follows that $\denom$ is also a denominator for $\vv{w}$.
   This and the positivity of $\vv{w}$ in $\rs(\O)$ imply that $\vv{w}q$ is greater than $q\vv{1}/d$ in $\rs(\O)$, which in turn is greater than $\matA\vv{h}$, by assumption.
   Thus, \eqref{equivalent ineq: e} holds in $\rs(\O)$.
   Collapsing along $\O$, on the other hand, \eqref{equivalent ineq: e} becomes $\collapse{\matA} \vv{h} < \collapse{\matA} \tail{\vv{s}}_q$, which holds by the feasibility of $\vv{h}$ for $\ip$, and shows that \eqref{equivalent ineq: e} also holds in $\rs(\O)^\perp$.

   In summary, we have just shown that $\vv{k}$ is feasible for $\IP$, and so
   \[ \val \IP \geq \norm{\vv{k}} = \ft{\matA}{\vv{u}} \cdot q - \norm{\tail{\vv{s}}_q} + \val \ip\]
   and equality holds by \eqref{ineq between deficits}.
\end{proof}

We now move toward establishing a useful bound for the value of $\ip(\matA, \vv{u}, \vv{s}, q)$.

\begin{lemma}
   \label{tail projection: L}
   If $(\matA, \vv{u}, \vv{s}, q)$ is a monomial list, then $\collapse{\matA}\tail{\vv{s}}_q$ is a positive lattice point, where the overbar denotes collapse along $\mf(\matA,\vv{u})$.
\end{lemma}

\begin{proof}
   By construction, $\vv{s}q - \tail{\vv{s}}_q $ has nonnegative integer coordinates, and the identity $\collapse{\vv{u}} q =\collapse{\matA} \vv{s} q = \collapse{\matA} ( \vv{s}q - \tail{\vv{s}}_q ) +\collapse{\matA} \tail{\vv{s}}_q$ then shows that $\collapse{\matA} \tail{\vv{s}}_q$ must also have integer coordinates.
   To see that this point is positive, note that $\collapse{\vv{u}} = \collapse{\matA} \vv{s}$ and $\collapse{\matA} \tail{\vv{s}}_q$ are both linear combinations with positive coefficients of the same set of columns of $\collapse{\matA}$.
   It is then easy to see that since $\collapse{\vv{u}} = \collapse{\matA} \vv{s}$ is positive, so is $\collapse{\matA} \tail{\vv{s}}_q$.
\end{proof}

\begin{proposition}[Bounds on the value of $\ip$]
   \label{bounded value: P}
   If $(\matA, \vv{u}, \vv{s}, q)$ is a monomial list, then
   \[0 \leq  \val  \ip(\matA, \vv{u}, \vv{s}, q) < \norm{\tail{\vv{s}}_q}.\]
\end{proposition}

\begin{proof}
   Fix a point $\defpt \in \RR^\numvars$ that defines $\O  = \mf(\matA, \vv{u})$ in the Newton polyhedron of $\matA$, and let an overbar denote collapse along $\O$.
   Let $\vv{h}$ be optimal for $\ip = \ip(\matA, \vv{u}, \vv{s}, q)$.
   If the $i$-th column of $\matA$ does not lie in $\O$, then $s_i$ is zero, and consequently $h_i$ is nonnegative.
   \Cref{prop: inner product with columns of A,rmk: collapse of a matrix,collapse of a defining vector: R} then tell us that
   \begin{equation}
      \label{bound in inner product: e}
      \val \ip = \norm{\vv{h}} \leq \iprod{\defpt}{\matA \vv{h}} = \iprod{\collapse{\defpt}}{\collapse{\matA} \vv{h}}.
   \end{equation}
   Those same results applied to $\tail{\vv{s}}_q$ give us
   \begin{equation}
      \label{norm of tail: e}
      \norm{\tail{\vv{s}}_q} =  \iprod{\defpt}{\matA \tail{\vv{s}}_q} = \iprod{\collapse{\defpt}}{\collapse{\matA} \tail{\vv{s}}_q}.
   \end{equation}
   These observations and the constraint $\collapse{\matA}\vv{h} <\collapse{\matA} \tail{\vv{s}_q}$ combine to tell us that
   \[ \val\ip \leq \iprod{\collapse{\defpt}}{\collapse{\matA} \vv{h}} < \iprod{\collapse{\defpt}}{\collapse{\matA} \tail{\vv{s}}_q} = \norm{\tail{\vv{s}}_q}.\]
   Finally, the positivity of $\collapse{\matA}\tail{\vv{s}}_q$ established in \Cref{tail projection: L} implies that $\vv{0}$ is feasible for $\ip$, and thus $\val \ip \ge 0$.
\end{proof}

\subsection{Some finiteness properties}

We now explore finiteness properties concerning the nature of these programs as, for a fixed monomial matrix $\matA$, we vary the $\matA$-list $(\matA, \vv{u}, \vv{s}, q)$.
The following theorem underlies some of our later finiteness results.

\begin{theorem}[There are finitely many $\ip(\matA,\bullet,\bullet,\bullet)$]
   \label{finitely many secondary programs: T}
   If $\matA$ is fixed, then there are only finitely many integer programs of the form $\ip(\matA, \vv{u}, \vv{s}, q)$ as we vary over all $\matA$-lists $(\matA, \vv{u}, \vv{s}, q)$.
\end{theorem}

\begin{proof}
   Consider a monomial list $(\matA, \vv{u}, \vv{s}, q)$.
   As $\matA$ is fixed, there are only finitely many possibilities for $\O = \mf(\matA, \vv{u})$, and only finitely many possibilities for the set of supporting indices of any point $\vv{s} \in \sp_{\QQ}(\matA ,\vv{u})$.

   Next, let $\collapse{\matA}$ be the collapse of $\matA$ along the face $\O$.
   If $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$, then $\vv{0} \leq \tail{\vv{s}}_q \leq \vv{1}$ for every positive integer $q$.
   Consequently, $\vv{0} \leq \collapse{\matA} \tail{\vv{s}}_q \leq \collapse{\matA}\, \vv{1}$, and as \Cref{tail projection: L} tells us that $\collapse{\matA} \tail{\vv{s}}_q$ has integer coordinates, it follows that there are only finitely many possibilities for this point.
\end{proof}

\begin{corollary}\label{finitely many coord sums: C}
   If $\matA$ is fixed, then there are only finitely many rational numbers of the form $ \norm{\tail{\vv{s}}_q}$ as we vary over all $\matA$-lists $(\matA, \vv{u}, \vv{s}, q)$.
\end{corollary}

\begin{proof}
   This follows from \eqref{norm of tail: e} and the proof of \Cref{finitely many secondary programs: T}.
\end{proof}

\section{Toward solving $\IP$}
\label{solving: S}

Throughout this section, $(\matA, \vv{u})$ is a monomial pair and $q$ is positive integer.
Our goal here is to demonstrate that the value and the image of $\opt\IP(\matA, \vv{u}, q)$ under $\matA$
\pedro{Replaced ``optimal image'' with this; maybe we'll want to rephrase this.}
vary with $q$ in a uniform way as $q$ tends to infinity.

\subsection{Shortfall and deficit}

The constraints of the integer program $\IP(\matA,\vv{u},q)$ and of the arithmetic integer program $\IP_p(\matA,\vv{u},q)$ imply that for every subset $\mathcal{F}$ of their feasible sets, the image of $\mathcal{F}$ under $\matA$, denoted $\matA(\mathcal{F})$, consists of points in the target lattice of $\matA$ that are less than $\vv{u}q$.
In particular, the Minkowski difference $\vv{u}q-\matA(\mathcal{F})$ consists of positive lattice points in the target lattice of $\matA$.

\begin{definition}[Shortfall for $\IP$ and $\IP_p$]
   The \emph{shortfall} of the integer program $\IP(\matA, \vv{u}, q)$ is the Minkowski difference
   \[ \short \IP(\matA, \vv{u}, q) = \vv{u}q - \matA( \opt \IP(\matA, \vv{u}, q)).\]
   The shortfall of the arithmetic integer program $\IP_p(\matA, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

The preceding discussion shows that the shortfall of either program consists of positive lattice points in the target lattice of $\matA$.

\begin{remark}[Algebraic interpretation of shortfalls]
\label{shortfall motivation: R}
Let $(\matA,\vv{u})$ be a monomial pair associated to an ideal pair $(\ideala,\ideald)$.
If $q$ is a power of $p$, $\IP = \IP(\matA,\vv{u},q)$, and $\nu = \nu(\ideala,\ideald,q) = \val \IP$, then the shortfall of $\IP$ can be interpreted as the ``leftovers'' of $\ideala^\nu$ modulo $\ideald^{[q]}$.

More precisely, the discussion preceding \Cref{IP: D} tells us that the generators of $\ideala^{\nu}$ not contained in $\ideald^{[q]}$ are precisely the monomials of the form $x^{\matA \vv{k}}$, with $\vv{k}$ in the domain lattice of $\matA$ satisfying $\norm{\vv{k}} = \nu$ and $\matA\vv{k}<\vv{u}q$.
Keeping in mind that $\nu= \val \IP$, these conditions on $\vv{k}$ are equivalent to $\vv{k}$ being optimal for $\IP$.
Thus, the generators of $\ideala^{\nu}$ not in $\ideald^{[q]}$ are precisely the monomials of the form $x^{\vv{w}}$, with the exponent vector $\vv{w}$ lying in $\matA(\opt \IP) = \vv{u}q - \short \IP$.
In other words,
\begin{equation}
\label{algebraic shortfall PI general: e}
 \ideala^{\nu(\ideala, \ideald, q)} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP(\matA,\vv{u},q)} \bmod \ideald^{[q]}.
 \end{equation}
Likewise, one can show that
\begin{equation}
\label{algebraic shortfall PI_p general: e}
\ideala^{[\mu(\ideala, \ideald, q)]} \equiv \ideal{x^{\vv{u}q-\vv{v}}: \vv{v} \in \short \IP_p(\matA,\vv{u},q)} \bmod \ideald^{[q]}
\end{equation}
giving us an algebraic interpretation for the shortfall of the arithmetic integer program $\IP_p(\matA,\vv{u},q)$.
\end{remark}

If $\vv{k}$ is optimal for $\IP = \IP(\matA,\vv{u},q)$ or $\IP_p = \IP_p(\matA,\vv{u},q)$, then $\matA\vv{k} < \vv{u}q$.
For sufficiently small positive $\epsilon$, we have $\matA(\vv{k}+\epsilon\vv{1}) < \vv{u}q$, so $(\vv{k}+\epsilon \vv{1})/q$ is feasible for $\LP(\matA,\vv{u})$.
Thus, $\norm{\vv{k}}/q < \val \LP(\matA,\vv{u}) = \ft{\matA}{\vv{u}}$, showing that the values of $\IP$ and $\IP_p$ are strictly less than $\ft{\matA}{\vv{u}}q$.
The notion of \emph{deficit} is introduced to measure how far those values are from this natural upper bound.

\begin{definition}[Deficit for $\IP$ and $\IP_p$]
   The \emph{deficit} of the integer program $\IP(\matA, \vv{u}, q)$ is positive rational number
   \[ \deficit \IP(\matA, \vv{u}, q) = \ft{\matA}{\vv{u}}q - \val \IP(\matA, \vv{u}, q).\]
   The deficit of the arithmetic integer program $\IP_p(\matA, \vv{u}, q)$ is defined likewise, replacing $\IP$ with $\IP_p$.
\end{definition}

We now extend the definitions of shortfall and deficit to the auxiliary integer program $\ip(\matA,\vv{u},\vv{s},q)$.

\begin{definition}[Shortfall and deficit for $\ip$]
   \label{deficit and shortfall ip: D}
   The \emph{shortfall} of the integer program $\ip = \ip(\matA, \vv{u}, \vv{s}, q)$ is the set
   \[ \short \ip = \collapse{\matA} \tail{\vv{s}}_q - \collapse{\matA} (\opt \ip)\]
   where the overbar denotes collapse along $\mf(\matA, \vv{u})$.
   The \emph{deficit} of $\ip$ is the positive rational number
   \[ \deficit \ip = \norm{\tail{\vv{s}}_q} - \val \ip. \]
\end{definition}

\Cref{tail projection: L} and the constraints of $\ip$ imply that the shortfall of $\ip$ consists of positive lattice points, while \Cref{bounded value: P} shows that the deficit of $\ip$ is indeed positive.
Moreover, every universal denominator for $\matA$ is also a denominator for the deficit of $\ip$.

Our next proposition will show that, even though the optimal set of an integer program $\ip$ may be infinite, as shown in \Cref{ex: ft.3}, its shortfall is always finite.
For that, we shall need the following simple boundedness result.

\begin{lemma}
   \label{bounded polytope: L}
   Let $\vv{c}$ and $\vv{u}$ be points in $\RR^\numvars$, and suppose that $\vv{c}$ has positive coordinates.
   If $\alpha$ is any real number, then the polyhedron consisting of all points $\vv{v} \in \RR^\numvars$ such that  $\vv{v} \le \vv{u}$ and $\iprod{\vv{c}}{\vv{v}} \geq \alpha$ is bounded.
\end{lemma}

\begin{proof}
   It suffices to show that the given set is bounded from below.
   For each $\vv{v}$ in that set and each $i$ we have $\vv{v}\le \vv{u} + (v_i - u_i)\canvec_i$.
   As $\vv{c}$ has positive coordinates, $\alpha\le \iprod{\vv{c}}{\vv{v}}\le \iprod{\vv{c}}{\vv{u} + (v_i -u_i)\canvec_i} = \iprod{\vv{c}}{\vv{u}} + c_i(v_i - u_i)$, so $v_i \ge (\alpha + c_iu_i - \iprod{\vv{c}}{\vv{u}})/c_i$.
\end{proof}

\begin{proposition}%[Finiteness of shortfalls]
   \label{finite image: P}
   The shortfall of $\ip(\matA, \vv{u}, \vv{s}, q)$ is finite.
\end{proposition}

\begin{proof}
   Suppose $\defpt$ defines $\O  = \mf(\matA, \vv{u})$ in the Newton polyhedron of $\matA$, and let an overbar denote collapse along $\O$.
   If $\vv{h}$ is optimal for $\ip = \ip(\matA, \vv{u}, \vv{s}, q)$, then \eqref{bound in inner product: e} tells us that $\val \ip = \norm{\vv{h}} \leq \iprod{\collapse{\defpt}}{\collapse{\matA} \vv{h}}$, and so $\collapse{\matA} \vv{h}$ is a lattice point in the polyhedron of all points $\vv{v}$ with $\vv{v} \le \collapse{\matA} \tail{\vv{s}}_q$ and $\iprod{\collapse{\defpt}}{\vv{v}} \geq \val \ip$.
   The positivity of $\collapse{\defpt}$ and \Cref{bounded polytope: L} then tell us that this polyhedron is bounded.
   Thus, $\collapse{\matA}(\opt \ip)$ is finite, and therefore so is $\short \ip$.
\end{proof}

\begin{example}[Running example: shortfall]
   In the situation of \Cref{ex: ft.3}, we have seen that the optimal set for $\ip = \ip(\matA,\vv{u},\vv{s},q)$ consists of three infinite families of points.
   A direct computation shows that each of those families provides a unique point in the shortfall of $\ip$, and that $\short\ip = \{(3,1),(2,4),(1,7)\}$.
   % \begin{align*}
   %   P_1 &= \{(k,k,1-2k): k\in \NN\},\\
   %   P_2 &= \{(k+1,k,-2k): k\in \NN\},\\
   %   P_3 &= \{(k+2,k,-1-2k): k\in \NN\}.
   % \end{align*}
   % For $\vv{h} \in \opt\ip$ we have
   % \[
   %    \collapse{\matA}\tail{\vv{s}}_p -\collapse{\matA}\vv{h} =
   %    \begin{cases}
   %       (3,1) & \text{if $\vv{h}\in P_1$}\\
   %       (2,4) & \text{if $\vv{h}\in P_2$}\\
   %       (1,7) & \text{if $\vv{h}\in P_3$}
   %    \end{cases}
   % \]
%   Thus, in this case $\short\ip = \{(3,1),(2,4),(1,7)\}$.
\end{example}

\Cref{finite image: P,finitely many secondary programs: T} give us the following result.

\begin{theorem}[Existence of finite sets of representatives]
   \label{fsr-exist: T}
   Given a monomial matrix $\matA$, there exists a finite subset $\fsr = \fsr(\matA)$ of the domain lattice of $\matA$ such that for each integer program $\ip = \ip(\matA, \vv{u}, \vv{s}, q)$ we have
   \[\short \ip = \collapse{\matA}\tail{\vv{s}}_q - \collapse{\matA}(\fsr \cap \opt \ip).\]
\end{theorem}

\begin{proof}
   \Cref{finite image: P} implies that for every monomial list $(\matA, \vv{u}, \vv{s}, q)$,  there exists a \emph{finite} subset $\fsr(\matA, \vv{u}, \vv{s}, q)$ of $\opt \ip (\matA, \vv{u}, \vv{s}, q)$ such that
   \[  \collapse{\matA}(\opt \ip (\matA, \vv{u}, \vv{s}, q) ) = \collapse{\matA}(\fsr(\matA, \vv{u}, \vv{s}, q)). \]
   \Cref{finitely many secondary programs: T} then implies that these sets may be chosen in such a way so that $\fsr(\matA) = \bigcup \fsr(\matA, \vv{u}, \vv{s}, q)$ is finite, where the union is over all $\matA$-lists.
\end{proof}

\subsection{Relating the two integer programs}
\label{relating-programs: ss}

\begin{proposition}[Relating deficit and shortfall of $\IP$ and $\ip$]
   \label{uniform value and image: P}
   Given a monomial matrix $\matA$, there exists $\beta = \beta(\matA) \in \ZZ$ satisfying the following condition\textup:
   If $(\matA, \vv{u})$ is a monomial pair, $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$ is a point with denominator $\denom$, and $q>\beta \denom$, then
   \[ \deficit \IP(\matA, \vv{u}, q) = \deficit \ip(\matA, \vv{u}, \vv{s}, q) \]
   and
   \[ \ol{\short \IP(\matA, \vv{u}, q)} = \short \ip(\matA, \vv{u}, \vv{s}, q)\]
   where the overbar denotes collapse along $\O = \mf(\matA, \vv{u})$.
\end{proposition}

\begin{proof}
   Let $\fsr$ be as in \Cref{fsr-exist: T}, and $\beta$ be the maximum among all coordinates of all points of $\vv{1} - \fsr$ and $\matA(\fsr)$.
   Fix an $\matA$-pair $(\matA, \vv{u})$ and a point $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$.
   If $\denom$ is a denominator for $\vv{s}$, fix an integer $q > \beta \denom$, and set $\IP = \IP(\matA,\vv{u},q)$ and $\ip = \ip(\matA,\vv{u},\vv{s},q)$.
   \Cref{uniform value: P} then shows that
   \begin{equation}\label{eq: comparing values}
       \val \IP = \ft{\matA}{\vv{u}}q - \norm{\tail{\vv{s}}_q}+\val\ip
   \end{equation}
   so $\deficit \IP = \deficit \ip$.
   Let $\vv{h}$ be a point in the domain lattice of $\matA$, and set $\vv{k} = \vv{s}q - \tail{\vv{s}}_q + \vv{h}$.
   Multiplying by $\collapse{\matA}$ and noting that $\collapse{\matA}\vv{s} = \collapse{\vv{u}}$, we obtain
   \begin{equation}\label{eq: comparing differences}
   \collapse{\vv{u}}q - \collapse{\matA}\vv{k} = \collapse{\matA}\tail{\vv{s}}_q - \collapse{\matA} \vv{h}.
   \end{equation}
   If $\vv{k}\in \opt\IP$, then $\vv{h}$ is feasible for $\ip$ by \Cref{comparison: R}, and therefore optimal for $\ip$ by \eqref{eq: comparing values}.
   Equation~\eqref{eq: comparing differences} then shows that $\ol{\short\IP}\subseteq \short \ip$.
   Conversely, if $\vv{h} \in \fsr \cap \opt\ip$, then \Cref{uniform value: P} shows that $\vv{k}\in \opt \IP$.
   \Cref{fsr-exist: T} and \eqref{eq: comparing differences} then give us the reverse containment, $\short \ip \subseteq \ol{\short\IP}$.
\end{proof}

The above result leads to a fundamental observation.

\begin{corollary}[Non-dependence on the special point]
   \label{independence: C}
   The deficit and the shortfall of $\ip(\matA, \vv{u}, \vv{s}, q)$ do not depend on $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$.
\end{corollary}

\begin{proof}
   Fix $\vv{s}$ and $\vv{s}'$ in $\sp_{\QQ}(\matA, \vv{u})$, as well as a common denominator $\denom$ for these points.
   As the deficits and shortfalls of $\ip(\matA,\vv{u},\vv{s},q)$  and $\ip(\matA,\vv{u},\vv{s}',q)$ clearly depend only on $q$ modulo $\denom$, it suffices to show that they agree whenever $q \gg 0$, but this follows from \Cref{uniform value and image: P}.
\end{proof}

The above corollary and \Cref{uniform value and image: P} motivate the following definition.

\begin{definition}[Universal deficit and shortfall]
\label{independence: D}
Given a monomial pair $(\matA, \vv{u})$ and positive integer $q$, we define the \emph{universal deficit} and \emph{universal shortfall} of $(\matA,\vv{u},q)$ as follows\textup:
 \[ \udeficit(\matA, \vv{u}, q) = \deficit\ip( \matA, \vv{u}, \vv{s}, q)\] and
\[\ushort(\matA, \vv{u}, q) = \short\ip( \matA, \vv{u}, \vv{s}, q)\]
where  $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$.
\end{definition}

\begin{remark}[A finiteness property]
   \label{finitely many deltas for a fixed A: R}
   Given a monomial matrix $\matA$, there are only finitely many universal deficits $\udeficit(\matA, \vv{u}, q)$ and universal shortfalls $\ushort(\matA, \vv{u}, q)$, as we vary over all $\matA$-pairs $(\matA,\vv{u})$ and all positive integers $q$.
   Indeed, this follows immediately from \Cref{finitely many secondary programs: T}.
\end{remark}

\begin{remark}[Invariance under collapse]
   \label{comparing deltas: R}
   If $(\matA, \vv{u}, \vv{s}, q)$ is a monomial list and $(\collapse{\matA}, \collapse{\vv{u}})$ is the collapse of $(\matA ,\vv{u})$ along $\mf(\matA, \vv{u})$, then \Cref{collapse of mf and mc: P} implies that $(\collapse{\matA}, \collapse{\vv{u}}, \vv{s}, q)$ is also a monomial list, and it is then clear from \Cref{aux program: D} that $\ip(\matA, \vv{u}, \vv{s}, q) = \ip(\collapse{\matA}, \collapse{\vv{u}}, \vv{s}, q)$.
   Consequently,
   \[ \udeficit(\matA, \vv{u}, q) = \udeficit(\collapse{\matA}, \collapse{\vv{u}}, q)\]
   and
   \[\ushort(\matA, \vv{u},q) = \ushort(\collapse{\matA}, \collapse{\vv{u}}, q)\]
   and one may replace the point in $\sp_{\QQ}(\matA, \vv{u})$ in \Cref{independence: D} with one in $\sp_{\QQ}(\collapse{\matA}, \collapse{\vv{u}})$ without affecting the universal deficit and shortfall.
\end{remark}

\begin{remark}[Uniform periodicity]
   \label{pair periodicity: R}
   Given a monomial matrix $\matA$, there exists a positive integer $\denom$ such that for every $\matA$-pair $(\matA,\vv{u})$, $\udeficit(\matA, \vv{u}, q)$ and $\ushort(\matA,\vv{u},q)$ only depend on $q$ modulo $\denom$.
   Indeed, if $\denom$ is a universal denominator for $\matA$, as in \Cref{universal denominator:  D}, then we may compute $\udeficit(\matA, \vv{u}, q)$ and $\ushort(\matA, \vv{u}, q)$ for every $\matA$-pair $(\matA, \vv{u})$ and every $q$ using a point in $\sp_{\QQ}(\matA, \vv{u})$ with denominator $\denom$.
   Consequently,
   \[
      \udeficit(\matA, \vv{u}, q) = \udeficit(\matA, \vv{u}, r)
   \]
   and
   \[
      \ushort(\matA, \vv{u}, q) = \ushort(\matA, \vv{u}, r)
   \]
   whenever $q \equiv r \bmod \denom$.
\end{remark}

We record another application of universal denominators below.

\begin{theorem}[Deficit and shortfall of $\IP$ \vs $\udeficit$ and $\ushort$]
\label{uniform uniform value and image: T}
Given a monomial matrix $\matA$, there exists an integer $\beta = \beta(\matA)$ with the following property\textup:
If $q > \beta$ and $(\matA, \vv{u})$ is a monomial pair, then
\[  \ft{\matA}{\vv{u}} q - \val \IP(\matA, \vv{u}, q) \eqqcolon \deficit \IP(\matA, \vv{u}, q) = \udeficit(\matA, \vv{u}, q) \]
and
\[  \ol{ \short \IP(\matA, \vv{u}, q)} = \ushort (\matA, \vv{u}, q).\]
\end{theorem}

\begin{proof}
   Let $\denom$ be a universal denominator for $\matA$, so that for every $\matA$-pair $(\matA, \vv{u})$, there exists a point in $\sp_{\QQ}(\matA, \vv{u})$ with denominator $\denom$.
   If $\beta_{\circ}$  is any integer satisfying the condition stated in \Cref{uniform value and image: P}, then we may take $\beta = \denom \beta_{\circ}$.
\end{proof}

To interpret this result algebraically, we need to extend the notion of collapses to monomial and diagonal ideals.

\begin{definition}[Algebraic collapses]
   Let $(\ideala,\ideald)$ be an ideal pair in $\ringR = \kk[x_1,\ldots,x_\numvars]$.
   Let $(\matA,\vv{u})$ be an associated monomial pair and $\O=\mf(\matA,\vv{u})$.
   \begin{enumerate}
      \item The \emph{collapse of $\ringR$} (along $\O$) is the polynomial ring $\collapse{\ringR}$ obtained from $\ringR$ by omitting the variable $x_i$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideala$} (along $\O$) is the monomial ideal $\collapse{\ideala}$ of $\collapse{\ringR}$ obtained from $\ideala$ by setting $x_i$ equal to $1$ whenever $\canvec_i \in \rb(\O)$.
      \item The \emph{collapse of $\ideald$} (along $\O$) is the proper diagonal ideal $\collapse{\ideald}$ of $\collapse{\ringR}$ obtained from $\ideald$ by setting $x_i$ equal to $0$ whenever $\canvec_i \in \rb(\O)$.
   \end{enumerate}
\end{definition}

Thus, $\collapse{\ideala}$ and $\collapse{\ideald}$ are the images of $\ideala$ and $\ideald$ under suitable (different) evaluation homomorphisms $\ringR\to \collapse{\ringR}$, designed so that $(\collapse{\ideala},\collapse{\ideald})$ is an ideal pair, and $(\collapse{\matA},\collapse{\vv{u}})$ is a monomial pair associated to it.

We note that the collapsed ideal pair $(\collapse{\ideala},\collapse{\ideald})$ depends on the choice of the associated monomial pair $(\matA,\vv{u})$ associated to $(\ideala,\ideald)$.
If this choice is irrelevant or clear from the context, then we shall omit the reference to the minimal face $\O$ when referring to collapsed ideal pairs.

\begin{corollary}
\label{computing nu for large q: C}
   Given a monomial ideal $\ideala$, there exists an integer $\beta = \beta(\ideala)$ with the following property\textup:
   If $q> \beta$, and $(\ideala, \ideald)$ is an ideal pair, then
   \begin{equation*}
      \nu(\ideala, \ideald, q) = \ft{\ideala}{\ideald} q - \udeficit(\matA, \vv{u},q) = \nu(\collapse{\ideala},\collapse{\ideald}, q). \qed
   \end{equation*}
\end{corollary}



Recall that a pair of ideals $(\ideala, \idealb)$ of a polynomial ring over a field are called \hl{\emph{compatible}} if $\idealb$ contains $\sqrt{a}$, that is, there exists a positive integer $t$ such that $\ideala^t \subseteq \idealb$. \todo{Defined outside of appendix?}

\begin{corollary}  Consider a compatible pair of ideals $(\ideala, \idealb)$ of $\QQ[x]$, with $\ideala$ monomial, and fix a pair of ideals $(\ideala_{\ZZ}, \idealb_{\ZZ})$ of $\ZZ[x]$ such that $\ideala_{\ZZ} \QQ[x] = \ideala$ and $\idealb_{\ZZ} \QQ[x] = \idealb$.    Then, there exist positive integers $\beta$ and $d$, a positive rational number $\lambda$, and a finite sequence of positive rational numbers $\{ \eta_r \}_r$ indexed by the units of $\ZZ/d\ZZ$, with the following properties:  If $p > \beta$, and $e$ is a positive integer with $\lpr{p^e}{d} = r$, then 
\[ \nu(\ideala_p, \idealb_p, p^e) = \lambda p^e - \eta_r \] where $\ideala_p = \ideala_{\ZZ} \FF_p[x]$, and $\idealb_p = \idealb_{\ZZ} \FF_p[x]$.
\end{corollary}

\begin{proof}  Let $\matA$ be a monomial matrix associated to $\ideala$.  \Cref{nu invariants associated to a monomial ideal in large characteristic: T}  then implies that there exist a finite collection of pairs $(\matA, \vv{u}_1), \ldots, (\matA, \vv{u}_{\ell})$, which depend on $\matA$ and $\idealb$, and a positive integer $\beta$, which depends on the pair $(\ideala_{\ZZ}, \idealb_{\ZZ})$,  such that $\nu(\ideala_p, \idealb_p, p^e) = \max \val \IP(\matA, \vv{u}_i, p^e)$  for every prime $p > \beta$, and positive integer $e$.  

On the other hand, after possibly increasing $\beta$, \Cref{uniform uniform value and image: T} guarantees that 
$\val \IP(\matA, \vv{u}_i, p^e) = \deg(\matA, \vv{u}_i) p^e - \udeficit(A, \vv{u}_i, p^e)$  for every prime $p > \beta$ and positive integer $e$, and for each $(\matA, \vv{u}_i)$ as above.   Combining these observations, 
$\nu(\ideala_p, \idealb_p, p^e) = \max  \{ \deg(\matA, \vv{u}_i) p^e - \udeficit(\matA, \vv{u}_i, p^e) \}$ for every $p > \beta$ and $e > 0$.  

Set $\lambda = \max \deg(\matA, \vv{u}_i)$, and for every positive integer $q$, let $\eta_{q}$ be the minimum value of all $\udeficit(A, \vv{u}_i, q)$ with $ \deg(\matA, \vv{u}_i) = \lambda$.  Note that, if we fix a universal denominator $d$ for $\matA$, then \Cref{pair periodicity: R} tells us that $\eta_q = \eta_r$ whenever $q \equiv r \bmod d$.  

It follows from these definitions that, after possibly increasing $\beta$ again, 
\[ \nu(\ideala_p, \idealb_p, p^e) = \lambda p^e - \eta_{\lpr{p^e}{d}} \] 
for all $p > \beta$ and $e > 0$.
\end{proof}

\section{Arithmetic integer programs revisited}

The remainder of this paper is dedicated to the study of the arithmetic integer programs $\IP_p(\matA, \vv{u}, p^e)$ described in \Cref{aip: D}, which perhaps unsurprisingly, turn out to be far more complex in nature than their non-arithmetic counterparts $\IP(\matA, \vv{u}, p^e)$.
Throughout this section, $(\matA,\vv{u})$ is a monomial pair, $e$ is a natural number, and $q$ is a power of a prime $p$.

\subsection{A key theorem}
\Cref{general AIP: T} plays a key role in our algorithm for computing the value of $\IP_p(\matA, \vv{u}, p^e)$ for $p \gg 0$ when $\ft{\matA}{\vv{u}} \le 1$ and the matrix $\matA$ is associated to an $\idealm$-primary ideal, where $\idealm$ is the ideal generated by the variables.
The description of this algorithm caps off this section, and relies on the proof of the main theorem herein, \Cref{m-primary AIP: T}, which shows that $\val \IP_p(\matA, \vv{u}, p^e)$ is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{\matA}{\vv{u}}$ and, remarkably, depends only on $(\matA,\vv{u})$ and the class of $p$ modulo any universal denominator for $\matA$.
We start with a technical lemma.

\begin{lemma}
   \label{general AIP prep: L}
   Consider nonnegative points $\vv{h}$ and $\vv{k}$ in the domain lattice of $\matA$, and set $\vv{g} = \vv{h} p^e + \vv{k}$ and $\vv{v} = \vv{u}q - \matA\vv{h}$.
   Then the following conditions are equivalent\textup:
   \begin{enumerate}[$(1)$]
      \item $\vv{g} \in \feas \IP_p(\matA,\vv{u},qp^e)$ and $\vv{k} < p^e \vv{1}$.
      \item $\vv{h} \in \feas \IP_p(\matA,\vv{u},q)$, $\vv{k} \in \feas \IP_p(\matA,\vv{v},p^e)$, and $\norm{\vv{k}} < p^e$.
   \end{enumerate}
   Moreover, if those conditions are met and, in addition, $\vv{g}\in \opt \IP_p(\matA,\vv{u},qp^e)$, then $\vv{h} \in \opt \IP_p(\matA,\vv{u},q)$, and consequently $\vv{v} \in \short \IP_p(\matA,\vv{u},q)$.
\end{lemma}

\begin{proof}
   Suppose that (1) holds.
   The linear constraint $\matA\vv{g} < \vv{u}qp^e$ imposed by $\IP_p(\matA, \vv{u}, qp^e)$ implies that $\matA\vv{h} < \vv{u}q$, and the identity
   \[\matA \vv{g} = \matA \vv{h} p^e + \matA \vv{k} = (\vv{u}q-\vv{v})p^e + \matA \vv{k}\]
   shows that that linear constraint on $\vv{g}$ is equivalent to $\matA \vv{k} < \vv{v}p^e$.
   Thus, both $\vv{h}$ and $\vv{k}$ satisfy the necessary linear constraints.
   By \Cref{dickson: R}, the arithmetic constraint satisfied by $\vv{g}$ implies that $0 \not \equiv \binom{\norm{\vv{g}}}{\vv{g}} \equiv \binom{\norm{\vv{h}}}{\vv{h}} \binom{\norm{\vv{k}}}{\vv{k}} \bmod p$, so that $\binom{\norm{\vv{h}}}{\vv{h}}$ and $\binom{\norm{\vv{k}}}{\vv{k}}$ must be nonzero modulo $p$, and thus both $\vv{h}$ and $\vv{k}$ satisfy the required arithmetic constraints.
   Finally, as $\vv{k} < p^e\vv{1}$, this point has a base $p$ expansion of the form $\vv{k} = \sum_{0 \leq s< e} \vv{k}_s  p^s$.
   The nonvanishing of $\binom{\norm{\vv{k}}}{\vv{k}}$ modulo $p$ tells us that $\norm{\vv{k}_s} < p$ for each $s$, and thus $\norm{\vv{k}} < p^e$.
   
   Suppose now that (2) holds.
   As noted above, the linear constraint on $\vv{k}$ imposed by $\IP_p(\matA,\vv{v},p^e)$ is equivalent to the required linear constraint on $\vv{g}$.
   The inequality $\norm{\vv{k}} < p^e$ implies that $\vv{k} < p^e \vv{1}$, and \Cref{dickson: R} shows that $\binom{\norm{\vv{g}}}{\vv{g}} \equiv  \binom{\norm{\vv{h}}}{\vv{h}} \binom{\norm{\vv{k}}}{\vv{k}} \bmod p$, so the arithmetic constraints satisfied by $\vv{h}$ and $\vv{k}$ give the necessary arithmetic constraint for $\vv{g}$.

   To conclude the proof, suppose the equivalent conditions (1) and (2) are met, and $\vv{g} \in \opt \IP_p(\matA,\vv{u},qp^e)$.
   If $\vv{h}$ were not optimal for $\IP_p(\matA, \vv{u}, q)$, then there would exist $\vv{m} \in \feas\IP_p(\matA, \vv{u}, q)$ with $\norm{\vv{m}} \geq \norm{\vv{h}} + 1$, which would lead to a point $\vv{m}p^e \in \feas\IP_p(\matA, \vv{u}, qp^e)$ with
   \[ \norm{\vv{m}p^e} \geq \norm{\vv{h}}  p^e + p^e >  \norm{\vv{h}}  p^e + \norm{\vv{k}} = \norm{\vv{g}}\]
   contradicting the optimality of $\vv{g}$.
\end{proof}

\begin{theorem}[Key Theorem]
\label{general AIP: T}
If $q$ is a power of $p$, and $e$ is a nonnegative integer, then
\[  L \coloneqq \val \IP_p(\matA, \vv{u}, qp^e) -  \val \IP_p(\matA, \vv{u}, q)p^e  \]
is nonnegative, at most $p^e-1$, and also at most
\[ M \coloneqq \max \{ \val \IP_p(\matA, \vv{v}, p^e)  \}\]
where the maximum is over the finitely many points $\vv{v} \in \short \IP_p(\matA, \vv{u}, q)$.
% \footnote{
%    Recall that, as $\matA$ is a monomial matrix, the feasible set of $\IP_p(\matA, \vv{v}, q)$ is finite, and hence, so is the shortfall of this program.  In particular, this maximum value is well defined.
% }
If, in addition\daniel{I don't know of any case where $M$ is at least $p^e$, but it might be true in low characteristic.}, $M \le p^e-1$,  then $L=M$, and
\[  \short \IP_p(\matA, \vv{u}, qp^e) = \bigcup \short \IP_p(\matA, \vv{v}, p^e)\]
where the union is over all $\vv{v} \in \short \IP_p(\matA, \vv{u}, q)$ with $\val \IP_p(\matA,\vv{v},p^e) = M$.
\end{theorem}

\begin{proof}
   Multiplying a feasible point for $\IP_p(\matA, \vv{u}, q)$ by $p^e$ yields a feasible point for $\IP_p(\matA, \vv{u}, qp^e)$, and hence $L\geq 0$.
   Let $\vv{g} \in \opt \IP_p(\matA, \vv{u}, qp^e)$.
   Dividing by $p^e$, we write $\vv{g} = \vv{h} p^e + \vv{k}$,
   where $\vv{h}$ and $\vv{k}$ are nonnegative lattice points and $\vv{k} < p^e \vv{1}$.
   \Cref{general AIP prep: L} then tell us that $\vv{h} \in \opt \IP_p(\matA,\vv{u},q)$, $\vv{v} \coloneqq \vv{u}q - \matA \vv{h} \in \short \IP_p(\matA,\vv{u},q)$, $\vv{k} \in \feas \IP_p(\matA,\vv{v},p^e)$, and $\norm{\vv{k}} < p^e$.
   Putting it all together, 
   \[ L = \norm{\vv{g}}-\norm{\vv{h}}p^e = \norm{\vv{k}} \leq \min \{ p^e-1, \val \IP_p(\matA, \vv{v}, p^e) \} \leq \min \{ p^e-1, M \}.\]
   Note also that if $L=M$, then $\norm{\vv{k}} = \val \IP_p(\matA,\vv{v},p^e) = M$, so $\vv{k} \in \opt\IP_p(\matA,\vv{v},p^e)$.
   The identity
   \begin{equation}
      \label{eq: relating shortfalls}
      \vv{u}qp^e-\matA \vv{g} =
      (\vv{u}q-\matA\vv{h})p^e-\matA(\vv{g}-\vv{h}p^e) = 
      \vv{v}p^e-\matA\vv{k}
   \end{equation}
   then shows that $\vv{u}qp^e-\matA \vv{g}$, an arbitrary point in $\short\IP_p(\matA, \vv{u},q p^e)$, lies in $\short \IP_p(\matA, \vv{v},p^e)$, so
   \begin{equation}
      \label{general comparison of shortfalls: e}
      \short \IP_p(\matA, \vv{u}, qp^e) \subseteq \bigcup \short \IP_p(\matA, \vv{v}, p^e)
   \end{equation}
   where the union is as in the statement.
   To complete the proof, it remains to show that if $M\le p^e-1$, then the reverse containment holds and $L$ indeed equals  $M$.
   
   Suppose $M \le p^e-1$, let $\vv{v} \in \short \IP_p(\matA, \vv{u}, q)$ with $\val\IP_p(\matA,\vv{v},p^e)=M$, and write $\vv{v} = \vv{u}q - \matA \vv{h}$ for some $\vv{h} \in \opt \IP_p(\matA, \vv{u}, q)$.
   If $\vv{k} \in \opt \IP_p(\matA, \vv{v}, p^e)$, then $\norm{\vv{k}} = M \leq p^e-1$, hence  $\vv{g} \coloneqq \vv{h} p^e + \vv{k} \in \feas \IP_p(\matA,\vv{u},qp^e)$ by \Cref{general AIP prep: L}.
   Thus,
   \[ L \geq \norm{\vv{g}} - \norm{\vv{h}}p^e = \norm{\vv{k}} = M \]
   and hence $L=M$, and $\vv{g}$ must be optimal for $\IP_p(\matA,\vv{u},qp^e)$.
   Finally, \eqref{eq: relating shortfalls} shows that $\vv{v}p^e - \matA\vv{k}$, an arbitrary point of $\short \IP_p(\matA,\vv{v},p^e)$, lies in $\short\IP_p(\matA,\vv{u},qp^e)$, establishing the reverse containment to \eqref{general comparison of shortfalls: e}.
\end{proof}

We record below a consequence of the bounds $0 \le L \leq p^e-1$ in \Cref{general AIP: T}.

\begin{corollary}
   \label{cor: mu comparison}
   Suppose that $(\matA,\vv{u})$ and $(\matB,\vv{v})$ are monomial pairs, not necessarily of the same dimension.
   If $\val \IP_p(\matA, \vv{u}, q)$ is greater than $\val \IP_p(\matB, \vv{v}, q)$ for some $q$, then $\val \IP_p(\matA, \vv{u}, qp^e)$ is greater than $\val \IP_p(\matB, \vv{v}, qp^e)$ for all $e$.
\end{corollary}

\begin{proof}
   \Cref{general AIP: T} gives us
   \[
      \val \IP_p(\matA, \vv{u},q)p^e \leq \val \IP_p(\matA, \vv{u}, qp^e) < (\val \IP_p(\matA, \vv{u}, q)+1)p^e
   \]
   as well as analogous inequalities for $(\matB,\vv{v})$.
   Combining these bounds with our assumption that $\val \IP_p(\matA, \vv{u}, q) \ge \val \IP_p(\matB, \vv{v}, q) + 1$, we see that
   \begin{align*}
     \val \IP_p(\matA, \vv{u}, qp^e)  &\geq \val \IP_p(\matA, \vv{u}, q)  p^e \\
                                  &\geq (\val \IP_p(\matB, \vv{v}, q)+1) p^e \\
                                  & > \val \IP_p(\matB, \vv{v}, qp^e). \qedhere
   \end{align*}
\end{proof}

%\begin{remark}
%The integer programs $\IP$ do not always satisfy the uniform comparison property of the arithmetic integer programs $\IP_p$ in  \Cref{cor: mu comparison}.
%For instance, suppose that $p \equiv 3 \bmod 4$, and let
%\[
% \matA = \begin{bmatrix} 4 & 0 \\ 0 & 4\end{bmatrix},  \
% \vv{u} = \begin{bmatrix}3\\ 3\end{bmatrix}, \text{ and }
% \vv{v} = \begin{bmatrix}5 \\ 1\end{bmatrix}.
%\]
%Then for $e \geq 1$, $\IP(\matA, \vv{u}, p^e)$ has optimal point $\big( \frac{3p^e-1}{4},  \frac{3p^e-1}{4} \big)$ when $e$ is odd and $\big( \frac{3p^e-3}{4}, \frac{3p^e-3}{4}\big)$ when $e$ is even, and so 
%\[
%\val\IP(\matA, \vv{u}, p^e) = \begin{cases}
%\frac{3 p^e - 1}{2} & \text{if } e \text{ is odd} \\
%\frac{3 p^e - 3}{2} & \text{if } e \text{ is even}
%\end{cases}
%\]
%These values, however, are switched for $\IP(\matA, \vv{v}, p^e)$: $\big( \frac{5p^e-3}{4}, \frac{p^e-3}{4} \big)$ is an optimal point for odd $e$,  and $\big( \frac{5p^e-1}{4},\frac{p^e-1}{4} \big)$ is one for even $e$, 
%so that 
%the program's value is $\frac{3p^e-3}{2}$ when $e$ is odd, and $\frac{3p^e-1}{2}$ when $e$ is even.
%\end{remark}

\begin{example}
\label{max depends on p and e: E}  The uniform comparison property described in \Cref{cor: mu comparison} may fail if we replace the arithmetic program $\IP_p$ with the standard program $\IP$.  For instance, suppose that $\matA$ is the $2 \times 2$ diagonal matrix with $4$ in each diagonal entry, and let $\vv{u}_1=(3,3)$ and $\vv{u}_2=(5,1)$;  note that $\ft{\matA}{\vv{u}_1} = \ft{\matA}{\vv{u}_2} = 3/2$.

Then, if $p \equiv 3 \bmod 4$, it follows from \Cref{concrete-solution-to-LP-IP: E}  that
\[
\val\IP(\matA, \vv{u}_1, p^e) = \begin{cases}
\frac{3 p^e - 1}{2} & \text{if } e \text{ is odd} \\
\frac{3 p^e - 3}{2} & \text{if } e \text{ is even}
\end{cases}
\]
and also, that these formulas are swapped after replacing $\vv{u}_1$ with $\vv{u}_2$, that is, 
\[
\val\IP(\matA, \vv{u}_2, p^e) = \begin{cases}
\frac{3 p^e - 3}{2} & \text{if } e \text{ is odd} \\ 
\frac{3 p^e - 1}{2} & \text{if } e \text{ is even}.
\end{cases}
\]
\end{example}


\subsection{Small and very small pairs}

\begin{definition}[Small and very small pairs]
A monomial pair $(\matA, \vv{u})$ is \emph{small} if $\vv{u}$ is not greater than any column of $\matA$, and is \emph{very small} if $\ft{\matA}{\vv{u}} \le 1$.
\end{definition}

\begin{remark}[Algebraic description of small and very small pairs]
\label{algebraic small and very small: R}
  Suppose $(\matA, \vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$.  If $\vv{a}_i$ is the $i$-th column of $\matA$, then the condition that $\vv{a}_i \not < \vv{u}$ is equivalent to the condition that the generator $x^{\vv{a}_i}$ of $\ideala$ lies in $\ideald$.  In other words, $(\matA, \vv{u})$ is small if and only if $\ideala \subseteq \ideald$.

The algebraic characterization of a very small pair is simply that $(\matA, \vv{u})$ is very small if and only if the $F$-threshold of $\ideala$ with respect to $\ideald$ is at most $1$.
\end{remark}

\begin{remark}[Geometric description of small and very small pairs]
\label{geometric small and very small: R}
Given an $\numvars \times n$ monomial matrix $\matA$, let $\N \subseteq \RR^{\numvars}$ be its Newton polyhedron.
Geometrically, a pair $(\matA, \vv{u})$ is small if and only if $\vv{u}$ does not lie in the interior of the Minkowski sum $\col(\matA) + \cone(\canvec_1,\ldots,\canvec_\numvars)$, a subset of $\RR^{\numvars}$ sometimes called the \emph{upper staircase} determined by the columns of $\matA$.
On the other hand, \Cref{FT: D} and \Cref{FT descriptions: P}\ref{lambda} imply that a pair $(\matA, \vv{u})$ is very small if and only if $\vv{u}$ does not lie in the interior of $\N$.
It is clear from these interpretations that a very small pair must also be small, and that a small pair can fail to be very small.
\end{remark}

\begin{example}[A typical picture]
   \label{ex: small vs very small}
   \begin{figure}
      \centering
      \includegraphics[width=.5\textwidth]{pictures/small_very_small_illustration.pdf}\\[2mm]
      \begin{tabular}{l}
        $(\matA,\mathbin{\vcenter{\hbox{\scalebox{1.5}{$\bullet$}}}})$ is small (but not very small)\\[1mm]
        $(\matA,\textcolor{lightgray}{\mathbin{\vcenter{\hbox{\scalebox{1.5}{$\bullet$}}}}})$ is very small
      \end{tabular}                                                              
      \caption{Small and very small pairs---a typical picture}
      \label{fig: small vs very small}
   \end{figure}
   \Cref{fig: small vs very small} shows the typical situation in two dimensions.
   It shows the Newton polyhedron of a matrix $\matA$ with two rows and four columns, as well as the upper staircase determined by the columns of $\matA$.
   If $\vv{u}$ is any of the gray points, the monomial pair $(\matA,\vv{u})$ is very small.
   If $\vv{u}$ is any of the black points, $(\matA,\vv{u})$ is small, but not very small.
   Finally, if $\vv{u}$ is any of the white points, $(\matA,\vv{u})$ is not small.

   It is interesting to notice that if we were to make this a three-dimensional example by adding a nonzero constant row to the matrix $\matA$, we would then have infinitely many ``layers'' looking exactly like \Cref{fig: small vs very small}, and consequently we would have infinitely many small but not very small pairs.
   Indeed, this behavior can occur for $\numvars \times n$ monomial matrices $\matA$ for which $m > 2$.
   For a perhaps simpler (but similar) example, notice that a monomial pair $(\matA, \vv{u})$ associated to the ideal pair $(\ideala, \ideald)$, where $\ideala= \ideal{x^3 z, y^2z}$ and $\ideald = \ideal{x^2, y, z^t}$, is small but not very small for every $t > 1$.
\end{example}

\begin{remark}[$F$-thresholds of small pairs]
   \label{rem: finitely many F-thresholds of small pairs}
   Even though there may exist infinitely many small $\matA$-pairs, as shown in the previous example, the $F$-thresholds of small $\matA$-pairs are bounded above, by a bound dependent solely on $\matA$, and consequently there are only finitely many such $F$-thresholds by \Cref{discreteness: P}.
   
   \daniel[inline]{Here is an argument that may produce a much tighter bound (e.g., if $\numvars$ is small):
   
   {Suppose that $\vv{c} \in \RR^\numvars$ defines $\O = \mf(\matA, \vv{u})$, and without loss of generality, assume that the columns of $\matA$ lying in $\O$ are $\vv{a}_1, \ldots, \vv{a}_{\ell}$.  Write  $\vv{u} = \vv{v} + \vv{w}$ with $\vv{v} \in \cone(\vv{a}_1, \ldots, \vv{a}_{\ell})$ and $\vv{w} \in \rs(\O)$.  By Carath\'eodory's Theorem for cones, we may express $\vv{v}$ as a conical combination of $t$ linearly independent columns among $\vv{a}_1, \ldots, \vv{a}_{\ell}$, and the smallness of $(\matA,\vv{u})$ implies that every coefficient in such a conical combination is at most $1$.  Given that $\iprod{\vv{c}}{\vv{a}_i} = 1$ for every $1 \leq i \leq \ell$, it follows that}
\[ \ft{\matA}{\vv{u}} = \iprod{\vv{c}}{\vv{u}} = \iprod{\vv{c}}{\vv{v}} \leq t \leq \min \{ \numvars, \ell \} \leq \min \{ \numvars, n \}.\]}

   Indeed, if $(\matA,\vv{u})$ is small and $\vv{s}$ is optimal for the linear program $\LP(\matA,\vv{u})$, then $s_i\vv{a}_i \le \matA\vv{s} \le \vv{u}$ for each $i$, where $\vv{a}_i$ denotes the $i$-th column of $\matA$.
   The smallness of the pair and the positivity of $\vv{u}$ then imply that $s_i \le 1$ for each $i$, whence $\ft{\matA}{\vv{u}} = \norm{\vv{s}}$ is at most the number of columns of $\matA$. 
\end{remark}

\begin{remark}[Small pairs from shortfalls]
\label{small pairs from shortfalls: R}
If $\vv{v}$ is any point in the shortfall of some integer program $\IP = \IP(\matA, \vv{u}, q)$, then the pair $(\matA, \vv{v})$ is small.  Indeed, by definition of shortfalls, we may write $\vv{v} = \vv{u}q-\matA\vv{h}$ for some $\vv{h} \in \opt \IP$.  Subtracting $\vv{a}_i$, the $i$-column of $\matA$, from both sides of this identity yields
\[ \vv{v}-\vv{a}_i = \vv{u}q-\matA\vv{h}-\vv{a}_i = \vv{u}q-\matA(\vv{h}+\canvec_i). \]
The optimality of $\vv{h}$ implies that $\vv{h}+\canvec_i$ cannot satisfy the linear constraint of $\IP$, which shows that the right-hand side above is not positive.  In other words, $\vv{v} \not > \vv{a}_i$, and as $i$ was arbitrary, this shows that $(\matA, \vv{v})$ is small.

Similarly, if $\vv{v}$ is any point in the universal shortfall $\ushort(\matA, \vv{u}, q)$, then $(\collapse{\matA}, \vv{v})$ is also small, where the overbar denotes collapse along $\O = \mf(\matA, \vv{u})$.
\end{remark}

\begin{proposition}
   \label{trivial small value bound: P}
   \pedro{Made this a TFAE statement, and included formulation in terms of crit.}
   For a monomial pair $(\matA,\vv{u})$, the following statements are equivalent\textup:   
   \begin{enumerate}[$(1)$]
      \item $(\matA, \vv{u})$ is small.
      \item $\val \IP_p(\matA, \vv{u}, p^e) \leq p^e-1$ for each $e\in \NN$.
      \item $\val \fip_p(\matA,\vv{u}) \le 1$.
   \end{enumerate}
\end{proposition}

\begin{proof}
   For a change of pace, we give an algebraic proof.
   Suppose $(\matA,\vv{u})$ is associated to the ideal pair $(\ideala, \ideald)$ in positive characteristic $p$.
   If $(\matA, \vv{u})$ is small, then $\ideala \subseteq \ideald$ by \Cref{algebraic small and very small: R}.
   For each $e\in \NN$, this containment implies that $\ideala^{[p^e]} \subseteq \ideald^{[p^e]}$, which shows that $\val \IP_p(\matA, \vv{u}, p^e) = \mu(\ideala, \ideald, p^e) \leq p^e-1$.
   This shows that $(1)$ implies $(2)$.

   The implication $(2) \Rightarrow (3)$ follows directly from \eqref{crit as limit of normalized program values: eq} and \Cref{prop: value of fractal program is crit}, which tell us that
   \[\val \fip_p(\matA,\vv{u}) = \crit(\ideala,\ideald) = \lim_{e \to \infty} \frac{\val \IP_p(\matA, \vv{u}, p^e)}{p^e}.\]
   Finally, note that if $(\matA,\vv{u})$ is not small, then $\ideala^{[1]} = \ideala  \not\subseteq \ideald$, and therefore
   \[\val \fip_p(\matA,\vv{u}) = \crit(\ideala,\ideald) = \min\{t\in \RRnn: \ideala^{[t]} \subseteq \ideald\} > 1\]
   showing that $(3)$ implies $(1)$.
\end{proof}

\begin{remark}[Reduction to the small case]
   We now describe how to reduce the computation of the values of the arithmetic integer programs $\IP_p(\matA, \vv{u}, p^e)$ for all $e \geq 1$ to the small case, at least when $p$ is large relative to the pair $(\matA, \vv{u})$.
   For what follows, fix a pair $(\matA, \vv{u})$, and suppose that $p$ is larger than the value of the standard integer program $\IP(\matA, \vv{u},1)$.
   The arithmetic constraint of $\IP_p(\matA,\vv{u},1)$ is thus automatically satisfied, and so $\IP_p(\matA, \vv{u}, 1) = \IP(\matA, \vv{u}, 1)$.

   If $\vv{v} \in \short \IP(\matA,\vv{u},1)$, \Cref{small pairs from shortfalls: R} tells us that $(\matA, \vv{v})$ is small, and \Cref{trivial small value bound: P}  then tells us that $\val \IP_p(\matA, \vv{v}, p^e) \le p^e-1$.
   Setting $q=1$ in the statement of \Cref{general AIP: T}, this observation tells us that quantity $M$ defined therein is at most $p^e-1$, and that same theorem shows that
   \[ \val \IP_p(\matA, \vv{u},p^e) = \val \IP(\matA, \vv{u},1)p^e + \max \{ \val \IP_p(\matA, \vv{v}, p^e) \}\]
   where the maximum is over all $\vv{v} \in \short \IP(\matA, \vv{u},1)$.
   As noted earlier, for each such $\vv{v}$ the pair $(\matA,\vv{v})$ is small, which completes our reduction.
\end{remark}

The following theorem allows us to reduce even further, to the very small case; a related statement appears as \cite[Theorem~6.4]{hernandez+etal.frobenius_powers}.
Notice that \Cref{fig: small vs very small} may be misleading, in the sense that in this case there are only finitely many $\vv{u} \in \NN^2$ for which $(\matA, \vv{u})$ is small, but not very small, so that the existence of $\beta$ in \Cref{small not very small value: T} is immediate.
However, as mentioned in \Cref{ex: small vs very small}, given a monomial matrix $\matA$, there may be infinitely many small pairs $(\matA, \vv{u})$ that are not very small.

\begin{theorem}[Value of $\IP_p$ for small but not very small pairs]
   \label{small not very small value: T}
   Given a monomial matrix $\matA$, there exists an integer $\beta=\beta(\matA)$ with the following property\textup:
   If $(\matA, \vv{u})$ is small, but not very small, then
   \[ \val \IP_p(\matA, \vv{u}, p^e) = p^e-1\]
   for every $p > \beta$ and $e \geq 1$, and consequently $\val \fip_p(\matA,\vv{u}) = 1$.
   \pedro{Added conclusion about crit.}
\end{theorem}

\begin{proof}
   If we fix a universal denominator $\denom$ for $\matA$, then \Cref{finitely many coord sums: C} implies that there exists an integer $\beta$ such that $p/\denom > \norm{\tail{\vv{s}}_p}$ for every $\matA$-list $(\matA,\vv{u},\vv{s}, p)$ with $p > \beta$.
   In what follows, we will assume that $p > \beta$.

   Suppose that $(\matA,\vv{u})$ is small, but not very small, and let $\vv{s}$ be a special point for this pair with denominator $\denom$.
   \Cref{canonical-feasible: T} then states that
   \[ \vv{k} \coloneqq \vv{s}p-\tail{\vv{s}}_p \in \feas \IP(\matA,\vv{u},p). \]
   Since $(\matA,\vv{u})$ is not very small, $\norm{\vv{s}} = \ft{\matA}{\vv{u}} > 1$, and our choice of $\denom$ then implies that $\norm{\vv{s}} \geq 1 + 1/\denom$, so that
   \[\norm{\vv{k}} \geq p + \frac{p}\denom - \norm{\tail{\vv{s}}_p} > p\]
   where the strict inequality follows from our choice of $p \gg 0$.

   This bound implies that there exists a point $\vv{h} \leq \vv{k}$ with $\norm{\vv{h}} = p-1$.
   Without loss of generality, assume $h_1 < k_1$, and define $\vv{g} = \vv{h}q + \canvec_1(q-1)$.
   By construction, $\vv{g} \leq \vv{k}q, \norm{\vv{g}} = qp-1$, and $\binom{\norm{\vv{g}}}{\vv{g}} \not\equiv 0 \bmod p$.
   Furthermore, the fact that $\vv{k} \in \feas \IP(\matA,\vv{u},p)$ implies that $\matA\vv{g} \leq \matA{\vv{k}}q < \vv{u}qp$, and so $\vv{g} \in \feas \IP_p(\matA,\vv{u},qp)$.
   It follows that $\val \IP_p(\matA,\vv{u},qp) \geq \norm{\vv{g}} = qp-1$, and \Cref{trivial small value bound: P} implies that this bound must be an equality.
\end{proof}

With these reductions in hand, we now describe how to compute the value of $\IP_p(\matA, \vv{u}, p)$ when $(\matA, \vv{u})$ is very small,  by appealing to our earlier work on the standard integer programs $\IP(\matA, \vv{u}, p^e)$.

% \pedro[inline]{
%    I modified the statement and proof of the following theorem to isolate the part that depends on $p\gg 0$.
%    Original statement and proof were commented out.
% }
% \daniel[inline]{This is better.  In this light, is it true that if $p \gg 0$ relative to $\matA$ and $(\matA,\vv{u})$ is small, then $\IP_p(\matA,\vv{u},p) = \IP(\matA,\vv{u},p)$ if and only if $(\matA,\vv{u})$ is very small?}
% \pedro[inline]{
%    If $\ft{\matA}{\vv{u}} > 1$, then $\val \IP(\matA,\vv{u},p) >  p$, for $p \gg 0$ as in the proof of the previous theorem.
%    But if that is the case \emph{and} $\IP_p(\matA,\vv{u},p) = \IP(\matA,\vv{u},p)$, then the scarcity of points with norm $p$ satisfying the arithmetic constraint of $\IP_p$ will show that a point of the form $p \canvec_i$ is feasible for these programs.
%    This would imply that $p\vv{a}_i < p \vv{u}$, hence $\vv{a}_i < \vv{u}$, so the pair isn't even small, a contradiction.
%    (Or maybe it's easier to just argue algebraically.)\\[2mm]
%    Maybe this could be a lemma? Something like\ldots
%    \begin{lemma}
%       If $(\matA,\vv{u})$ is very small, then the arithmetic integer program $\IP_p(\matA, \vv{u}, p)$ agrees with the standard integer program $\IP(\matA, \vv{u}, p)$.
%       Moreover, the converse is true for $p$ sufficiently large, depending solely on $\matA$.
%    \end{lemma}
%    Then we can remove this from the theorem, and eliminate its proof (simply say it follows from the lemma and \Cref{uniform uniform value and image: T}).
% }
% \emily[inline]{Sounds good to me.}
% \daniel[inline]{Me too.  We could then just refer to this later, when using $p \gg 0$ toward the end of the proof of \Cref{main theorem wrt diagonal: T}, when we need to use that $\norm{\vv{h}_{l+1}}$ is at least $p$}
% \pedro[inline]{
%    I added the lemma below.
%    I did not modify the proof of \Cref{main theorem wrt diagonal: T}, though, since the fact that $\val \IP > p$ still does not appear in any statement.
% }
\begin{lemma}
   \label{ip = aip: L}
   If $(\matA,\vv{u})$ is very small, then the arithmetic integer program $\IP_p(\matA, \vv{u}, p)$ agrees with the standard integer program $\IP(\matA, \vv{u}, p)$.
   Moreover, the converse is true for $p$ sufficiently large, depending solely on $\matA$.
\end{lemma}

\begin{proof}
   Suppose $(\matA,\vv{u})$ is very small.
   We have seen that
   \[ \deficit \IP(\matA, \vv{u}, p)  = \ft{\matA}{\vv{u}} p -\val \IP(\matA, \vv{u}, p)\]
   is positive, and since $\ft{\matA}{\vv{u}} \leq 1$, this implies that $\val\IP(\matA,\vv{u},p)\le p-1$.
   Thus, every feasible point for $\IP(\matA, \vv{u}, p)$ automatically satisfies the arithmetic constraint of $\IP_p(\matA, \vv{u}, p)$, and so these programs coincide.

   Conversely, suppose $\IP_p(\matA,\vv{u},p) = \IP(\matA,\vv{u},p)$, for $p \gg 0$ chosen as in \Cref{small not very small value: T}.
   Aiming at a contradiction, suppose $(\matA,\vv{u})$ is not very small, so that $\ft{\matA}{\vv{u}} > 1$.
   Arguing as in the proof of \loccit\ we conclude that $\val \IP_p(\matA,\vv{u},p) = \val \IP(\matA,\vv{u},p) >  p$.
   From here on, we argue algebraically: If the pair $(\matA,\vv{u})$ is associated to the ideal pair $(\ideala,\ideald)$, our last finding tells us that $\ideala^{[p]} \not\subseteq \ideald^{[p]}$, and hence $\ideala \not\subseteq \ideald$, so the pair $(\matA,\vv{u})$ is not even small---a contradiction.
\end{proof}

In view of the above lemma, \Cref{uniform uniform value and image: T} immediately gives us the following result.

\begin{theorem}[Uniformity of deficit and shortfall for very small pairs]
   \label{arithmetic uniform value and image: T}
   Given a monomial matrix $\matA$, there exists an integer $\beta = \beta(\matA)$ with the following property\textup:
   If $(\matA, \vv{u})$ is very small, and $p > \beta$, then
   \[\deficit \IP_p(\matA,\vv{u},p)=\deficit \IP(\matA,\vv{u},p) = \udeficit(\matA,\vv{u},p) \]
   and
   \[ \collapse{\short \IP_p(\matA,{\vv{u}},p)}= \collapse{\short \IP(\matA,{\vv{u}},p)}= \ushort(\matA,\vv{u},p) \]
   where the overbar denotes collapse along $\mf(\matA, \vv{u})$.
   \qed
\end{theorem}

\begin{remark} \label{program behavior small: R}
   \Cref{arithmetic uniform value and image: T}, together with the periodicity of universal deficits and shortfalls shown in \Cref{pair periodicity: R}, shows that for a very small pair $(\matA,\vv{u})$, the deficit and the collapse of the shortfall of  $\IP_p(\matA,\vv{u},p)$ along $\mf(\matA, \vv{u})$ do not depend on $p$,  but rather on the class of $p$ modulo a universal denominator for $\matA$.
\end{remark}

\begin{example}[$\IP(\matA,\vv{u},p)$ \vs $\IP_p(\matA,\vv{u},p)$ for a small but not very small pair]
   If $(\matA, \vv{u})$ is small but not very small, $\IP = \IP(\matA,\vv{u},p)$ and $\IP_p = \IP_p(\matA,\vv{u},p)$ need not agree.
   Moreover, the collapses of their shortfalls along the minimal face can also differ.
   For instance, let $\matA$ be the $2 \times 2$ identity matrix and $\vv{u} = (1,1)$, so that $(\matA,\vv{u})$ is small, but not very small.
   Notice that in this case the minimal face $\O = \mf(\matA,\vv{u})$ is bounded, so that collapsing along $\O$ is simply the identity.
   For any prime $p$, $\val \IP = 2p - 2$, attained by a unique optimal point, namely $(p-1,p-1)$.
   Thus, $\short \IP = \{(1,1)\}$, which is independent of $p$, as guaranteed by \Cref{uniform uniform value and image: T}  (at least when $p \gg 0$).
   In contrast, for any odd prime $p$, the point $(\frac{p-1}{2}, \frac{p-1}{2})$ is feasible for $\IP_p$, and therefore optimal by \Cref{trivial small value bound: P}.
   Thus, $\val \IP_p = p-1$ and the point $(\frac{p+1}{2}, \frac{p+1}{2})$, which depends strongly on $p$, is an element of $\short \IP_p$.
\end{example}

The above example shows that the nature of the programs $\IP$ and $\IP_p$ for very small pairs and for small but not very small pairs can differ drastically.
This motivates our technique of reducing to the \emph{very small} setting.

\Cref{arithmetic uniform value and image: T} is fundamental and, together with \Cref{general AIP: T}, forms the basis for a process to compute the value of $\IP_p(\matA, \vv{u}, p^e)$ when $p$ is large.  
In the next subsection we describe this process in an important special case.  Though somewhat technical, these arguments will motivate some constructions in the general case, which is more complicated, and treated in \Cref{sprouting: S}.

\subsection{The $\idealm$-primary case}
\label{m-primary: SS}

We now focus on computing the value of the arithmetic integer program $\IP_p(\matA,\vv{u}, p^e)$ when $\matA$ is associated to an $\idealm$-primary monomial ideal, where $\idealm$ is the ideal generated by the variables of the ambient polynomial ring, $(\matA,\vv{u})$ is very small, the prime $p$ is large relative to $\matA$, and $e$ is an arbitrary positive integer.
The assumption that $\matA$ comes from an $\idealm$-primary ideal implies that the minimal face of every $\matA$-pair is bounded, and so the collapse along such face is the identity.
In this context, \Cref{arithmetic uniform value and image: T} becomes significantly stronger, as it computes \emph{full} shortfalls, as opposed to properly collapsed ones.
Indeed, the failure of \Cref{arithmetic uniform value and image: T} to compute full shortfalls in general accounts for much of the increased technicality present in the next section.

The main result of this subsection is the following.

\begin{theorem}[Main Theorem, $\idealm$-primary case]
   \label{m-primary AIP: T}
   If $\matA$ is a monomial matrix associated to an $\idealm$-primary monomial ideal, then there exists $\beta=\beta(\matA)$ with the following property\textup:
   If $p > \beta$ and $(\matA,\vv{u})$ is very small, then $\val \IP_p(\matA,\vv{u},p^e)$ is a polynomial in $p$ of degree $e$ with leading coefficient $\ft{\matA}{\vv{u}}$, whose non-leading coefficients are rational and depend on $(\matA,\vv{u})$ and the class of $p$ modulo any universal denominator for $\matA$.
\end{theorem}

\begin{remark}
   In \Cref{non-leading coefficients: P}, we will show that the non-leading coefficients of this polynomial are nonpositive.
   The proof below, however, will only show that the constant coefficient is negative.
\end{remark}

Before presenting the proof, we clarify our requirements for $p\gg 0$.

\begin{remark}[On $p$ being sufficiently large]
   \label{p large m-primary: R} 
   First off, we assume that $p$ is large enough so that the conclusions of \Cref{small not very small value: T,arithmetic uniform value and image: T} are valid.
   Moreover, given a collection $\S$ of very small pairs $(\matA,\vv{u})$, we want the subset~$\S^*$ of~$\S$ consisting of the pairs for which $\val \IP_p(\matA,\vv{u},p)$ is maximum to only depend on $p$ modulo some integer, and not on $p$ itself.
   We explain below how this can be accomplished by choosing $p$ sufficiently large.

   For a very small pair $(\matA,\vv{u})$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(\matA,\vv{u},p) = \ft{\matA}{\vv{u}}p-\udeficit(\matA,\vv{u},p).\]
   % \pedro{This is actually unnecessary, as in this case there are only finitely many small pairs.}
   % \daniel{You are right, it doesn't seem necessary here.  But, this is the kind of argument we will need later on in the most general case.  Should we just make this observation then?  Maybe we could just give the simple justification here, but also point out the general justification.}
   % \pedro{Done. Had to rearrange things a bit.}
   \Cref{finitely many deltas for a fixed A: R} tells us that, as we vary over all such pairs, $\udeficit(\matA,\vv{u},p)$ takes on only finitely many values, while \Cref{pair periodicity: R} tells us that its value, once $(\matA,\vv{u})$ is fixed, depends only on the class of $p$ modulo a universal denominator $\denom$ for $\matA$.
   Moreover, as in this $\idealm$-primary case there are only finitely many very small pairs, $\ft{\matA}{\vv{u}}$ also takes on only finitely many values.\footnote{For later use, note that this conclusion remains valid without the $\idealm$-primary assumption: when restricted to very small pairs, $\ft{\matA}{\vv{u}}$ is bounded above by $1$, and thus takes on only finitely many values by \Cref{discreteness: P}.}
   Thus, by choosing $p\gg 0$, with lower bound dependent only on $\matA$, we can select the very small pairs $(\matA,\vv{u}) \in \S$ to be included in $\S^*$ by first selecting those with maximal $\ft{\matA}{\vv{u}}$ (which is independent of~$p$), and then selecting among those the pairs with minimal $\udeficit(\matA,\vv{u},p)$ (which only depends on $p$ modulo $\denom$).
\end{remark}

We are now ready to prove the above theorem.

\begin{proof}[Proof of \Cref{m-primary AIP: T}]
   Choose $p \gg 0$ as in \Cref{p large m-primary: R}, and fix a universal denominator $\denom$ for $\matA$.
   Set $\S_p = \S^*_p = \{ (\matA,\vv{u}) \}$ and, for each $e > 1$,
   \begin{align*}
   \S_{p^{e}} &= \{ (\matA,\vv{v}):  \vv{v} \in \short \IP_p(\matA,\vv{u},p^{e-1}) \},\\
   \S^*_{p^{e}} &= \{ (\matA,\vv{v}) \in \S_{p^{e}}:  \val\IP_p(\matA,\vv{v},p)\text{ is maximum} \}.
   \end{align*}
   Now consider the following claims:
   \begin{enumerate}[(a),leftmargin=*]
      \item\label{c1} $\val \IP_p(\matA,\vv{u},p^e)$ has the stated properties;
      \item\label{c2} $\S_{p^e}$ consists of very small pairs, and only depends on $p$ modulo $\denom$ (and consequently so does $\S^*_{p^e}$, by our choice of $p\gg 0$ as in \Cref{p large m-primary: R}).
   \end{enumerate}
   For $e=1$, \Cref{arithmetic uniform value and image: T} shows that
   \[ \val \IP_p(\matA,\vv{u},p) = \ft{\matA}{\vv{u}}p-\udeficit(\matA,\vv{u},p)\]
   and claim \ref{c1} follows from \Cref{pair periodicity: R}, while \ref{c2} holds trivially.
   Fix $e\ge 1$ and suppose that claims \ref{c1} and \ref{c2} hold for $e$ and all preceding exponents.
   We now proceed to investigate these claims for $e+1$.

   We start with claim \ref{c2}.
   Since we assume that $\S_{p^e}$ consists of very small pairs, \Cref{trivial small value bound: P} tells us that $\val\IP_p(\matA,\vv{v},p) \le p-1$ for each $\vv{v} \in \short \IP_p(\matA,\vv{u},p^{e-1})$.
   \Cref{general AIP: T} then shows that
   \[\short \IP_p(\matA,\vv{u},p^{e}) = \bigcup_{(\matA,\vv{v}) \in \S^*_{p^e}} \short \IP_p(\matA,\vv{v}, p)
      = \bigcup_{(\matA,\vv{v}) \in \S^*_{p^e}} \ushort(\matA,\vv{v}, p).\]
   Since $\S^*_{p^e}$ and each $\ushort(\matA,\vv{v}, p)$ only depend on $p$ modulo $\denom$, so does $\S_{p^{e+1}} = \{(\matA,\vv{v}): \vv{v}\in \short \IP_p(\matA,\vv{u},p^{e})\}$.
   Moreover, since $\S^*_{p^e}$ consists of very small pairs, the above decomposition, \Cref{small pairs from shortfalls: R}, and \Cref{arithmetic uniform value and image: T} tell us that every pair in $\S_{p^{e+1}}$ is small.
   We have therefore verified most of claim \ref{c2}, except that $\S_{p^{e+1}}$ might contain a small but not very small pair.

   Suppose that is not the case.
   \Cref{general AIP: T,trivial small value bound: P} show that
   \begin{equation}
      \label{recurrence: E}
      \val \IP_p(\matA,\vv{u},p^{e+1}) = \val \IP_p(\matA,\vv{u},p^e)p + M
   \end{equation}
   where $M = \val\IP_p(\matA,\vv{v},p)$ for any  $(\matA,\vv{v}) \in \S^*_{p^{e+1}}$.
   Since $(\matA,\vv{v})$ is very small, \Cref{arithmetic uniform value and image: T} gives us
   \[\val \IP_p(\matA,\vv{u},p^{e+1}) = (\val \IP_p(\matA,\vv{u},p^e) + \ft{\matA}{\vv{v}}) p - \udeficit(\matA,\vv{v},p)\]
   which, in view of our assumption on $\val \IP_p(\matA,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   So, in this case claims \ref{c1} and \ref{c2} hold for $e+1$.

   Suppose now that $\S_{p^{e+1}}$ contains a small but not very small pair.
   Engaging the full firepower of \Cref{general AIP: T}, along with \Cref{trivial small value bound: P,small not very small value: T}, we obtain
   \begin{equation}
      \label{tail: E}
      \val \IP_p(\matA,\vv{u},p^{e+k}) = \val \IP_p(\matA,\vv{u},p^e)p^k + p^k - 1,\text{ for all }k\in \NN
   \end{equation}
   which, given our assumption on $\val \IP_p(\matA,\vv{u},p^e)$, clearly satisfies \ref{c1}.
   Thus, even though \ref{c2} does not hold for $e+1$, we were able to verify \ref{c1} not only for $e+1$, but for all subsequent exponents.
\end{proof}

\begin{remark}[An algorithm]
   \label{m-primary algorithm: R}
   The above proof gives, in this $\idealm$-primary, very small case, an algorithm to compute $\val\IP_p(\matA,\vv{u},p^e)$ not only up to a specific exponent $e$, but for \emph{all} $e \ge 1$.
   Indeed, as we iterate \eqref{recurrence: E}, one of two situations will occur that will allow us to determine the \emph{entire} remainder of the sequence.

   First, with a bit of luck we may come across a set $\S_{p^e}$ that contains a small but not very small pair, and \eqref{tail: E} gives us the remainder of the sequence.
   In the absence of such luck, note that in this $\idealm$-primary case there are only finitely many small $\matA$-pairs.
   Thus, there are only finitely many distinct sets $\S_{p^e}$, and once one of these sets repeats, the numbers $M$ that appear in the recurrence \eqref{recurrence: E} will cycle from that point onward.

   All of this is formalized in Algorithm~\ref{alg}, which takes a very small pair $(\matA,\vv{u})$ and a positive representative $r$ for a congruence class modulo a universal denominator $\denom$ for $\matA$, and returns a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for the values of $\IP_p(\matA,\vv{u},p^e)$ with $p$ in the given congruence class---a convenient way to pack the entire sequence of values we are after.
   More explicitly, the rational function $G(\pp,\tt)$ returned can be written as a power series
   \[G(\pp,\tt) = \sum_{e=1}^\infty G_e(\pp)\tt^e\]
   where each $G_e(\pp)$ is a polynomial in $\pp$ such that
   \[ \val \IP_p(\matA,\vv{u},p^e) = G_e(p)\]
   for any sufficiently large prime $p\equiv r\bmod \denom$.
   Moreover, if $(\matA,\vv{u})$ is associated to the ideal pair $(\ideala,\ideald)$, then for all such primes the critical exponent $\crit(\ideala,\ideald)$ can be obtained by evaluating $G(\pp,\tt)(1-\pp\tt)$ at $\big(p,\frac1p\big)$.

  This algorithm relies on the ability to solve several linear programs---each time an $F$-threshold is evaluated---and several integer programs---each time a universal deficit or shortfall is computed.
   Given the computational complexity of solving such programs, our algorithm is bound to be highly inefficient or impractical for large matrices or large $r$.
   Somewhat surprisingly, a preliminary implementation in \emph{Macaulay2} \cite{M2} by the authors actually fares well on small examples.
\end{remark}

% \pedro[inline]{
%    Should we get into more details?
%    E.g., present pseudo-code such as Algorithm~\ref{alg}, or discuss practical (or impractical) matters like the computability of the shortfalls?
% }
% \emily[inline]{The pseudocode looks good.  If we can find a succinct way to touch on computability, I'm for it.}
% \pedro[inline]{
%    I gave it a shot.
%    I changed the notation in the pseudo-code a bit: I'm using $r$ to denote the representative of the congruence class mod $\denom$, to emphasize that it need not be prime.
%    I'm now using $\S_e$ (and likewise for $\S^*$), as $\S_{p^e}$ does not make sense anymore, and $\S_{r^e}$ causes confusion then $r=1$, as it does not tell us the level we are in.
%    I guess $\S_{\pp^e}$ would be another option.
% }
% \daniel[inline]{I prefer the second option, to keep things consistent with upcoming notation.}
% \pedro[inline]{Went with second one.}

\setlength{\algomargin}{0em}
\begin{algorithm}\caption{The $\idealm$-primary case}
   \label{alg}
\Indp
\SetInd{1.55em}{0em}
\DontPrintSemicolon
\medskip
\SetKwInput{Input}{input}\SetKwInput{Output}{output}
\SetKwFor{Loop}{repeat}{}{}
\Input{ \\
   $\bullet$ a very small pair $(\matA,\vv{u})$, where $\matA$ is associated to an $\idealm$-primary ideal\\
   $\bullet$ a positive representative $r$ for a congruence class modulo a universal denominator $\denom$ for $\matA$
}
\medskip
\Output{ \\ $\bullet$ a generating function $G(\pp,\tt) \in \QQ(\pp,\tt)$ for $\val\IP_p(\matA,\vv{u},p^e)$, with $p\equiv r \bmod \denom$
}
\medskip
\Begin{
   \medskip
$\S_{\pp},\  \S^*_{\pp} \leftarrow \{(\matA,\vv{u})\}$\;
$e \leftarrow 1$\;
%\texttt{done} $\leftarrow$ \texttt{false}\;
$M_1 \leftarrow \ft{\matA}{\vv{u}}\pp - \udeficit(\matA,\vv{u},r)$\;
\medskip
\Loop{}{
   $e\leftarrow e+1$\;
   \nl$\S_{\pp^e} \leftarrow \big\{(\matA,\vv{v}): \vv{v} \in \bigcup_{(\matA,\vv{v}^*) \in \S^*_{\pp^{e-1}}} \ushort(\matA,\vv{v}^*,r)\big\}$\;\label{line1}
   \If{$\S_{\pp^k} = \S_{\pp^e}$ for some $k<e$}{
      \KwRet{$\dfrac{\sum_{1\le i<k} M_i\tt^i}{1-\pp\tt}+\dfrac{\sum_{k\le i<e} M_i\tt^i}{(1-\pp\tt)(1-\tt^{e-k})}$}
   }
   \nl$\epsilon \leftarrow \max \{\ft{\matA}{\vv{v}}: (\matA,\vv{v}) \in \S_{\pp^e}\}$\;\label{line2}
   \If{$\epsilon >1$}{
      \KwRet{$\dfrac{\sum_{1\le i<e}M_i\tt^i}{1-\pp\tt} + \dfrac{(\pp - 1)\tt^e}{(1-\pp \tt)(1-\tt)}$}
   }
   \nl$\text{\texttt{aux}} \leftarrow \{(\matA,\vv{v})\in \S_{\pp^e}: \ft{\matA}{\vv{v}} = \epsilon\}$\;\label{line3}
   \nl$\delta \leftarrow \min\{\udeficit(\matA,\vv{v},r): (\matA,\vv{v})\in \text{\texttt{aux}}\}$\;\label{line4}
   \nl$\S^*_{\pp^e} \leftarrow \{(\matA,\vv{v})\in \text{\texttt{aux}}: \udeficit(\matA,\vv{v},r) = \delta\}$\;\label{line5}
   $M_e \leftarrow \epsilon \pp - \delta$\;
}
}
\end{algorithm}

\section{Sprouting graphs} \label{sprouting: S}
Now that we have a grasp on the value of the arithmetic integer program $\IP_p(\matA, \vv{u}, p^e)$ when the matrix $\matA$ is associated to an $\idealm$-primary monomial ideal, we broaden our scope to address the case of an arbitrary monomial matrix.
In order to do so, we first build a technical framework in which to carry out our investigation, starting with the \emph{directed sprouting graph}.

\subsection{The sprouting graph of a monomial matrix}

\begin{definition}[Descendant]
   A \emph{descendant} of a monomial matrix $\matA$ is any monomial matrix $\matB$ obtained from $\matA$ by deleting some (possibly none) of its columns.
\end{definition}

\begin{definition}[$p$-sprout]
   \label{p-sprout: D}
   Consider a monomial pair $(\matA,\vv{u})$, and let an overbar denote collapse along $\mf(\matA,\vv{u})$.
   We say that $(\matB, \vv{v})$ is a \emph{$p$-sprout} of $(\matA, \vv{u})$ whenever the following conditions are satisfied.
   \begin{enumerate}
      \item $\matB = \collapse{\matA}$, the collapse of $\matA$ along $\O = \mf(\matA, \vv{u})$.
      \item $\vv{v}$ is any point in $\ushort(\matA, \vv{u}, p) = \ushort(\matB, \collapse{\vv{u}}, p)$.
   \end{enumerate}
\end{definition}

\begin{remark}
   \label{p-sprout: R}
   As noted in \Cref{collapse of monomial is monomial: R}, the collapse of a monomial matrix along a face of its Newton polyhedron is again a monomial matrix.
   This and the positivity of points in shortfalls show that the $p$-sprout of a monomial pair is also a monomial pair.  Furthermore,  \Cref{finite image: P} tells us that there are only finitely many $p$-sprouts of a fixed monomial pair, while \Cref{small pairs from shortfalls: R} tells us that each such sprouted pair is small.
 \end{remark}

\begin{remark}[Sprouts as collapsed shortfall pairs]
   \label{sprouts as collapsed shortfall pairs: R}
   Throughout this remark, suppose that $p$ is large enough relative to $\matA$ so that the conclusion of \Cref{arithmetic uniform value and image: T} holds.
   Let us call an $\matA$-pair $(\matA,\vv{w})$ a \emph{$p$-shortfall pair associated to $(\matA,\vv{u})$} if $\vv{w} \in \short \IP_p(\matA,\vv{u},p)$.
%   \daniel{I don't think this is an equality unless $\mf(\matA,\vv{u})$ is bounded.  Am I missing something?}
%   \emily{No, I removed the ``$= \ushort(\matA,\vv{u},p)$'' since our intention is to choose a point in the actual shortfall.}
   Recall that $p$-shortfall pairs played an important role in the process for computing $\val \IP_p(\matA,\vv{u},p^e)$ described in \Cref{m-primary: SS} when $\matA$ is associated to an $\idealm$-primary ideal.

   It follows immediately from \Cref{p-sprout: D} and \Cref{arithmetic uniform value and image: T} that a $p$-sprout of a pair $(\matA,\vv{u})$ is the same as the collapse of a $p$-shortfall pair of $(\matA,\vv{u})$ along the face $\O=\mf(\matA,\vv{u})$.  In particular, when $\O$ is bounded there is no difference between $p$-sprouts and $p$-shortfall pairs of $(\matA,\vv{u})$.
\end{remark}

\begin{definition}[The directed sprouting graph]
   Let $\matA$ be a monomial matrix.
   We define $\graph_p(\matA)$ to be the set consisting of all very small $\matA$-pairs, and once $\graph_q(\matA)$ has been defined for some $q$ a power of $p$, we then define $\graph_{qp}(\matA)$ to be the set consisting of all $p$-sprouts of all pairs in $\graph_q(\matA)$.

   We define the vertices of the graph $\sprout_p(\matA)$ to be the disjoint union
   \[ \bigsqcup_{e=1}^{\infty} \graph_{p^e}(\matA). \]
   A vertex in the $p^e$-th component of the above disjoint union is said to be of \emph{level} $p^e$.
   The directed edges in $\sprout_p(\matA)$ are defined only between points of consecutive levels:
   There is a directed edge from a vertex of level $q$ to one of level $qp$ if the latter is a $p$-sprout of the former.
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary1: R}
   Consider a monomial matrix $\matA$.
   In this remark, we gather some basic facts concerning the graph $\sprout_p(\matA)$.
\begin{enumerate}
\item The set $\graph_p(\matA)$ of very small $\matA$-pairs is independent of $p$, and can be infinite, depending on the geometry of the Newton polyhedron of $\matA$.

\item \label{elementary1 small pairs} \Cref{p-sprout: R} tells us that every vertex of $\sprout_p(\matA)$ is a small monomial pair.  Furthermore, if $(\matB,\vv{v})$ is a vertex of $\sprout_p(\matA)$, then $\matB$ must be among the finitely many descendants of $\matA$.

\item \label{elementary1 periodic in e} Applying \Cref{finitely many deltas for a fixed A: R} and the finiteness of each universal shortfall to $\matA$ and to each of its descendant monomial matrices, we see that $\bigcup_{e>1} \graph_{p^e}(\matA)$ is a finite set, and the recursive nature of the construction of the sets $\graph_{p^e}(\matA)$ then implies that these sets are eventually periodic in $e$.

\item \label{elementary1 periodic in p} Furthermore, \Cref{pair periodicity: R} tells us that if $\denom$ is a universal denominator for $\matA$ and all of its finitely many descendants, then the sprouting graph  $\sprout_p(\matA)$---meaning, all of its vertices \emph{and} arrows---depends only on the class of $p$ modulo $\denom$.
\end{enumerate}
\end{remark}

\begin{lemma}
   \label{positive-polynomial: L}
   Given a real number $w > 0$, and a set $\Omega$ of real numbers that is bounded from above, there exists an integer $\beta = \beta(w, \Omega)$ satisfying the following condition\textup:
   If $p > \beta$, then for every integer $e \geq 1$, and for every $\omega_1, \ldots, \omega_e \in \Omega$, we have that $wp^{e} >  \omega_1 p^{e-1} + \cdots + \omega_{e-1} p + \omega_e$.
\end{lemma}

\begin{proof}
   Given a positive upper bound $\lambda$ for $\Omega$, let $\beta = \lambda/w  + 1$.
   Then for $p>\beta$, $\omega_1 p^{e-1} + \cdots + \omega_{e-1}  p + \omega_e$ is at most $\lambda(p^{e-1} + p^{e-2} + \cdots + 1) = \lambda \cdot \frac{p^e-1}{p-1}$, which, in turn, is less than $\lambda (p^e-1) \cdot w/\lambda < w p^e$.
\end{proof}

\begin{theorem}[Iterated lifting]
\label{ILL: T}
   For each monomial matrix $\matA$, there exists an integer $\beta = \beta(\matA)$ with the following property\textup:
   If $p>\beta$ and \[ (\matA_1, \vv{u}_1) \to (\matA_2, \vv{u}_2) \to \cdots \to (\matA_e, \vv{u}_e)\] is a path in $\sprout_p(\matA)$, then for every $1 \leq i \leq e$, there exists a point $\vv{k}_i$ in the optimal set of the standard integer program $\IP(\matA_i, \vv{u}_i,p)$  such that
   \[
      \vv{k}_1 p^{e-1} + \vv{k}_2 p^{e-2} + \cdots + \vv{k}_{e-1} p + \vv{k}_e
   \]
   is feasible for $\IP(\matA_1, \vv{u}_1, p^e)$.
 \end{theorem}

\begin{proof}
   We start by describing what it means for $p$ to be large.
   Toward this, let $\matM_1, \ldots, \matM_l$ be the finitely many descendants of  $\matA$.
   Fix a positive integer $\denom$ that is a universal denominator for all $\matM_i$, as guaranteed by \Cref{universal-denominators-exist:  T}, and a finite set of representatives $\fsr(\matM_i)$ for each $\matM_i$, as in \Cref{fsr-exist: T}; set $\fsr = \fsr(\matM_1) \cup \cdots \cup \fsr(\matM_l)$.
   By \Cref{rem: finitely many F-thresholds of small pairs} the set consisting of the $F$-thresholds of all small $\matM_i$-pairs for $i=1,\ldots,l$ is finite, and consequently so is the set $S$ consisting of all special points with denominator $\denom$ of all those pairs.
   Let $\Omega$ be the set consisting of all coordinates of all points in $\matA(\fsr+S\cup\{\vv{0}\})$.
   \pedro{$\vv{0}$ included so that this set contains $\matA(\fsr)$}
   We stress that $\fsr$, $S$, and $\Omega$ are finite sets determined by $\matA$, and do not depend in any way on $p$.

   The finiteness of $\fsr$  and \Cref{positive-polynomial: L}
   imply that there exists an integer $\beta = \beta(\denom, \fsr)$ for which the following conditions hold for $p > \beta$.
    \begin{align}
      \tag{$\heartsuit$} \label{p-big-1}
      &\text{$\frac{p}{\denom}$ is greater than any coordinate of any point in $\vv{1} - \fsr$;}\qquad\qquad\quad \\
      \tag{$\diamondsuit$} \label{p-big-2}
      &\text{$\frac{p^e}{\denom} > \sum_{i=1}^e \omega_i p^{e-i}$ for every $e \geq 1$ and $\omega_1, \ldots, \omega_e \in \Omega$.}
    \end{align}

    In what follows, we assume that $p > \beta$.
    Consider a finite path
    \[ (\matA_1, \vv{u}_1) \to (\matA_2, \vv{u}_2) \to \cdots \to (\matA_e, \vv{u}_e) \]
    in $\sprout_p(\matA)$.
    For every $1 \leq i \leq e$, set $\O_i = \mf(\matA_i, \vv{u}_i)$, and fix a special point $\vv{s}_i \in \sp(\matA_i, \vv{u}_i)$ with denominator $\denom$.
    If $1 \leq i < e$, then the sprouting $(\matA_i, \vv{u}_i) \to (\matA_{i+1}, \vv{u}_{i+1})$ tells us that $\matA_{i+1}$ is the collapse of $\matA_i$ along $\O_i$, and that
    \[
       \vv{u}_{i+1} \in \ushort(\matA_i, \vv{u}_i, p)= \matA_{i+1} \tail{\vv{s}_i}_p - \matA_{i+1}(\opt \ip( \matA_i, \vv{u}_i, \vv{s}_i, p)).
    \]
    \Cref{fsr-exist: T} and our choice of $\fsr$ then allow us to choose $\vv{h}_i \in \fsr \cap \opt \ip ( \matA_i, \vv{u}_i, \vv{s}_i, p)$ such that $\vv{u}_{i+1} = \matA_{i+1} \tail{\vv{s}_i}_p - \matA_{i+1} \vv{h}_i$.
    Finally, let $\vv{h}_e$ be any point in the nonempty set $\fsr \cap \opt \ip ( \matA_e, \vv{u}_e, \vv{s}_e, p)$.

    Next, for every $1 \leq i \leq e$,  we define $\vv{k}_i = \vv{s}_i p - [\vv{s}_i]_p + \vv{h}_i$.
    Observe that \eqref{p-big-1} and \eqref{p-big-2} imply that for every $1 \leq i \leq e$, the quantity $p/\denom$ is greater than every coordinate of $\vv{1}-\vv{h}_i$ and every coordinate of $\matA_i \vv{h}_i$.
    It then follows from \Cref{uniform value: P} that
    \begin{equation}
       \label{optimality-for-each-component: e}
       \vv{k}_i \in \opt \IP(\matA_i, \vv{u}_i,p).
    \end{equation}

    We will now induce on $e$ to prove that $\sum_{i=1}^e \vv{k}_i p^{e-i} \in \feas\IP(\matA_1, \vv{u}_1, p^e)$.
    When $e = 1$, this follows from \eqref{optimality-for-each-component: e}.
    Next, suppose that $e \geq 2$.
    Our induction hypothesis applied to the truncated path
    \[ (\matA_2, \vv{u}_2) \to \cdots \to (\matA_e, \vv{u}_e) \]
    tells us that $\vv{k}^{\ast} = \sum_{i=2}^e \vv{k}_i p^{e-i} \in \feas \IP(\matA_2, \vv{u}_2, p^{e-1})$.
    To complete the induction step, we must show that $\vv{k}_1 p^{e-1} + \vv{k}^{\ast} \in \feas\IP(\matA_1, \vv{u}_1, p^e)$.
    However, as \eqref{optimality-for-each-component: e} implies that this point has nonnegative integer coordinates, it remains to show that $\matA_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$.

    To do so, recall that our choice of $\vv{s}_1 \in \sp(\matA_1, \vv{u}_1)$ allows us to write $\vv{u}_1 = \matA_1 \vv{s}_1 + \vv{w}$, where $\vv{w}$ is a positive point of $\rs(\O_1)$.
    It then follows from the definition of $\vv{k}_1$ and this expression for $\vv{u}_1$ that the inequality $\matA_1 ( \vv{k}_1 p^{e-1} + \vv{k}^{\ast} ) < \vv{u}_1 p^e$ is equivalent to
    \begin{equation}
       \label{target-inequality: e}
       \matA_1( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + \matA_1\vv{k}^{\ast} < \vv{w} p^e.
    \end{equation}

    We prove this inequality using the technique outlined in \Cref{rmk: verifying inequalities using collapses}.
    First we verify that the inequality holds in $\rb(\O_1)^{\perp}$, by verifying that it holds after collapsing along $\O_1$.
    As $\matA_2$ is the collapse of $\matA_1$ along $\O_1$ and $\vv{w}\in \rs(\O_1)$, this means verifying that
    \[\matA_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) p^{e-1} + \matA_2\vv{k}^{\ast} < \vv{0}.\]
    But $\matA_2( - \tail{\vv{s}_1}_p + \vv{h}_1 ) = -\vv{u}_2$, by our choice of $\vv{h}_1$, so this inequality reduces to $-\vv{u}_2 p^{e-1} + \matA_2 \vv{k}^{\ast} < \vv{0}$, which holds as $\vv{k}^{\ast} \in \feas \IP(\matA_2, \vv{u}_2, p^{e-1})$.

    We now prove that \eqref{target-inequality: e} holds in $\rs(\O_1)$, by verifying that the stronger inequality
    \begin{equation}
       \matA_1 \vv{h}_1 p^{e-1} + \matA_1 (\vv{s}_2 p + \vv{h}_2)p^{e-2} + \cdots + \matA_1 (\vv{s}_e p + \vv{h}_e ) < \vv{w}p^e
       \label{eq: stronger ineq}
    \end{equation}
    holds in $\rs(\O_1)$.
    However, $\vv{w}$ is positive in $\rs(\O_1)$, and the equation $\vv{u}_1 = \matA_1 \vv{s}_1 + \vv{w}$ implies that the universal denominator $\denom$ is also a denominator for $\vv{w}$, and so $\vv{w} p^e$ is greater than or equal to $p^e \vv{1} / \denom$ in $\rs(\O_1)$.
    On the other hand, every coordinate of the left-hand side of \eqref{eq: stronger ineq} is of the form $\sum_{i=1}^{e} \omega_i  p^{e-i}$ for some $\omega_1, \ldots, \omega_e \in \Omega$.
    Thus, the condition \eqref{p-big-2} tells us that this stronger inequality holds in $\rs(\O_1)$.

    We have just verified that \eqref{target-inequality: e} holds throughout $\rs(\O_1) \oplus \rs(\O_1)^{\perp}$, which allows us to conclude the induction step, and hence our proof.
\end{proof}


\subsection{Subgraphs associated to pairs}

We now consider certain subgraphs of the directed sprouting graph, whose definitions are motivated by the sets with the same names used in the $\idealm$-primary setting, which appear in the proof of \Cref{m-primary AIP: T}, and from which \Cref{m-primary algorithm: R} is built from.

\begin{definition}[Subgraphs associated to very small pairs]
   Suppose that $(\matA,\vv{u})$ is very small, and define $\S_p(\matA,\vv{u}) = \{ (\matA,\vv{u}) \}$.
   Next, suppose that $\S_q(\matA,\vv{u})$ has been defined for some $q=p^e$.
   \begin{enumerate}
      \item If $\S_q(\matA,\vv{u})$ is nonempty and consists only of very small pairs, then define $\S^{\ast}_q(\matA,\vv{u})$ to be the subset of $\S_q(\matA,\vv{u})$ consisting of all $(\matB,\vv{v})$ that first maximize $\ft{\matB}{\vv{v}}$, and only then minimize $\udeficit(\matB,\vv{v},p)$.  We then~define~$\S_{qp}(\matA,\vv{u})$ to be the set of all $p$-sprouts of all pairs in $\S^{\ast}_q(\matA,\vv{u})$.
      \item Otherwise, we define $\S_q^{\ast}(\matA,\vv{u})=\S_{qp}(\matA,\vv{u}) = \emptyset$.
   \end{enumerate}
   By definition, each $\S_{p^e}(\matA,\vv{u})$ and $\S^{\ast}_{p^e}(\matA,\vv{u})$ is a subset of $\graph_{p^e}(\matA)$, which we identify with the vertices of $\sprout_p(\matA)$ of level $p^e$.
   We then define $\sprout_p^{\ast}(\matA,\vv{u})$ to be the induced subgraph of $\sprout_p(\matA)$ on the set of vertices
   \[ \bigsqcup_{e=1}^{\infty} \S^{\ast}_{p^e}(\matA,\vv{u}). \]
\end{definition}

\begin{remark}[Elementary observations]
   \label{elementary2: R}
   Suppose $(\matA,\vv{u})$ is very small.
   In this remark, we gather some basic facts concerning the graph $\sprout^{\ast}_p(\matA,\vv{u})$.
   \begin{enumerate}
      \item  \label{elementary2 lowest level}
      The only vertex of $\sprout_p^{\ast}(\matA,\vv{u})$ of level $p$ is $(\matA,\vv{u})$.
      \item \label{elementary2 small pairs}
      It follows from \Cref{elementary1: R}\eqref{elementary1 small pairs} that $\S_{q}(\matA,\vv{u})$, when nonempty, consists of small pairs whose monomial matrix is among the finitely many descendants of $\matA$.
      Furthermore, $\S_{qp}(\matA,\vv{u}) = \emptyset$ if and only if $\S_q(\matA,\vv{u}) = \emptyset$ or $\S_q(\matA,\vv{u})$ contains a pair that is not very small, which itself holds if and only if $\S_{q}^{\ast}(\matA,\vv{u})= \emptyset$.
      Moreover, $\S_q^{\ast}(\matA,\vv{u})$ is either empty, or contains only very small pairs.
      \item \label{elementary2 periodic in e}
      Arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in e}, we see that $\bigcup_{e=1}^{\infty} \S_{p^e}(\matA,\vv{u})$ and  $\bigcup_{e=1}^{\infty} \S^{\ast}_{p^e}(\matA,\vv{u})$ are finite, and that each of the sets $\S_{p^e}(\matA,\vv{u})$ and $\S^{\ast}_{p^e}(\matA,\vv{u})$ are eventually periodic in $e$.
      \item \label{elementary2 periodic in p}
      Similarly, arguing as in \Cref{elementary1: R}\eqref{elementary1 periodic in p}, the graph $\sprout_p^{\ast}(\matA,\vv{u})$ depends only on $p$ modulo any universal denominator $\denom$ for $\matA$  and all of its finitely many descendants.
      \item \label{collapse sprout star graphs same}
      The graphs $\sprout^{\ast}_p(\matA,\vv{u})$ and $\sprout_p^{\ast}(\collapse{\matA},\collapse{\vv{u}})$, where the overbar denotes the collapse along $\O = \mf(\matA, \vv{u})$, are canonically isomorphic:
      The first level of $\sprout^{\ast}_p(\matA,\vv{u})$ consists of the single vertex $(\matA, \vv{u})$, while the first level of $\sprout_p^{\ast}(\collapse{\matA},\collapse{\vv{u}})$ has unique vertex $(\collapse{\matA}, \collapse{\vv{u}})$; moreover, $\ft{\matA}{ \vv{u}} = \ft{\collapse{\matA}}{\collapse{\vv{u}}}$.  The vertices on the remaining levels of the two graphs coincide, and after identifying the vertices on the first level with one another, 
      all edges also agree.
\end{enumerate}
\end{remark}

\begin{example}[Running example: a sprouting subgraph]
   \label{ex: ft.4}
   \begin{figure}
      \centering
      \includegraphics[width=.85\textwidth]{pictures/sprouting_graph.pdf}
      \caption{The sprouting subgraph for \Cref{ex: ft.4}}
      \label{fig: sprouting graph}
   \end{figure}
   \Cref{fig: sprouting graph} shows the sprouting subgraph associated to the pair $(\matA,\vv{u})$ in our running example, initiated in \Cref{ex: ft}.
   As in \Cref{ex: ft.3}, we consider the case where $p$ is congruent to $11$ modulo a universal denominator for $\matA$.
   The overbar represents collapse along $\mf(\matA,\vv{u})$.
   The figure shows $\S_{p^e}(\matA,\vv{u})$ for $1 \le e \le 4$, with $\sprout^*_p(\matA,\vv{u})$ highlighted.
   The two framed nodes are pairs that are not very small, which cause $\sprout^*_p(\matA,\vv{u})$ to terminate, as $\S_{p^e}(\matA,\vv{u})$ is empty for $e\ge 5$, and $\S_{p^e}^*(\matA,\vv{u})$ is empty for $e\ge 4$.
   % \daniel[inline]{So what is the critical exponent?  This has a denominator a power of $p$, because of terminal red points.  Does it have the kind of intermediary powers of $p$ what we don't see in our examples paper?}
   % \pedro[inline]{
   %    No intermediate powers here; the critical exponent is $\frac4{17}-\frac3{17 p^3}$.
   % }
\end{example}

\begin{example}[Another sprouting subgraph]
   \label{ex: new example}
   \begin{figure}
      \centering
%      \daniel[inline]{Pedro:  Can you place a copy of this in the dropbox folder?  In the meantime, I am omitting this, so that the document will compile.}
      \includegraphics[width=.6\textwidth]{pictures/sprouting_graph_4.pdf}
      \caption{The sprouting subgraph for \Cref{ex: new example}}
      \label{fig: sprouting graph 2}
   \end{figure}
   \Cref{fig: sprouting graph 2} shows the first nine levels of $\sprout^*_p(\matA,\vv{u})$, where
   \[
      \matA = \begin{bmatrix} 36&10&31 \\ 19&46&31 \\ 47&25&36 \end{bmatrix}
      \quad\text{and} \quad
      \vv{u} =\begin{bmatrix} 29 \\ 24 \\ 30 \end{bmatrix}
   \]
   when $p$ is congruent to $11$ modulo a universal denominator for $\matA$.
   The matrix $\matB$ consists of the last two rows of $\matA$, while $\matC$ consists of the last row.
   Unlike the previous example, here $\sprout^*_p(\matA,\vv{u})$ does not terminate---the last five levels shown in the picture repeat indefinitely.
\end{example}

\begin{definition}%[Numbers associated to the levels of $\sprout^*_p(\matA,\vv{u})$]
   \label{epsilon delta: D}
   If $(\matA,\vv{u})$ is very small, and $\S^{\ast}_{p^e}(\matA,\vv{u}) \neq \emptyset$, then we define
   \begin{align*}
     \epsilon_{p^e}(\matA,\vv{u}) & = \ft{\matB}{\vv{v}} \\
     \delta_{p^e}(\matA,\vv{u}) & = \udeficit(\matB,\vv{v},p)
   \end{align*}
   where $(\matB,\vv{v})$ is any pair in $\S^{\ast}_{p^e}(\matA,\vv{u})$.
   Observe that, by definition of $\S^{\ast}_{p^e}(\matA,\vv{u})$, these numbers are independent of the choice of $(\matB,\vv{v}) \in \S^{\ast}_{p^e}(\matA,\vv{u})$.
\end{definition}

\begin{proposition}
   \label{p large graph: P}
   Given a monomial matrix $\matA$, there exists $\beta = \beta(\matA)$ with the following property\textup:
   If $p > \beta$, $(\matA,\vv{u})$ is very small, and $\S_{p^e}^{\ast}(\matA,\vv{u})$ is nonempty, then
   \[
      \max \{ \val \IP_p(\matB,\vv{v},p) : (\matB,\vv{v}) \in \S_{p^e}(\matA,\vv{u}) \} = \epsilon_{p^e}(\matA,\vv{u}) p-\delta_{p^e}(\matA,\vv{u})
   \]
   and the subset of $\S_{p^e}(\matA,\vv{u})$ of pairs that achieve this maximum is $\S^{\ast}_{p^e}(\matA,\vv{u})$.
\end{proposition}

\begin{proof}
   First, choose $p$ to be large enough so that the conclusion of \Cref{arithmetic uniform value and image: T} holds for $\matA$, as well as for each of its finitely many descendants.
   In particular, for such primes, $\val \IP_p(\matB,\vv{v},p) = \ft{\matB}{\vv{v}}p-\udeficit(\matB,\vv{v},p)$  for each vertex $(\matB,\vv{v})$ of $\sprout_p^{\ast}(\matA,\vv{u})$, and the existence of $\beta(\matA)$ as above then follows from arguments similar to those made in \Cref{p large m-primary: R}.
\end{proof}

\begin{definition}[Depth of a sprouting subgraph]
   If $(\matA,\vv{u})$ is very small, then $\mathcal{Q}_p(\matA,\vv{u})$ denotes the largest level of any vertex in the graph $\sprout_p^{\ast}(\matA,\vv{u})$.
   Formally,
   \[
      \mathcal{Q}_p(\matA,\vv{u}) = \inf \{ q :  \S^{\ast}_{qp}(\matA,\vv{u}) = \emptyset \}.
   \]
\end{definition}

As noted in \Cref{elementary2: R}\eqref{elementary2 lowest level}, if $(\matA,\vv{u})$ is very small, then $\S^{\ast}_p(\matA,\vv{u}) = \{ (\matA,\vv{u} )\}$, which shows that $\Q_p(\matA,\vv{u})$ is at least $p$.
Furthermore, \Cref{elementary2: R}\eqref{elementary2 periodic in e} implies that one can determine whether $\Q_p(\matA,\vv{u}) = \infty$, as in \Cref{ex: new example}, by computing only finitely many levels of $\sprout_p^*(\matA,\vv{u})$.
Finally, \Cref{elementary2: R}\eqref{elementary2 periodic in p} implies that $\log_p \Q_p(\matA,\vv{u})$ depends only on $(\matA,\vv{u})$, and on the class of $p$ modulo any universal denominator for $\matA$, but not on $p$ itself.

\subsection{The main theorem}

Having the necessary concepts and definitions in hand, we now turn to the proof of our main theorem, which extends \Cref{m-primary AIP: T} to arbitrary monomial matrices.

\begin{lemma}\label{lem: upper bound for higher mu}
   Given a monomial matrix $\matA$, there exists an integer $\beta= \beta(\matA)$ for which the following holds\textup:
   For each $p>\beta$, if $(\matA, \vv{u})$ is very small, and $(\matA_1, \vv{u}_1) \to \cdots \to (\matA_e, \vv{u}_e)$ is a path in $\sprout^{\ast}_p(\matA,\vv{u})$,  then
   \[
      \val \IP_p(\matB, \vv{v}, p^e) \leq \sum_{i=1}^e \val \IP_p(\matA_i, \vv{u}_i, p)p^{e-i}
   \]
   for any vertex $(\matB, \vv{v})$ of $\sprout^{\ast}_p(\matA,\vv{u})$ of the same level as $(\matA_1, \vv{u}_1)$.
\end{lemma}

\begin{proof}
   Choose $p$ large enough so that the conclusion of \Cref{arithmetic uniform value and image: T} holds for $\matA$ and for each of its finitely many descendants, and also so that \Cref{p large graph: P} holds for $\matA$.
   This proposition then implies that $\val \IP_p(\matB,\vv{v},p)$ equals $\val \IP_p(\matA_1, \vv{u}_1, p)$, by virtue of both being vertices of the same level in the graph $\sprout_p^{\ast}(\matA, \vv{u})$.
   This establishes the result when $e = 1$.

   Next, consider a path $(\matA_1,\vv{u}_1) \to \cdots \to (\matA_e, \vv{u}_e)$ with $e \geq 2$, and suppose that the result holds for all shorter paths.
   Invoking \Cref{general AIP: T} for the pair $(\matB,\vv{v})$, keeping in mind that  $\val \IP_p(\matB,\vv{v},p) =  \val \IP_p(\matA_1,\vv{u}_1,p)$, we see that
    \[
      \val \IP_p(\matB,\vv{v},p^e) \leq \val \IP_p(\matA_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (\matB,\vv{w},p^{e-1}) \}
    \]
    where the maximum above is over all $p$-shortfall pairs derived from $(\matB,\vv{v})$, that is, over all pairs $(\matB,\vv{w})$ with $\vv{w} \in \short \IP_p(\matB,\vv{v},p)$.

    Let an overbar denote collapse along $\O=\mf(\matB,\vv{v})$.
    If the pair $(\matB,\vv{w})$ is as above, then the linear constraints of $\IP_p(\collapse{\matB}, \collapse{\vv{w}}, p^{e-1})$ are a subset of the linear constraints of $\IP_p(\matB, \vv{w}, p^{e-1})$, while their arithmetic constraints are identical.
    Therefore, the value of $\IP_p(\matB,\vv{w},p^{e-1})$ is at most the value of $\IP_p(\collapse{\matB}, \collapse{\vv{w}}, p^{e-1})$.  On the other hand, as noted in \Cref{sprouts as collapsed shortfall pairs: R}, the collapsed pairs $(\collapse{\matB}, \collapse{\vv{w}})$ of this form are precisely the $p$-sprouts of $(\matB,\vv{v})$.
    Thus,
    \[
      \val \IP_p(\matB,\vv{v},p^e) \leq \val \IP_p(\matA_1,\vv{u}_1,p) p^{e-1} + \max \{ \val \IP_p (\matC,\vv{z},p^{e-1}) \}
   \]
   where the maximum above is over all $p$-sprouts $(\matC,\vv{z})$ of $(\matB,\vv{v})$.
   Therefore, to complete our inductive step, it suffices to show that
   \begin{equation}\label{ineq}
      \val \IP_p(\matC,\vv{z},p^{e-1}) \le \sum_{i=2}^e \val \IP_p(\matA_i,\vv{u}_i,p) p^{e-i}
   \end{equation}
   for each $p$-sprout $(\matC,\vv{z})$ of $(\matB,\vv{v})$.
   In what follows, we fix such a $p$-sprout.

   Let $q$ be the common level of $(\matB,\vv{v})$ and $(\matA_1, \vv{u}_1)$ in $\sprout^{\ast}_p(\matA,\vv{u})$.
   Being a $p$-sprout of $(\matB,\vv{v})$, it follows that $(\matC,\vv{z}) \in \S_{qp}(\matA,\vv{u})$, while our assumption that $e \geq 2$ implies that $\S^{\ast}_{qp}(\matA,\vv{u})$ is nonempty, as it contains $(\matA_2, \vv{u}_2)$.
   Below, we establish \eqref{ineq} in cases, depending on whether $(\matC,\vv{z}) \in \S^{\ast}_{qp}(\matA,\vv{u})$.

   If $(\matC,\vv{z}) \notin \S^{\ast}_{qp}(\matA,\vv{u})$, then $\val \IP_p(\matC,\vv{z}, p)< \val \IP_p(\matA_2, \vv{u}_2, p)$ by \Cref{p large graph: P}, and consequently $\val \IP_p(\matC, \vv{z},p^{e-1}) < \val\IP_p(\matA_2,\vv{u}_2, p^{e-1})$ by \Cref{cor: mu comparison}.
   The induction hypothesis applied to $(\matA_2, \vv{u}_2) \to \cdots \to (\matA_e, \vv{u}_e)$ and $(\matA_2,\vv{u}_2)$ itself gives \eqref{ineq}.
   On the other hand, if $(\matC, \vv{z}) \in \S^{\ast}_{qp}(\matA,\vv{u})$, then it is on the same level in $\sprout_p^{\ast}(\matA,\vv{u})$ as $(\matA_2, \vv{u}_2)$, and  our induction hypothesis applied to the path $(\matA_2, \vv{u}_2) \to \cdots \to (\matA_e, \vv{u}_e)$ and the point $(\matC, \vv{z})$ once again gives us \eqref{ineq}, completing the proof.
\end{proof}

\begin{theorem}[Main Theorem]
   \label{main theorem wrt diagonal: T}
   Given a monomial matrix $\matA$, there exists an integer $\beta = \beta(\matA)$ with the following property\textup:
   If $p > \beta$ and $(\matA,\vv{u})$ is very small, then $\val \IP_p(\matA,\vv{u},p^e)$ is a polynomial of degree $e$ in $p$.
   The leading coefficient of this polynomial is $\ft{\matA}{\vv{u}}$, and all non-leading coefficients are nonpositive and rational.
   Furthermore, these coefficients depend on $(\matA,\vv{u})$ and the class of $p$ modulo any universal denominator for $\matA$, but not on $p$ itself.

   More explicitly, if $e$ is an integer with $1 \leq e \leq \log_p \Q_p(\matA,\vv{u})$, then
   \[
      \val \IP_p(\matA,\vv{u}, p^e) =  \ft{\matA}{\vv{u}}  p^e - \sum_{1 \leq i < e} ( \delta_{p^i}(\matA,\vv{u}) - \epsilon_{p^{i+1}}(\matA,\vv{u}))  p^{e-i} - \delta_{p^e}(\matA,\vv{u}).
   \]
   Furthermore, if $\Q = \Q_p(\matA,\vv{u})$ is finite, then
   \[
      \val \IP_p(\matA,\vv{u}, \Q q) = \val \IP_p(\matA,\vv{u}, \Q)  q + q-1
   \]
   for every $q$ a power of $p$.
\end{theorem}

Below we prove all claims above except the nonpositivity of the non-leading coefficients in $\val \IP_p(\matA,\vv{u},p^e)$, which is postponed until \Cref{non-leading coefficients: P}.

\begin{proof}
   Choose $p \gg 0$ so that the conclusions of \Cref{ILL: T,small not very small value: T,arithmetic uniform value and image: T,lem: upper bound for higher mu} are valid.
   Set $\Q = \Q_p(\matA,\vv{u})$.
   If $e$ is an integer satisfying $1 \leq e \leq \log_p\Q$, then $\S_{p^e}^{\ast}(\matA,\vv{u})$ is nonempty, and by the construction of $\sprout_p^{\ast}(\matA,\vv{u})$, there exists a path $(\matA,\vv{u}) = (\matA_1, \vv{u}_1) \to \cdots \to (\matA_e, \vv{u}_e)$ in this graph.
   This is also a path in $\sprout_p(\matA)$, and so \Cref{ILL: T} tells us that there exist points $\vv{k}_i \in \opt \IP(\matA_i, \vv{u}_i, p)$ for $1 \le i \le e$ such that the point $\vv{k} \coloneqq \sum_{i=1}^e \vv{k}_i p^{e-i}$ is feasible for the standard integer program $\IP(\matA, \vv{u}, p^e)$.

   However, as noted in \Cref{elementary2: R}\eqref{elementary2 small pairs}, each of the vertices $(\matA_i, \vv{u}_i)$ is very small, so \Cref{ip = aip: L} shows that $\IP(\matA_i,\vv{u}_i,p) = \IP_p(\matA_i, \vv{u}_i, p)$.
   \Cref{trivial small value bound: P} then tells us that $\norm{\vv{k}_i} \le p - 1$, and \Cref{dickson: R} shows that the point $\vv{k}$ satisfies the arithmetic constraint of the arithmetic program $\IP_p(\matA,\vv{u},p^e)$, so that
   \begin{align*}
     \val \IP_p(\matA,\vv{u},p^e) \geq  \norm{\vv{k}} & = \sum_{i=1}^e \val \IP_p(\matA_i,\vv{u}_i,p) p^{e-i} \\
                                                  & = \sum_{i=1}^e (\epsilon_{p^i}(\matA,\vv{u})p - \delta_{p^i}(\matA,\vv{u})) p^{e-i}.
   \end{align*}
   \Cref{lem: upper bound for higher mu} then implies that we must have equality throughout.
   Noticing that $\epsilon_p(\matA,\vv{u}) = \ft{\matA}{\vv{u}}$, this is simply a rearrangement of the fist equation in the statement.

   Next, suppose that $\Q$ is finite.
   By definition of $\Q$, we know that $\S_{\Q}^{\ast}(\matA,\vv{u})$ is nonempty, while $\S^{\ast}_{\Q p}(\matA,\vv{u})$ is empty, so that $\S_{\Q p}(\matA,\vv{u})$ must contain a pair that is not very small.
   Set $l=\log_p \Q$.
   Then there exists a path
   \begin{equation}\label{eq: first path}
      (\matA,\vv{u}) = (\matB_1,\vv{v}_1) \to \cdots \to (\matB_{l}, \vv{v}_{l})
   \end{equation}
   in $\sprout_p^{\ast}(\matA,\vv{u})$, which extends to a path
   \[
      (\matA,\vv{u}) = (\matB_1,\vv{v}_1) \to \cdots \to (\matB_{l}, \vv{v}_{l}) \to (\matB_{l+1}, \vv{v}_{l+1})
   \]
   in $\sprout_p(\matA)$ whose terminal vertex is small, but not very small.
   \Cref{ILL: T}, applied to this second path, tells us that there exist points $\vv{h}_i \in \opt \IP(\matB_i, \vv{v}_i, p)$ for $1\le i\le l+1$ such that
   \[
      \vv{h} \coloneqq \sum_{i=1}^{l+1} \vv{h}_i p^{l+1-i} \in \feas \IP(\matA,\vv{u}, \Q p).
   \]
   Arguing as in the proof of \Cref{small not very small value: T}, our choice of $p \gg 0$ guarantees that $\norm{\vv{h}_{l+1}} = \val\IP(\matB_{l+1}, \vv{v}_{l+1},p) > p$, and so there exists a point $\vv{g} \leq \vv{h}_{l+1}$ with $\norm{\vv{g}} = p-1$.
   Without loss of generality, suppose that the inequality $\vv{g} \leq \vv{h}_{l+1}$ is strict in the first entry, so that $\vv{0} \leq \vv{g} + \canvec_1 \leq \vv{h}_{l+1}$.

   Fix an integer $e \geq 1$, and consider the point
   \[
      \vv{m} \coloneqq \sum_{i=1}^{l} \vv{h}_i p^{e+l-i} + (\vv{g}+\canvec_1)p^{e-1} - \canvec_1
   \]
   which is obtained from $\vv{h}p^{e-1}$ by replacing $\vv{h}_{l+1}p^{e-1}$ with  $(\vv{g}+\canvec_1)p^{e-1} - \canvec_1$, which is less than or equal to $\vv{h}_{l+1} p^{e-1}$, by our choice of $\vv{g}$.
   Therefore, $\vv{m} \leq \vv{h}p^{e-1}$, and the feasibility of $\vv{h}$ for $\IP(\matA,\vv{u}, \Q p)$ then implies that $\vv{m} \in \feas \IP(\matA,\vv{u}, \Q p^e)$.

   To see that $\vv{m}$ satisfies the arithmetic constraint of $\IP_p(\matA,\vv{u}, \Q p^e)$, observe that the base $p$ expansion of $\vv{m}$ is given by
   \[
      \vv{m} = \sum_{i=1}^{l} \vv{h}_i p^{e+l-i} + \vv{g}p^{e-1} + (p-1) \canvec_1 \cdot p^{e-2} + \cdots + (p-1)\canvec_1
   \]
   and note that $\norm{\vv{h}_i} = \epsilon_{p^i}(\matA,\vv{u})p-\delta_{p^i}(\matA,\vv{u}) < p$ for each $1 \leq i \leq l$, as the path in \eqref{eq: first path} lies entirely in $\sprout_p^{\ast}(\matA,\vv{u})$.
   Thus, $\vv{m}$ is feasible for $\IP_p(\matA,\vv{u}, \Q p^e)$, and this and our earlier work show that
   \begin{align*}
     \val \IP_p(\matA,\vv{u}, \Q p^e) \geq \norm{\vv{m}} & = \sum_{i=1}^l (\epsilon_{p^i}(\matA,\vv{u})p-\delta_{p^i}(\matA,\vv{u})) p^{e+l-i} + p^e-1 \\
                                                     & = \Big ( \sum_{i=1}^l (\epsilon_{p^i}(\matA,\vv{u})p-\delta_{p^i}(\matA,\vv{u})) p^{l-i} \Big ) p^e + p^e-1 \\
                                                     & = \val \IP_p(\matA,\vv{u}, \Q) p^e + p^e-1
   \end{align*}
   and \Cref{general AIP: T} further implies that equality must hold throughout.
\end{proof}

\begin{corollary}
	\label{value-of-aip-invariant-under-collapse: C}
	Given a monomial matrix $\matA$, there exists an integer $\beta = \beta(A)$ with the following property:  If $p > \beta$, and $(\matA, \vv{u})$ is very small, then for all $e$, \[ \val \IP_p(\matA, \vv{u}, p^e) = \val \IP_p(\collapse{\matA}, \collapse{\vv{u}}, p^e)\] where the overbar denotes the collapse along $\O = \mf(\matA, \vv{u})$.  Thus, if $p > \beta$, then
	\[ \val \fip_p(\matA,\vv{u}) = \val \fip_p(\collapse{\matA},\collapse{\vv{u}}). \]
	\end{corollary} 

\begin{proof} This follows from \Cref{main theorem wrt diagonal: T,elementary2: R}\eqref{collapse sprout star graphs same}.
\end{proof}


\begin{remark}[An algorithm]
   \label{algorithm: R}
   Like in the $\idealm$-primary case, our methods provide us with an algorithm that, at least in theory, returns the formulas given in \Cref{main theorem wrt diagonal: T} for \emph{all} $e \ge 1$.
   In fact, the pseudocode presented in Algorithm~\ref{alg} applies to the general case with minimal modifications:
   $\S_{\pp^e}$ should be defined as the set consisting of all $p$-sprout of all elements in $\S^*_{\pp^{e-1}}$ in line \ref{line1}, and $\matA$ should be replaced with a descendant $\matB$ in lines \ref{line2}--\ref{line5}.
   This algorithm terminates because $\sprout^*_p(\matA,\vv{u})$ is either finite or its levels eventually repeat cyclically, as pointed out in \Cref{elementary2: R}\eqref{elementary2 periodic in e}.
   All of the considerations made in \Cref{m-primary algorithm: R} about the potential inefficiency and impracticality of the algorithm for the $\idealm$-primary case still apply here.
\end{remark}

\begin{example}[Running example: values of $\IP_p$]
   \label{ex: ft.5}
   \Cref{table: running example data} shows the data associated to the pair $(\matA,\vv{u})$ in our running example, whose sprouting subgraph is shown in \Cref{fig: sprouting graph}.
   \begin{table}
      \begin{center}
         \begingroup
         \setlength{\tabcolsep}{8pt} % Default value: 6pt
         \renewcommand{\arraystretch}{1.4} % Default value: 1
         \begin{tabular}{cccc}
           \toprule
           $e$ & $\epsilon_{p^e}(\matA,\vv{u})$ & $\delta_{p^e}(\matA,\vv{u})$ & $\val\IP_p(\matA,\vv{u},p^e)$ \\
           \midrule
           1 & $\frac{4}{17}$ & $\frac{10}{17}$ & $\frac{4}{17}p - \frac{10}{17}$\\
           2 & $\frac{10}{17}$ & $\frac{8}{17}$ & $\frac{4}{17}p^2 - \frac{8}{17}$ \\
           3 & $\frac{8}{17}$ & $\frac{20}{17}$ & $\frac{4}{17}p^3 - \frac{20}{17}$\\
           \bottomrule
         \end{tabular}
         \endgroup
         % The \begingroup ... \endgroup pair ensures the separation
         % parameters only affect this particular table, and not any
         % sebsequent ones in the document.
      \end{center}
      \caption{The data obtained for \Cref{ex: ft.5}}
      \label{table: running example data}
   \end{table}
   For any $e \ge 3$ we have
   \[
      \val\IP_p(\matA,\vv{u},p^e) = \frac{4}{17}p^e - \frac{20}{17}p^{e-3} + p^{e-3} - 1
       = \frac{4}{17}p^e - \frac{3}{17}p^{e-3}  - 1
    \]
    for sufficiently large $p$ congruent to $11$ modulo a universal denominator for~$\matA$.
    If $(\matA,\vv{u})$ is associated to an ideal pair $(\ideala,\ideald)$, then for $p$ as above we have
    \[\crit(\ideala,\ideald) = \frac{4}{17} - \frac{3}{17p^3}.\]
\end{example}

\begin{example}[Another illustration of \Cref{main theorem wrt diagonal: T}]
   \label{ex: new example.2}
   \Cref{table: new example data} shows the data associated to the pair $(\matA,\vv{u})$ in \Cref{ex: new example}, corresponding to the nine levels of the sprouting subgraph shown in \Cref{fig: sprouting graph 2}.
   \begin{table}
      \begin{center}
         \begingroup
         \setlength{\tabcolsep}{8pt} % Default value: 6pt
         \renewcommand{\arraystretch}{1.4} % Default value: 1
         \begin{tabular}{cccc}
           \toprule
           $e$ & $\epsilon_{p^e}(\matA,\vv{u})$ & $\delta_{p^e}(\matA,\vv{u})$ & $\val\IP_p(\matA,\vv{u},p^e)$ \\
           \midrule
           1 & $\frac{624}{773}$ & $\frac{680}{773}$ & $\frac{624}{773}p - \frac{680}{773}$\\
           2 & $\frac{773}{881}$ & $\frac{574}{881}$ & $\frac{624}{773}p^2 - \frac{\num{1551}}{\num{681013}}p - \frac{574}{881}$ \\
           3 & $\frac{574}{881}$ & $\frac{147}{881}$ & $\frac{624}{773}p^3 - \frac{\num{1551}}{\num{681013}}p^2 - \frac{147}{881}$ \\
           4 & $\frac{1}{25}$ & $\frac{11}{25}$ & $\frac{624}{773}p^4 - \frac{\num{1551}}{\num{681013}}p^3 - \frac{\num{2794}}{\num{22025}}p - \frac{11}{25}$ \\
           5 & $\frac{11}{25}$ & $\frac{21}{25}$ & $\frac{624}{773}p^5 - \frac{\num{1551}}{\num{681013}}p^4 - \frac{\num{2794}}{\num{22025}}p^2 - \frac{21}{25}$ \\
           6 & $\frac{21}{25}$ & $\frac{6}{25}$ & $\frac{624}{773}p^6 - \frac{\num{1551}}{\num{681013}}p^5 - \frac{\num{2794}}{\num{22025}}p^3 - \frac{6}{25}$ \\
           7 & $\frac{6}{25}$ & $\frac{16}{25}$ & $\frac{624}{773}p^7 - \frac{\num{1551}}{\num{681013}}p^6 - \frac{\num{2794}}{\num{22025}}p^4 - \frac{16}{25}$ \\
           8 & $\frac{16}{25}$ & $\frac{1}{25}$ & $\frac{624}{773}p^8 - \frac{\num{1551}}{\num{681013}}p^7 - \frac{\num{2794}}{\num{22025}}p^5 - \frac{1}{25}$ \\
           9 & $\frac{1}{25}$ & $\frac{11}{25}$ & $\frac{624}{773}p^9 - \frac{\num{1551}}{\num{681013}}p^8 - \frac{\num{2794}}{\num{22025}}p^6 - \frac{11}{25}$ \\
           \bottomrule
         \end{tabular}
         \endgroup
         % The \begingroup ... \endgroup pair ensures the separation
         % parameters only affect this particular table, and not any
         % sebsequent ones in the document.
      \end{center}
      \caption{The data obtained for \Cref{ex: new example.2}}
      \label{table: new example data}
   \end{table}
   For any $e\ge 4$ we have
   \[
      \val\IP_p(\matA,\vv{u},p^e) =
      \begin{cases}
         \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{21}{25} & \text{if $e \equiv 0 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{6}{25} & \text{if $e \equiv 1 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{16}{25} & \text{if $e \equiv 2 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{1}{25} & \text{if $e \equiv 3 \bmod 5$}\\[1mm]
         \frac{624}{773}p^{e} - \frac{\num{1551}}{\num{681013}}p^{e-1} - \frac{\num{2794}}{\num{22025}}p^{e-3} - \frac{11}{25} & \text{if $e \equiv 4 \bmod 5$}
      \end{cases}
   \]
   for any sufficiently large prime $p$ congruent to $11$ modulo a universal denominator for $\matA$.
   If $(\matA,\vv{u})$ is associated to an ideal pair $(\ideala,\ideald)$ and $p$ is as above, then
   \[\crit(\ideala,\ideald) = \frac{624}{773} - \frac{\num{1551}}{\num{681013} p} - \frac{\num{2794}}{\num{22025} p^3}.\]
\end{example}

\subsection{Concerning non-leading coefficients}

We now address the nonpositivity of the non-leading coefficients, claimed in \Cref{main theorem wrt diagonal: T}.

\begin{lemma}
   \label{non-leading coefficients: L}
   If $(\matB, \vv{v})$ is a $p$-sprout of $(\matA, \vv{u})$, then
   \[
      \udeficit(\matA, \vv{u}, p) \geq \ft{\matB}{\vv{v}}
   \]
   with equality if $\matA$ is a monomial matrix associated to an $\idealm$-primary monomial ideal that is generated by monomials of the same degree, with respect to some positive $\ZZ$-grading.
\end{lemma}

% \pedro[inline]{
%    Here, we don't really just mean homogeneous, but actually generated by monomials of the same degree.
% \daniel[inline]{You are right. I updated the statement.}
% }

\begin{proof}
   Let $\N$ be the Newton polyhedron of $\matA$, let an overbar denote collapse along $\O=\mf(\matA,\vv{u})$, and choose a point~$\defpt$ that defines the face $\O$ in $\N$.
   By definition, $\matB$ is the collapse of $\matA$ along $\O$, and $\vv{v} \in \ushort(\matA,\vv{u},p)$.
   \Cref{collapse of Newton polyhedron: P} tells us that $\collapse{\O}$ is a face of $\collapse{\N}$, the Newton polyhedron of $\matB=\collapse{\matA}$, defined in $\collapse{\N}$ by the collapsed point $\collapse{\vv{c}}$.
   \Cref{FT descriptions: P}\ref{lambda} then shows that $\frac1{\ft{\matB}{\vv{v}}}\cdot \vv{v} \in \collapse{\N}$, so by \Cref{alpha=1: convention} we have $\iprod{\collapse{\vv{c}}}{\vv{v}} \ge \ft{\matB}{\vv{v}}$.
   But since $\vv{v} \in \ushort(\matA, \vv{u}, p)$, we may write $ \vv{v} = \matB \tail{\vv{s}}_p - \matB \vv{h}$ for some $\vv{s} \in \sp_{\QQ}(\matA, \vv{u})$ and $\vv{h}$  optimal for $\ip = \ip(\matA, \vv{u}, \vv{s}, p)$, and \eqref{bound in inner product: e} and \eqref{norm of tail: e} allow us to conclude that
   \[
      \ft{\matB}{\vv{v}} \le \iprod{\collapse{\defpt}}{\vv{v}} \leq \norm{\tail{\vv{s}}_p} - \val \ip= \udeficit(\matA, \vv{u}, p).
   \]

   We now address the last assertion.
   Suppose $\matA$ is associated to an $\idealm$-primary ideal $\ideala$ generated by monomials of the same degree $d$ under a positive $\ZZ$-grading.
   Then homogeneity implies that the convex hull of the columns of $\matA$ corresponding to monomials of degree $d$ is a proper face $\O$ of $\N$.
   The positivity of the grading implies that the point $\defpt$ defining this face must be positive.
   Thus, $\O$ must be bounded, and in particular, collapsing along $\O$ is simply the identity.
   Finally, the $\mathfrak{m}$-primary assumption further implies that $\mf(\matA, \vv{u}) = \O$ for every pair $(\matA,\vv{u})$.
   Given this, one may retrace the steps above to see that every inequality involving the inner product of $\defpt = \collapse{\defpt}$ with another point must be, in fact, an equality.
   \pedro{
      I think we need to explain this further; to get equality in \eqref{bound in inner product: e} we need to show that $h_i=0$ whenever the $i$th column of $\matA$ is not in $\O$.
   }
\end{proof}

\begin{proposition}
\label{non-leading coefficients: P}
The non-leading coefficients appearing in the polynomial expressions described in \Cref{main theorem wrt diagonal: T} are rational and nonpositive.
\end{proposition}

\begin{proof}
   Fix a pair $(\matA,\vv{u})$, and set $\Q=\Q_p(\matA,\vv{u})$.
   By \Cref{main theorem wrt diagonal: T}, the non-leading coefficients under consideration are the rational numbers $-(\delta_{q}(\matA,\vv{u})-\epsilon_{qp}(\matA,\vv{u}))$ whenever $q < \Q$, the rational number $-(\delta_{\Q}(\matA,\vv{u}) - 1)$ whenever $\Q$ is finite, the rational numbers $-\delta_q(\matA,\vv{u})$ whenever $q\le \Q$, and $-1$.

   The proofs that the coefficients of the first and second type are nonpositive are similar, so we will only consider the coefficients of the second type.
   Toward this, suppose that $\Q$ is finite.
   In this case, $\S^{\ast}_{\Q p}(\matA,\vv{u})$ is empty, and so there is an edge $(\matB,\vv{v}) \to (\matC,\vv{z})$ in $\sprout_p(\matA)$ whose initial pair lies in $\S^{\ast}_{\Q}(\matA,\vv{u})$, and whose terminal pair is not very small. \Cref{non-leading coefficients: L} then tells us that $\delta_{\Q}(\matA,\vv{u}) = \udeficit(\matB,\vv{v},p)$ is at least $\ft{\matC}{\vv{z}}$, which is greater than $1$ as $(\matC,\vv{z})$ is not very small.
   Thus, $-(\delta_\Q(\matA,\vv{u})-1)$ is negative.
\end{proof}

\subsection{Critical exponents versus $F$-thresholds}
\label{crit versus ft: SS}

Let us now investigate what \Cref{main theorem wrt diagonal: T} tells us about the difference between critical exponents and $F$-thresholds of monomial ideals, at least from the perspective of reduction to sufficiently large prime characteristic.
Recall that if $\ideala$ and $\idealb$ are ideals in an $F$-finite regular ring, then whenever these numbers are defined, the critical exponent of $\ideala$ with respect to $\idealb$ is at most the $F$-threshold $\ideala$ with respect to $\idealb$, and both are known to be rational \cite[Corollary~5.8]{hernandez+etal.frobenius_powers}.

Suppose that $p \gg 0$ so that the conclusions of \Cref{main theorem wrt diagonal: T} hold for some fixed monomial matrix~$\matA$.
Consider a very small monomial pair $(\matA,\vv{u})$, associated to an ideal pair $(\ideala,\ideald)$, and set $\Q = \Q_p(\matA,\vv{u})$.
If $\Q$ is infinite, then  \Cref{main theorem wrt diagonal: T} implies that
\begin{equation}\label{eq: crit infinite case}
\crit(\ideala,\ideald)=\ft{\ideala}{\ideald} - \sum_{i=1}^{\infty} \frac{\delta_{p^i}(\matA,\vv{u})-\epsilon_{p^{i+1}}(\matA,\vv{u})}{p^i}.
\end{equation}
In this case, \Cref{elementary2: R}\eqref{elementary2 periodic in e} implies that the terms $\delta_{p^i}(\matA,\vv{u})-\epsilon_{p^{i+1}}(\matA,\vv{u})$ are eventually periodic in $i$, which demonstrates that $\crit(\ideala,\ideald)$ is rational.

On the other hand, when $\Q$ is finite, \Cref{main theorem wrt diagonal: T} instead implies that
\begin{align*}
\crit(\ideala,\ideald)& = \frac{\mu(\ideala,\ideald, \Q) +1}{\Q} \\
& = \ft{\ideala}{\ideald} -  \!\! \sum_{1 \le i < \log_p\!\! \Q} \!\!\! \frac{\delta_{p^i}(\matA,\vv{u})-\epsilon_{p^{i+1}}(\matA,\vv{u})}{p^i} -  \frac{ \delta_{\Q}(\matA,\vv{u})-1}{\Q}
\end{align*}
and so $\crit(\ideala,\ideald)$ is again rational, with denominator a power of $p$.

Thus, if $p \gg 0$ and $(\matA,\vv{u})$ is associated to an ideal pair $(\ideala, \ideald)$, then
\[ \ft{\ideala}{\ideald} - \crit(\ideala, \ideald) = \sum_{i=1}^{\infty} \frac{ \sigma_{p^i}(\ideala,\ideald)}{p^i} \]
where $\big(\sigma_{p^i}(\ideala,\ideald) \big)_{i=1}^{\infty}$ is a sequence of nonnegative rational numbers that is eventually periodic, and depends on the pair $(\matA,\vv{u})$ and on the class of $p$ modulo any universal denominator for $\matA$, but not on the value of $p$ itself.

\begin{remark}
   Consider a very small pair $(\matA,\vv{u})$ associated to an ideal pair $(\ideala,\ideald)$, where $\ideala$ is an $\idealm$-primary ideal generated by monomials of the same degree $d$ under some positive $\ZZ$-grading, as in \Cref{ex: m-primary homogeneous case}.
   \Cref{non-leading coefficients: L} shows that the terms $\delta_{p^s}(\matA,\vv{u})-\epsilon_{p^{s+1}}(\matA,\vv{u})$ appearing in \eqref{eq: crit infinite case} are all zero.
   Thus, for sufficiently large~$p$, $\crit(\ideala,\ideald)$ is either equal to $\ft{\ideala}{\ideald} = \deg \vv{u}/d$, if $\Q=\Q(\matA,\vv{u})$ is infinite, or it is a rational number with denominator a power of $p$ otherwise.
   To make this more explicit, note that $d$ is a universal denominator for $\matA$, as shown in \Cref{ex: m-primary homogeneous case 2}, and hence a denominator for $\delta_\Q(\matA,\vv{u})$.
   Thus, we have
   \[\crit(\ideala,\ideald) = \frac{\deg \vv{u}}{d} - \frac{r}{d\Q} \]
   where $r$ is a positive integer congruent to $\Q\deg\vv{u}$ modulo $d$.
   This explains the form of the various formulas obtained by the authors in \cite[Theorems~3.6, 4.8, and~5.5]{hernandez+etal.frobenius_examples}.
%    \pedro[inline]{Daniel: is this what you had in mind, or did you want to say more?
%       \daniel[inline]{All I would add is that in the second case, the critical exponent looks like $\ft{\matA}{\vv{u}}-r/\Q$ with $r \in \QQ$ is such that this fraction is an integer divided by $\Q$.  Really, I just wanted to explain why all of the critical exponents in our Examples paper looked the way they did.  There aren't any weird intermediate terms there in the case that a critical exponent is not the $F$-threshold.  Is this worth mentioning?}
%       \pedro[inline]{
%          I think so, and gave it a shot above.
%       }
%    }
   % \pedro[inline]{Maybe we could bring up this case more often throughout the paper; \eg as an example when introducing minimal face, universal denominator, etc. \emily[inline]{Sure}}
\end{remark}
% \daniel[inline]{Summarize what the constant terms are.  Namely, $-\delta_{p^e}(\matA,\vv{u})$ and $-1$.  This will come up when looking at the roots of the BS-polynomials}
% \emily[inline]{See below.}
% \daniel[inline]{Thanks.}

\todo[inline]{
   Find appropriate places for the next statement.  Proof calls upon \Cref{non-leading coefficients: L}.
}

\begin{proposition}[A simple special case]
	\label{simple-special: P}
   Given a monomial matrix $\matA$, fix a universal denominator $\denom$ for all the finitely many descendants of $\matA$.
   Then there exists $\beta = \beta(\matA)$ such that whenever $p>\beta$ and $p \equiv 1 \bmod \denom$,
\[
 \val\IP_p(\matA,\vv{u},p^e) = (p^e-1) \ft{\matA}{\vv{u}}
\]
for every very small $\matA$-pair $(\matA, \vv{u})$, and all $e \geq 1$.
In particular, for such $p$ we have $\crit(\matA,\vv{u}) = \ft{\matA}{\vv{u}}$.
\end{proposition}

\begin{proof}
We first prove the following claim:

\begin{claim}
   If $\matB$ is a descendant of $\matA$, $(\matB, \vv{v})$ is a very small pair, and $p \equiv 1 \bmod d$, then $\udeficit(\matB, \vv{v}, p) = \ft{\matB}{\vv{v}}$.
\end{claim}

Let $\vv{s}$ be a special point for $(\matB, \vv{v})$ with denominator $\denom$, so that $\norm{\vv{s}} = \ft{\matB}{\vv{v}} \leq 1$, and $\vv{s} = \vv{t}/\denom$, where $\vv{t}$ has nonnegative integer coordinates bounded above by $\denom$.
Since $p \equiv 1 \bmod \denom$, this means that $\tail{s_i}_p$ equals $\lpr{t_i p}{d}/d = t_i/d$ if $s_i \neq 0$, and equals $0$ otherwise; \ie $\tail{\vv{s}}_p = \vv{s}$.
If $\ip = \ip(\matB, \vv{v}, \vv{s}, p)$, we have that $0 \leq \val \ip < \norm{\vv{s}} = \ft{\matB}{\vv{v}} \leq 1$  by \Cref{bounded value: P}, forcing the value of the integer program $\ip$ to be $0$.
Hence $\udeficit(\matB, \vv{v}, p) = \deficit \ip = \norm{\vv{s}} - \val\ip = \ft{\matB}{\vv{v}}$, proving the claim.\\[2mm]
Observe that if $(\matC, \vv{w})$ is a $p$-sprout of a pair $(\matB, \vv{v})$ as above, then $\ft{\matC}{\vv{w}} \leq \udeficit(\matB, \vv{v}, p) = \ft{\matB}{\vv{v}}$ by \Cref{non-leading coefficients: L} and the above claim, so that $(\matC, \vv{w})$ is also very small.
Hence $\S^\ast_{q}(\matA, \vv{u})$ is nonempty for every $q$, and consequently, $\Q_p(\matA,\vv{u})$ is infinite.

Fix $(\matB, \vv{v}) \in \S_{q}^\ast(\matA,\vv{u})$ for some $q$, and let an overbar denote collapse along $\O = \mf(\matB, \vv{v})$.
The proof of the claim shows that a special point $\vv{s}$ for $(\matB,\vv{v})$ with denominator $\denom$ satisfies $\tail{\vv{s}}_p = \vv{s}$, and $\vv{0} \in \opt \ip(\matB,\vv{v},\vv{s},p)$.
Hence $\overline{\vv{v}} = \overline{\matB}\vv{s} = \overline{\matB}\tail{\vv{s}}_p - \overline{\matB} \, \vv{0} \in \ushort(\matB, \vv{v}, p)$, and $(\overline{\matB}, \overline{\vv{v}}) \in \S_{pq}(\matA, \vv{u})$.

The claim implies that $\S^\ast_{pq}(\matA, \vv{u})$ consists of the pairs in $\S_{pq}(\matA, \vv{u})$ with maximum $F$-threshold.
We know $\ft{\overline{\matB}}{\overline{\vv{v}}} = \ft{\matB}{\vv{v}}$ by \Cref{collapse of mf and mc: P}, and
that the $F$-threshold of any $p$-sprout of $(\matB, \vv{v})$ is bounded above by $\ft{\matB}{\vv{v}}$ by our earlier observation.
Hence $(\overline{\matB}, \overline{\vv{v}}) \in \S^\ast_{pq}(\matA, \vv{u})$.

Inductively, we conclude that for each $e\ge 1$, there exists a path $(\matA,\vv{u}) = (\matA_1,\vv{u}_1) \to \cdots \to (\matA_e,\vv{u}_e)$ in $\sprout^*(\matA,\vv{u})$, where each pair is the collapse of the previous one along its minimal face.
Consequently, $\udeficit(\matA_i,\vv{u}_i,p) = \ft{\matA_i}{\vv{u}_i} = \ft{\matA}{\vv{u}}$, for each $1\le i \le e$.
Then for each such $i$, $\epsilon_{p^i}(\matA,\vv{u}) = \delta_{p^i}(\matA,\vv{u}) = \ft{\matA}{\vv{u}}$, and the desired formula follows from
\Cref{main theorem wrt diagonal: T}.
\end{proof}

\section{Frobenius powers of monomial ideals}
\label{frobenius-powers-monomial-ideals: S}

\begin{theorem}[Main theorem on Frobenius powers of monomial ideals]
	\label{frobenius-powers-main: T}
	Given a monomial matrix $\matA$, there exists $\beta = \beta(\matA)$ with the following property\textup:
        If $\denom$ is a universal denominator for $\matA$, $p > \beta$, and $\ideala$ is the monomial ideal in a polynomial ring of characteristic $p>0$ associated to $\matA$, then 
	\begin{enumerate}[$(1)$]
	\item the number of constancy regions of $\ideala^{[t]}$ with $t$ in the unit interval depends only on the congruence class of $p$ modulo $\denom$\textup;
	\item though the endpoints of these regions depend on $p$, they agree with rational functions in $p$ that depends only on the congruence class of $p$ modulo $\denom$\textup;
	\item the values of $\ideala^{[t]}$ within each constancy region in the unit interval depends only on the congruence class of $p$ modulo $\denom$.
	\end{enumerate}	
\end{theorem}

\begin{lemma}
   \label{lem: lifting pairs}
   Let $\N$ be the Newton polyhedron associated to a monomial matrix~$\matA$.
   Let $\O$ be a standard face of $\N$, and let an overbar denote the collapse along~$\O$.
   Consider a pair  $(\collapse{\matA}, \vv{w})$ with $\mf(\collapse{\matA}, \vv{w}) = \collapse{\O}$, and fix a pair $(\matA, \vv{u})$ with $\collapse{\vv{u}} = \vv{w}$.
   If we set $\mathcal{L} \coloneqq \mf(\matA, \vv{u})$, then $\O = \mathcal{L}$ if and only if $\rb(\O) \subseteq \rb(\mathcal{L})$.
\end{lemma}

\begin{proof}
   We will prove that if $\rb(\O) \subseteq \rb(\mathcal{L})$, then $\O =\mathcal{L}$.
   Assume that $\rb(\mathcal{O})$ lies in $\rb(\mathcal{L})$, fix a point $\vv{c}$ defining $\O$ in $\N$, and set $\lambda = \ft{\matA}{\vv{u}}$.
   Then $\lambda^{-1} \vv{u} \in \mathcal{L}$, and so $\lambda^{-1} \vv{w} = \lambda^{-1} \collapse{\vv{u}} \in \collapse{\mathcal{L}}$.
   Since $\collapse{\mathcal{L}}$ is a face of $\collapse{\N}$ by \Cref{collapse of Newton polyhedron: P}, and $\lambda = \ft{\collapse{\matA}}{\vv{w}}$ by \Cref{collapse of mf and mc: P}, the minimality of $\collapse{\O} = \mf(\collapse{\matA}, \vv{w})$ implies $\collapse{\O} \subseteq \collapse{\mathcal{L}}$, and invoking \Cref{collapse of Newton polyhedron: P} again we conclude that $\O \subseteq \mathcal{L}$.

   On the other hand, we have 
   \[ \lambda = \ft{\collapse{\matA}}{\vv{w}} = \iprod{\collapse{\vv{c}}}{\vv{w}} = \iprod{\vv{c}}{\vv{u}} \]
   and as $\lambda^{-1} \vv{u} \in \mathcal{L} \subseteq \N$, the identity $\lambda = \iprod{\vv{c}}{\vv{u}}$ implies that $\lambda^{-1} \vv{u} \in \O$.
   Finally, the minimality of $\mathcal{L} = \mf(\matA, \vv{u})$ implies that $\mathcal{L} \subseteq \O$.
\end{proof}

% \begin{lemma}
%    \label{lem: minimality property of minimal face}
%    Let $\N$ be the Newton polyhedron of a monomial matrix $\matA$, let $\O$ be the minimal face of a monomial pair $(\matA,\vv{u})$, and let $\L$ be a standard face of $\N$.
%    If $\O$ and $\L$ are defined in $\N$ by points $\defpt$ and $\vv{b}$, respectively, then $\iprod{\defpt}{\vv{u}} \le \iprod{\vv{b}}{\vv{u}}$.
% \end{lemma}

% \begin{proof}
%    Let $\lambda = \ft{\matA}{\vv{u}} = \iprod{\defpt}{\vv{u}}$.
%    Then $\lambda^{-1}\vv{u} \in \O \subseteq \N$, and so $\iprod{\vv{b}}{\lambda^{-1}\vv{u}} \ge 1$.
%    Thus, $\iprod{\vv{b}}{\vv{u}} \ge \lambda = \iprod{\vv{c}}{\vv{u}}$, as desired.
% \end{proof}

\begin{lemma}
   \label{lem: lifting pairs 2}
   Let $\N$ be the Newton polyhedron associated to a monomial matrix~$\matA$.
   Let $\O$ be a standard unbounded face of $\N$, and let an overbar denote the collapse along~$\O$.
   Consider a pair  $(\collapse{\matA}, \vv{w})$ with $\mf(\collapse{\matA}, \vv{w}) = \collapse{\O}$.
   Then there exists a positive point $\vv{u}$ in the target lattice of $\matA$ such that $\collapse{\vv{u}} = \vv{w}$ and $\mf(\matA,\vv{u}) = \O$.
\end{lemma}

\begin{proof}
   Let $\vv{v}$ be a positive point in the target lattice of $\matA$ such that $\collapse{\vv{v}}=\vv{w}$.
   Consider a standard face $\L$ of $\N$ such that $\rb(\O) \not\subseteq \rb(\L)$.
   We start by showing that we can modify $\vv{v}$, producing another lift $\vv{u}$ of $\vv{w}$ so that $\mf(\matA,\vv{u}) \ne \L$.
   
   Let $\vv{b}$ and $\defpt$ be points that define $\L$ and $\O$ in $\N$, and let $\vv{e}$ denote the sum of the standard basis vectors in $\rb(\O)$.
   The assumption on the recession basis of $\L$ implies that $\iprod{\vv{b}}{\vv{e}} \ne 0$.
   Let $k$ be a positive integer with
   \[ k > \frac{\iprod{\vv{c}}{\vv{v}} - \iprod{\vv{b}}{\vv{v}}}{\iprod{\vv{b}}{\vv{e}}}\]
   and set $\vv{u} = \vv{v} + k\vv{e}$.
   We then have
   \[\iprod{\vv{b}}{\vv{u}} = \iprod{\vv{b}}{\vv{v}} + k\iprod{\vv{b}}{\vv{e}} > \iprod{\vv{c}}{\vv{v}} = \iprod{\vv{c}}{\vv{u}} \]
   which, in view of the equivalence of \ref{new ip} and \ref{min} in \Cref{FT descriptions: P}, shows that $\mf(\matA,\vv{u})$ cannot be $\L$.

   Clearly, the integer $k$ used in the construction of the point $\vv{u}$ can be chosen to ensure that the minimal face of $(\matA,\vv{u})$ is \emph{none} of the finitely many standard faces $\L$ of $\N$ with $\rb(\O) \not\subseteq \rb(\L)$.
   With this choice of $k$, the recession basis of $\mf(\matA,\vv{u})$ contains $\rb(\O)$, and \Cref{lem: lifting pairs} shows that this minimal face must be $\O$.
\end{proof}

\begin{proposition}[Finite set of representatives for small critical exponents]
   \label{finite-representatives-small-crits: P}
   If~$\matA$ is a monomial matrix, then there exist a finite set $\setW=\setW(\matA)$ of positive points in the target lattice of $\matA$ and an integer $\beta = \beta(\matA)$ such that the following properties hold whenever $p > \beta$\textup:
   \begin{enumerate}[$(1)$]
      \item $\crit(\matA,\vv{u},p) \le 1$ for all $\vv{u} \in \setW$.
      \item If $\crit(\matA,\vv{v},p) \le 1$ for some $\vv{v}$, then there exists $\vv{u} \in \setW$ with $\vv{u} \le \vv{v}$ such that $\crit(\matA,\vv{v},p) = \crit(\matA,\vv{u},p)$.
   \end{enumerate}
\end{proposition}

\begin{proof}
   We shall construct the set $\setW$ as a union of finite sets associated to the standard faces of the Newton polyhedron $\N$ of $\matA$, and a finite set coming from small but not very small pairs.
   For concreteness, suppose $\matA$ has $\numvars$ rows.
   
   If $\O$ is a \emph{bounded} standard face of $\N$, set
   \[\setW_\O \coloneqq \{\vv{u} \in \ZZpos^\numvars : (\matA,\vv{u})\text{ is very small and }\mf(\matA,\vv{u}) = \O\}.\]
   Observe that if $\vv{u} \in \setW_\O$, then $\lambda \coloneqq \ft{\matA}{\vv{u}} \le 1$ and $\lambda^{-1} \vv{u}\in \O$, and consequently $\vv{u}$ lies in the convex hull of $\O \cup \{\vv{0}\}$.
   Since $\O$ is bounded, so is this convex hull, and consequently the set $\setW_\O$ is finite.
   \pedro[inline]{
      I believe $\setW_\O = (\ri \O \cup \ri \conv(\O\cup \{\vv{0}\})) \cap \ZZpos^\numvars$, but we don't need this level of precision here.
   }
   
   If $\O$ is an unbounded standard face of $\N$, the set of all positive points $\vv{u}$ such that $(\matA,\vv{u})$ is very small and $\mf(\matA,\vv{u}) = \O$ is infinite, so we need to be more selective, and settle for a finite subset of ``minimal representatives''.
   Denoting collapsing along $\O$ by an overbar, $\collapse{\O}$ is a bounded standard face of $\collapse{\N}$ by \Cref{collapse of Newton polyhedron: P}, and we construct a finite set $\setW_{\collapse{\O}}$ of positive points in the target lattice of $\collapse{\matA}$ as in the previous paragraph.
   For each point $\vv{w}$ in $\setW_{\collapse{\O}}$, we set
   \[ S_\vv{w} \coloneqq \{ \vv{u} \in \ZZpos^\numvars: \collapse{\vv{u}} = \vv{w}\text{ and }\mf(\matA,\vv{u}) = \O \}.\]
   Note that if $\vv{u} \in S_\vv{w}$, then $(\matA,\vv{u})$ is very small, since $\ft{\matA}{\vv{u}} = \ft{\collapse{\matA}}{\vv{w}}$ by \Cref{collapse of mf and mc: P} and $(\collapse{\matA},\vv{w})$ is very small by construction.
   \Cref{lem: lifting pairs 2} tells us that $S_\vv{w}$ is nonempty, and Dickson's Lemma \cite[Lemma~A]{dickson} tells us that the set $\min S_\vv{w}$  of minimal elements of $S_\vv{w}$ under componentwise inequality is finite.
   Set
   \[\setW_\O \coloneqq \bigcup_{\vv{w}} \min S_\vv{w} \]
   where the union ranges over all $\vv{w} \in \setW_{\collapse{\O}}$.

   To conclude the construction of $\setW$, set 
   \[\setW^* \coloneqq \min\{\vv{u} \in \ZZpos^\numvars : (\matA,\vv{u})\text{ is small but not very small}\}\]
   where `$\min$' is again used to denote the set of all minimal elements of a set under componentwise inequality.
   This set is finite, again by Dickson's Lemma, and we set
   \[\setW \coloneqq \setW^* \cup \bigg(\bigcup_\O \setW_\O\bigg)\]
   where the union ranges over all standard faces $\O$ of $\N$.

   We now prove that the set $\setW$ just constructed does the job.
   Fix an integer $\beta$ for which the conclusions of both \Cref{small not very small value: T,value-of-aip-invariant-under-collapse: C} hold for all $p > \beta$, and fix $p>\beta$.

   Claim $(1)$ follows from \Cref{trivial small value bound: P}, as $(\matA,\vv{u})$ is small for every $\vv{u} \in \setW$.
   Toward $(2)$, let $\vv{v}$ be a positive point such that $\crit(\matA,\vv{v},p) \le 1$.
   Then $(\matA,\vv{v})$ is small by \Cref{trivial small value bound: P}.
   If this pair is not very small, then $\vv{v} \ge \vv{u}$ for some $\vv{u} \in \setW^*$, and $\crit(\matA,\vv{v},p) = \crit(\matA,\vv{u},p) = 1$ by \Cref{small not very small value: T}.
   Suppose now that $(\matA,\vv{v})$ is very small, and let $\O = \mf(\matA,\vv{v})$.
   If $\O$ is bounded, then $\vv{v}$ itself is in $\setW_\O$, and we simply take $\vv{u} = \vv{v}$.
   If $\O$ is unbounded, then, again indicating collapsing along $\O$ by overbars, \Cref{collapse of mf and mc: P} shows that the pair $(\collapse{\matA},\collapse{\vv{v}})$ is very small, since $\ft{\collapse{\matA}}{\collapse{\vv{v}}} = \ft{\matA}{\vv{v}} \le 1$, and that $\mf(\collapse{\matA},\collapse{\vv{v}}) = \collapse{\O}$.
   Thus, $\collapse{\vv{v}} \in \setW_{\collapse{\O}}$, so that $\vv{v} \in S_{\collapse{\vv{v}}}$, and $\vv{v} \ge \vv{u}$ for some $\vv{u} \in \min S_{\collapse{\vv{v}}} \subseteq \setW_\O$.
   To conclude the proof, note that $\crit(\matA,\vv{v},p) = \crit(\collapse{\matA},\collapse{\vv{v}},p) = \crit(\matA,\vv{u},p)$ by \Cref{value-of-aip-invariant-under-collapse: C}.
\end{proof}

\begin{remark}[On the computability of $\setW$] \label{computibility of W: R}
   Retaining the notation introduced in the proof of \Cref{finite-representatives-small-crits: P}, when considering the bounded faces in the computation of $\setW$, we may consider only the bounded standard faces $\L$ that are \emph{maximal} with respect to inclusion, and take the set of all positive lattice points in the convex hull of $\L\cup \{\vv{0}\}$.
   This set is computable (\eg using the package \emph{Polyhedra} for \emph{Macaulay2} \cite{PolyhedraSource,M2}), 
   and coincides with the union of the sets $\setW_\O$, where $\O$ ranges over all standard faces of $\N$ contained in $\L$.
   \details[inline]{
      \pedro[inline]{
         Will write down all the details here, as I intend to use this in the M2 code, and want to make sure it's right.
      }
      Let $\vv{v}_1,\ldots,\vv{v}_k$ be the vertices of $\L$.
      Let $\vv{u} \in \conv(\L\cup\{\vv{0}\}) \cap \ZZpos^\numvars$.
      Then $\vv{u}$ is a convex combination of $\vv{v}_1, \ldots, \vv{v}_k$ and $\vv{0}$, and therefore $\vv{u} = \sum_{i=1}^k \lambda_i\vv{v}_i$ for some nonnegative $\lambda_i$ with $\lambda \coloneqq \sum_{i=1}^k \lambda_i \le 1$.
      Moreover, the positivity of $\vv{u}$ tells us that $\lambda > 0$.
      Thus, $\lambda^{-1}\vv{u}$ is a convex combination of the vertices of $\L$, and therefore $\lambda^{-1}\vv{u} \in \L$.
      This implies that $\O \coloneqq \mf(\matA,\vv{u}) \subseteq \L$.
      Moreover, $\ft{\matA}{\vv{u}} = \lambda \le 1$, so $(\matA,\vv{u})$ is very small, and consequently $\vv{u} \in \setW_\O$.

      Conversely, suppose $\vv{u} \in \setW_\O$, for some standard face $\O \subseteq \L$.
      Then $(\matA,\vv{u})$ is very small, so $\lambda\coloneqq \ft{\matA}{\vv{u}} \le 1$, and $\lambda^{-1}\vv{u} \in \O \subseteq \L$.
      Thus, we can write $\lambda^{-1} \vv{u} = \sum_{i=1}^kt_i \vv{v}_i$, where $t_i \ge 0$ and  $\sum_{i=1}^k t_i = 1$.
      Then $\vv{u} = \sum_{i=1}^k (\lambda t_i) \vv{v}_i +(1-\lambda)\vv{0}$, a convex combination of $\vv{v}_1, \ldots, \vv{v}_k$ and $\vv{0}$, whence $\vv{u} \in \conv(\L\cup \{\vv{0}\})$.
   }
   \todo[inline]{TBC}
\end{remark}

The following proposition---a refinement of \cite[Proposition~2.5]{hernandez+etal.frobenius_examples}---describes the Frobenius powers of a monomial ideal in terms of critical exponents.

\begin{proposition}
   \label{crits of mon ideals: P}
   Let $\matA$ be a monomial matrix, and let $\setW$ and $\beta$ be as in \Cref{finite-representatives-small-crits: P}.
   If $\ideala$ is a monomial ideal in characteristic $p>\beta$ associated to $\matA$, then for each $t\in [0,1)$ we have
   \[ \ideala^{[t]} = \ideal{x^{\vv{u}-\vv{1}} : \vv{u} \in \setW\text{ and }\crit(\matA,\vv{u},p) > t}.\]	
\end{proposition}

\begin{proof}\ 
   \todo[inline]{TBC}
	% If a monomial $x^{\vv{u}-\vv{1}}$ lies in $\ideala^{[t]}$, then $\crit(\ideala,\ideald_\vv{u}) > t$, as $x^{\vv{u}-\vv{1}}\notin \ideald_\vv{u}$.
	% Conversely, if $\crit(\ideala, \ideald_\vv{u}) > t$, then $\ideala^{[t]}\not\subseteq \ideald_\vv{u}$, so there exists a monomial $x^{\vv{v}} \in \ideala^{[t]}$ with $\vv{v} < \vv{u}$.
	% Equivalently, $\vv{v} \leq \vv{u}-\vv{1}$, hence $x^{\vv{u}-\vv{1}}\in \ideal{x^{\vv{v}}}\subseteq \ideala^{[t]}$. 
\end{proof}

\begin{example}[Running example: Frobenius powers]
   \label{ex: ft.6}
   Let $\kk$ be a field of positive characteristic $p$, and $\ideala = \ideal{x^5 y^5 z^2, x^3 y^4 z^8, x^4 y^3 z^5} \subseteq \kk[x,y,z]$.
   \Cref{table: main example} shows the Frobenius powers $\ideala^{[t]}$ for $t \in [0,1)$, when $p$ is sufficiently large and congruent to $11$ modulo $\num{2170560}$.
%   \begin{center}
%      \begingroup
%      \setlength{\tabcolsep}{8pt} % Default value: 6pt
%      \renewcommand{\arraystretch}{1.4} % Default value: 1
%      \begin{tabular}{llll}
%        $\lambda_1 = \frac{4}{17} - \frac{3}{17 p^3}$
%        & $\lambda_2 = \frac5{19}$
%        & $\lambda_3 = \frac27 - \frac1{7 p}$
%        & $\lambda_4 = \frac5{17} - \frac3{17 p^4}$ \\
%        $\lambda_5 = \frac13$ 
%        & $\lambda_6 = \frac7{17} - \frac1{17 p^3}$
%        & $\lambda_7 = \frac8{19}$
%        & $\lambda_8 = \frac8{17} - \frac3{17 p}$ \\
%        $\lambda_9 = \frac12$
%        & $\lambda_{10} = \frac{10}{19}$
%        & $\lambda_{11} = \frac9{17} - \frac1{17 p^2}$
%        & $\lambda_{12} = \frac47 - \frac1{7 p^2}$ \\
%        $\lambda_{13} = \frac{10}{17} - \frac3{17 p^2}$
%        & $\lambda_{14} = \frac{12}{19}$
%        & $\lambda_{15} = \frac{11}{17} - \frac2{17 p}$ 
%        & $\lambda_{16} = \frac23$ \\
%        $\lambda_{17} = \frac{13}{19}$
%        & $\lambda_{18} = \frac{12}{17} - \frac1{17 p^5}$
%        & $\lambda_{19} = \frac{13}{17} - \frac1{17 p^4}$
%        & $\lambda_{20} = \frac{15}{19}$ \\
%        $\lambda_{21} = \frac{14}{17} - \frac1{17 p}$
%        & $\lambda_{22} = \frac{16}{19}$
%        & $\lambda_{23} = \frac67 - \frac2{21 p}$
%        & $\lambda_{24} = \frac{15}{17} - \frac1{17 p^6}$ \\
%        $\lambda_{25} = \frac{17}{19}$
%        & $\lambda_{26} = \frac{16}{17} - \frac1{51 p}$
%        & $\lambda_{27} = \frac{18}{19}$
%        & $\lambda_{28} = 1$ 
%      \end{tabular}
%   \endgroup
%   \end{center}
\begin{table}
   \begin{center} 
      \begingroup
      \setlength{\tabcolsep}{8pt} % Default value: 6pt
      \renewcommand{\arraystretch}{1.4} % Default value: 1
      \begin{tabular}{ll}
        \toprule
        Interval & $\ideala^{[t]}$\\
        \midrule
        $0 \le t < \frac{4}{17} - \frac{3}{17 p^3}$ & $\ideal{1}$ \\
        $\frac{4}{17} - \frac{3}{17 p^3} \le t < \frac5{19}$ & $\ideal{z, x}$ \\
        $\frac5{19} \le t < \frac27 - \frac1{7 p}$ & $\ideal{z, xy}$ \\
        $\frac27 - \frac1{7 p} \le t < \frac5{17} - \frac3{17 p^4}$ & $\ideal{yz, xz, xy}$ \\
        $\frac5{17} - \frac3{17 p^4} \le t < \frac13$ & $\ideal{xz, xy, yz^2}$ \\
        $\frac13 \le t < \frac7{17} - \frac1{17 p^3}$ & $\ideal{xy}$ \\
        $\frac7{17} - \frac1{17 p^3} \le t < \frac8{19}$ & $\ideal{xyz, x^2y}$ \\
        $\frac8{19} \le t < \frac8{17} - \frac3{17 p}$ & $\ideal{xyz, x^2y^2}$ \\
        $\frac8{17} - \frac3{17 p} \le t < \frac12$ & $\ideal{xyz^2, x^2yz, x^2y^2}$ \\
        $\frac12 \le t < \frac{10}{19}$ & $\ideal{xyz^2, x^2yz}$ \\
        $\frac{10}{19} \le t < \frac9{17} - \frac1{17 p^2}$ & $\ideal{xyz^2, x^2y^2z}$ \\
        $\frac9{17} - \frac1{17 p^2} \le t < \frac47 - \frac1{7 p^2}$ & $\ideal{xyz^3, x^2yz^2, x^2y^2z}$ \\
        $\frac47 - \frac1{7 p^2} \le t < \frac{10}{17} - \frac3{17 p^2}$ & $\ideal{x^2yz^2, x^2y^2z, xy^2z^3}$ \\
        $\frac{10}{17} - \frac3{17 p^2} \le t < \frac{12}{19}$ & $\ideal{x^2yz^2, x^2y^2z, xy^2z^4}$ \\
        $\frac{12}{19} \le t < \frac{11}{17} - \frac2{17 p}$ & $\ideal{x^2y^2z, x^2yz^3, xy^2z^4}$ \\
        $\frac{11}{17} - \frac2{17 p} \le t < \frac23$ & $\ideal{x^2yz^3, x^2y^2z^2, x^3y^2z, xy^2z^5}$ \\
        $\frac23 \le t < \frac{13}{19}$ & $\ideal{x^2y^2z^2, x^3y^2z}$ \\
        $\frac{13}{19} \le t < \frac{12}{17} - \frac1{17 p^5}$ & $\ideal{x^2y^2z^2, x^3y^3z}$ \\
        $\frac{12}{17} - \frac1{17 p^5} \le t < \frac{13}{17} - \frac1{17 p^4}$ & $\ideal{x^2y^2z^3, x^3y^2z^2, x^3y^3z}$ \\
        $\frac{13}{17} - \frac1{17 p^4} \le t < \frac{15}{19}$ & $\ideal{x^3y^2z^2, x^3y^3z, x^2y^2z^4}$ \\
        $\frac{15}{19} \le t < \frac{14}{17} - \frac1{17 p}$ & $\ideal{x^3y^3z, x^2y^2z^4, x^3y^2z^3}$ \\
        $\frac{14}{17} - \frac1{17 p} \le t < \frac{16}{19}$ & $\ideal{x^3y^2z^3, x^3y^3z^2, x^4y^3z, x^2y^2z^5}$ \\
        $\frac{16}{19} \le t < \frac67 - \frac2{21 p}$ & $\ideal{x^3y^2z^3, x^3y^3z^2, x^2y^2z^5, x^4y^4z}$ \\
        $\frac67 - \frac2{21 p} \le t < \frac{15}{17} - \frac1{17 p^6}$ & $\ideal{x^3y^2z^3, x^3y^3z^2, x^4y^4z, x^2y^3z^5}$ \\
        $\frac{15}{17} - \frac1{17 p^6} \le t < \frac{17}{19}$ & $\ideal{x^3y^2z^3, x^4y^3z^2, x^4y^4z, x^2y^3z^6}$ \\
        $\frac{17}{19} \le t < \frac{16}{17} - \frac1{51 p}$ & $\ideal{x^3y^2z^4, x^3y^3z^3, x^4y^3z^2, x^4y^4z, x^2y^3z^6}$ \\
        $\frac{16}{17} - \frac1{51 p} \le t < \frac{18}{19}$ & $\ideal{x^3y^2z^4, x^4y^3z^2, x^4y^4z, x^2y^3z^7}$ \\
        $\frac{18}{19} \le t < 1$ & $\ideal{x^3y^2z^4, x^4y^4z, x^4y^3z^3, x^2y^3z^7}$ \\
        \bottomrule
      \end{tabular}
      \endgroup
   \end{center}
   \caption{Frobenius powers for \Cref{ex: ft.6}}
   \label{table: main example}
\end{table}
\end{example}




\section{Applications to generic hypersurfaces}
\label{generic-hypersurfaces: S}

\begin{remark}
	\Cref{main theorem wrt diagonal: T} tells us that under its assumptions, the constant term of $\val \IP_p(\matA,\vv{u},p^e)$ as a polynomial in $p$ is $- \delta_{p^e}(\matA,\vv{u})$ for
	$1 \leq e \leq \log_p \Q_p(\matA,\vv{u})$, and is $-1$ for $e > \log_p \Q_p(\matA,\vv{u})$.
\end{remark}

\newpage

\begin{theorem}[Main theorem on test ideals of generic hypersurfaces]
	\label{generic-test-ideals-main: T}
Given nonnegative nonzero $\vv{a}_1, \ldots, \vv{a}_n \in \ZZ^m$, there exist $d$ and $\beta$ with the following property:  
Suppose that $\kk$ is a field of prime characteristic $p > \beta$ with $[\kk:\kk^p] < \infty$.  
Fix variables $z = z_1, \ldots, z_n$ over $\kk[x] = [x_1, \ldots, x_m]$, and let $R$ denote either $\kk[z]$ or $\kk(z)$. 
If $G = z_1 x^{\vv{a}_1} + \cdots + z_n x^{\vv{a}_n} \in R[x]$ is a generic linear combination of the $x^{\vv{a}_i}$, then
\begin{enumerate}[$(1)$]
		\item the number of $F$-jumping numbers of $G$ in the unit interval depends only on the congruence class of $p$ modulo $\denom$\textup;
		\item though the endpoints of the constancy regions of the test ideals $\tau(G^t)$ with $t$ in the unit interval 
		depend on $p$, they agree with rational functions in $p$ that depends only on the congruence class of $p$ modulo $\denom$\textup;
		\item the values of $\tau(G^t)$ within each constancy region in the unit interval depends only on the congruence class of $p$ modulo $\denom$.
	\end{enumerate}	
\end{theorem}

\begin{proof}
If for any $1 \leq j \leq m$, the $j$-th coordinate of $\vv{a}_i$ is zero for every $1 \leq i \leq n$, then $x_i$ will not appear in $G$, so will not appear in any minimal generator of its test ideals.  Hence we can remove any coordinate(s) of each $\vv{a}_i$ for which the above property holds, and after replacing $m$ with the remaining number of coordinates we can assume, without loss of generality, that $\matA = \begin{bmatrix} \vv{a}_1 & \cdots & \vv{a}_n \end{bmatrix}$ is an $m \times n$ monomial matrix.  Let $\ideala$ be the monomial ideal of $\kk[x]$ associated to $\matA$. 

The statement now immediately follows from  \Cref{frobenius-powers-main: T} and 
the fact that for all $1 < t < 0$, $\tau(G^t) = \ideala^{[t]} R[z]$ when $\ideala$ is an ideal of 
$R = \kk[z]$
\cite[Theorem 5.3]{hernandez+etal.frobenius_powers} or $R = \kk(z)$ \cite[Corollary 5.7]{hernandez+etal.frobenius_powers}, where $\kk$ is $F$-finite. 
\end{proof}	
	
\newpage
\appendix

\section{Monomial ideals and reduction}
\label{monomial-reduction: A}

Throughout this appendix, we focus on polynomial rings in the string of variables $x = x_1, \ldots, x_\numvars$, and in an attempt to simplify notation,  given a ring $\LL$, we will {consistently} use $\LL[x]$ to denote the polynomial ring $\LL[x_1, \ldots, x_\numvars]$.

Recall, from {the introduction}, that a pair of ideals $(\ideala, \idealb)$ of $\LL[x]$ is called \emph{radically compatible}
\daniel{I want to switch, and in some places have switched, \emph{radically compatible} $\to$ \emph{compatible} and \emph{compatible} $\to$ \emph{small compatible} to emphasize the connection with small monomial pairs.  I have probably failed to update this in various spots}
\pedro{How about simply ``small''?}
if $\ideala$ is nonzero, $\idealb$ is proper, and $\ideala$ is contained in the radical of $\idealb$.  
Our purpose in this appendix is twofold:  First, we show that if $(\ideala, \idealb)$ is a radically compatible pair of ideals of $\kk[x]$, where $\kk$ is a field of positive characteristic $p$, then when determining the values of $\mu(\ideala, \idealb, p^e)$, one may always assume that $\idealb$ is the diagonal ideal associated to a positive point.   This is, in essence, the content of \Cref{reduce-to-monomial-case: T}.  Second, we show that a similar statement holds in the context of \emph{reduction to large prime characteristic}, which is the content of \Cref{invariants associated to a monomial ideal in large characteristic: T}.
Let us also note that none of the results here rely on any of the in-depth examination of arithmetic integer programs and fractal programs conducted in the main text. 
\pedro{Except for \Cref{cor: mu comparison}}
\daniel{This will need to be clarified (there are more exceptions now).The point is that it is logically independent of all of the nitty-gritty details that we used to solve AIP and fractal programs.}
\pedro{Maybe we should just say that the appendix is ``mostly independent'' of the in-depth examination of \ldots}

Our approach is based on framework established in \cite[Appendix]{budur+mustata+saito.roots_bs_polys_monomial}.  For example, the \emph{monomialization operator} in \Cref{monomialization: D} below plays an important role in our arguments, and though this operator was not formally defined in \loccit, it appears, along with a natural variant, in \cite[Proposition 6.1 and Lemma 6.2]{budur+mustata+saito.roots_bs_polys_monomial}.  After introducing this operator, we establish some of its basic properties.

\begin{definition}[The $\mon$ operator on ideals]
\label{monomialization: D}
Consider a Noetherian domain $\LL$.  If $I$ is an ideal of the polynomial ring $\LL[x]$, then $\mon(I)$ is the ideal generated by all monomials $x^{\vv{u}} \in \LL[x]$ that are multiplied into $I$ by some nonzero element of $\LL$.
\end{definition}

Clearly, if $\LL$ is a field, then $x^{\vv{u}} \in \mon(I)$ if and only if $1 \cdot x^{\vv{u}} \in I$.  Otherwise, one can still find a single nonzero multiplier in $\LL$ with which to test inclusion in $\mon(I)$.  

\begin{lemma}
\label{single multiplier: L}
  Consider a Noetherian domain $\LL$.  Given an ideal $I$ of $\LL[x]$, there exists a nonzero element $\tau \in \LL$ with which to test inclusion in $\mon(I)$, \ie such that $x^{\vv{u}} \in \mon(I)$ if and only if $\tau x^{\vv{u}} \in I$ for every monomial $x^{\vv{u}} \in \LL[x]$.
\end{lemma}

\begin{proof}  As $\LL[x]$ is Noetherian, and $\mon(I)$ is generated by monomials, there exist $x^{\vv{u}_1}, \ldots, x^{\vv{u}_n}$ that generate $\mon(I)$, and nonzero elements $\tau_1, \ldots, \tau_n \in \LL$ such that $\tau_i x^{\vv{u}_i} \in I$ for every $i$.  It is then easy to verify that $\tau\coloneqq \tau_1 \cdots \tau_n$ does the trick.
\end{proof}

\begin{lemma} 
\label{frobenius-powers+mon-commute: L}
The $\mon$ operation commutes with standard Frobenius powers for ideals of any polynomial ring over a field of prime characteristic. %[$\mon$ commutes with standard Frobenius powers]  If $\kk$ is a field with $\operatorname{char}(\kk)=p>0$, and $\idealb$ is an ideal of $\kk[x]$, then $\mon(\idealb^{[p^e]}) = \mon(\idealb)^{[p^e]}$ for every $e$.
\end{lemma}

\begin{proof}  Consider an ideal $\idealb$ of $\ringR=\kk[x]$, where $\kk$ is a field of characteristic $p>0$, set $\idealc = \mon(\idealb)$, and let $q=p^e$.  We will now demonstrate that $\idealc^{[q]} = \mon(\idealb^{[q]})$.  One containment is immediate:   As $\idealc^{[q]} \subseteq \idealb^{[q]}$, we have that $\idealc^{[q]} = \mon(\idealc^{[q]}) \subseteq \mon(\idealb^{[q]})$.
   
   To conclude, it remains to show that any monomial $x^{\vv{u}} \in \idealb^{[q]}$ must lie in $\idealc^{[q]}$.
   Write $\vv{u} = \vv{v}q + \vv{w}$, where $\vv{v}, \vv{w} \in \NN^\numvars$ and $\vv{0} \leq \vv{w} < \vv{1}q$.
   As $x^{\vv{u}} = x^{\vv{v}q} x^{\vv{w}} \in \idealb^{[q]}$, we have $x^{\vv{w}} \in ( \idealb^{[q]}: x^{\vv{v}q}) = (\idealb:x^{\vv{v}})^{[q]}$, where the equality follows from the fact that $\ringR$ is free over $\ringR^q$.
   Applying the $q$-th root operation to this inclusion and observing that $\ideal{x^{\vv{w}}}^{[1/q]} = \ideal{1}$, due to the bounds on $\vv{w}$ noted above, we see that $ (\idealb: x^{\vv{v}}) = \ideal{1}$.
   Therefore, $x^{\vv{v}} \in \idealb$, so $x^{\vv{v}} \in \mon(\idealb) = \idealc$, and we conclude that $x^{\vv{u}} \in \langle x^{\vv{v}q} \rangle \subseteq \idealc^{[q]}$.
\end{proof}

% \pedro[inline]{
%    We can also make the argument more explicit (but longer) and avoid $[1/q]$-th powers:
%    As $x^{\vv{u}} = x^{\vv{v}q} x^{\vv{w}} \in \idealb^{[q]}$, we can write
%    \[x^{\vv{v}q} x^{\vv{w}} = \sum_i f_i g_i^q\]
%    for some $f_i \in \ringR$ and $g_i \in \idealb$.
%    Observing that $x^{\vv{w}}$ is part of a basis for $\ringR$ over $\ringR^q$, for each $i$ let $a_i^q\in \ringR^q$ be the $x^\vv{w}$-coordinate of $f_i$ in that basis.
%    Comparing $x^\vv{w}$-coordinates in the above equation we see that
%    \[x^{\vv{v}q} = \sum_i a_i^q g_i^q\]
%    and taking $q$-th roots we see that $x^\vv{v} \in \idealb$.
% }


Though we closely follow \cite{budur+mustata+saito.roots_bs_polys_monomial}, there are some notable differences between our results.   For example, in \cref{mon-operation-modulo-p: T}, we prove that the monomialization operator commutes with reduction to large characteristic in polynomial rings, generalizing \cite[Lemma 6.2]{budur+mustata+saito.roots_bs_polys_monomial}, which concerns a related operator in certain localizations of polynomial rings.  To accomplish this, we require some standard, but technical, results from the framework that supports reduction to prime characteristic; due to this, we also choose to work generally when reducing to prime characteristic.

\pedro{Not sure I understand this sentence. Is ``generally'' being used for ``globally''?}
\daniel{Besides globally (as in, not looking at monomialization in local rings, I also meant that we aren't just reducing ideals in $\QQ[x]$ modulo $p$, which is what I think they focus on in that paper.  Feel free to remove/restate this.}

We also provide examples illustrating that the uniformity properties established here for the $\mu$-invariants attached to a monomial ideal are strictly stronger than the ones for their $\nu$-counterparts established in \loccit, both over a field of fixed positive characteristic, and when reducing to positive characteristic.  

\subsection{Reducing to monomial pairs}

In what follows, we extend our use of the term (\emph{small}) \emph{compatible pair}, and say that a pair $(\matA, \mathcal{C})$ consisting of a monomial matrix $\matA$ with $\numvars$ rows, and a collection $\mathcal{C}$ of monomials in the ambient variables $x = x_1, \ldots, x_{\numvars}$, is \emph{compatible} (and \emph{small}) if for some (equivalently, for every) field $\LL$, the pair of ideals $(\ideala, \idealc)$ is  compatible (and small),  where $\ideala$ is the monomial ideal of $\LL[x]$ associated to $\matA$, and $\idealc = \mathcal{C} \LL[x]$ is the monomial ideal generated by $\mathcal{C}$.

\begin{theorem}
\label{reduce to diagonal general: T}
Consider a compatible pair $(\matA, \mathcal{C})$, where $\matA$ is a monomial matrix with $m$ rows, and $\mathcal{C}$ is a collection of monomials in the variables $x = x_1, \ldots, x_\numvars$.    Then, there exist monomial pairs $(\matA_1, \vv{u}_1), \ldots, (\matA_{\ell}, \vv{u}_{\ell})$, all of which are small when $(\matA, \mathcal{C})$ is, with the following properties\textup:  Each $\matA_i$ either equals $\matA$, or can be obtained from $\matA$ by deleting some of its rows, and if $\kk$ is a field of characteristic $p>0$, and $(\ideala, \idealc)$ is the compatible pair of ideals of $\kk[x]$ associated to $(\matA, \mathcal{C})$, then 
\begin{align*}
\nu(\ideala, \idealc, p^e) & = \max  \val \IP(\matA_i, \vv{u}_i, p^e)  \\ 
\mu(\ideala, \idealc, p^e) & = \max  \val \IP_p(\matA_i, \vv{u}_i, p^e) 
\end{align*}
for every positive integer~$e$.  Finally, there exists a single pair $(\matA_i, \vv{u}_i)$ that achieves the maximum in the expression for $\mu(\ideala, \idealc, p^e)$ for all such $e$.
\end{theorem}

\begin{proof}  
We will start by considering the special case where $\mathcal{C}$ corresponds to a nonzero point $\vv{v} \in \NN^\numvars$, in the sense that $\mathcal{C} = \{ x_i^{v_i} : v_i \neq 0 \}$. Without loss of generality, we may assume that exactly the first $t$ coordinates of the point $\vv{v}$ are nonzero, so that $\mathcal{C} = \{x_1^{v_1}, \ldots, x_t^{v_t}\}$, and the truncated point ${\vv{u}} = (v_1, \ldots, v_t) \in \NN^t$ is positive.  

Let $\matB$ be the matrix consisting of the first $t$ rows of $\matA$.  If $\LL$ is an arbitrary field, and $(\ideala, \idealc)$ is the radically compatible pair in $\LL[x]$ associated to $(\matA, \mathcal{C})$, then $\ideala \subseteq \sqrt \idealc = \ideal{x_1, \ldots, x_t}$, which shows that every monomial generator of $\ideala$ is divisible by some $x_i$ with $1 \leq i \leq t$, and hence, that every column of $\matB$ is nonzero. Thus,  $\matB$ is a monomial matrix, and $(\matB, {\vv{u}})$ is a monomial pair.
Similarly, if $(\matA, \mathcal{C})$ is small, then every monomial generator of $\ideala$ is a multiple of some $x_i^{v_i}$ for some $1 \leq i \leq t$, and so $(\matB, \vv{u})$ is small.  Regardless, when $\LL=\kk$ is a field of characteristic $p>0$ it is obvious that $\nu(\ideala, \idealc, p^e) = \val \IP (\matB, \vv{u}, p^e)$ and $\mu(\ideala, \idealc, p^e) = \val \IP_p(\matB, \vv{u}, p^e)$ for all $e$.

We now consider the case where $\mathcal{C}$ is general.   According to \cite[Lemma 5.18]{miller+sturmfels.combinatorial_CA},  if $\LL$ is an arbitrary field, then one may decompose the monomial ideal $\mathcal{C} \LL[x]$ as
%
\begin{equation}
\label{irreducible-decomposition: e}
 \mathcal{C} \LL[x] = \mathcal{C}_1 \LL[x] \cap \cdots \cap \mathcal{C}_{\ell} \LL[x]
 \end{equation}
%
where each set of monomials $\mathcal{C}_i = \{ x_s^{v_s(i)} : v_s(i) \neq 0 \}$ is associated to the nonzero point $\vv{v}_i = (v_1(i), \ldots, v_\numvars(i)) \in \NN^\numvars$. Furthermore, the points $\vv{v}_1, \ldots, \vv{v}_{\ell}$ arising in this way depend only on $\mathcal{C}$, but are independent of the choice of field $\LL$.  In addition, as the pair $(\matA, \mathcal{C})$ is radically compatible, then so is each pair $(\matA, \mathcal{C}_i)$.

By the special case considered above, for each $1\le i \le \ell$ there is a pair $(\matA_i, \vv{u}_i)$ such that, when $\LL=\kk$ is a field of characteristic $p>0$, then $\nu(\ideala, \idealc_i, p^e) = \val \IP(\matA_i, \vv{u}_i, p^e)$ and $\mu(\ideala, \idealc_i, p^e) = \val \IP_p(\matA_i, \vv{u}_i, p^e)$ for every positive integer $e$, where $\idealc_i = \mathcal{C}_i \LL[x]$.    It follows from this, \eqref{irreducible-decomposition: e}, and the fact that standard Frobenius powers commute with intersection in $\kk[x]$---since finite intersections commute with extensions under flat maps \cite[Theorem~7.4(ii)]{matsumura}, and the Frobenius is flat over $\kk[x]$---that
\pedro{Maybe include reference?} 
\daniel{I included one to paper in which fractional Frobenius powers were first defined.  But, it is overkill, since it deals with arbitrary intersections.  In this case, we only need to deal with finitely many terms in the intersection.  If you know of an reference for the fact that such intersections commute with flat base change, then we would only need to remind the reader that Frobenius is flat in this case}
\pedro{Sounds good; I did that.}
%
\[ \mu(\ideala, \mathfrak{c}, p^e) = \max  \mu(\ideala, \idealc_i, p^e)  = \max \val \IP_p(\matA_i, \vv{u}_i, p^e) \] and likewise for $\nu(\ideala, \mathfrak{c}, p^e)$.  Finally,  \Cref{cor: mu comparison} guarantees that, in the case of $\mu(\ideala, \mathfrak{c}, p^e)$, there is a single such index that achieves this maximum for every $e$.
\end{proof}

\begin{remark}
\label{lifting pairs: R}
{Our proof of} \Cref{reduce to diagonal general: T} is explicit, in the sense that the monomial pairs $(\matA_1, \vv{u}_1), \ldots, (\matA_{\ell}, \vv{u}_{\ell})$ that it exhibits correspond to the components of the combinatorial decomposition \eqref{irreducible-decomposition: e}.  Nevertheless, there are other valid choices of such pairs that are of theoretical interest.
For instance,  \Cref{lifted-programs: L} shows that one may always choose pairs with $\matA_i=\matA$ for all $1 \leq i \leq \ell$.
\end{remark}

\begin{theorem}%[Reduction to diagonal ideals]
   \label{reduce-to-monomial-case: T}
   Given a radically compatible pair of ideals $(\ideala, \idealb)$ of $\kk[x]$, with $\kk$ a field of characteristic $p>0$, and $\ideala$ the monomial ideal associated to a monomial matrix $\matA$, there exist positive points $\vv{u}_1, \ldots, \vv{u}_{\ell} \in \ZZ^\numvars$ such that
\begin{align*} 
\nu(\ideala, \idealb, p^e) = \nu(\ideala, \mon(\idealb), p^e) & = \max \val \IP(\matA,\vv{u}_i, p^e) \\ 
\mu(\ideala, \idealb, p^e) = \mu(\ideala, \mon(\idealb), p^e) & = \max \val \IP_p(\matA,\vv{u}_i, p^e)
\end{align*}
%
for every natural number $e$.  Furthermore, there exists a single positive point $\vv{u}_i$ that achieves the maximum in the expression for $\mu(\ideala, \idealb, p^e)$ for all such $e$.
\end{theorem}

\begin{proof} 
   Set $\idealc = \mon(\idealb)$.  Since $\ideala$ is monomial, a (Frobenius) power of $\ideala$ sits in~$\idealb^{[p^e]}$ if and only if it sits in $\mon(\idealb^{[p^e]})$, which equals $\idealc^{[p^e]}$ by \Cref{frobenius-powers+mon-commute: L}.  Consequently, $\nu(\ideala, \idealb, p^e) = \nu(\ideala, \idealc, p^e)$ and $\mu(\ideala, \idealb, p^e) = \mu(\ideala, \idealc, p^e)$ for every $e$.  Finally, if we fix a set of monomials $\mathcal{C}$ in $x = x_1, \ldots, x_\numvars$ such that $\mathcal{C} \kk[x] = \idealc$, then the theorem follows from applying \Cref{reduce to diagonal general: T} and \Cref{lifting pairs: R} with the compatible pair $(\matA, \mathcal{C})$.
   \end{proof}

\Cref{reduce-to-monomial-case: T} was established in \cite[Section~4]{budur+mustata+saito.roots_bs_polys_monomial} for $\nu$-invariants, and our argument follows the one presented there.  However, \Cref{reduce-to-monomial-case: T} allows for the possibility that the point $\vv{u}_i$ corresponding to the maximum in the formula for $\nu(\ideala, \idealb, p^e)$ may  depend on $e$, and as we see in \Cref{less uniformity for nu: E}, it sometimes necessarily does.  Thus, in this sense, the $\mu$-variants enjoy stronger uniformity properties than the $\nu$-invariants.


\begin{example} 
\label{less uniformity for nu: E}
Let $\kk$ be a field of characteristic $p \equiv 3 \bmod 4$. Consider the ideals $\ideala = \langle x^4, y^4 \rangle$ and $\idealb = \mon(\idealb) = \ideal{x^5, x^3 y, y^3} = \ideal{x^3, y^3} \cap \ideal{x^5, y}$ of $\kk[x,y]$.  Let $\matA$ be the $2 \times 2$ diagonal matrix with $4$ in each diagonal entry, $\vv{u}_1=(3,3)$, and $\vv{u}_2=(5,1)$.  
Then 
\[ \nu(\ideala, \idealb, p^e) = \max \{ \val \IP(\matA,\vv{u}_1, p^e), \val \IP(\matA, \vv{u}_2, p^e) \} \] and \Cref{max depends on p and e: E} tells us both that this maximum value equals $(3p^e-1)/2$, and that the integer program achieving this maximum alternates with $e$.

Furthermore, it is not hard to see that there is no positive point $\vv{v} \in \NN^2$ such that $\val \IP(\matA, \vv{v}, p^e) = (3p^e-1)/2 = \nu(\ideala, \idealb, p^e)$ for every $e$, at least when $p \equiv 3 \bmod 4$.  Indeed, \Cref{max depends on p and e: E} implies that an equality $\val \IP(\matA, \vv{v}, p^e) = (3p^e-1)/2$ for all $e$ would force an equality $\ft{\matA}{\vv{v}} = 3/2$, and so $\vv{v}$ would have to be one of $(1,5), (2,4), (3,3), (4,2)$, or $(5,1)$.  However, as $p \equiv 3 \bmod 4$,  \Cref{concrete-solution-to-LP-IP: E}   would then tell us that, in each case, $\val \IP(\matA, \vv{v}, p^e) = (3p^e-3)/2$ for infinitely many $e$.
\end{example}


 
\subsection{Reduction to prime characteristic}

We now briefly recall the process of reduction to prime characteristic, in the context of polynomial rings.

To start, we recall some fundamental facts, both of which may be thought of as corollaries of Noether Normalization.  We provide formal references for their proofs, though the reader may also consult the first author's thesis \cite[Chapter~3]{hernandez.thesis} for more details.

\begin{remark}[Generic freeness]\label{generic-freeness}
   Consider a Noetherian domain $\ringA$, and a finitely generated $\ringA$-algebra $\ringS$.
   Generic freeness states that if $M$ is any finitely generated $\ringS$-module, then there exists a nonzero element  $\ell \in \ringA$ such that $\ringA[\ell^{-1}] \otimes_\ringA M$, the localization of $M$ at $\ell$, is a free $\ringA[\ell^{-1}]$-module \cite[Theorem~24.1]{matsumura}.
\end{remark}

\begin{remark}[Maximal ideals of domains finitely generated over $\ZZ$]
   \label{maximal ideals: R}
   Let $\ringA$ be a domain of characteristic zero that is finitely generated as an algebra over $\ZZ$.
   Then every maximal ideal of $\ringA$ contains a positive prime integer,
   \pedro{The previous claim follows from \cite[V.3.4, Theorem~3(ii)]{bourbaki.commalg}, and does not depend on $\ringA$ being a domain.} \daniel{OK.  In the proof I know, I thought this was important.}  
    and all but finitely many prime integers are contained in some maximal ideal of $\ringA$.
    \pedro{Does anyone know a reference for this in the standard literature?} 
    \daniel{I don't.  Mel and Craig have a \emph{Tight closure in equal characteristic zero} paper, and there is a lot of stuff in there, but I haven't looked at that since I was writing my thesis, and it all seemed overly technical at the time}
   Furthermore, the quotient of $\ringA$ by any maximal ideal is a finite field \cite[V.3.4, Corollary~1]{bourbaki.commalg}.
\end{remark}

\begin{definition}[Reduction to prime characteristic]
   \label{reduction: D}
   Let $\kk$ be a field of characteristic zero, and set $\ringR = \kk[x]$.
   If $\ringA$ is a finitely generated $\ZZ$-subalgebra of $\kk$, then we set $\ringR_\ringA = \ringA[x]$, and if $I$ is an ideal of $\ringR$, then $I_\ringA$ denotes any ideal of $\ringR_\ringA$ that extends to $I$ under the inclusion $\ringR_\ringA \hookrightarrow \ringR$.   We call such an ideal $I_\ringA$ an $\ringA$-model of $I$, and when such an ideal exists, we say that $\ringA$ \emph{supports} {the model $I_\ringA$ of $I$}.\footnote{Note that every ideal $I$ of $\ringR$ has an $\ringA$-model for a suitable $\ringA$: one may take $\ringA$ to be the $\ZZ$-subalgebra of $\kk$ generated by all coefficients appearing in a finite generating set for $I$.}

   If $I_\ringA$ exists and $\idealm \in \mspec(\ringA)$, then $I_\ringA(\idealm)$ is the extension of $I_\ringA$ to the ring $\ringR_{\ringA}(\idealm) \coloneqq (\ringA/\idealm)[x]$ under the quotient map $\ringR_\ringA \to \ringR_\ringA(\idealm)$.
   As noted in \Cref{maximal ideals: R}, $\ringA/\idealm$ is a finite field, and for this reason we may regard $I_\ringA(\idealm)$ as a prime characteristic model of~$I$.
   Furthermore, as $\idealm \in \mspec(\ringA)$ varies we obtain models $I_\ringA(\idealm)$ of $I$ over finite fields of all but finitely many characteristics.
\end{definition}

The following application of generic freeness forms the technical basis for the process of reduction to prime characteristic, and is well known to experts.  

\begin{proposition}
   \label{comparing expansions:  P}
   Suppose $\ringA$ is a Noetherian domain.
   Given ideals $I \subseteq J$ of $\ringA[x]$, there exists a nonzero element $\ell \in \ringA$ with the following property\textup:
  If $\ringB$ is any $\ringA[\ell^{-1}]$-algebra, then the canonical $\ringB$-linear map  $\ringB \otimes_\ringA (J/I) \to \ringB[x]/I \ringB[x]$ defined by $b \otimes (f+I) \mapsto bf+I \ringB[x]$ is injective, and hence, induces an isomorphism \[ \ringB \otimes_\ringA (J/I) \cong J \ringB[x] / I \ringB[x].\]    
  Furthermore, and significantly, if $I \ringB_{\circ}[x]=J \ringB_{\circ}[x]$ for some $\ringA[\ell^{-1}]$-algebra $\ringB_{\circ}$, then $I \ringB[x]=J \ringB[x]$ for every $\ringA[\ell^{-1}]$-algebra $\ringB$.
  \end{proposition}

\begin{proof}
   By generic freeness, we may fix a nonzero element $\ell \in \ringA$ such that each of the tensor products $\ringA[\ell^{-1}] \otimes_\ringA (J/I)$ and $\ringA[\ell^{-1}] \otimes_\ringA (\ringA[x]/J)$ is free over $\ringA[\ell^{-1}]$.
   Let $0 \leq \rho \leq \infty$ denote the rank of the free $\ringA[\ell^{-1}]$-module $\ringA[\ell^{-1}] \otimes_\ringA (J/I)$, and let $\ringB$ be an $\ringA[\ell^{-1}]$-algebra.

Applying the functor $M \mapsto \ringA[\ell^{-1}] \otimes_\ringA M$ to the short exact sequence
\[ 0 \to J/I \to \ringA[x] / I \to \ringA[x]/J \to 0 \] 
yields a short exact sequence of $\ringA[\ell^{-1}]$-modules that splits, as the last term is free.
Split exactness and free rank are preserved by base change, so applying the functor $L \mapsto \ringB \otimes_{\ringA[\ell^{-1}]} L$ to this split exact sequence then yields the split exact sequence
\[ 0 \to \ringB \otimes_\ringA (J/I) \to \ringB \otimes_\ringA (\ringA[x]/I) \to \ringB \otimes_\ringA (\ringA[x]/J) \to 0 \] 
of $\ringB$-modules, which starts with a free $\ringB$-module of rank $\rho$.  
To conclude the proof, note that the composition of the injective map $\ringB \otimes_\ringA (J/I)  \to \ringB \otimes_\ringA (\ringA[x]/I)$ with the canonical isomorphism $\ringB \otimes_\ringA (\ringA[x]/I) \cong \ringB[x]/I \ringB[x]$ is the canonical map in the statement, and that the free rank $\rho$ of the first term is independent of $\ringB$.
\end{proof}

\begin{remark}
   Let $\kk$ be a field of characteristic zero, $I$ an ideal of $\ringR=\kk[x]$, and $\ringA$ a finitely generated $\ZZ$-subalgebra of $\kk$ that supports a model $I_\ringA$ of $I$.  
According to \Cref{comparing expansions:  P}, there exists a nonzero element $\ell \in \ringA$ such that 
\[ \ringB \otimes_\ringA I_\ringA  \cong I_\ringA \ringB[x] \quad \text{and} \quad \ringB \otimes_\ringA (\ringR_\ringA / I_\ringA)  \cong \ringB[x]/I_\ringA \ringB[x] \] 
for every $\ringA[\ell^{-1}]$-algebra $\ringB$.  In particular, if we take $\ringB=\kk$, then
\[ \kk \otimes_\ringA I_\ringA  \cong I_\ringA \ringR = I  \quad \text{and} \quad \kk \otimes_\ringA (\ringR_\ringA / I_\ringA)  \cong \ringR/I. \] 
On the other hand, if $\mathcal{U} = \{ \idealm \in \mspec(\ringA) : \operatorname{char}(\ringA/\idealm) \nmid \ell \}$,  a dense open subset of $\mspec(\ringA)$, 
 then for each $\idealm \in \mathcal{U}$, we may take $\ringB=\ringA/\idealm$ above to see that 
\[ (\ringA/\idealm) \otimes_\ringA I_\ringA  \cong I_\ringA \ringR_\ringA(\idealm) = I_\ringA(\idealm)  \text{ and } \kk \otimes_\ringA (\ringR_\ringA / I_\ringA)  \cong \ringR_\ringA(\idealm) /I_\ringA(\idealm). \] 

These isomorphisms illustrate that  \Cref{reduction: D} is consistent with other standard notions of reduction to prime characteristic considered in the literature.
\pedro{Maybe give a reference for one such treatment of reduction to positive characteristic}
For example, the conditions $I_\ringA \ringR = I$ on $I_\ringA$ and $\kk \otimes_\ringA I_\ringA \cong I$ are equivalent, and though $I_\ringA \ringR_\ringA(\idealm)$  may differ from $(\ringA/\idealm) \otimes_\ringA I_\ringA$ for some $\idealm \in \mspec(\ringA)$, they are isomorphic for all $\idealm$ in some dense open subset of $\mspec(\ringA)$.
In particular, every result below concerning the extensions $I_\ringA(\idealm) =I_\ringA \ringR_\ringA(\idealm)$ for all $\idealm$ in such a subset of $\mspec(\ringA)$ is valid for $(\ringA/\idealm) \otimes_\ringA I_\ringA$ for all $\idealm$ in another such subset of $\mspec(\ringA)$.
\end{remark}

\begin{corollary}
\label{reduction basics: C}
Let $\kk$ be a field of characteristic zero.  Consider ideals  $I$ and $J$ of the polynomial ring $\ringR = \kk[x]$, and let $\ringA$ be a finitely generated $\ZZ$-subalgebra of $\kk$ that supports $\ringA$-models $I_\ringA$ of $I$, and $J_\ringA$ of $J$.   

\begin{enumerate}[$(1)$]
\item \label{different models of same ideal}
If $I=J$, that is, if $I_\ringA$ and $J_\ringA$ are $\ringA$-models of the same ideal, then $I_\ringA(\idealm) = J_\ringA(\idealm)$ for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$.
\item \label{reduction preserves being monomial} If $I$ is a monomial ideal generated by a collection of monomials $\mathcal{C}$, then $I_\ringA(\idealm) = \mathcal{C} \ringR_\ringA(\idealm)$ for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$.
\item \label{reduction preserves compatibility} \hl{If $(I,J)$ is a \textup(small\textup) compatible pair, then so are almost all of its reductions.  More precisely, if $I^t \subseteq J$ for some natural number $t$, then $I_\ringA(\idealm)^t \subseteq J_\ringA(\idealm)$ for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$.}
%\item \label{intersection of models} \hl{$I_\ringA \cap J_\ringA$ is an $\ringA$-model of $I \cap J$, and $(I_\ringA \cap J_\ringA) \ringR_\ringA(\idealm) = I_\ringA(\idealm) \cap J_\ringA(\idealm)$ for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$.} \daniel{Unnecessary?  Proof commented out}
\end{enumerate}
\end{corollary}

\begin{proof}
   For the first assertion, set $L=I_\ringA + J_\ringA$, and choose $\ell \in \ringA \setminus \{0\}$ so that the conclusion of \Cref{comparing expansions:  P} holds for the containments $I_\ringA \subseteq L$ and $J_\ringA \subseteq L$.
   Given that the extension of each of $I_\ringA$, $J_\ringA$, and $L$ to $\ringR$ equals $I$, setting $\ringB_{\circ} = \kk$ in \Cref{comparing expansions:  P} implies that their extensions to $\ringB[x]$ agree for every $\ringA[\ell^{-1}]$-algebra~$\ringB$.
   Thus, if $\mathcal{U} = \{ \idealm \in \mspec(\ringA) : \operatorname{char}(\ringA/\idealm) \nmid \ell \}$,  a dense open subset of $\mspec(\ringA)$, 
 then for each $\idealm \in \mathcal{U}$, we may set $\ringB=\ringA/\idealm$ above to see that $I_\ringA(\idealm) = J_\ringA(\idealm)$.

 In the context of the second assertion, both $I_\ringA$ and $\mathcal{C}\ringR_\ringA$ are $\ringA$-models for $I$, and in the context of the third, if $I^t \subseteq J$, then both $J_\ringA$ and $I_\ringA^t +J_\ringA$ are $\ringA$-models for $J=I^t + J$.
 Thus, the second and third assertions follow from the first. 
\end{proof}

\begin{example}
   The dense open set referenced in \Cref{reduction basics: C}\ref{reduction preserves being monomial} may not be all of $\mspec(\ringA)$, even when $\ringA=\ZZ$.
   For an extreme example,  note that the ideal $I_{\ZZ} = \ideal{2x, 3x+y} \subseteq \ZZ[x,y]$ is a $\ZZ$-model of $I=\ideal{ x, y } \subseteq \QQ[x,y]$, and though $I_{\ZZ}( \ideal{p} )$ is what one expects when $p \neq 2$, the reduction $I_{\ZZ}(\ideal{2})  = \ideal{ x+y } \subseteq \FF_2[x,y]$ is especially far from being a monomial ideal, given that it contains no monomials.  
\end{example}

\begin{proposition}
   \label{colon mod p: P}
   {Let $\ringA$ be a Noetherian domain.
   Given ideals $I$ and $J$ of $\ringA[x]$, there exists a nonzero element $\ell \in \ringA$ such that}
   \[
      (J:_{\ringA[x]} I)\ringB[x] = (J \ringB[x] :_{\ringB[x]} I \ringB[x])
   \]
   for any $\ringA[\ell^{-1}]$-algebra $\ringB$.
\end{proposition}

\begin{proof}  \hl{As this result is well known, we will only consider the case that $I$ is principally generated by an element $f \in \ringA[x]$.  The general case, which requires an additional, standard application of generic freeness, is left to the reader.}


By  \Cref{comparing expansions: P}, there exists a nonzero element $\ell \in \ringA$ such that \[  \ringB \otimes_\ringA ((f \ringA[x] + J)/J)  \cong (f \ringB[x] + J \ringB[x])/J \ringB[x]  \] for every  $\ringA[\ell^{-1}]$-algebra $\ringB$.  Thus, the exact sequence of $\ringA$-modules 
\[  
0 \to (J :_{\ringA[x]} f) \to \ringA[x] \stackrel{f}{\longrightarrow} (f \ringA[x] + J)/J \to 0
\]
induces an exact sequence of $\ringB$-modules 
\[
\ringB \otimes_\ringA (J :_{\ringA[x]} f) \to \ringB[x] \stackrel{f}{\longrightarrow} (f \ringB[x] + J \ringB[x])/J \ringB[x] \to 0
\]
and so $(J :_{\ringA[x]} f) \ringB[x]$, the image of the first map, coincides with $(J \ringB[x] :_{\ringB[x]} f)$.
\end{proof}

\begin{corollary}[The formation of colon ideals commutes with most reductions to prime characteristic]
   \label{colon mod p: C}
 {Let $\kk$ be a field of characteristic zero, and $I$ and $J$ be ideals of $\ringR=\kk[x]$.
   If $\ringA$ is a finitely generated $\ZZ$-subalgebra of $\kk$ that supports models $I_\ringA$ and $J_\ringA$, then  $(J_\ringA :_{\ringR_\ringA} I_\ringA)$ is an $\ringA$-model of $(J:_\ringR I)$.
   Furthermore,} 
   \[ %((I :_\ringR f))_\ringA(\idealm) \coloneqq 
   (J_\ringA :_{\ringR_\ringA} I_\ringA) \ringR_\ringA(\idealm) = (J_\ringA(\idealm) :_{\ringR_\ringA(\idealm)} I_\ringA(\idealm)) \]
   for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$.
    \end{corollary}

 \begin{proof}
    Suppose that $\ell \in \ringA \setminus \{0\}$ satisfies the conclusion of \Cref{colon mod p: P} relative to the ideals $I_\ringA$ and $J_\ringA$ of $\ringR_\ringA=\ringA[x]$.  Our claim then follows from invoking \Cref{colon mod p: P} with $\ringB=\kk$, and with $\ringB=\ringA/\idealm$ for every point $\idealm$ in the dense open set $\mathcal{U} = \{\idealm \in \mspec(\ringA) : \operatorname{char}(\ringA/\idealm) \nmid \ell\}$ of $\mspec(\ringA)$. 
%     We may then take $\ringB=\kk$ in \Cref{colon mod p: P} to see that $(J_\ringA:_{\ringR_\ringA} I_\ringA)\ringR = (J :_{\ringR} I)$, which shows that $(J_\ringA :_{\ringR_\ringA} I_\ringA)$ is an $\ringA$-model for $(J :_\ringR I)$.
%    Now, if $\mathcal{U} = \{\idealm \in \mspec(\ringA) : \operatorname{char}(\ringA/\idealm) \nmid \ell\}$, then for each $\idealm \in \mathcal{U}$ we may instead take $\ringB=\ringA/\idealm$ in \Cref{colon mod p: P} to see that
%    \[
%       (J_\ringA:_{\ringR_\ringA} I_\ringA)\ringR_\ringA(\idealm) = (J_\ringA(\idealm) :_{\ringR_\ringA(\idealm)} I_\ringA(\idealm)).
%       \qedhere
%    \]
\end{proof}

In \Cref{all monomial colons: C} {below, we will show that, once $J$ is fixed, the element} $\ell$ in \Cref{colon mod p: P} can be chosen independently of $I$, {as long as $I$ is a principal monomial ideal.   In our proof, we will use a basic property of colon ideals:  If $J$ is an ideal of an arbitrary commutative ring $\ringR$, then}
\begin{equation}
\label{iterated colon: e}
 (J: ab) = ((J: a): b) \text{ for every } a,b \in \ringR.
\end{equation}

\begin{corollary}
   \label{all monomial colons: C} 
   Let $\ringA$ be a Noetherian domain.
   Given an ideal $J$ of $\ringA[x]$, there exists a nonzero element $\ell \in \ringA$ such that
   \[ (J:_{\ringA[x]} x^{\vv{u}}) \ringB[x] = (J \ringB[x]:_{\ringB[x]} x^{\vv{u}})\]
   for every $\ringA[\ell^{-1}]$-algebra $\ringB$ and every monomial $x^{\vv{u}} \in \ringA[x]$.   
\end{corollary}

\begin{proof}
   As $\ringA[x]$ is Noetherian, there exists $t \in \NN$ such that $(J:_{\ringA[x]}x_i^t)=(J:_{\ringA[x]}x_i^{t+1})$ for each $1 \leq i \leq \numvars$.  Define $\phi:  \NN^\numvars \to \NN^\numvars$ by $\vv{u} \mapsto (\min\{u_1, t\}, \ldots, \min \{u_\numvars,t\})$.  Our choice of $t$ and repeated applications of \eqref{iterated colon: e} then show that $(J:_{\ringA[x]}x^\vv{u}) = (J:_{\ringA[x]}x^{\phi(\vv{u})})$.
   If $\ell$ satisfies the conclusion of \Cref{colon mod p: P} for the finitely many colon ideals $(J:_{\ringA[x]}x_i^t)=(J:_{\ringA[x]}x_i^{t+1})$, and $\ringB$ is an $\ringA[\ell^{-1}]$-algebra, then
 \[
       (J \ringB[x]:_{\ringB[x]} x_i^{t}) = (J:_{\ringA[x]}x_i^{t})\ringB[x]
                               = (J:_{\ringA[x]}x_i^{t+1})\ringB[x]
                               =(J \ringB[x]:_{\ringB[x]} x_i^{t+1})
   \]
   for each $i$, and as above, we may conclude that $(J \ringB[x]:_{\ringB[x]}x^\vv{u}) = (J \ringB[x]:_{\ringB[x]}x^{\phi(\vv{u})})$.

   After replacing $\ell$ with a nonzero multiple, we may also assume that the conclusion of \Cref{colon mod p: P} holds for the finitely many ideals $(J:_{\ringA[x]} x^{\phi(\vv{u})})$ of $\ringA[x]$, and so
\[ (J:_{\ringA[x]} x^{\vv{u}})\ringB[x] = (J:_{\ringA[x]} x^{\phi(\vv{u})})\ringB[x] = (J \ringB[x]:_{\ringB[x]} x^{\phi(\vv{u})}) = (J \ringB[x]:_{\ringB[x]} x^{\vv{u}}). \qedhere\]
\end{proof}

\begin{theorem}[$\mon$ operation commutes with generic extensions]
\label{mon-operation-general-expansion: T}
Let $\ringA$ be a Noetherian domain.  Given an ideal $J$ of $\ringA[x]$, there exists $\ell \in \ringA \setminus \{0\}$ such that 
\[ \mon(J) \ringB[x] = \mon(J \ringB[x])\]
for every $\ringA[\ell^{-1}]$-algebra $\ringB$ {that happens to be a field}.
\end{theorem}

\begin{proof}
   The identity $(J:_{\ringA[x]} x^{\vv{u}}) = (J:_{\ringA[x]} x^{\phi(\vv{u})})$ established in the proof of \Cref{all monomial colons: C} implies that there are only finitely many ideals of the form $(J:_{\ringA[x]} x^{\vv{u}})$.
   Thus, we may choose $\ell \in \ringA\setminus \{0\}$ that satisfies the conclusion of \Cref{comparing expansions:  P} for every containment $(J:_{\ringA[x]} x^{\vv{u}}) \subseteq \ringA[x]$, as well as the conclusion of \Cref{all monomial colons: C}.

   By \Cref{single multiplier: L}, we may fix $a \in \ringA \setminus \{0\}$ such that $x^{\vv{u}} \in \mon(J)$ if and only if $ax^{\vv{u}} \in J$.
   After replacing $\ell$ with $a \ell$, we may assume that $a$ is a unit in $\ringA[\ell^{-1}]$.
   For the remainder of this proof, let $\ringB$ be an $\ringA[\ell^{-1}]$-algebra that happens to be a field.

   If $x^{\vv{u}} \in \mon(J)$, then $a x^{\vv{u}} \in J \subseteq J \ringB[x]$.
   Furthermore, as $a$ is a unit in $\ringA[\ell^{-1}]$, it must map to a unit in $\ringB$, which allows us to conclude that $x^{\vv{u}} \in \mon(J \ringB[x])$.

   Now suppose that $x^{\vv{u}} \in \mon(J \ringB[x])$.
   As $\ringB$ is a field, this simply means that $x^{\vv{u}} \in J \ringB[x]$, and \Cref{all monomial colons: C} allows us to rewrite this as
   \[(J:_{\ringA[x]} x^{\vv{u}}) \ringB[x] = (J \ringB[x] :_{\ringB[x]} x^{\vv{u}}) = \ringB[x].\]
   \Cref{comparing expansions:  P} and our choice of $\ell$ then imply that \[(J:_{\ringA[x]} x^{\vv{u}}) \ringA[\ell^{-1}][x] = \ringA[\ell^{-1}][x].\]
%   \pedro{or $\ringA[\ell^{-1}][x]$; I prefer the simpler notation} \daniel{OK.  I exchanged $\ringA[\ell^{-1},x] \leftrightarrow \ringA[\ell^{-1}][x]$}
   Thus, $\ell^n \in (J:_{\ringA[x]} x^{\vv{u}})$ for some $n$, so that $\ell^n x^{\vv{u}} \in J$, and hence $x^{\vv{u}} \in \mon(J)$.
\end{proof}

%In the same way that \Cref{colon mod p: P} implies \Cref{colon mod p: C}, 
\Cref{mon-operation-general-expansion: T} immediately implies the following result.

\begin{theorem}[The $\mon$ operation commutes with most reductions to prime characteristic]
   \label{mon-operation-modulo-p: T}
   Let $\kk$ be a field of characteristic zero and $I$ an ideal of $\ringR=\kk[x]$.
   If $\ringA$ is a finitely generated $\ZZ$-subalgebra of $\kk$ that supports an $\ringA$-model $I_\ringA$ of $I$, then $\mon(I_\ringA)$ is an $\ringA$-model for $\mon(I)$.
   Furthermore,
   \[ \mon(I_\ringA) \ringR_\ringA(\idealm) = \mon(I_\ringA(\idealm)) \]
   for every point $\idealm$ in some dense open subset of $\mspec(\ringA)$. \qed
\end{theorem}

We are now prepared to describe the behavior of the $\nu$ and $\mu$ invariants associated to a monomial ideal under reduction to prime characteristic.  We begin with a general fact that holds for all compatible pairs in characteristic zero, monomial or not.

\begin{proposition}
\label{general-compatible->smalll: P}
  Consider a compatible pair of ideals $(I,J)$ of $\kk[x]$, where $\kk$ is a field of characteristic zero. Let $t$ be the natural number such that $I^t \not \subseteq J$ but $I^{t+1} \subseteq J$, and set $L=(J: I^t)$.  Then $(I,L)$ is a small compatible pair, and given a finitely generated $\ZZ$-subalgebra $\ringA$ of $\kk$, and models $I_\ringA, J_\ringA$ and $L_\ringA$ for $I,J$ and $L$, respectively, there exists a dense open set $\mathcal{U} \subseteq \mspec(\ringA)$ such that
%
\[ \mu(I_\ringA(\idealm), J_\ringA(\idealm), p^e) = t p^e + \mu(I_\ringA(\idealm), L_\ringA(\idealm), p^e) \] 
%
for all $\idealm \in \mathcal{U}$ and $e \geq 1$.
\end{proposition}

\begin{proof}   Let $\ringA, I_\ringA, J_\ringA$, and $L_\ringA$ be as above.  A standard application of \Cref{comparing expansions:  P} shows that $I_\ringA(\idealm)^t \not \subseteq J_\ringA(\idealm)$ for all $\idealm$ in some dense open subset $\mathcal{U}$ of $\mspec(\ringA)$, and \Cref{reduction basics: C}\ref{reduction preserves compatibility} tells us that, after possible shrinking $\mathcal{U}$, we may also assume that $I_\ringA(\idealm)^{t+1} \subseteq J_\ringA(\idealm)$ for all $\idealm \in \mathcal{U}$. In addition,  \Cref{reduction basics: C}\ref{different models of same ideal}
 and \Cref{colon mod p: C} imply that we may further assume that 
 \[ L_\ringA(\idealm) = (J_\ringA(\idealm) : I_\ringA(\idealm)^t) \text{ for every $\idealm \in \mathcal{U}$}. \] 
 
 Replacing $\mathcal{U}$ with a dense open subset, we may even assume that the characteristic of $\ringA/\idealm$ is greater than $t+1$ for every $\idealm \in \mathcal{U}$, and the result then follows from \Cref{compatible to small compatible: L} with $p = \operatorname{char}(\ringA/\idealm)$, $\ideala = I_\ringA(\idealm), \idealb = J_\ringA(\idealm)$, and $\idealc = L_\ringA(\idealm)$.
 \end{proof}


\begin{theorem}
   \label{invariants associated to a monomial ideal in large characteristic: T}   
   Consider a compatible pair of ideals $(I,J)$ of $\ringR=\kk[x]$, where $\kk$ is a field of characteristic zero, and $I$ is the monomial ideal associated to a monomial matrix $\matM$.  Then there exists $t \in \NN$, small monomial pairs $(\matM, \vv{u}_1),  \ldots, (\matM, \vv{u}_{\ell}),$ and a function $(\ringA, I_\ringA, J_\ringA) \mapsto \mathcal{U}$  that associates to every finitely generated $\ZZ$-subalgebra $\ringA$ of $\kk$ supporting models $I_\ringA$ of $I$, and $J_\ringA$ of $J$, a dense open set $\mathcal{U} \subseteq \mspec(\ringA)$, with the following properties\textup:
   If $\idealm \in \mathcal{U}$ and $p = \operatorname{char}(\ringA/\idealm)$, then 
   \[
      \mu(I_\ringA(\idealm), J_\ringA(\idealm), p^e) = tp^e + \max \val \IP_p(\matM, \vv{u}_i, p^e) 
   \]
   for every positive integer $e$.
Furthermore, for each such $p$, there is a single pair $(\matM, \vv{u}_i)$ that achieves this maximum for every such $e$.  
\end{theorem}

\begin{proof}  Let $t \in \NN$ and $L = (J: I^t)$ be as in the statement of \Cref{general-compatible->smalll: P}, and let $\ringA, I_\ringA$, and $J_\ringA$ be as above.  \Cref{colon mod p: C} tells us that $L_\ringA \coloneqq (J_\ringA: I_\ringA^t)$ is an $\ringA$-model for $L$, and \Cref{general-compatible->smalll: P} then implies that
\begin{equation}
\label{step-1-mu-reduction: e}
\mu(I_\ringA(\idealm), J_\ringA(\idealm), p^e) = t p^e + \mu(I_\ringA(\idealm), L_\ringA(\idealm), p^e)
 \end{equation}
%
for all $e \geq 1$, and all points $\idealm$ in some dense open subset of $\mspec(\ringA)$.  In light of this, we now shift our attention to the  term $\mu(I_\ringA(\idealm), L_\ringA(\idealm), p^e)$ in \eqref{step-1-mu-reduction: e}.  

To start, recall that $I$ is the monomial ideal of $\kk[x]$ associated to the monomial matrix $\matM$, and fix a collection of monomials $\mathcal{C}$ in $x=x_1, \ldots, x_m$ such that $\mon(L) = \mathcal{C} \kk[x]$.   We may then fix monomial pairs $(\matM_1, \vv{u}_1), \ldots, (\matM_{\ell}, \vv{u}_{\ell})$ satisfying the conclusions of \Cref{reduce to diagonal general: T}, relative to $(\matM, \mathcal{C})$.  As $(\matM, \mathcal{C})$ corresponds to the small compatible pair $(I, L)$, each $(\matM_i, \vv{u}_i)$ may also be taken to be small, and by \Cref{lifting pairs: R} we may also assume that $\matM_i = \matM$ for each $1 \leq i \leq \ell$. 

Let $\idealm \in \mspec(\ringA)$, and consider the following analogous ``mod $\idealm$" statements:
%
\begin{equation}
\label{step-3-mu-reduction: e}
\text{$I_\ringA(\idealm)$ is the monomial ideal of $\ringR_\ringA(\idealm) = (\ringA/\idealm)[x]$ associated to $\matM$.}
\end{equation}
%
\begin{equation}
\label{step-2-mu-reduction: e}
\mon(L_\ringA(\idealm)) = \mathcal{C} \ringR_\ringA(\idealm).
\end{equation}


We claim that each of these statements hold for all points $\idealm$ in some dense open subset of $\mspec(\ringA)$.  For \eqref{step-3-mu-reduction: e}, this simply follows from  \Cref{reduction basics: C}\ref{reduction preserves being monomial}.  

For \eqref{step-2-mu-reduction: e},  \Cref{mon-operation-modulo-p: T} implies that $\mon(L_\ringA)$ is an $\ringA$-model for $\mon(L)$, and our choice of $\mathcal{C}$ guarantees that $\mathcal{C} \ringR_\ringA$ is another $\ringA$-model for $\mon(L)$.  In light of this redundancy, \Cref{reduction basics: C}\ref{different models of same ideal} implies that $\mon(L_\ringA) \ringR_\ringA(\idealm) = \mathcal{C} \ringR_\ringA(\idealm)$ for all $\idealm$ in some dense open subset of $\mspec(\ringA)$.  On the other hand, \Cref{mon-operation-modulo-p: T} also tells us that $\mon(L_\ringA) \ringR_\ringA(\idealm) = \mon(L_\ringA(\idealm))$ for all $\idealm$ in some dense open subset of $\mspec(\ringA)$, and combining this with the preceding observation, we conclude that \eqref{step-2-mu-reduction: e} also holds for all $\idealm$ in some dense open subset of $\mspec(\ringA)$.  

Thus, \eqref{step-1-mu-reduction: e}, \eqref{step-3-mu-reduction: e}, and \eqref{step-2-mu-reduction: e} hold simultaneously for all $\idealm$ in some dense open subset $\mathcal{U}$ of $\mspec(\ringA)$.  Fix a point $\idealm \in \mathcal{U}$, and note that
%
\[ \mu(I_\ringA(\idealm), L_\ringA(\idealm), p^e) = \mu(I_\ringA(\idealm), \mon(L_\ringA(\idealm)), p^e) = \mu(I_\ringA(\idealm), \mathcal{C} \ringR_\ringA(\idealm), p^e).\]
Indeed, the first equality follows from \eqref{step-3-mu-reduction: e} and \Cref{reduce-to-monomial-case: T}, and the second from \eqref{step-2-mu-reduction: e}.  It follows from this,  our choice of the $(\matM, \vv{u}_i)$, and \Cref{reduce to diagonal general: T}, that 
%
\[ \mu(I_\ringA(\idealm), L_\ringA(\idealm), p^e) = \mu(I_\ringA(\idealm), \mathcal{C} \ringR_\ringA(\idealm), p^e)  =  \max \val \IP_p(\matM, \vv{u}_i, p^e) \]
%
and that there is a pair $(\matM, \vv{u}_i)$ that achieves this maximum for every positive integer $e$.  Comparing this with \eqref{step-1-mu-reduction: e}
 then allows us to conclude our proof.
\end{proof}

A version of \Cref{invariants associated to a monomial ideal in large characteristic: T} concerning the behavior of $\nu$-invariants  under reduction to prime characteristic was established in \cite[Section~4]{budur+mustata+saito.roots_bs_polys_monomial}, and appears as \Cref{nu invariants associated to a monomial ideal in large characteristic: T} below.  Its proof is similar to that of \Cref{invariants associated to a monomial ideal in large characteristic: T}, and so is omitted.    

The main difference between  \Cref{invariants associated to a monomial ideal in large characteristic: T} and  \Cref{nu invariants associated to a monomial ideal in large characteristic: T} is that, in the latter, there is no reduction to case of small pairs, and as was the case with  \Cref{reduce-to-monomial-case: T}, the positive point $\vv{u}$ that realizes $\nu(I_\ringA(\idealm), J_\ringA(\idealm), p^e)$ is allowed to depend on $e$, and sometimes must, as illustrated by \Cref{less uniformity for nu: E}.

\begin{theorem}
   \label{nu invariants associated to a monomial ideal in large characteristic: T}   
   Consider a compatible pair of ideals $(I,J)$ of $\ringR=\kk[x]$, where $\kk$ is a field of characteristic zero, and $I$ is the monomial ideal associated to a monomial matrix $\matM$.  Then there exist monomial pairs $(\matM, \vv{u}_1),  \ldots, (\matM, \vv{u}_{\ell}),$ and a function $(\ringA, I_\ringA, J_\ringA) \mapsto \mathcal{U}$  that associates to every finitely generated $\ZZ$-subalgebra $\ringA$ of $\kk$ supporting models $I_\ringA$ of $I$, and $J_\ringA$ of $J$, a dense open set $\mathcal{U} \subseteq \mspec(\ringA)$, with the following property\textup:
   If $\idealm \in \mathcal{U}$, $p = \operatorname{char}(\ringA/\idealm)$, and $e$ is a positive integer, then 
   \[
      \nu(I_\ringA(\idealm), J_\ringA(\idealm), p^e) = \max \val \IP (\matM, \vv{u}_i, p^e).
      \qed
   \]
\end{theorem}

\newpage

{\small
\bibliographystyle{amsalpha}
\bibliography{bibdatabase}
}

\end{document}
